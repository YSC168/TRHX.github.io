<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TRHX&#39;S BLOG</title>
  
  <subtitle>ä¸€å…¥ IT æ·±ä¼¼æµ· ä»æ­¤å­¦ä¹ æ— ç»æœŸ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.itrhx.com/"/>
  <updated>2019-10-09T15:21:29.389Z</updated>
  <id>https://www.itrhx.com/</id>
  
  <author>
    <name>TRHX&#39;BLOG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python3 çˆ¬è™«å®æˆ˜ â€” å®‰å±…å®¢æ­¦æ±‰äºŒæ‰‹æˆ¿</title>
    <link href="https://www.itrhx.com/2019/10/09/A54-pyspider-anjuke/"/>
    <id>https://www.itrhx.com/2019/10/09/A54-pyspider-anjuke/</id>
    <published>2019-10-09T15:02:42.994Z</published>
    <updated>2019-10-09T15:21:29.389Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>çˆ¬å–æ—¶é—´ï¼š2019-10-09<br>çˆ¬å–éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†â˜†<br>è¯·æ±‚é“¾æ¥ï¼š<a href="https://wuhan.anjuke.com/sale/" target="_blank" rel="noopener">https://wuhan.anjuke.com/sale/</a><br>çˆ¬å–ç›®æ ‡ï¼šçˆ¬å–æ­¦æ±‰äºŒæ‰‹æˆ¿æ¯ä¸€æ¡å”®æˆ¿ä¿¡æ¯ï¼ŒåŒ…å«åœ°ç†ä½ç½®ã€ä»·æ ¼ã€é¢ç§¯ç­‰ï¼Œä¿å­˜ä¸º CSV æ–‡ä»¶<br>æ¶‰åŠçŸ¥è¯†ï¼šè¯·æ±‚åº“ requestsã€è§£æåº“ Beautiful Soupã€CSV æ–‡ä»¶å‚¨å­˜ã€åˆ—è¡¨æ“ä½œã€åˆ†é¡µåˆ¤æ–­<br>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/TRHX/Python3-Spider-Practice/tree/master/anjuke" target="_blank" rel="noopener">https://github.com/TRHX/Python3-Spider-Practice/tree/master/anjuke</a><br>å…¶ä»–çˆ¬è™«å®æˆ˜ä»£ç åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š<a href="https://github.com/TRHX/Python3-Spider-Practice" target="_blank" rel="noopener">https://github.com/TRHX/Python3-Spider-Practice</a></p><hr><a id="more"></a><h1 id="ã€1x00ã€‘é¡µé¢æ•´ä½“åˆ†æ"><a href="#ã€1x00ã€‘é¡µé¢æ•´ä½“åˆ†æ" class="headerlink" title="ã€1x00ã€‘é¡µé¢æ•´ä½“åˆ†æ"></a><font color="#FF0000">ã€1x00ã€‘é¡µé¢æ•´ä½“åˆ†æ</font></h1><p>åˆ†æ <a href="https://wuhan.anjuke.com/sale/" target="_blank" rel="noopener">å®‰å±…å®¢æ­¦æ±‰äºŒæ‰‹æˆ¿é¡µé¢</a>ï¼Œè¿™æ¬¡çˆ¬å–å®æˆ˜å‡†å¤‡ä½¿ç”¨ BeautifulSoup è§£æåº“ï¼Œç†Ÿç»ƒ BeautifulSoup è§£æåº“çš„ç”¨æ³•ï¼Œæ³¨æ„åˆ°è¯¥é¡µé¢ä¸å…¶ä»–é¡µé¢ä¸åŒçš„æ˜¯ï¼Œä¸èƒ½ä¸€æ¬¡æ€§çœ‹åˆ°åˆ°åº•æœ‰å¤šå°‘é¡µï¼Œä»¥å‰çŸ¥é“ä¸€å…±æœ‰å¤šå°‘é¡µï¼Œç›´æ¥ä¸€ä¸ªå¾ªç¯çˆ¬å–å°±è¡Œäº†ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡æ”¹å˜ url æ¥å°è¯•æ‰¾åˆ°æœ€åä¸€é¡µï¼Œä½†æ˜¯è¿™æ ·å°±æ˜¾å¾—ä¸ç¨‹åºå‘˜äº†ğŸ˜‚ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ BeautifulSoup è§£æ <code>ä¸‹ä¸€é¡µæŒ‰é’®</code>ï¼Œæå–åˆ°ä¸‹ä¸€é¡µçš„ urlï¼Œç›´åˆ°æ²¡æœ‰ <code>ä¸‹ä¸€é¡µæŒ‰é’®</code> è¿™ä¸ªå…ƒç´ ä¸ºæ­¢ï¼Œä»è€Œå®ç°æ‰€æœ‰é¡µé¢çš„çˆ¬å–ï¼Œå‰©ä¸‹çš„ä¿¡æ¯æå–å’Œå‚¨å­˜å°±æ¯”è¾ƒç®€å•äº†</p><hr><h1 id="ã€2x00ã€‘è§£ææ¨¡å—"><a href="#ã€2x00ã€‘è§£ææ¨¡å—" class="headerlink" title="ã€2x00ã€‘è§£ææ¨¡å—"></a><font color="#FF0000">ã€2x00ã€‘è§£ææ¨¡å—</font></h1><p>åˆ†æé¡µé¢ï¼Œå¯ä»¥å‘ç°æ¯æ¡äºŒæ‰‹æˆ¿ä¿¡æ¯éƒ½æ˜¯åŒ…å«åœ¨ <code>&lt;li&gt;</code> æ ‡ç­¾å†…çš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ BeautifulSoup è§£æé¡µé¢å¾—åˆ°æ‰€æœ‰çš„ <code>&lt;li&gt;</code> æ ‡ç­¾ï¼Œç„¶åå†å¾ªç¯è®¿é—®æ¯ä¸ª <code>&lt;li&gt;</code> æ ‡ç­¾ï¼Œä¾æ¬¡è§£æå¾—åˆ°æ¯æ¡äºŒæ‰‹æˆ¿çš„å„ç§ä¿¡æ¯</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A54/01.png" alt="01"><br></fancybox><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_pages</span><span class="params">(url, num)</span>:</span></span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">'lxml'</span>)</span><br><span class="line">    result_list = soup.find_all(<span class="string">'li'</span>, class_=<span class="string">'list-item'</span>)</span><br><span class="line">    <span class="comment"># print(len(result_list))</span></span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> result_list:</span><br><span class="line">        <span class="comment"># æ ‡é¢˜</span></span><br><span class="line">        title = result.find(<span class="string">'a'</span>, class_=<span class="string">'houseListTitle'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(title)</span></span><br><span class="line">        <span class="comment"># æˆ·å‹</span></span><br><span class="line">        layout = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">0</span>].text</span><br><span class="line">        <span class="comment"># print(layout)</span></span><br><span class="line">        <span class="comment"># é¢ç§¯</span></span><br><span class="line">        cover = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">1</span>].text</span><br><span class="line">        <span class="comment"># print(cover)</span></span><br><span class="line">        <span class="comment"># æ¥¼å±‚</span></span><br><span class="line">        floor = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">2</span>].text</span><br><span class="line">        <span class="comment"># print(floor)</span></span><br><span class="line">        <span class="comment"># å»ºé€ å¹´ä»½</span></span><br><span class="line">        year = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">3</span>].text</span><br><span class="line">        <span class="comment"># print(year)</span></span><br><span class="line">        <span class="comment"># å•ä»·</span></span><br><span class="line">        unit_price = result.find(<span class="string">'span'</span>, class_=<span class="string">'unit-price'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(unit_price)</span></span><br><span class="line">        <span class="comment"># æ€»ä»·</span></span><br><span class="line">        total_price = result.find(<span class="string">'span'</span>, class_=<span class="string">'price-det'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(total_price)</span></span><br><span class="line">        <span class="comment"># å…³é”®å­—</span></span><br><span class="line">        keyword = result.find(<span class="string">'div'</span>, class_=<span class="string">'tags-bottom'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(keyword)</span></span><br><span class="line">        <span class="comment"># åœ°å€</span></span><br><span class="line">        address = result.find(<span class="string">'span'</span>, class_=<span class="string">'comm-address'</span>).text.replace(<span class="string">' '</span>, <span class="string">''</span>).replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="comment"># print(address)</span></span><br><span class="line">        <span class="comment"># è¯¦æƒ…é¡µurl</span></span><br><span class="line">        details_url = result.find(<span class="string">'a'</span>, class_=<span class="string">'houseListTitle'</span>)[<span class="string">'href'</span>]</span><br><span class="line">        <span class="comment"># print(details_url)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    start_num = <span class="number">0</span></span><br><span class="line">    start_url = <span class="string">'https://wuhan.anjuke.com/sale/'</span></span><br><span class="line">    parse_pages(start_url, start_num)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€3x00ã€‘å¾ªç¯çˆ¬å–æ¨¡å—"><a href="#ã€3x00ã€‘å¾ªç¯çˆ¬å–æ¨¡å—" class="headerlink" title="ã€3x00ã€‘å¾ªç¯çˆ¬å–æ¨¡å—"></a><font color="#FF0000">ã€3x00ã€‘å¾ªç¯çˆ¬å–æ¨¡å—</font></h1><p>å‰é¢å·²ç»åˆ†æè¿‡ï¼Œè¯¥ç½‘é¡µæ˜¯æ— æ³•ä¸€ä¸‹å°±èƒ½çœ‹åˆ°ä¸€å…±æœ‰å¤šå°‘é¡µçš„ï¼Œå°è¯•æ‰¾åˆ°æœ€åä¸€é¡µï¼Œå‘ç°ä¸€å…±æœ‰50é¡µï¼Œé‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥æä¸ªå¾ªç¯ï¼Œä¸€ç›´åˆ°ç¬¬50é¡µå°±è¡Œäº†ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€å¤©é¡µé¢æ•°å¢åŠ äº†å‘¢ï¼Œé‚£ä¹ˆä»£ç çš„å¯ç»´æŠ¤æ€§å°±ä¸å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿ <code>ä¸‹ä¸€é¡µæŒ‰é’®</code> ï¼Œå½“å­˜åœ¨ä¸‹ä¸€é¡µçš„æ—¶å€™ï¼Œæ˜¯ <code>&lt;a&gt;</code> æ ‡ç­¾ï¼Œå¹¶ä¸”å¸¦æœ‰ä¸‹ä¸€é¡µçš„ URLï¼Œä¸å­˜åœ¨ä¸‹ä¸€é¡µçš„æ—¶å€™æ˜¯ <code>&lt;i&gt;</code> æ ‡ç­¾ï¼Œå› æ­¤å¯ä»¥å†™ä¸ª <code>if</code> è¯­å¥ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­¤ <code>&lt;a&gt;</code> æ ‡ç­¾ï¼Œè‹¥å­˜åœ¨ï¼Œè¡¨ç¤ºæœ‰ä¸‹ä¸€é¡µï¼Œç„¶åæå–å…¶ <code>href</code> å±æ€§å¹¶ä¼ ç»™è§£ææ¨¡å—ï¼Œå®ç°åé¢æ‰€æœ‰é¡µé¢çš„ä¿¡æ¯æå–ï¼Œæ­¤å¤–ï¼Œç”±äºå®‰å±…å®¢æœ‰åçˆ¬ç³»ç»Ÿï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ Pythonä¸­çš„ <code>random.randint()</code> æ–¹æ³•ï¼Œåœ¨ä¸¤ä¸ªæ•°å€¼ä¹‹é—´éšæœºå–ä¸€ä¸ªæ•°ï¼Œä¼ å…¥ <code>time.sleep()</code> æ–¹æ³•ï¼Œå®ç°éšæœºæš‚åœçˆ¬å–</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A54/02.png" alt="02"><br></fancybox><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µ</span></span><br><span class="line">next_url = soup.find_all(<span class="string">'a'</span>, class_=<span class="string">'aNxt'</span>)</span><br><span class="line"><span class="keyword">if</span> len(next_url) != <span class="number">0</span>:</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    print(<span class="string">'ç¬¬'</span> + str(num) + <span class="string">'é¡µæ•°æ®çˆ¬å–å®Œæ¯•ï¼'</span>)</span><br><span class="line">    <span class="comment"># 3-60ç§’ä¹‹é—´éšæœºæš‚åœ</span></span><br><span class="line">    time.sleep(random.randint(<span class="number">3</span>, <span class="number">60</span>))</span><br><span class="line">    parse_pages(next_url[<span class="number">0</span>].attrs[<span class="string">'href'</span>], num)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'æ‰€æœ‰æ•°æ®çˆ¬å–å®Œæ¯•ï¼'</span>)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—"><a href="#ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—" class="headerlink" title="ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—"></a><font color="#FF0000">ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—</font></h1><p>æ•°æ®å‚¨å­˜æ¯”è¾ƒç®€å•ï¼Œå°†æ¯ä¸ªäºŒæ‰‹æˆ¿ä¿¡æ¯ç»„æˆä¸€ä¸ªåˆ—è¡¨ï¼Œä¾æ¬¡å†™å…¥åˆ° anjuke.csv æ–‡ä»¶ä¸­å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">results = [title, layout, cover, floor, year, unit_price, total_price, keyword, address, details_url]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'anjuke.csv'</span>, <span class="string">'a'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf-8-sig'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    w = csv.writer(f)</span><br><span class="line">    w.writerow(results)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€5x00ã€‘å®Œæ•´ä»£ç "><a href="#ã€5x00ã€‘å®Œæ•´ä»£ç " class="headerlink" title="ã€5x00ã€‘å®Œæ•´ä»£ç "></a><font color="#FF0000">ã€5x00ã€‘å®Œæ•´ä»£ç </font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_pages</span><span class="params">(url, num)</span>:</span></span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    soup = BeautifulSoup(response.text, <span class="string">'lxml'</span>)</span><br><span class="line">    result_list = soup.find_all(<span class="string">'li'</span>, class_=<span class="string">'list-item'</span>)</span><br><span class="line">    <span class="comment"># print(len(result_list))</span></span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> result_list:</span><br><span class="line">        <span class="comment"># æ ‡é¢˜</span></span><br><span class="line">        title = result.find(<span class="string">'a'</span>, class_=<span class="string">'houseListTitle'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(title)</span></span><br><span class="line">        <span class="comment"># æˆ·å‹</span></span><br><span class="line">        layout = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">0</span>].text</span><br><span class="line">        <span class="comment"># print(layout)</span></span><br><span class="line">        <span class="comment"># é¢ç§¯</span></span><br><span class="line">        cover = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">1</span>].text</span><br><span class="line">        <span class="comment"># print(cover)</span></span><br><span class="line">        <span class="comment"># æ¥¼å±‚</span></span><br><span class="line">        floor = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">2</span>].text</span><br><span class="line">        <span class="comment"># print(floor)</span></span><br><span class="line">        <span class="comment"># å»ºé€ å¹´ä»½</span></span><br><span class="line">        year = result.select(<span class="string">'.details-item &gt; span'</span>)[<span class="number">3</span>].text</span><br><span class="line">        <span class="comment"># print(year)</span></span><br><span class="line">        <span class="comment"># å•ä»·</span></span><br><span class="line">        unit_price = result.find(<span class="string">'span'</span>, class_=<span class="string">'unit-price'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(unit_price)</span></span><br><span class="line">        <span class="comment"># æ€»ä»·</span></span><br><span class="line">        total_price = result.find(<span class="string">'span'</span>, class_=<span class="string">'price-det'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(total_price)</span></span><br><span class="line">        <span class="comment"># å…³é”®å­—</span></span><br><span class="line">        keyword = result.find(<span class="string">'div'</span>, class_=<span class="string">'tags-bottom'</span>).text.strip()</span><br><span class="line">        <span class="comment"># print(keyword)</span></span><br><span class="line">        <span class="comment"># åœ°å€</span></span><br><span class="line">        address = result.find(<span class="string">'span'</span>, class_=<span class="string">'comm-address'</span>).text.replace(<span class="string">' '</span>, <span class="string">''</span>).replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="comment"># print(address)</span></span><br><span class="line">        <span class="comment"># è¯¦æƒ…é¡µurl</span></span><br><span class="line">        details_url = result.find(<span class="string">'a'</span>, class_=<span class="string">'houseListTitle'</span>)[<span class="string">'href'</span>]</span><br><span class="line">        <span class="comment"># print(details_url)</span></span><br><span class="line">        results = [title, layout, cover, floor, year, unit_price, total_price, keyword, address, details_url]</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'anjuke.csv'</span>, <span class="string">'a'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf-8-sig'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            w = csv.writer(f)</span><br><span class="line">            w.writerow(results)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µ</span></span><br><span class="line">    next_url = soup.find_all(<span class="string">'a'</span>, class_=<span class="string">'aNxt'</span>)</span><br><span class="line">    <span class="keyword">if</span> len(next_url) != <span class="number">0</span>:</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        print(<span class="string">'ç¬¬'</span> + str(num) + <span class="string">'é¡µæ•°æ®çˆ¬å–å®Œæ¯•ï¼'</span>)</span><br><span class="line">        <span class="comment"># 3-60ç§’ä¹‹é—´éšæœºæš‚åœ</span></span><br><span class="line">        time.sleep(random.randint(<span class="number">3</span>, <span class="number">60</span>))</span><br><span class="line">        parse_pages(next_url[<span class="number">0</span>].attrs[<span class="string">'href'</span>], num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'æ‰€æœ‰æ•°æ®çˆ¬å–å®Œæ¯•ï¼'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'anjuke.csv'</span>, <span class="string">'a'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'utf-8-sig'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        writer = csv.writer(fp)</span><br><span class="line">        writer.writerow([<span class="string">'æ ‡é¢˜'</span>, <span class="string">'æˆ·å‹'</span>, <span class="string">'é¢ç§¯'</span>, <span class="string">'æ¥¼å±‚'</span>, <span class="string">'å»ºé€ å¹´ä»½'</span>, <span class="string">'å•ä»·'</span>, <span class="string">'æ€»ä»·'</span>, <span class="string">'å…³é”®å­—'</span>, <span class="string">'åœ°å€'</span>, <span class="string">'è¯¦æƒ…é¡µåœ°å€'</span>])</span><br><span class="line">    start_num = <span class="number">0</span></span><br><span class="line">    start_url = <span class="string">'https://wuhan.anjuke.com/sale/'</span></span><br><span class="line">    parse_pages(start_url, start_num)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€6x00ã€‘æ•°æ®æˆªå›¾"><a href="#ã€6x00ã€‘æ•°æ®æˆªå›¾" class="headerlink" title="ã€6x00ã€‘æ•°æ®æˆªå›¾"></a><font color="#FF0000">ã€6x00ã€‘æ•°æ®æˆªå›¾</font></h1><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A54/03.png" alt="03"><br></fancybox><hr><h1 id="ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹"><a href="#ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹" class="headerlink" title="ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹"></a><font color="#FF0000">ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹</font></h1><ul><li><p>è™½ç„¶ä½¿ç”¨äº†éšæœºæš‚åœçˆ¬å–çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨çˆ¬å–äº†å¤§çº¦ 20 é¡µçš„æ•°æ®åä¾ç„¶ä¼šå‡ºç°éªŒè¯é¡µé¢ï¼Œå¯¼è‡´ç¨‹åºç»ˆæ­¢</p></li><li><p>åŸæ¥è®¾æƒ³çš„æ˜¯å¯ä»¥ç”±ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥åŸå¸‚çš„æ‹¼éŸ³æ¥æŸ¥è¯¢ä¸åŒåŸå¸‚çš„ä¿¡æ¯ï¼Œæ–¹æ³•æ˜¯æŠŠç”¨æˆ·è¾“å…¥çš„åŸå¸‚æ‹¼éŸ³å’Œå…¶ä»–å‚æ•°ä¸€èµ·æ„é€ æˆä¸€ä¸ª URLï¼Œç„¶åå¯¹è¯¥ URL å‘é€è¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚è¿”å›çš„ä»£ç ï¼Œå¦‚æœæ˜¯ 200 å°±ä»£è¡¨å¯ä»¥è®¿é—®ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è¾“å…¥çš„åŸå¸‚æ˜¯æ­£ç¡®çš„ï¼Œç„¶è€Œå‘ç°å³ä¾¿æ˜¯è¾“å…¥é”™è¯¯ï¼Œè¯¥ URL ä¾ç„¶å¯ä»¥è®¿é—®ï¼Œåªä¸è¿‡ä¼šè·³è½¬åˆ°ä¸€ä¸ªæ­£ç¡®çš„é¡µé¢ï¼Œæ²¡æœ‰ææ¸…æ¥šæ˜¯ä»€ä¹ˆåŸç†ï¼Œä¹Ÿå°±æ— æ³•å®ç°ç”±ç”¨æˆ·è¾“å…¥åŸå¸‚æ¥æŸ¥è¯¢è¿™ä¸ªåŠŸèƒ½</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çˆ¬å–æ—¶é—´ï¼š2019-10-09&lt;br&gt;çˆ¬å–éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†â˜†&lt;br&gt;è¯·æ±‚é“¾æ¥ï¼š&lt;a href=&quot;https://wuhan.anjuke.com/sale/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://wuhan.anjuke.com/sale/&lt;/a&gt;&lt;br&gt;çˆ¬å–ç›®æ ‡ï¼šçˆ¬å–æ­¦æ±‰äºŒæ‰‹æˆ¿æ¯ä¸€æ¡å”®æˆ¿ä¿¡æ¯ï¼ŒåŒ…å«åœ°ç†ä½ç½®ã€ä»·æ ¼ã€é¢ç§¯ç­‰ï¼Œä¿å­˜ä¸º CSV æ–‡ä»¶&lt;br&gt;æ¶‰åŠçŸ¥è¯†ï¼šè¯·æ±‚åº“ requestsã€è§£æåº“ Beautiful Soupã€CSV æ–‡ä»¶å‚¨å­˜ã€åˆ—è¡¨æ“ä½œã€åˆ†é¡µåˆ¤æ–­&lt;br&gt;å®Œæ•´ä»£ç ï¼š&lt;a href=&quot;https://github.com/TRHX/Python3-Spider-Practice/tree/master/anjuke&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/TRHX/Python3-Spider-Practice/tree/master/anjuke&lt;/a&gt;&lt;br&gt;å…¶ä»–çˆ¬è™«å®æˆ˜ä»£ç åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š&lt;a href=&quot;https://github.com/TRHX/Python3-Spider-Practice&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/TRHX/Python3-Spider-Practice&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å®æˆ˜" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="å®‰å±…å®¢" scheme="https://www.itrhx.com/tags/%E5%AE%89%E5%B1%85%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ Hexo-Git-Backup æ’ä»¶å¤‡ä»½ä½ çš„ Hexo åšå®¢</title>
    <link href="https://www.itrhx.com/2019/09/29/A53-hexo-backup/"/>
    <id>https://www.itrhx.com/2019/09/29/A53-hexo-backup/</id>
    <published>2019-09-29T10:02:15.603Z</published>
    <updated>2019-10-01T05:28:05.860Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>æ¬¢è¿å…³æ³¨æˆ‘çš„ CSDN ä¸“æ ï¼š<a href="https://blog.csdn.net/qq_36759224/article/category/9285510" target="_blank" rel="noopener">ã€Šä¸ªäººåšå®¢æ­å»ºï¼šHexo+Github Pagesã€‹</a>ï¼Œä»æ­å»ºåˆ°ç¾åŒ–ä¸€æ¡é¾™ï¼Œå¸®ä½ è§£å†³ Hexo å¸¸è§é—®é¢˜ï¼</p><hr><p>ç”±äº Hexo åšå®¢æ˜¯é™æ€æ‰˜ç®¡çš„ï¼Œæ‰€æœ‰çš„åŸå§‹æ•°æ®éƒ½ä¿å­˜åœ¨æœ¬åœ°ï¼Œå¦‚æœå“ªä¸€å¤©ç”µè„‘åäº†ï¼Œæˆ–è€…æ˜¯è¯¯åˆ äº†æœ¬åœ°æ•°æ®ï¼Œé‚£å°±æ˜¯å«å¤©å¤©ä¸åº”å«åœ°åœ°ä¸çµäº†ï¼Œæ­¤æ—¶å®šæ—¶å¤‡ä»½å°±æ˜¾å¾—æ¯”è¾ƒé‡è¦äº†ï¼Œå¸¸è§çš„å¤‡ä»½æ–¹æ³•æœ‰ï¼šæ‰“åŒ…æ•°æ®ä¿å­˜åˆ°Uç›˜ã€äº‘ç›˜æˆ–è€…å…¶ä»–åœ°æ–¹ï¼Œä½†æ˜¯æ—©å°±æœ‰å¤§ç¥å¼€å‘äº†å¤‡ä»½æ’ä»¶ï¼š<a href="https://github.com/coneycode/hexo-git-backup" target="_blank" rel="noopener">hexo-git-backup</a> ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥å°†æ‰€æœ‰æ•°æ®åŒ…æ‹¬ä¸»é¢˜æ–‡ä»¶å¤‡ä»½åˆ° github äº†</p><p>é¦–å…ˆè¿›å…¥ä½ åšå®¢ç›®å½•ï¼Œè¾“å…¥å‘½ä»¤ <code>hexo version</code> æŸ¥çœ‹ Hexo ç‰ˆæœ¬ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘çš„ç‰ˆæœ¬æ˜¯ 3.7.1ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A53/01.png" alt="01"><br></fancybox><p>å®‰è£…å¤‡ä»½æ’ä»¶ï¼Œå¦‚æœä½ çš„ Hexo ç‰ˆæœ¬æ˜¯ 2.x.xï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-git-backup@0.0.91 --save</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çš„ Hexo ç‰ˆæœ¬æ˜¯ 3.x.xï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-git-backup --save</span><br></pre></td></tr></table></figure><p>åˆ° Hexo åšå®¢æ ¹ç›®å½•çš„ <code>_config.yml</code> é…ç½®æ–‡ä»¶é‡Œæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">backup:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  theme: material-x-1.2.1</span><br><span class="line">  message: Back up my www.itrhx.com blog</span><br><span class="line">  repository:</span><br><span class="line">    github: git@github.com:TRHX/TRHX.github.io.git,backup</span><br><span class="line">    coding: git@git.dev.tencent.com:TRHX/TRHX.git,backup</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li>themeï¼šä½ è¦å¤‡ä»½çš„ä¸»é¢˜åç§°</li><li>messageï¼šè‡ªå®šä¹‰æäº¤ä¿¡æ¯</li><li>repositoryï¼šä»“åº“åï¼Œæ³¨æ„ä»“åº“åœ°å€åé¢è¦æ·»åŠ ä¸€ä¸ªåˆ†æ”¯åï¼Œæ¯”å¦‚æˆ‘å°±åˆ›å»ºäº†ä¸€ä¸ª backup åˆ†æ”¯</li></ul><p>æœ€åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¤‡ä»½ä½ çš„åšå®¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo backup</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨ä»¥ä¸‹ç®€å†™å‘½ä»¤ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo b</span><br></pre></td></tr></table></figure><p>å¤‡ä»½æˆåŠŸåå¯ä»¥åœ¨ä½ çš„ä»“åº“åˆ†æ”¯ä¸‹çœ‹åˆ°å¤‡ä»½çš„åŸå§‹æ–‡ä»¶ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A53/02.png" alt="02"><br></fancybox><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A53/03.png" alt="03"><br></fancybox>]]></content>
    
    <summary type="html">
    
      ä¸€é”®å¤‡ä»½åšå®¢æ•°æ®ï¼Œå†ä¹Ÿä¸æ€•æ•°æ®ä¸¢å¤±äº†ï¼
    
    </summary>
    
      <category term="Hexo" scheme="https://www.itrhx.com/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://www.itrhx.com/tags/Hexo/"/>
    
      <category term="å¤‡ä»½" scheme="https://www.itrhx.com/tags/%E5%A4%87%E4%BB%BD/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å®æˆ˜ â€” è±†ç“£ç”µå½±TOP250</title>
    <link href="https://www.itrhx.com/2019/09/28/A52-pyspider-doubantop250/"/>
    <id>https://www.itrhx.com/2019/09/28/A52-pyspider-doubantop250/</id>
    <published>2019-09-28T08:35:19.823Z</published>
    <updated>2019-10-09T15:13:53.081Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>çˆ¬å–æ—¶é—´ï¼š2019-09-27<br>çˆ¬å–éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†â˜†<br>è¯·æ±‚é“¾æ¥ï¼š<a href="https://movie.douban.com/top250" target="_blank" rel="noopener">https://movie.douban.com/top250</a> ä»¥åŠæ¯éƒ¨ç”µå½±è¯¦æƒ…é¡µ<br>çˆ¬å–ç›®æ ‡ï¼šçˆ¬å–æ¦œå•ä¸Šæ¯ä¸€éƒ¨ç”µå½±è¯¦æƒ…é¡µçš„æ•°æ®ï¼Œä¿å­˜ä¸º CSV æ–‡ä»¶ï¼›ä¸‹è½½æ‰€æœ‰ç”µå½±æµ·æŠ¥åˆ°æœ¬åœ°<br>æ¶‰åŠçŸ¥è¯†ï¼šè¯·æ±‚åº“ requestsã€è§£æåº“ lxmlã€Xpath è¯­æ³•ã€æ­£åˆ™è¡¨è¾¾å¼ã€CSV å’ŒäºŒè¿›åˆ¶æ•°æ®å‚¨å­˜ã€åˆ—è¡¨æ“ä½œ<br>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/TRHX/Python3-Spider-Practice/tree/master/douban-top250" target="_blank" rel="noopener">https://github.com/TRHX/Python3-Spider-Practice/tree/master/douban-top250</a><br>å…¶ä»–çˆ¬è™«å®æˆ˜ä»£ç åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š<a href="https://github.com/TRHX/Python3-Spider-Practice" target="_blank" rel="noopener">https://github.com/TRHX/Python3-Spider-Practice</a></p><hr><a id="more"></a><h1 id="ã€1x00ã€‘å¾ªç¯çˆ¬å–é¦–é¡µ"><a href="#ã€1x00ã€‘å¾ªç¯çˆ¬å–é¦–é¡µ" class="headerlink" title="ã€1x00ã€‘å¾ªç¯çˆ¬å–é¦–é¡µ"></a><font color="#FF0000">ã€1x00ã€‘å¾ªç¯çˆ¬å–é¦–é¡µ</font></h1><p>è§‚å¯Ÿè±†ç“£ç”µå½± Top 250ï¼Œè¯·æ±‚åœ°å€ä¸ºï¼š<a href="https://movie.douban.com/top250" target="_blank" rel="noopener">https://movie.douban.com/top250</a></p><p>æ¯é¡µå±•ç¤º25æ¡ç”µå½±ä¿¡æ¯ï¼Œç…§ä¾‹ç¿»é¡µè§‚å¯Ÿ url çš„å˜åŒ–ï¼š</p><p>ç¬¬ä¸€é¡µï¼š<a href="https://movie.douban.com/top250" target="_blank" rel="noopener">https://movie.douban.com/top250</a><br>ç¬¬äºŒé¡µï¼š<a href="https://movie.douban.com/top250?start=25&amp;filter=" target="_blank" rel="noopener">https://movie.douban.com/top250?start=25&amp;filter=</a><br>ç¬¬ä¸‰é¡µï¼š<a href="https://movie.douban.com/top250?start=50&amp;filter=" target="_blank" rel="noopener">https://movie.douban.com/top250?start=50&amp;filter=</a></p><p>ä¸€å…±æœ‰10é¡µï¼Œæ¯æ¬¡æ”¹å˜çš„æ˜¯ start çš„å€¼ï¼Œåˆ©ç”¨ä¸€ä¸ª for å¾ªç¯ï¼Œä» 0 åˆ° 250 æ¯éš” 25 å–ä¸€ä¸ªå€¼æ‹¼æ¥åˆ° urlï¼Œå®ç°å¾ªç¯çˆ¬å–æ¯ä¸€é¡µï¼Œç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¿›å…¥æ¯ä¸€éƒ¨ç”µå½±çš„è¯¦æƒ…é¡µï¼Œç„¶åçˆ¬å–è¯¦æƒ…é¡µçš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Xpath æå–æ¯ä¸€é¡µæ¯éƒ¨ç”µå½±è¯¦æƒ…é¡µçš„ URLï¼Œå°†å…¶èµ‹å€¼ç»™ <code>m_urls</code>ï¼Œå¹¶è¿”å› <code>m_urls</code>ï¼Œ<code>m_urls</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨å…ƒç´ å°±æ˜¯ç”µå½±è¯¦æƒ…é¡µçš„ URL</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_pages</span><span class="params">(number)</span>:</span></span><br><span class="line">    url = <span class="string">'https://movie.douban.com/top250?start=%s&amp;filter='</span> % number</span><br><span class="line">    index_response = requests.get(url=url, headers=headers)</span><br><span class="line">    tree = etree.HTML(index_response.text)</span><br><span class="line">    m_urls = tree.xpath(<span class="string">"//li/div/div/a/@href"</span>)</span><br><span class="line">    <span class="keyword">return</span> m_urls</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">250</span>, <span class="number">25</span>):</span><br><span class="line">        movie_urls = index_pages(i)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€2x00ã€‘è§£ææ¨¡å—"><a href="#ã€2x00ã€‘è§£ææ¨¡å—" class="headerlink" title="ã€2x00ã€‘è§£ææ¨¡å—"></a><font color="#FF0000">ã€2x00ã€‘è§£ææ¨¡å—</font></h1><p>å®šä¹‰ä¸€ä¸ªè§£æå‡½æ•° <code>parse_pages()</code>ï¼Œåˆ©ç”¨ for å¾ªç¯ï¼Œä¾æ¬¡æå– <code>index_pages()</code> å‡½æ•°è¿”å›çš„åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯æ¯éƒ¨ç”µå½±è¯¦æƒ…é¡µçš„ URLï¼Œå°†å…¶ä¼ ç»™è§£æå‡½æ•°è¿›è¡Œè§£æ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_pages</span><span class="params">(number)</span>:</span></span><br><span class="line">expressions</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_pages</span><span class="params">(url)</span>:</span></span><br><span class="line">expressions</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">250</span>, <span class="number">25</span>):</span><br><span class="line">        movie_urls = index_pages(i)</span><br><span class="line">        <span class="keyword">for</span> movie_url <span class="keyword">in</span> movie_urls:</span><br><span class="line">            results = parse_pages(movie_url)</span><br></pre></td></tr></table></figure><p>è¯¦ç»†çœ‹ä¸€ä¸‹è§£æå‡½æ•° <code>parse_pages()</code>ï¼Œé¦–å…ˆè¦å¯¹æ¥æ”¶åˆ°çš„è¯¦æƒ…é¡µ URL å‘é€è¯·æ±‚ï¼Œè·å–å“åº”å†…å®¹ï¼Œç„¶åå†ä½¿ç”¨ Xpath æå–ç›¸å…³ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_pages</span><span class="params">(url)</span>:</span></span><br><span class="line">    movie_pages = requests.get(url=url, headers=headers)</span><br><span class="line">    parse_movie = etree.HTML(movie_pages.text)</span><br></pre></td></tr></table></figure><hr><h2 id="ã€2x01ã€‘Xpath-è§£ææ’åã€ç”µå½±åã€è¯„åˆ†ä¿¡æ¯"><a href="#ã€2x01ã€‘Xpath-è§£ææ’åã€ç”µå½±åã€è¯„åˆ†ä¿¡æ¯" class="headerlink" title="ã€2x01ã€‘Xpath è§£ææ’åã€ç”µå½±åã€è¯„åˆ†ä¿¡æ¯"></a><font color="#1BC3FB">ã€2x01ã€‘Xpath è§£ææ’åã€ç”µå½±åã€è¯„åˆ†ä¿¡æ¯</font></h2><p>å…¶ä¸­æ’åã€ç”µå½±åå’Œè¯„åˆ†ä¿¡æ¯æ˜¯æœ€å®¹æ˜“åŒ¹é…åˆ°çš„ï¼Œç›´æ¥ä½¿ç”¨ Xpath è¯­æ³•å°±å¯ä»¥è½»æ¾è§£å†³ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ’å</span></span><br><span class="line">ranking = parse_movie.xpath(<span class="string">"//span[@class='top250-no']/text()"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”µå½±å</span></span><br><span class="line">name = parse_movie.xpath(<span class="string">"//h1/span[1]/text()"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯„åˆ†</span></span><br><span class="line">score = parse_movie.xpath(<span class="string">"//div[@class='rating_self clearfix']/strong/text()"</span>)</span><br></pre></td></tr></table></figure><hr><h2 id="ã€2x02ã€‘Xpath-è§£æå‚è¯„äººæ•°"><a href="#ã€2x02ã€‘Xpath-è§£æå‚è¯„äººæ•°" class="headerlink" title="ã€2x02ã€‘Xpath è§£æå‚è¯„äººæ•°"></a><font color="#1BC3FB">ã€2x02ã€‘Xpath è§£æå‚è¯„äººæ•°</font></h2><p>æ¥ä¸‹æ¥å‡†å¤‡çˆ¬å–æœ‰å¤šå°‘äººå‚ä¸äº†è¯„ä»·ï¼Œåˆ†æä¸€ä¸‹é¡µé¢ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A52/01.png" alt="01"><br></fancybox><p>å¦‚æœåªçˆ¬å–è¿™ä¸ª <code>&lt;span&gt;</code> æ ‡ç­¾ä¸‹çš„æ•°å­—çš„è¯ï¼Œæ²¡æœ‰ä»»ä½•æç¤ºä¿¡æ¯ï¼Œåˆ«äººçœ‹äº†ä¸çŸ¥é“æ˜¯å•¥ä¸œè¥¿ï¼Œæ‰€ä»¥æŠŠ <code>äººè¯„ä»·</code> è¿™ä¸‰ä¸ªå­—ä¹Ÿçˆ¬ä¸‹æ¥çš„è¯å°±æ¯”è¾ƒå¥½äº†ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°æ•°å­—å’Œæ–‡å­—ä¸åœ¨åŒä¸€ä¸ªå…ƒç´ æ ‡ç­¾ä¸‹ï¼Œè€Œä¸”æ–‡å­—éƒ¨åˆ†è¿˜æœ‰ç©ºæ ¼ï¼Œè¦çˆ¬å–çš„è¯å°±è¦æŠŠ <code>class=&quot;rating_people&quot;</code> çš„ <code>a</code> æ ‡ç­¾ä¸‹æ‰€æœ‰çš„ <code>text</code> æå–å‡ºæ¥ï¼Œç„¶åå†å»æ‰ç©ºæ ¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚è¯„äººæ•°</span></span><br><span class="line"><span class="comment"># åŒ¹é…aèŠ‚ç‚¹</span></span><br><span class="line">value = parse_movie.xpath(<span class="string">"//a[@class='rating_people']"</span>)</span><br><span class="line"><span class="comment"># æå–aèŠ‚ç‚¹ä¸‹æ‰€æœ‰æ–‡æœ¬</span></span><br><span class="line">string = [value[<span class="number">0</span>].xpath(<span class="string">'string(.)'</span>)]</span><br><span class="line"><span class="comment"># å»é™¤å¤šä½™ç©ºæ ¼</span></span><br><span class="line">number = [a.strip() <span class="keyword">for</span> a <span class="keyword">in</span> string]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ number = ['1617307äººè¯„ä»·']</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·åšå¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æå–æ•°å­—ï¼Œå¾—åˆ°ä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åä½¿ç”¨å¦ä¸€ä¸ªå¸¦æœ‰æç¤ºä¿¡æ¯çš„åˆ—è¡¨ï¼Œå°†ä¸¤ä¸ªåˆ—è¡¨çš„å…ƒç´ åˆå¹¶ï¼Œç»„æˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œè¿™ä¸ªæ–°åˆ—è¡¨çš„å…ƒç´ å°±æ˜¯æç¤ºä¿¡æ¯+äººæ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‚è¯„äººæ•°</span></span><br><span class="line">value = parse_movie.xpath(<span class="string">"//span[@property='v:votes']/text()"</span>)</span><br><span class="line"><span class="comment"># åˆå¹¶å…ƒç´ </span></span><br><span class="line">number = [<span class="string">" "</span>.join([<span class="string">'å‚è¯„äººæ•°ï¼š'</span>] + value)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ number = ['å‚è¯„äººæ•°ï¼š1617307']</span></span><br></pre></td></tr></table></figure></p><hr><h2 id="ã€2x03ã€‘æ­£åˆ™è¡¨è¾¾å¼è§£æåˆ¶ç‰‡å›½å®¶ã€è¯­è¨€"><a href="#ã€2x03ã€‘æ­£åˆ™è¡¨è¾¾å¼è§£æåˆ¶ç‰‡å›½å®¶ã€è¯­è¨€" class="headerlink" title="ã€2x03ã€‘æ­£åˆ™è¡¨è¾¾å¼è§£æåˆ¶ç‰‡å›½å®¶ã€è¯­è¨€"></a><font color="#1BC3FB">ã€2x03ã€‘æ­£åˆ™è¡¨è¾¾å¼è§£æåˆ¶ç‰‡å›½å®¶ã€è¯­è¨€</font></h2><p>æ¥ä¸‹æ¥å°è¯•çˆ¬å–åˆ¶ç‰‡å›½å®¶/åœ°åŒºã€è¯­è¨€ç­‰ä¿¡æ¯ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A52/02.png" alt="02"><br></fancybox><p>åˆ†æé¡µé¢å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåˆ¶ç‰‡å›½å®¶/åœ°åŒºå’Œè¯­è¨€ç»“æ„æ¯”è¾ƒç‰¹æ®Šï¼Œæ²¡æœ‰ç‰¹åˆ«çš„ class æˆ–è€… id å±æ€§ï¼Œæ‰€åŒ…å«çš„å±‚æ¬¡å…³ç³»ä¹Ÿå¤ªå¤æ‚ï¼Œæ‰€ä»¥è¿™é‡Œä¸ºäº†ç®€ä¾¿ï¼Œç›´æ¥é‡‡ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ä¿¡æ¯ï¼Œå°±æ²¡æœ‰é‚£ä¹ˆå¤æ‚äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ¶ç‰‡å›½å®¶/åœ°åŒº</span></span><br><span class="line">value = re.findall(<span class="string">'&lt;span class="pl"&gt;åˆ¶ç‰‡å›½å®¶/åœ°åŒº:&lt;/span&gt;(.*?)&lt;br/&gt;'</span>, movie_pages.text)</span><br><span class="line">country = [<span class="string">" "</span>.join([<span class="string">'åˆ¶ç‰‡å›½å®¶:'</span>] + value)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­è¨€</span></span><br><span class="line">value = re.findall(<span class="string">'&lt;span class="pl"&gt;è¯­è¨€:&lt;/span&gt;(.*?)&lt;br/&gt;'</span>, movie_pages.text)</span><br><span class="line">language = [<span class="string">" "</span>.join([<span class="string">'è¯­è¨€:'</span>] + value)]</span><br></pre></td></tr></table></figure><hr><h1 id="ã€3x00ã€‘è¿”å›è§£ææ•°æ®"><a href="#ã€3x00ã€‘è¿”å›è§£ææ•°æ®" class="headerlink" title="ã€3x00ã€‘è¿”å›è§£ææ•°æ®"></a><font color="#FF0000">ã€3x00ã€‘è¿”å›è§£ææ•°æ®</font></h1><p>å…¶ä»–å‰©ä¸‹çš„ä¿¡æ¯çš†å¯åˆ©ç”¨ä»¥ä¸Šæ–¹æ³•è¿›è¡Œæå–ï¼Œæ‰€æœ‰ä¿¡æ¯æå–å®Œæ¯•ï¼Œæœ€åä½¿ç”¨ <code>zip()</code> å‡½æ•°ï¼Œå°†æ‰€æœ‰æå–çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†å¯¹è±¡ä¸­å¯¹åº”çš„å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ï¼Œç„¶åè¿”å›ç”±è¿™äº›å…ƒç»„ç»„æˆçš„åˆ—è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> zip(ranking, name, score, number, types, country, language, date, time, other_name, director, screenwriter, performer, m_url, imdb_url)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—"><a href="#ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—" class="headerlink" title="ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—"></a><font color="#FF0000">ã€4x00ã€‘æ•°æ®å‚¨å­˜æ¨¡å—</font></h1><p>å®šä¹‰ä¸€ä¸ªæ•°æ®ä¿å­˜å‡½æ•° <code>save_results()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_results</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'douban.csv'</span>, <span class="string">'a'</span>, encoding=<span class="string">"utf-8-sig"</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        writer = csv.writer(fp)</span><br><span class="line">        writer.writerow(data)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šç¼–ç æ–¹å¼è¦è®¾ç½®ä¸º <code>utf-8-sig</code>ï¼Œå¦‚æœè®¾ç½®ä¸º <code>utf-8</code>ï¼Œåˆ™æ–‡ä»¶ä¼šä¹±ç ï¼Œä¸è®¾ç½®ç¼–ç ï¼Œåˆ™å¯èƒ½ä¼šæŠ¥ä¸€ä¸‹ç±»ä¼¼é”™è¯¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeEncodeError: <span class="string">'gbk'</span> codec can<span class="string">'t encode character '</span>\ub3c4<span class="string">' in position 9: illegal multibyte sequence</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é”™è¯¯å‡ºç°åœ¨ <code>\ub3c4</code> ä¸Šï¼Œå°†è¯¥ Unicode ç¼–ç è½¬æ¢ä¸ºä¸­æ–‡ä¸º <code>ë„</code>ï¼Œå‘ç°æ­£æ˜¯æ’åç¬¬ 19 çš„ç”µå½±ï¼šç†”ç‚‰ ë„ê°€ë‹ˆï¼Œå› ä¸ºæ ‡é¢˜æœ‰éŸ©æ–‡ï¼Œæ‰€ä»¥åœ¨å‚¨å­˜ä¸º CSV æ–‡ä»¶æ—¶ä¼šæŠ¥ç¼–ç é”™è¯¯ï¼Œè€Œå°†ç¼–ç è®¾ç½®ä¸º <code>utf-8-sig</code> å°±ä¸ä¼šæŠ¥é”™ï¼Œå…·ä½“åŸå› å‚è§ï¼š<a href="https://www.jianshu.com/p/d9b25fb0a098" target="_blank" rel="noopener">ã€ŠPython ä¸­æ–‡æ—¥æ–‡æ±‰å­—ä¹±ç å¤„ç†utf-8-sigã€‹</a></p><p>æ¥ä¸‹æ¥æ˜¯ä¿å­˜ç”µå½±çš„æµ·æŠ¥åˆ°æœ¬åœ°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜ç”µå½±æµ·æŠ¥</span></span><br><span class="line">poster = parse_movie.xpath(<span class="string">"//div[@id='mainpic']/a/img/@src"</span>)</span><br><span class="line">response = requests.get(poster[<span class="number">0</span>])</span><br><span class="line">name2 = re.sub(<span class="string">r'[A-Za-z\:\s]'</span>, <span class="string">''</span>, name[<span class="number">0</span>])</span><br><span class="line">poster_name = str(ranking[<span class="number">0</span>]) + <span class="string">' - '</span> + name2 + <span class="string">'.jpg'</span></span><br><span class="line">dir_name = <span class="string">'douban_poster'</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dir_name):</span><br><span class="line">    os.mkdir(dir_name)</span><br><span class="line">poster_path = dir_name + <span class="string">'/'</span> + poster_name</span><br><span class="line"><span class="keyword">with</span> open(poster_path, <span class="string">"wb"</span>)<span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure><p>è§£æç”µå½±è¯¦æƒ…é¡µï¼Œä½¿ç”¨ Xpath æå–æµ·æŠ¥çš„ URLï¼Œå‘è¯¥ URL å‘é€è¯·æ±‚</p><p>å›¾ç‰‡ä»¥ <code>æ’å+ç”µå½±å.jpg</code> çš„æ–¹å¼å‘½åï¼Œä½†æ˜¯ç”±äºæå–çš„ç”µå½±åéƒ¨åˆ†å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚æ’åç¬¬ 10 çš„ç”µå½±ï¼šå¿ çŠ¬å…«å…¬çš„æ•…äº‹ Hachi: A Dogâ€™s Taleï¼Œå…¶ä¸­æœ‰ä¸ªå†’å·ï¼Œè€Œ Windows æ–‡ä»¶å‘½åæ˜¯ä¸èƒ½åŒ…å«è¿™äº›å­—ç¬¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å»é™¤ç”µå½±ååŒ…å«çš„è‹±æ–‡å­—ç¬¦ã€ç©ºç™½å­—ç¬¦ã€ç‰¹æ®Šå­—ç¬¦ï¼Œåªç•™ä¸‹ä¸­æ–‡ï¼Œä»£ç å®ç°ï¼š <code>name2 = re.sub(r&#39;[A-Za-z\:\s]&#39;, &#39;&#39;, name[0])</code></p><p>å®šä¹‰ä¸€ä¸ªæ–‡ä»¶å¤¹åç§° <code>douban_poster</code>ï¼Œåˆ©ç”¨ <code>os</code> æ¨¡å—åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶å¤¹ï¼Œè‹¥ä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª</p><p>æœ€åä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜æµ·æŠ¥åˆ°å½“å‰ç›®å½•çš„ douban_poster æ–‡ä»¶å¤¹ä¸‹</p><hr><h1 id="ã€5x00ã€‘å®Œæ•´ä»£ç "><a href="#ã€5x00ã€‘å®Œæ•´ä»£ç " class="headerlink" title="ã€5x00ã€‘å®Œæ•´ä»£ç "></a><font color="#FF0000">ã€5x00ã€‘å®Œæ•´ä»£ç </font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_pages</span><span class="params">(number)</span>:</span></span><br><span class="line">    url = <span class="string">'https://movie.douban.com/top250?start=%s&amp;filter='</span> % number</span><br><span class="line">    index_response = requests.get(url=url, headers=headers)</span><br><span class="line">    tree = etree.HTML(index_response.text)</span><br><span class="line">    m_urls = tree.xpath(<span class="string">"//li/div/div/a/@href"</span>)</span><br><span class="line">    <span class="keyword">return</span> m_urls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_pages</span><span class="params">(url)</span>:</span></span><br><span class="line">    movie_pages = requests.get(url=url, headers=headers)</span><br><span class="line">    parse_movie = etree.HTML(movie_pages.text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ’å</span></span><br><span class="line">    ranking = parse_movie.xpath(<span class="string">"//span[@class='top250-no']/text()"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”µå½±å</span></span><br><span class="line">    name = parse_movie.xpath(<span class="string">"//h1/span[1]/text()"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯„åˆ†</span></span><br><span class="line">    score = parse_movie.xpath(<span class="string">"//div[@class='rating_self clearfix']/strong/text()"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å‚è¯„äººæ•°</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//span[@property='v:votes']/text()"</span>)</span><br><span class="line">    number = [<span class="string">" "</span>.join([<span class="string">'å‚è¯„äººæ•°ï¼š'</span>] + value)]</span><br><span class="line">    <span class="comment"># value = parse_movie.xpath("//a[@class='rating_people']")</span></span><br><span class="line">    <span class="comment"># string = [value[0].xpath('string(.)')]</span></span><br><span class="line">    <span class="comment"># number = [a.strip() for a in string]</span></span><br><span class="line">    <span class="comment"># print(number)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç±»å‹</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//span[@property='v:genre']/text()"</span>)</span><br><span class="line">    types = [<span class="string">" "</span>.join([<span class="string">'ç±»å‹ï¼š'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ¶ç‰‡å›½å®¶/åœ°åŒº</span></span><br><span class="line">    value = re.findall(<span class="string">'&lt;span class="pl"&gt;åˆ¶ç‰‡å›½å®¶/åœ°åŒº:&lt;/span&gt;(.*?)&lt;br/&gt;'</span>, movie_pages.text)</span><br><span class="line">    country = [<span class="string">" "</span>.join([<span class="string">'åˆ¶ç‰‡å›½å®¶:'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯­è¨€</span></span><br><span class="line">    value = re.findall(<span class="string">'&lt;span class="pl"&gt;è¯­è¨€:&lt;/span&gt;(.*?)&lt;br/&gt;'</span>, movie_pages.text)</span><br><span class="line">    language = [<span class="string">" "</span>.join([<span class="string">'è¯­è¨€:'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸Šæ˜ æ—¶æœŸ</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//span[@property='v:initialReleaseDate']/text()"</span>)</span><br><span class="line">    date = [<span class="string">" "</span>.join([<span class="string">'ä¸Šæ˜ æ—¥æœŸï¼š'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç‰‡é•¿</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//span[@property='v:runtime']/text()"</span>)</span><br><span class="line">    time = [<span class="string">" "</span>.join([<span class="string">'ç‰‡é•¿ï¼š'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå</span></span><br><span class="line">    value = re.findall(<span class="string">'&lt;span class="pl"&gt;åˆå:&lt;/span&gt;(.*?)&lt;br/&gt;'</span>, movie_pages.text)</span><br><span class="line">    other_name = [<span class="string">" "</span>.join([<span class="string">'åˆå:'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¼æ¼”</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//div[@id='info']/span[1]/span[@class='attrs']/a/text()"</span>)</span><br><span class="line">    director = [<span class="string">" "</span>.join([<span class="string">'å¯¼æ¼”:'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¼–å‰§</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//div[@id='info']/span[2]/span[@class='attrs']/a/text()"</span>)</span><br><span class="line">    screenwriter = [<span class="string">" "</span>.join([<span class="string">'ç¼–å‰§:'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸»æ¼”</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//div[@id='info']/span[3]"</span>)</span><br><span class="line">    performer = [value[<span class="number">0</span>].xpath(<span class="string">'string(.)'</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># URL</span></span><br><span class="line">    m_url = [<span class="string">'è±†ç“£é“¾æ¥ï¼š'</span> + movie_url]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># IMDbé“¾æ¥</span></span><br><span class="line">    value = parse_movie.xpath(<span class="string">"//div[@id='info']/a/@href"</span>)</span><br><span class="line">    imdb_url = [<span class="string">" "</span>.join([<span class="string">'IMDbé“¾æ¥ï¼š'</span>] + value)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿å­˜ç”µå½±æµ·æŠ¥</span></span><br><span class="line">    poster = parse_movie.xpath(<span class="string">"//div[@id='mainpic']/a/img/@src"</span>)</span><br><span class="line">    response = requests.get(poster[<span class="number">0</span>])</span><br><span class="line">    name2 = re.sub(<span class="string">r'[A-Za-z\:\s]'</span>, <span class="string">''</span>, name[<span class="number">0</span>])</span><br><span class="line">    poster_name = str(ranking[<span class="number">0</span>]) + <span class="string">' - '</span> + name2 + <span class="string">'.jpg'</span></span><br><span class="line">    dir_name = <span class="string">'douban_poster'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dir_name):</span><br><span class="line">        os.mkdir(dir_name)</span><br><span class="line">    poster_path = dir_name + <span class="string">'/'</span> + poster_name</span><br><span class="line">    <span class="keyword">with</span> open(poster_path, <span class="string">"wb"</span>)<span class="keyword">as</span> f:</span><br><span class="line">        f.write(response.content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> zip(ranking, name, score, number, types, country, language, date, time, other_name, director, screenwriter, performer, m_url, imdb_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_results</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'douban.csv'</span>, <span class="string">'a'</span>, encoding=<span class="string">"utf-8-sig"</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        writer = csv.writer(fp)</span><br><span class="line">        writer.writerow(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">250</span>, <span class="number">25</span>):</span><br><span class="line">        movie_urls = index_pages(i)</span><br><span class="line">        <span class="keyword">for</span> movie_url <span class="keyword">in</span> movie_urls:</span><br><span class="line">            results = parse_pages(movie_url)</span><br><span class="line">            <span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">                num += <span class="number">1</span></span><br><span class="line">                save_results(result)</span><br><span class="line">                print(<span class="string">'ç¬¬'</span> + str(num) + <span class="string">'æ¡ç”µå½±ä¿¡æ¯ä¿å­˜å®Œæ¯•ï¼'</span>)</span><br><span class="line">                time.sleep(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€6x00ã€‘æ•°æ®æˆªå›¾"><a href="#ã€6x00ã€‘æ•°æ®æˆªå›¾" class="headerlink" title="ã€6x00ã€‘æ•°æ®æˆªå›¾"></a><font color="#FF0000">ã€6x00ã€‘æ•°æ®æˆªå›¾</font></h1><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A52/03.png" alt="03"><br></fancybox><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A52/04.png" alt="04"><br></fancybox><hr><h1 id="ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹"><a href="#ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹" class="headerlink" title="ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹"></a><font color="#FF0000">ã€7x00ã€‘ç¨‹åºä¸è¶³çš„åœ°æ–¹</font></h1><p>ç¨‹åºä¸è¶³çš„åœ°æ–¹ï¼šè±†ç“£ç”µå½±æœ‰åçˆ¬æœºåˆ¶ï¼Œå½“ç¨‹åºçˆ¬å–åˆ°å¤§çº¦ 150 æ¡æ•°æ®çš„æ—¶å€™ï¼ŒIP å°±ä¼šè¢«å°æ‰ï¼Œç¬¬äºŒå¤© IP æ‰ä¼šè§£å°ï¼Œå¯ä»¥è€ƒè™‘ç»¼åˆä½¿ç”¨å¤šä¸ªä»£ç†ã€å¤šä¸ª User-Agentã€éšæœºæ—¶é—´æš‚åœç­‰æ–¹æ³•è¿›è¡Œçˆ¬å–</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çˆ¬å–æ—¶é—´ï¼š2019-09-27&lt;br&gt;çˆ¬å–éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†â˜†&lt;br&gt;è¯·æ±‚é“¾æ¥ï¼š&lt;a href=&quot;https://movie.douban.com/top250&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://movie.douban.com/top250&lt;/a&gt; ä»¥åŠæ¯éƒ¨ç”µå½±è¯¦æƒ…é¡µ&lt;br&gt;çˆ¬å–ç›®æ ‡ï¼šçˆ¬å–æ¦œå•ä¸Šæ¯ä¸€éƒ¨ç”µå½±è¯¦æƒ…é¡µçš„æ•°æ®ï¼Œä¿å­˜ä¸º CSV æ–‡ä»¶ï¼›ä¸‹è½½æ‰€æœ‰ç”µå½±æµ·æŠ¥åˆ°æœ¬åœ°&lt;br&gt;æ¶‰åŠçŸ¥è¯†ï¼šè¯·æ±‚åº“ requestsã€è§£æåº“ lxmlã€Xpath è¯­æ³•ã€æ­£åˆ™è¡¨è¾¾å¼ã€CSV å’ŒäºŒè¿›åˆ¶æ•°æ®å‚¨å­˜ã€åˆ—è¡¨æ“ä½œ&lt;br&gt;å®Œæ•´ä»£ç ï¼š&lt;a href=&quot;https://github.com/TRHX/Python3-Spider-Practice/tree/master/douban-top250&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/TRHX/Python3-Spider-Practice/tree/master/douban-top250&lt;/a&gt;&lt;br&gt;å…¶ä»–çˆ¬è™«å®æˆ˜ä»£ç åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š&lt;a href=&quot;https://github.com/TRHX/Python3-Spider-Practice&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/TRHX/Python3-Spider-Practice&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å®æˆ˜" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="è±†ç“£ç”µå½±" scheme="https://www.itrhx.com/tags/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å®æˆ˜ â€” çŒ«çœ¼ç”µå½±TOP100</title>
    <link href="https://www.itrhx.com/2019/09/24/A51-pyspider-maoyantop100/"/>
    <id>https://www.itrhx.com/2019/09/24/A51-pyspider-maoyantop100/</id>
    <published>2019-09-24T11:31:56.965Z</published>
    <updated>2019-10-09T15:14:30.989Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>çˆ¬å–æ—¶é—´ï¼š2019-09-23<br>çˆ¬å–éš¾åº¦ï¼šâ˜…â˜†â˜†â˜†â˜†â˜†<br>è¯·æ±‚é“¾æ¥ï¼š<a href="https://maoyan.com/board/4" target="_blank" rel="noopener">https://maoyan.com/board/4</a><br>çˆ¬å–ç›®æ ‡ï¼šçŒ«çœ¼ TOP100 çš„ç”µå½±åç§°ã€æ’åã€ä¸»æ¼”ã€ä¸Šæ˜ æ—¶é—´ã€è¯„åˆ†ã€å°é¢å›¾åœ°å€ï¼Œæ•°æ®ä¿å­˜ä¸º CSV æ–‡ä»¶<br>æ¶‰åŠçŸ¥è¯†ï¼šè¯·æ±‚åº“ requestsã€è§£æåº“ lxmlã€Xpath è¯­æ³•ã€CSV æ–‡ä»¶å‚¨å­˜<br>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/TRHX/Python3-Spider-Practice/tree/master/maoyan-top100" target="_blank" rel="noopener">https://github.com/TRHX/Python3-Spider-Practice/tree/master/maoyan-top100</a><br>å…¶ä»–çˆ¬è™«å®æˆ˜ä»£ç åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š<a href="https://github.com/TRHX/Python3-Spider-Practice" target="_blank" rel="noopener">https://github.com/TRHX/Python3-Spider-Practice</a></p><hr><a id="more"></a><p>è§‚å¯ŸçŒ«çœ¼ç”µå½±TOP100æ¦œï¼Œè¯·æ±‚åœ°å€ä¸ºï¼š<a href="https://maoyan.com/board/4" target="_blank" rel="noopener">https://maoyan.com/board/4</a></p><p>æ¯é¡µå±•ç¤º10æ¡ç”µå½±ä¿¡æ¯ï¼Œç¿»é¡µè§‚å¯Ÿ url å˜åŒ–ï¼š</p><p>ç¬¬ä¸€é¡µï¼š<a href="https://maoyan.com/board/4" target="_blank" rel="noopener">https://maoyan.com/board/4</a><br>ç¬¬äºŒé¡µï¼š<a href="https://maoyan.com/board/4?offset=10" target="_blank" rel="noopener">https://maoyan.com/board/4?offset=10</a><br>ç¬¬ä¸‰é¡µï¼š<a href="https://maoyan.com/board/4?offset=20" target="_blank" rel="noopener">https://maoyan.com/board/4?offset=20</a></p><p>ä¸€å…±æœ‰10é¡µï¼Œåˆ©ç”¨ä¸€ä¸ª for å¾ªç¯ï¼Œä» 0 åˆ° 100 æ¯éš” 10 å–ä¸€ä¸ªå€¼æ‹¼æ¥åˆ° urlï¼Œå®ç°å¾ªç¯çˆ¬å–æ¯ä¸€é¡µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(number)</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset=%s'</span> % number</span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):</span><br><span class="line">        index = index_page(i)</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªé¡µé¢è§£æå‡½æ•° <code>parse_page()</code>ï¼Œä½¿ç”¨ lxml è§£æåº“çš„ Xpath æ–¹æ³•ä¾æ¬¡æå–ç”µå½±æ’åï¼ˆrankingï¼‰ã€ç”µå½±åç§°ï¼ˆmovie_nameï¼‰ã€ä¸»æ¼”ï¼ˆperformerï¼‰ã€ä¸Šæ˜ æ—¶é—´ï¼ˆreleasetimeï¼‰ã€è¯„åˆ†ï¼ˆscoreï¼‰ã€ç”µå½±å°é¢å›¾ urlï¼ˆmovie_imgï¼‰</p><p>é€šè¿‡å¯¹ä¸»æ¼”éƒ¨åˆ†çš„æå–å‘ç°æœ‰å¤šä½™çš„ç©ºæ ¼ç¬¦å’Œæ¢è¡Œç¬¦ï¼Œå¾ªç¯ performer åˆ—è¡¨ï¼Œä½¿ç”¨ <code>strip()</code> æ–¹æ³•å»é™¤å­—ç¬¦ä¸²å¤´å°¾ç©ºæ ¼å’Œæ¢è¡Œç¬¦</p><p>ç”µå½±è¯„åˆ†åˆ†ä¸ºæ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼Œä¾æ¬¡æå–ä¸¤éƒ¨åˆ†ï¼Œå¾ªç¯éå†ç»„æˆä¸€ä¸ªå®Œæ•´çš„è¯„åˆ†</p><p>æœ€åä½¿ç”¨ <code>zip()</code> å‡½æ•°ï¼Œå°†æ‰€æœ‰æå–çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†å¯¹è±¡ä¸­å¯¹åº”çš„å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ï¼Œç„¶åè¿”å›ç”±è¿™äº›å…ƒç»„ç»„æˆçš„åˆ—è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page</span><span class="params">(content)</span>:</span></span><br><span class="line">    tree = etree.HTML(content)</span><br><span class="line">    <span class="comment"># ç”µå½±æ’å</span></span><br><span class="line">    ranking = tree.xpath(<span class="string">"//dd/i/text()"</span>)</span><br><span class="line">    <span class="comment"># ç”µå½±åç§°</span></span><br><span class="line">    movie_name = tree.xpath(<span class="string">'//p[@class="name"]/a/text()'</span>)</span><br><span class="line">    <span class="comment"># ä¸»æ¼”</span></span><br><span class="line">    performer = tree.xpath(<span class="string">"//p[@class='star']/text()"</span>)</span><br><span class="line">    performer = [p.strip() <span class="keyword">for</span> p <span class="keyword">in</span> performer]</span><br><span class="line">    <span class="comment"># ä¸Šæ˜ æ—¶é—´</span></span><br><span class="line">    releasetime = tree.xpath(<span class="string">'//p[@class="releasetime"]/text()'</span>)</span><br><span class="line">    <span class="comment"># è¯„åˆ†</span></span><br><span class="line">    score1 = tree.xpath(<span class="string">'//p[@class="score"]/i[@class="integer"]/text()'</span>)</span><br><span class="line">    score2 = tree.xpath(<span class="string">'//p[@class="score"]/i[@class="fraction"]/text()'</span>)</span><br><span class="line">    score = [score1[i] + score2[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(min(len(score1), len(score2)))]</span><br><span class="line">    <span class="comment"># ç”µå½±å°é¢å›¾</span></span><br><span class="line">    movie_img = tree.xpath(<span class="string">'//img[@class="board-img"]/@data-src'</span>)</span><br><span class="line">    <span class="keyword">return</span> zip(ranking, movie_name, performer, releasetime, score, movie_img)</span><br></pre></td></tr></table></figure><p>æœ€åå®šä¹‰ä¸€ä¸ª <code>save_results()</code> å‡½æ•°ï¼Œå°†æ‰€æœ‰æ•°æ®ä¿å­˜åˆ° <code>maoyan.csv</code> æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_results</span><span class="params">(result)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'maoyan.csv'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        writer = csv.writer(fp)</span><br><span class="line">        writer.writerow(result)</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(number)</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset=%s'</span> % number</span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page</span><span class="params">(content)</span>:</span></span><br><span class="line">    tree = etree.HTML(content)</span><br><span class="line">    <span class="comment"># ç”µå½±æ’å</span></span><br><span class="line">    ranking = tree.xpath(<span class="string">"//dd/i/text()"</span>)</span><br><span class="line">    <span class="comment"># ç”µå½±åç§°</span></span><br><span class="line">    movie_name = tree.xpath(<span class="string">'//p[@class="name"]/a/text()'</span>)</span><br><span class="line">    <span class="comment"># ä¸»æ¼”</span></span><br><span class="line">    performer = tree.xpath(<span class="string">"//p[@class='star']/text()"</span>)</span><br><span class="line">    performer = [p.strip() <span class="keyword">for</span> p <span class="keyword">in</span> performer]</span><br><span class="line">    <span class="comment"># ä¸Šæ˜ æ—¶é—´</span></span><br><span class="line">    releasetime = tree.xpath(<span class="string">'//p[@class="releasetime"]/text()'</span>)</span><br><span class="line">    <span class="comment"># è¯„åˆ†</span></span><br><span class="line">    score1 = tree.xpath(<span class="string">'//p[@class="score"]/i[@class="integer"]/text()'</span>)</span><br><span class="line">    score2 = tree.xpath(<span class="string">'//p[@class="score"]/i[@class="fraction"]/text()'</span>)</span><br><span class="line">    score = [score1[i] + score2[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(min(len(score1), len(score2)))]</span><br><span class="line">    <span class="comment"># ç”µå½±å°é¢å›¾</span></span><br><span class="line">    movie_img = tree.xpath(<span class="string">'//img[@class="board-img"]/@data-src'</span>)</span><br><span class="line">    <span class="keyword">return</span> zip(ranking, movie_name, performer, releasetime, score, movie_img)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_results</span><span class="params">(result)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'maoyan.csv'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        writer = csv.writer(fp)</span><br><span class="line">        writer.writerow(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">print(<span class="string">'å¼€å§‹çˆ¬å–æ•°æ®...'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>):</span><br><span class="line">        index = index_page(i)</span><br><span class="line">        results = parse_page(index)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> results:</span><br><span class="line">            save_results(i)</span><br><span class="line">print(<span class="string">'æ•°æ®çˆ¬å–å®Œæ¯•ï¼ï¼'</span>)</span><br></pre></td></tr></table></figure><p>çˆ¬å–åˆ°çš„æ•°æ®ï¼ˆmaoyan.csv æ–‡ä»¶ï¼‰ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A51/01.png" alt="01"><br></fancybox>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çˆ¬å–æ—¶é—´ï¼š2019-09-23&lt;br&gt;çˆ¬å–éš¾åº¦ï¼šâ˜…â˜†â˜†â˜†â˜†â˜†&lt;br&gt;è¯·æ±‚é“¾æ¥ï¼š&lt;a href=&quot;https://maoyan.com/board/4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://maoyan.com/board/4&lt;/a&gt;&lt;br&gt;çˆ¬å–ç›®æ ‡ï¼šçŒ«çœ¼ TOP100 çš„ç”µå½±åç§°ã€æ’åã€ä¸»æ¼”ã€ä¸Šæ˜ æ—¶é—´ã€è¯„åˆ†ã€å°é¢å›¾åœ°å€ï¼Œæ•°æ®ä¿å­˜ä¸º CSV æ–‡ä»¶&lt;br&gt;æ¶‰åŠçŸ¥è¯†ï¼šè¯·æ±‚åº“ requestsã€è§£æåº“ lxmlã€Xpath è¯­æ³•ã€CSV æ–‡ä»¶å‚¨å­˜&lt;br&gt;å®Œæ•´ä»£ç ï¼š&lt;a href=&quot;https://github.com/TRHX/Python3-Spider-Practice/tree/master/maoyan-top100&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/TRHX/Python3-Spider-Practice/tree/master/maoyan-top100&lt;/a&gt;&lt;br&gt;å…¶ä»–çˆ¬è™«å®æˆ˜ä»£ç åˆé›†ï¼ˆæŒç»­æ›´æ–°ï¼‰ï¼š&lt;a href=&quot;https://github.com/TRHX/Python3-Spider-Practice&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/TRHX/Python3-Spider-Practice&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å®æˆ˜" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AE%9E%E6%88%98/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="çŒ«çœ¼ç”µå½±" scheme="https://www.itrhx.com/tags/%E7%8C%AB%E7%9C%BC%E7%94%B5%E5%BD%B1/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C18</title>
    <link href="https://www.itrhx.com/2019/09/21/A50-Python3-spider-C18/"/>
    <id>https://www.itrhx.com/2019/09/21/A50-Python3-spider-C18/</id>
    <published>2019-09-21T03:59:30.358Z</published>
    <updated>2019-09-24T12:41:19.337Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åå…«ç«  â€”â€” ã€çˆ¬è™«æ¡†æ¶ pyspider â€” æ·±å…¥ç†è§£ã€‘</font></center></blockquote><a id="more"></a><hr><h1 id="ã€18-1ã€‘å¯åŠ¨å‚æ•°"><a href="#ã€18-1ã€‘å¯åŠ¨å‚æ•°" class="headerlink" title="ã€18.1ã€‘å¯åŠ¨å‚æ•°"></a><font color="#ff0000">ã€18.1ã€‘å¯åŠ¨å‚æ•°</font></h1><p>å¸¸ç”¨å¯åŠ¨å‘½ä»¤ï¼š<code>pyspider all</code>ï¼Œå®Œæ•´å‘½ä»¤ç»“æ„ä¸ºï¼š<code>pyspider [OPTIONS] COMMAND [ARGS]</code>ï¼ŒOPTIONS ä¸ºå¯é€‰å‚æ•°ï¼ŒåŒ…å«ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><font color="#ff0000"><strong>-c, â€“config FILENAME</strong></font>ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶åç§°</li><li><font color="#ff0000"><strong>â€“logging-config TEXT</strong></font>ï¼šæ—¥å¿—é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤: pyspider/pyspider/logging.conf</li><li><font color="#ff0000"><strong>â€“debug</strong></font>ï¼šå¼€å¯è°ƒè¯•æ¨¡å¼</li><li><font color="#ff0000"><strong>â€“queue-maxsize INTEGER</strong></font>ï¼šé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦</li><li><font color="#ff0000"><strong>â€“taskdb TEXT</strong></font>ï¼štaskdb çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œé»˜è®¤: sqlite</li><li><font color="#ff0000"><strong>â€“projectdb TEXT</strong></font>ï¼šprojectdb çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œé»˜è®¤: sqlite</li><li><font color="#ff0000"><strong>â€“resultdb TEXT</strong></font>ï¼šresultdb çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œé»˜è®¤: sqlite</li><li><font color="#ff0000"><strong>â€“message-queue TEXT</strong></font>ï¼šæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥å­—ç¬¦ä¸²ï¼Œé»˜è®¤: multiprocessing.Queue</li><li><font color="#ff0000"><strong>â€“phantomjs-proxy TEXT</strong></font>ï¼šPhantomJS ä½¿ç”¨çš„ä»£ç†ï¼Œip:port çš„å½¢å¼</li><li><font color="#ff0000"><strong>â€“data-path TEXT</strong></font>ï¼šæ•°æ®åº“å­˜æ”¾çš„è·¯å¾„</li><li><font color="#ff0000"><strong>â€“add-sys-path / â€“not-add-sys-path</strong></font>ï¼šå°†å½“å‰å·¥ä½œç›®å½•æ·»åŠ åˆ°python libæœç´¢è·¯å¾„</li><li><font color="#ff0000"><strong>â€“version</strong></font>ï¼šæ˜¾ç¤º pyspider çš„ç‰ˆæœ¬ä¿¡æ¯</li><li><font color="#ff0000"><strong>â€“help</strong></font>ï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</li></ul><p>é…ç½®æ–‡ä»¶ä¸ºä¸€ä¸ª JSON æ–‡ä»¶ï¼Œä¸€èˆ¬ä¸º config.json æ–‡ä»¶ï¼Œå¸¸ç”¨é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"taskdb"</span>: <span class="string">"mysql+taskdb://username:password@host:port/taskdb"</span>,</span><br><span class="line">  <span class="string">"projectdb"</span>: <span class="string">"mysql+projectdb://username:password@host:port/projectdb"</span>,</span><br><span class="line">  <span class="string">"resultdb"</span>: <span class="string">"mysql+resultdb://username:password@host:port/resultdb"</span>,</span><br><span class="line">  <span class="string">"message_queue"</span>: <span class="string">"amqp://username:password@host:port/%2F"</span>,</span><br><span class="line">  <span class="string">"webui"</span>: &#123;</span><br><span class="line">  <span class="string">"port"</span>: <span class="number">5000</span>,</span><br><span class="line">    <span class="string">"username"</span>: <span class="string">"some_name"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">"some_passwd"</span>,</span><br><span class="line">    <span class="string">"need-auth"</span>: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è®¾ç½®å¯¹åº”çš„ç”¨æˆ·åï¼Œå¯†ç ï¼Œç«¯å£ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨å‘½ä»¤ <code>pyspider -c config.json all</code> å³å¯è¿è¡Œ</p><hr><h1 id="ã€18-2ã€‘è¿è¡Œå•ä¸ªç»„ä»¶"><a href="#ã€18-2ã€‘è¿è¡Œå•ä¸ªç»„ä»¶" class="headerlink" title="ã€18.2ã€‘è¿è¡Œå•ä¸ªç»„ä»¶"></a><font color="#ff0000">ã€18.2ã€‘è¿è¡Œå•ä¸ªç»„ä»¶</font></h1><p>pyspider çš„æ¶æ„ä¸»è¦åˆ†ä¸º Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰ã€Fetcherï¼ˆæŠ“å–å™¨ï¼‰ã€Processerï¼ˆå¤„ç†å™¨ï¼‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œéƒ½å¯ä»¥å•ç‹¬è¿è¡Œï¼ŒåŸºæœ¬å‘½ä»¤ï¼š <code>pyspider [component_name] [options]</code></p><hr><h2 id="ã€18-2-1ã€‘è¿è¡Œ-Scheduler"><a href="#ã€18-2-1ã€‘è¿è¡Œ-Scheduler" class="headerlink" title="ã€18.2.1ã€‘è¿è¡Œ Scheduler"></a><font color="#1BC3FB">ã€18.2.1ã€‘è¿è¡Œ Scheduler</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyspider scheduler [OPTIONS]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">  --xmlrpc /--no-xmlrpc</span><br><span class="line">  --xmlrpc-host TEXT</span><br><span class="line">  --xmlrpc-port INTEGER</span><br><span class="line">  --inqueue-limit INTEGER  ä»»åŠ¡é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œå¦‚æœæ»¡äº†åˆ™æ–°çš„ä»»åŠ¡ä¼šè¢«å¿½ç•¥</span><br><span class="line">  --delete-time INTEGER    è®¾ç½®ä¸º delete æ ‡è®°ä¹‹å‰çš„åˆ é™¤æ—¶é—´</span><br><span class="line">  --active-tasks INTEGER   å½“å‰æ´»è·ƒä»»åŠ¡æ•°é‡é…ç½®</span><br><span class="line">  --loop-limit INTEGER     å•è½®æœ€å¤šè°ƒåº¦çš„ä»»åŠ¡æ•°é‡</span><br><span class="line">  --fail-pause-num INTEGER ä¸Šæ¬¡å¤±è´¥æ—¶è‡ªåŠ¨æš‚åœé¡¹ç›®æš‚åœæ¬¡æ•°ï¼Œä»»åŠ¡å¤±è´¥ï¼Œå°†<span class="number">0</span>è®¾ç½®ä¸ºç¦ç”¨</span><br><span class="line">  --scheduler-cls TEXT     Scheduler ä½¿ç”¨çš„ç±»</span><br><span class="line">  --threads TEXT           ThreadBaseScheduler çš„çº¿ç¨‹å·ï¼Œé»˜è®¤å€¼ï¼š<span class="number">4</span></span><br><span class="line">  --help                   æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br></pre></td></tr></table></figure><hr><h2 id="ã€18-2-2ã€‘è¿è¡Œ-Fetcher"><a href="#ã€18-2-2ã€‘è¿è¡Œ-Fetcher" class="headerlink" title="ã€18.2.2ã€‘è¿è¡Œ Fetcher"></a><font color="#1BC3FB">ã€18.2.2ã€‘è¿è¡Œ Fetcher</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyspider fetcher [OPTIONS]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">  --xmlrpc /--no-xmlrpc</span><br><span class="line">  --xmlrpc-host TEXT</span><br><span class="line">  --xmlrpc-port INTEGER</span><br><span class="line">  --poolsize INTEGER         åŒæ—¶è¯·æ±‚çš„ä¸ªæ•°</span><br><span class="line">  --proxy TEXT               ä½¿ç”¨çš„ä»£ç†</span><br><span class="line">  --user-agent TEXT          ä½¿ç”¨çš„ User-Agent</span><br><span class="line">  --timeout TEXT             è¶…æ—¶æ—¶é—´</span><br><span class="line">  --phantomjs-endpoint TEXT  phantomjs çš„ç«¯ç‚¹ï¼Œé€šè¿‡ pyspider å¯åŠ¨ phantomjs</span><br><span class="line">  --splash-endpoint TEXT     æ‰§è¡Œ splash çš„ç«¯ç‚¹ï¼šhttp://splash.readthedocs.io/en/stable/api.html execut</span><br><span class="line">  --fetcher-cls TEXT         Fetcher ä½¿ç”¨çš„ç±»</span><br><span class="line">  --help                     æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br></pre></td></tr></table></figure><hr><h2 id="ã€18-2-3ã€‘è¿è¡Œ-Processer"><a href="#ã€18-2-3ã€‘è¿è¡Œ-Processer" class="headerlink" title="ã€18.2.3ã€‘è¿è¡Œ Processer"></a><font color="#1BC3FB">ã€18.2.3ã€‘è¿è¡Œ Processer</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyspider processor [OPTIONS]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">  --processor-cls TEXT  Processor ä½¿ç”¨çš„ç±»</span><br><span class="line">  --process-time-limit INTEGER    è„šæœ¬å¤„ç†æ—¶é—´é™åˆ¶</span><br><span class="line">  --help                          æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br></pre></td></tr></table></figure><hr><h2 id="ã€18-2-4ã€‘è¿è¡Œ-WebUI"><a href="#ã€18-2-4ã€‘è¿è¡Œ-WebUI" class="headerlink" title="ã€18.2.4ã€‘è¿è¡Œ WebUI"></a><font color="#1BC3FB">ã€18.2.4ã€‘è¿è¡Œ WebUI</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyspider webui [OPTIONS]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Options:</span><br><span class="line">  --host TEXT                   è¿è¡Œåœ°å€</span><br><span class="line">  --port INTEGER                è¿è¡Œç«¯å£</span><br><span class="line">  --cdn TEXT                    JS å’Œ CSS çš„ CDN æœåŠ¡å™¨</span><br><span class="line">  --scheduler-rpc TEXT          Scheduler çš„ xmlrpc è·¯å¾„</span><br><span class="line">  --fetcher-rpc TEXT            Fetcher çš„ xmlrpc è·¯å¾„</span><br><span class="line">  --max-rate FLOAT              æ¯ä¸ªé¡¹ç›®æœ€å¤§çš„ rate å€¼</span><br><span class="line">  --max-burst FLOAT             æ¯ä¸ªé¡¹ç›®æœ€å¤§çš„ burst å€¼</span><br><span class="line">  --username TEXT               Auth éªŒè¯çš„ç”¨æˆ·å</span><br><span class="line">  --password TEXT               Auth éªŒè¯çš„å¯†ç </span><br><span class="line">  --need-auth                   æ˜¯å¦éœ€è¦éªŒè¯</span><br><span class="line">  --webui-instance TEXT         è¿è¡Œæ—¶ä½¿ç”¨çš„ Flask åº”ç”¨</span><br><span class="line">  --process-time-limit INTEGER  è°ƒè¯•ä¸­çš„è„šæœ¬å¤„ç†æ—¶é—´é™åˆ¶</span><br><span class="line">  --help                        æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br></pre></td></tr></table></figure><hr><h1 id="ã€18-3ã€‘crawl-æ–¹æ³•å„å‚æ•°"><a href="#ã€18-3ã€‘crawl-æ–¹æ³•å„å‚æ•°" class="headerlink" title="ã€18.3ã€‘crawl() æ–¹æ³•å„å‚æ•°"></a><font color="#ff0000">ã€18.3ã€‘crawl() æ–¹æ³•å„å‚æ•°</font></h1><p>å‚æ•°æ–‡æ¡£ï¼š<a href="http://docs.pyspider.org/en/latest/apis/self.crawl/" target="_blank" rel="noopener">http://docs.pyspider.org/en/latest/apis/self.crawl/</a></p><hr><ul><li><font color="#ff0000"><strong>url</strong></font>ï¼šçˆ¬å–ç›®æ ‡ URLï¼Œå¯ä»¥å®šä¹‰ä¸ºå•ä¸ª URL å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆ URL åˆ—è¡¨</li></ul><hr><ul><li><font color="#ff0000"><strong>callback</strong></font>ï¼šå›è°ƒå‡½æ•°ï¼ŒæŒ‡å®šäº†è¯¥ URL å¯¹åº”çš„å“åº”å†…å®¹ç”¨å“ªä¸ªæ–¹æ³•æ¥è§£æï¼Œç¤ºä¾‹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.itrhx.com/'</span>, callback=self.index_page)</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼šæŒ‡å®š <code>callback</code> ä¸º <code>index_page</code>ï¼Œä»£è¡¨çˆ¬å– <a href="http://www.itrhx.com/">http://www.itrhx.com/</a> å¾—åˆ°çš„å“åº”ä¼šç”¨ <code>index_page()</code> æ–¹æ³•æ¥è§£æï¼Œè€Œ <code>index_page()</code> æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯å“åº”å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>age</strong></font>ï¼šä»»åŠ¡çš„æœ‰æ•ˆæ—¶é—´ï¼Œå¦‚æœæŸä¸ªä»»åŠ¡åœ¨æœ‰æ•ˆæ—¶é—´å†…ä¸”å·²ç»è¢«æ‰§è¡Œï¼Œåˆ™å®ƒä¸ä¼šé‡å¤æ‰§è¡Œï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§è®¾ç½®æ–¹æ³•ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.itrhx.com/'</span>, callback=self.callback, age=<span class="number">10</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@config(age=10 * 24 * 60 * 60)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>priority</strong></font>ï¼šçˆ¬å–ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œå…¶å€¼é»˜è®¤æ˜¯ 0ï¼Œpriority çš„æ•°å€¼è¶Šå¤§ï¼Œå¯¹åº”çš„è¯·æ±‚ä¼šè¶Šä¼˜å…ˆè¢«è°ƒåº¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ<code>2.html</code> é¡µé¢å°†ä¼šä¼˜å…ˆçˆ¬å–ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.itrhx.com/1.html'</span>, callback=self.index_page)</span><br><span class="line">  self.crawl(<span class="string">'http://www.itrhx.com/2.html'</span>, callback=self.detail_page, priority=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>exetime</strong></font>ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œå…¶å€¼æ˜¯æ—¶é—´æˆ³ï¼Œé»˜è®¤æ˜¯ 0ï¼Œå³ä»£è¡¨ç«‹å³æ‰§è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºè¡¨ç¤ºè¯¥ä»»åŠ¡ä¼šåœ¨ 30 åˆ†é’Ÿä¹‹åæ‰§è¡Œï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.itrhx.com/'</span>, callback=self.callback, exetime=time.time()+<span class="number">30</span>*<span class="number">60</span>)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>retries</strong></font>ï¼šå®šä¹‰é‡è¯•æ¬¡æ•°ï¼Œå…¶å€¼é»˜è®¤æ˜¯ 3</li></ul><hr><ul><li><font color="#ff0000"><strong>itag</strong></font>ï¼šè®¾ç½®åˆ¤å®šç½‘é¡µæ˜¯å¦å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹å€¼ï¼Œåœ¨çˆ¬å–æ—¶ä¼šåˆ¤å®šæ¬¡å½“å‰èŠ‚ç‚¹æ˜¯å¦å’Œä¸Šæ¬¡çˆ¬å–åˆ°çš„èŠ‚ç‚¹ç›¸åŒã€‚å¦‚æœèŠ‚ç‚¹ç›¸åŒï¼Œåˆ™è¯æ˜é¡µé¢æ²¡æœ‰æ›´æ–°ï¼Œå°±ä¸ä¼šé‡å¤çˆ¬å–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">  <span class="keyword">for</span> item <span class="keyword">in</span> response.doc(<span class="string">'.item'</span>).items():</span><br><span class="line">      self.crawl(item.find(<span class="string">'a'</span>).attr.url, callback=self.detail_page, itag=item.find(<span class="string">'.update-time'</span>).text())</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼šè®¾ç½® <code>update-time</code> è¿™ä¸ªèŠ‚ç‚¹çš„å€¼ä¸º itagï¼Œåœ¨ä¸‹æ¬¡çˆ¬å–æ—¶å°±ä¼šé¦–å…ˆæ£€æµ‹è¿™ä¸ªå€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸å†é‡å¤çˆ¬å–ï¼Œå¦åˆ™æ‰§è¡Œçˆ¬å–</p><hr><ul><li><font color="#ff0000"><strong>auto_recrawl</strong></font>ï¼šå¼€å¯æ—¶ï¼Œçˆ¬å–ä»»åŠ¡åœ¨è¿‡æœŸåä¼šé‡æ–°æ‰§è¡Œï¼Œå¾ªç¯æ—¶é—´å³å®šä¹‰çš„ age æ—¶é—´é•¿åº¦ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.itrhx.com/'</span>, callback=self.callback, age=<span class="number">5</span>*<span class="number">60</span>*<span class="number">60</span>, auto_recrawl=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼šå®šä¹‰ <code>age</code> æœ‰æ•ˆæœŸä¸º 5 å°æ—¶ï¼Œè®¾ç½®äº† <code>auto_recrawl</code> ä¸º <code>True</code>ï¼Œè¿™æ ·ä»»åŠ¡å°±ä¼šæ¯ 5 å°æ—¶æ‰§è¡Œä¸€æ¬¡</p><hr><ul><li><font color="#ff0000"><strong>method</strong></font>ï¼šHTTP è¯·æ±‚æ–¹å¼ï¼Œé»˜è®¤ä¸º GETï¼Œå¦‚æœæƒ³å‘èµ· POST è¯·æ±‚ï¼Œå¯ä»¥å°† method è®¾ç½®ä¸º POST</li></ul><hr><ul><li><font color="#ff0000"><strong>params</strong></font>ï¼šå®šä¹‰ GET è¯·æ±‚å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºè¡¨ç¤ºä¸¤ä¸ªç­‰ä»·çš„çˆ¬å–ä»»åŠ¡ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://httpbin.org/get'</span>, callback=self.callback, params=&#123;<span class="string">'a'</span>: <span class="number">123</span>, <span class="string">'b'</span>: <span class="string">'c'</span>&#125;)</span><br><span class="line">  self.crawl(<span class="string">'http://httpbin.org/get?a=123&amp;b=c'</span>, callback=self.callback)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>data</strong></font>ï¼šPOST è¡¨å•æ•°æ®ï¼Œå½“è¯·æ±‚æ–¹å¼ä¸º POST æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤å‚æ•°ä¼ é€’è¡¨å•æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://httpbin.org/post'</span>, callback=self.callback, method=<span class="string">'POST'</span>, data=&#123;<span class="string">'a'</span>: <span class="number">123</span>, <span class="string">'b'</span>: <span class="string">'c'</span>&#125;)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>files</strong></font>ï¼šä¸Šä¼ çš„æ–‡ä»¶ï¼Œéœ€è¦æŒ‡å®šæ–‡ä»¶åï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://httpbin.org/post'</span>, callback=self.callback, method=<span class="string">'POST'</span>, files=&#123;field: &#123;filename: <span class="string">'content'</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>user_agent</strong></font>ï¼šçˆ¬å–ä½¿ç”¨çš„ User-Agent</li></ul><hr><ul><li><font color="#ff0000"><strong>headers</strong></font>ï¼šçˆ¬å–æ—¶ä½¿ç”¨çš„ Headersï¼Œå³ Request Headers</li></ul><hr><ul><li><font color="#ff0000"><strong>cookies</strong></font>ï¼šçˆ¬å–æ—¶ä½¿ç”¨çš„ Cookiesï¼Œä¸ºå­—å…¸æ ¼å¼</li></ul><hr><ul><li><font color="#ff0000"><strong>connect_timeout</strong></font>ï¼šåœ¨åˆå§‹åŒ–è¿æ¥æ—¶çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤ä¸º 20 ç§’</li></ul><hr><ul><li><font color="#ff0000"><strong>timeout</strong></font>ï¼šæŠ“å–ç½‘é¡µæ—¶çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤ä¸º 120 ç§’</li></ul><hr><ul><li><font color="#ff0000"><strong>allow_redirects</strong></font>ï¼šç¡®å®šæ˜¯å¦è‡ªåŠ¨å¤„ç†é‡å®šå‘ï¼Œé»˜è®¤ä¸º True</li></ul><hr><ul><li><font color="#ff0000"><strong>validate_cert</strong></font>ï¼šç¡®å®šæ˜¯å¦éªŒè¯è¯ä¹¦ï¼Œæ­¤é€‰é¡¹å¯¹ HTTPS è¯·æ±‚æœ‰æ•ˆï¼Œé»˜è®¤ä¸º True</li></ul><hr><ul><li><font color="#ff0000"><strong>proxy</strong></font>ï¼šçˆ¬å–æ—¶ä½¿ç”¨çš„ä»£ç†ï¼Œæ”¯æŒç”¨æˆ·åå¯†ç çš„é…ç½®ï¼Œæ ¼å¼ä¸º <code>username:password@hostname:port</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://httpbin.org/get'</span>, callback=self.callback, proxy=<span class="string">'127.0.0.1:9743'</span>)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è®¾ç½® <code>craw_config</code> æ¥å®ç°å…¨å±€é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line">  crawl_config = &#123;<span class="string">'proxy'</span>: <span class="string">'127.0.0.1:9743'</span>&#125;</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>fetch_type</strong></font>ï¼šå¼€å¯ PhantomJS æ¸²æŸ“ï¼Œå¦‚æœé‡åˆ° JavaScript æ¸²æŸ“çš„é¡µé¢ï¼ŒæŒ‡å®šæ­¤å­—æ®µå³å¯å®ç° PhantomJS çš„å¯¹æ¥ï¼Œpyspider å°†ä¼šä½¿ç”¨ PhantomJS è¿›è¡Œç½‘é¡µçš„æŠ“å–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'https://www.taobao.com'</span>, callback=self.index_page, fetch_type=<span class="string">'js'</span>)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>js_script</strong></font>ï¼šé¡µé¢åŠ è½½å®Œæ¯•åæ‰§è¡Œçš„ JavaScript è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œé¡µé¢åŠ è½½æˆåŠŸåå°†æ‰§è¡Œé¡µé¢æ··åŠ¨çš„ JavaScript ä»£ç ï¼Œé¡µé¢ä¼šä¸‹æ‹‰åˆ°æœ€åº•éƒ¨ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.example.org/'</span>, callback=self.callback,</span><br><span class="line">             fetch_type=<span class="string">'js'</span>, js_script=<span class="string">'''</span></span><br><span class="line"><span class="string">             function() &#123;window.scrollTo(0,document.body.scrollHeight);</span></span><br><span class="line"><span class="string">                 return 123;</span></span><br><span class="line"><span class="string">             &#125;</span></span><br><span class="line"><span class="string">             '''</span>)</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>js_run_at</strong></font>ï¼šä»£è¡¨ JavaScript è„šæœ¬è¿è¡Œçš„ä½ç½®ï¼Œæ˜¯åœ¨é¡µé¢èŠ‚ç‚¹å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œé»˜è®¤æ˜¯ç»“å°¾ï¼Œå³ <code>document-end</code></li></ul><hr><ul><li><font color="#ff0000"><strong>js_viewport_width/js_viewport_height</strong></font>ï¼šJavaScript æ¸²æŸ“é¡µé¢æ—¶çš„çª—å£å¤§å°</li></ul><hr><ul><li><font color="#ff0000"><strong>load_images</strong></font>ï¼šåœ¨åŠ è½½ JavaScript é¡µé¢æ—¶ç¡®å®šæ˜¯å¦åŠ è½½å›¾ç‰‡ï¼Œé»˜è®¤ä¸ºå¦</li></ul><hr><ul><li><font color="#ff0000"><strong>save</strong></font>ï¼šåœ¨ä¸åŒçš„æ–¹æ³•ä¹‹é—´ä¼ é€’å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">  self.crawl(<span class="string">'http://www.example.org/'</span>, callback=self.callback,</span><br><span class="line">             save=&#123;<span class="string">'page'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(self, response)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> response.save[<span class="string">'page'</span>]</span><br></pre></td></tr></table></figure><hr><ul><li><font color="#ff0000"><strong>cancel</strong></font>ï¼šå–æ¶ˆä»»åŠ¡ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡æ˜¯ <code>ACTIVE</code> çŠ¶æ€çš„ï¼Œåˆ™éœ€è¦å°† <code>force_update</code> è®¾ç½®ä¸º <code>True</code></li></ul><hr><ul><li><font color="#ff0000"><strong>force_update</strong></font>ï¼šå³ä½¿ä»»åŠ¡å¤„äº ACTIVE çŠ¶æ€ï¼Œé‚£ä¹Ÿä¼šå¼ºåˆ¶æ›´æ–°çŠ¶æ€</li></ul><hr><h1 id="ã€18-4ã€‘ä»»åŠ¡åŒºåˆ†"><a href="#ã€18-4ã€‘ä»»åŠ¡åŒºåˆ†" class="headerlink" title="ã€18.4ã€‘ä»»åŠ¡åŒºåˆ†"></a><font color="#ff0000">ã€18.4ã€‘ä»»åŠ¡åŒºåˆ†</font></h1><p>pyspider åˆ¤æ–­ä¸¤ä¸ªä»»åŠ¡æ˜¯å¦æ˜¯é‡å¤çš„æ˜¯ä½¿ç”¨çš„æ˜¯è¯¥ä»»åŠ¡å¯¹åº”çš„ URL çš„ MD5 å€¼ä½œä¸ºä»»åŠ¡çš„å”¯ä¸€ IDï¼Œå¦‚æœ ID ç›¸åŒï¼Œé‚£ä¹ˆä¸¤ä¸ªä»»åŠ¡å°±ä¼šåˆ¤å®šä¸ºç›¸åŒï¼Œå…¶ä¸­ä¸€ä¸ªå°±ä¸ä¼šçˆ¬å–äº†</p><p>æŸäº›æƒ…å†µä¸‹ï¼Œè¯·æ±‚çš„é“¾æ¥æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯ POST çš„å‚æ•°ä¸åŒï¼Œè¿™æ—¶å¯ä»¥é‡å†™ <code>task_id()</code> æ–¹æ³•ï¼Œåˆ©ç”¨ URL å’Œ POST çš„å‚æ•°æ¥ç”Ÿæˆ IDï¼Œæ”¹å˜è¿™ä¸ª ID çš„è®¡ç®—æ–¹å¼æ¥å®ç°ä¸åŒä»»åŠ¡çš„åŒºåˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pyspider.libs.utils <span class="keyword">import</span> md5string</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_taskid</span><span class="params">(self, task)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> md5string(task[<span class="string">'url'</span>]+json.dumps(task[<span class="string">'fetch'</span>].get(<span class="string">'data'</span>, <span class="string">''</span>)))</span><br></pre></td></tr></table></figure><hr><h1 id="ã€18-5ã€‘å…¨å±€é…ç½®"><a href="#ã€18-5ã€‘å…¨å±€é…ç½®" class="headerlink" title="ã€18.5ã€‘å…¨å±€é…ç½®"></a><font color="#ff0000">ã€18.5ã€‘å…¨å±€é…ç½®</font></h1><p>pyspider å¯ä»¥ä½¿ç”¨ <code>crawl_config</code> æ¥æŒ‡å®šå…¨å±€çš„é…ç½®ï¼Œé…ç½®ä¸­çš„å‚æ•°ä¼šå’Œ <code>crawl()</code> æ–¹æ³•åˆ›å»ºä»»åŠ¡æ—¶çš„å‚æ•°åˆå¹¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">        <span class="string">'headers'</span>: &#123;<span class="string">'User-Agent'</span>: <span class="string">'GoogleBot'</span>,&#125;</span><br><span class="line">        <span class="string">'proxy'</span>: <span class="string">'127.0.0.1:9743'</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h1 id="ã€18-6ã€‘å®šæ—¶çˆ¬å–"><a href="#ã€18-6ã€‘å®šæ—¶çˆ¬å–" class="headerlink" title="ã€18.6ã€‘å®šæ—¶çˆ¬å–"></a><font color="#ff0000">ã€18.6ã€‘å®šæ—¶çˆ¬å–</font></h1><p>é€šè¿‡ <code>every</code> å±æ€§æ¥è®¾ç½®çˆ¬å–çš„æ—¶é—´é—´éš”ï¼Œå¦‚ä¸‹ä»£ç è¡¨ç¤ºæ¯å¤©æ‰§è¡Œä¸€æ¬¡çˆ¬å–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@every(minutes=24 * 60)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urllist:</span><br><span class="line">        self.crawl(url, callback=self.index_page)</span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼šå¦‚æœè®¾ç½®äº†ä»»åŠ¡çš„æœ‰æ•ˆæ—¶é—´ï¼ˆage å‚æ•°ï¼‰ï¼Œå› ä¸ºåœ¨æœ‰æ•ˆæ—¶é—´å†…çˆ¬å–ä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥è¦æŠŠæœ‰æ•ˆæ—¶é—´è®¾ç½®å¾—æ¯”é‡å¤æ—¶é—´æ›´çŸ­ï¼Œè¿™æ ·æ‰å¯ä»¥å®ç°å®šæ—¶çˆ¬å–</p><p>é”™è¯¯ä¸¾ä¾‹ï¼šè®¾å®šä»»åŠ¡çš„è¿‡æœŸæ—¶é—´ä¸º 5 å¤©ï¼Œè€Œè‡ªåŠ¨çˆ¬å–çš„æ—¶é—´é—´éš”ä¸º 1 å¤©ï¼Œå½“ç¬¬äºŒæ¬¡å°è¯•é‡æ–°çˆ¬å–çš„æ—¶å€™ï¼Œpyspider ä¼šç›‘æµ‹åˆ°æ­¤ä»»åŠ¡å°šæœªè¿‡æœŸï¼Œä¾¿ä¸ä¼šæ‰§è¡Œçˆ¬å–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@every(minutes=24 * 60)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.crawl(<span class="string">'http://www.itrhx.com/'</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">@config(age=5 * 24 * 60 * 60)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åå…«ç«  â€”â€” ã€çˆ¬è™«æ¡†æ¶ pyspider â€” æ·±å…¥ç†è§£ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="pyspider" scheme="https://www.itrhx.com/tags/pyspider/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C17</title>
    <link href="https://www.itrhx.com/2019/09/18/A49-Python3-spider-C17/"/>
    <id>https://www.itrhx.com/2019/09/18/A49-Python3-spider-C17/</id>
    <published>2019-09-18T06:18:23.904Z</published>
    <updated>2019-09-24T12:41:15.652Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åä¸ƒç«  â€”â€” ã€çˆ¬è™«æ¡†æ¶ pyspider â€” åŸºæœ¬ä½¿ç”¨ã€‘</font></center></blockquote><a id="more"></a><hr><h1 id="ã€17-1ã€‘åˆè¯†-pyspider"><a href="#ã€17-1ã€‘åˆè¯†-pyspider" class="headerlink" title="ã€17.1ã€‘åˆè¯† pyspider"></a><font color="#ff0000">ã€17.1ã€‘åˆè¯† pyspider</font></h1><p>pyspider æ˜¯ç”±å›½äºº Binux ç¼–å†™çš„ä¸€ä¸ª Python çˆ¬è™«æ¡†æ¶</p><ul><li>GitHubï¼š<a href="https://github.com/binux/pyspider" target="_blank" rel="noopener">https://github.com/binux/pyspider</a> </li><li>å®˜æ–¹æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰ï¼š<a href="http://docs.pyspider.org/" target="_blank" rel="noopener">http://docs.pyspider.org/</a></li><li>éå®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰ï¼š<a href="http://book.crifan.com/books/python_spider_pyspider/website/" target="_blank" rel="noopener">http://book.crifan.com/books/python_spider_pyspider/website/</a></li><li>éå®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰ï¼š<a href="https://www.cntofu.com/book/156/index.md" target="_blank" rel="noopener">https://www.cntofu.com/book/156/index.md</a></li></ul><p>pyspider ç‰¹æ€§ï¼š</p><ul><li>python è„šæœ¬æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½• html è§£æåŒ…ï¼ˆå†…ç½® pyqueryï¼‰</li><li>WEB ç•Œé¢ç¼–å†™è°ƒè¯•è„šæœ¬ï¼Œèµ·åœè„šæœ¬ï¼Œç›‘æ§æ‰§è¡ŒçŠ¶æ€ï¼ŒæŸ¥çœ‹æ´»åŠ¨å†å²ï¼Œè·å–ç»“æœäº§å‡º</li><li>æ”¯æŒ MySQLã€MongoDBã€Redisã€SQLiteã€Elasticsearchã€PostgreSQL</li><li>å¯¹æ¥äº† PhantomJSï¼Œæ”¯æŒæŠ“å– JavaScript çš„é¡µé¢</li><li>ç»„ä»¶å¯æ›¿æ¢ï¼Œæ”¯æŒå•æœºå’Œåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæ”¯æŒ Docker éƒ¨ç½²</li><li>æä¾›ä¼˜å…ˆçº§æ§åˆ¶ã€å¤±è´¥é‡è¯•ã€å®šæ—¶æŠ“å–ç­‰åŠŸèƒ½</li></ul><p>Windows ç³»ç»Ÿå®‰è£… pyspiderï¼š</p><p>ä½¿ç”¨å‘½ä»¤ <code>pip install pyspider</code> å®‰è£…ï¼Œè‹¥æŠ¥ PyCurl ç›¸å…³é”™è¯¯ï¼Œå¯è®¿é—® <a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#pycurl" target="_blank" rel="noopener">https://www.lfd.uci.edu/~gohlke/pythonlibs/#pycurl</a> ä¸‹è½½å¯¹åº” wheel æ–‡ä»¶å¹¶ä½¿ç”¨å‘½ä»¤ <code>pip install whlæ–‡ä»¶å</code> å®‰è£…å³å¯</p><p>å¦‚æœè¦çˆ¬å– JavaScrip æ¸²æŸ“çš„é¡µé¢ï¼Œè¿˜è¦ä¸‹è½½ PhantomJSï¼Œå¹¶å°† PhantomJS çš„è·¯å¾„é…ç½®åˆ°ç¯å¢ƒå˜é‡é‡Œï¼Œæˆ–è€…ç›´æ¥å¤åˆ¶åˆ° Python å®‰è£…ç›®å½•çš„ Scripts æ–‡ä»¶å¤¹ï¼Œéœ€è¦ç”¨åˆ°æ•°æ®åº“å‚¨å­˜çš„è¯ï¼ŒåŒæ ·è¦å®‰è£…å¥½ç›¸åº”çš„æ•°æ®åº“</p><p>å‡†å¤‡å°±ç»ªåï¼Œä½¿ç”¨ <code>pyspider all</code> å‘½ä»¤å¯å¯åŠ¨ pyspiderï¼Œæµè§ˆå™¨æ‰“å¼€ï¼š<a href="http://localhost:5000/" target="_blank" rel="noopener">http://localhost:5000/</a> å¯ä»¥çœ‹åˆ° pyspider çš„ WebUI ç®¡ç†ç•Œé¢</p><hr><h1 id="ã€17-2ã€‘ä½¿ç”¨-pyspider"><a href="#ã€17-2ã€‘ä½¿ç”¨-pyspider" class="headerlink" title="ã€17.2ã€‘ä½¿ç”¨ pyspider"></a><font color="#ff0000">ã€17.2ã€‘ä½¿ç”¨ pyspider</font></h1><hr><h2 id="ã€17-2-1ã€‘ä¸»ç•Œé¢"><a href="#ã€17-2-1ã€‘ä¸»ç•Œé¢" class="headerlink" title="ã€17.2.1ã€‘ä¸»ç•Œé¢"></a><font color="#1BC3FB">ã€17.2.1ã€‘ä¸»ç•Œé¢</font></h2><p>å½“æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªçˆ¬è™«é¡¹ç›®åï¼Œä¸»ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/01.png" alt="01"><br></fancybox><ul><li><p><font color="#ff0000">Recent Active Tasks</font>ï¼šæŸ¥çœ‹æœ€è¿‘æ´»åŠ¨çš„ä»»åŠ¡ï¼Œä¼šè·³è½¬åˆ°ä¸€ä¸ªé¡µé¢æœ‰åˆ—è¡¨æ˜¾ç¤º</p></li><li><p><font color="#ff0000">Create</font>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çˆ¬è™«é¡¹ç›®</p></li><li><p><font color="#ff0000">group</font>ï¼šå®šä¹‰é¡¹ç›®çš„åˆ†ç»„ï¼Œä»¥æ–¹ä¾¿ç®¡ç†ï¼Œè‹¥ group è®¾ç½®ä¸º deleteï¼Œåˆ™è¯¥é¡¹ç›®å°†ä¼šåœ¨24å°æ—¶ä¹‹ååˆ é™¤</p></li><li><p><font color="#ff0000">project name</font>ï¼šçˆ¬è™«é¡¹ç›®åç§°</p></li><li><p><font color="#ff0000">status</font>ï¼šé¡¹ç›®çŠ¶æ€ï¼Œå„çŠ¶æ€å¦‚ä¸‹ï¼š<br> <font color="#1BC3FB">TODO</font>ï¼šä¸€ä¸ªçˆ¬è™«é¡¹ç›®åˆšåˆšåˆ›å»ºæ—¶çš„çŠ¶æ€ï¼Œæ­¤çŠ¶æ€ä¸‹å¯ä»¥ç¼–è¾‘ Python ä»£ç <br> <font color="#1BC3FB">STOP</font>ï¼šä¸­æ­¢é¡¹ç›®çš„è¿è¡Œ<br> <font color="#1BC3FB">CHECKING</font>ï¼šå½“ä¸€ä¸ªè¿è¡Œä¸­çš„é¡¹ç›®è¢«ç¼–è¾‘æ—¶é¡¹ç›®çŠ¶æ€ä¼šè¢«è‡ªåŠ¨è®¾ç½®æˆæ­¤çŠ¶æ€å¹¶ä¸­æ­¢è¿è¡Œ<br> <font color="#1BC3FB">DEBUG</font>ï¼šä¼šè¿è¡Œçˆ¬è™«ï¼Œé¡¾åæ€ä¹‰æ‰¾ BUGï¼Œä¸€èˆ¬æ¥è¯´ç”¨äºè°ƒè¯•é˜¶æ®µ<br> <font color="#1BC3FB">RUNNING</font>ï¼šè¿è¡Œçˆ¬è™«é¡¹ç›®<br> <font color="#1BC3FB">PAUSED</font>ï¼šé¡¹ç›®æš‚åœè¿è¡Œï¼Œé»˜è®¤æ²¡æœ‰è¿™ä¸ªçŠ¶æ€ï¼Œä½†æ˜¯å½“ä½ åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çªç„¶æ–­ç½‘å°±ä¼šå‡ºç°æ­¤çŠ¶æ€</p></li><li><p><font color="#ff0000">rate/burst</font>ï¼šå½“å‰çš„çˆ¬å–é€Ÿç‡ï¼Œrate ä»£è¡¨ 1 ç§’å‘å‡ºå¤šå°‘ä¸ªè¯·æ±‚ï¼Œburst ç›¸å½“äºæµé‡æ§åˆ¶ä¸­çš„ä»¤ç‰Œæ¡¶ç®—æ³•çš„ä»¤ç‰Œæ•°ï¼Œrate å’Œ burst è®¾ç½®çš„è¶Šå¤§ï¼Œçˆ¬å–é€Ÿç‡è¶Šå¿«ï¼Œé€Ÿç‡çš„è®¾å®šéœ€è¦è€ƒè™‘æœ¬æœºæ€§èƒ½å’Œçˆ¬å–è¿‡å¿«è¢«å°çš„é—®é¢˜</p></li><li><p><font color="#ff0000">avg time</font>ï¼šä»»åŠ¡å¹³å‡æ—¶é—´</p></li><li><p><font color="#ff0000">process</font>ï¼š5mã€1hã€1d åˆ†åˆ«æŒ‡çš„æ˜¯æœ€è¿‘ 5 åˆ†ã€1 å°æ—¶ã€1 å¤©å†…çš„è¯·æ±‚æƒ…å†µï¼Œall ä»£è¡¨æ‰€æœ‰çš„è¯·æ±‚æƒ…å†µï¼Œè¯·æ±‚ç”±ä¸åŒé¢œè‰²è¡¨ç¤ºï¼Œè“è‰²çš„ä»£è¡¨ç­‰å¾…è¢«æ‰§è¡Œçš„è¯·æ±‚ï¼Œç»¿è‰²çš„ä»£è¡¨æˆåŠŸçš„è¯·æ±‚ï¼Œé»„è‰²çš„ä»£è¡¨è¯·æ±‚å¤±è´¥åç­‰å¾…é‡è¯•çš„è¯·æ±‚ï¼Œçº¢è‰²çš„ä»£è¡¨å¤±è´¥æ¬¡æ•°è¿‡å¤šè€Œè¢«å¿½ç•¥çš„è¯·æ±‚</p></li><li><p><font color="#ff0000">actions</font>ï¼šå¯¹çˆ¬è™«é¡¹ç›®çš„æ“ä½œï¼Œå„æ“ä½œå¦‚ä¸‹ï¼š<br> <font color="#1BC3FB">Run</font>ï¼šç«‹å³æ‰§è¡Œä»»åŠ¡ï¼Œéœ€è¦ status ä¸º RUNNING æˆ–è€… DEBUG çŠ¶æ€ï¼›å‡å¦‚åœ¨é…ç½®çš„è°ƒåº¦æ‰§è¡Œæ—¶é—´å†…å·²ç»æ‰§è¡Œè¿‡ï¼Œå†ç‚¹ run æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åˆ é™¤ task.db é‡Œçš„æ•°æ®æ‰è¡Œ<br> <font color="#1BC3FB">Active Tasks</font>ï¼šæŸ¥çœ‹å½“å‰çˆ¬è™«é¡¹ç›®çš„æ´»åŠ¨ä»»åŠ¡<br> <font color="#1BC3FB">Results</font>ï¼šæŸ¥çœ‹é¡¹ç›®è¿è¡Œç»“æœ</p></li></ul><hr><h2 id="ã€17-2-2ã€‘é¡¹ç›®ç•Œé¢"><a href="#ã€17-2-2ã€‘é¡¹ç›®ç•Œé¢" class="headerlink" title="ã€17.2.2ã€‘é¡¹ç›®ç•Œé¢"></a><font color="#1BC3FB">ã€17.2.2ã€‘é¡¹ç›®ç•Œé¢</font></h2><p>åˆ›å»ºä¸€ä¸ªçˆ¬è™«é¡¹ç›®ï¼Œç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/02.png" alt="02"><br></fancybox><ul><li><font color="#ff0000">åˆ›å»ºé¡¹ç›®</font>ï¼šç‚¹å‡» Create å³å¯æ–°å»ºä¸€ä¸ªçˆ¬è™«é¡¹ç›®</li><li><font color="#ff0000">Project Name</font>ï¼šçˆ¬è™«é¡¹ç›®åç§°</li><li><font color="#ff0000">Start URL(s)</font> ï¼šçˆ¬è™«å…¥å£åœ°å€ï¼Œé€‰å¡«ï¼Œå¯åœ¨é¡¹ç›®ä¸­æ›´æ”¹</li></ul><p>é¡¹ç›®åˆ›å»ºå®Œæˆè¿›å…¥è°ƒè¯•ç•Œé¢ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/03.png" alt="03"><br></fancybox><ul><li><p><font color="#ff0000">è°ƒè¯•ç•Œé¢å³è¾¹</font>ï¼šç¼–å†™ä»£ç çš„åŒºåŸŸ</p></li><li><p><font color="#ff0000">è°ƒè¯•ç•Œé¢å·¦è¾¹</font>ï¼šè°ƒè¯•çš„åŒºåŸŸï¼Œç”¨äºæ‰§è¡Œä»£ç ï¼Œæ˜¾ç¤ºè¾“å‡ºä¿¡æ¯ç­‰ç”¨é€”</p></li><li><p><font color="#ff0000">run</font>ï¼šå•æ­¥è°ƒè¯•çˆ¬è™«ç¨‹åºï¼Œç‚¹å‡»å°±å¯è¿è¡Œå½“å‰ä»»åŠ¡</p></li><li><p><font color="#ff0000">&lt; &gt; ç®­å¤´</font>ï¼šä¸Šä¸€æ­¥ã€ä¸‹ä¸€æ­¥ï¼Œç”¨äºè°ƒè¯•è¿‡ç¨‹ä¸­åˆ‡æ¢åˆ°ä¸Šä¸€æ­¥éª¤æˆ–è€…ä¸‹ä¸€æ­¥éª¤</p></li><li><p><font color="#ff0000">save</font>ï¼šä¿å­˜å½“å‰ä»£ç ï¼Œå½“ä»£ç å˜æ›´ååªæœ‰ä¿å­˜äº†å†è¿è¡Œæ‰èƒ½å¾—åˆ°æœ€æ–°ç»“æœ</p></li><li><p><font color="#ff0000">enable css selector helper</font>ï¼š CSS é€‰æ‹©å™¨è¾…åŠ©ç¨‹åº</p></li><li><p><font color="#ff0000">web</font>ï¼šé¡µé¢é¢„è§ˆ</p></li><li><p><font color="#ff0000">html</font>ï¼šå¯ä»¥æŸ¥çœ‹é¡µé¢æºä»£ç </p></li><li><p><font color="#ff0000">follows</font>ï¼šè¡¨ç¤ºçˆ¬å–è¯·æ±‚ï¼Œç‚¹å‡»å¯æŸ¥çœ‹æ‰€æœ‰çš„è¯·æ±‚</p></li></ul><p>åœ¨æ–°å»ºä¸€ä¸ªçˆ¬è™«é¡¹ç›®çš„æ—¶å€™ï¼Œpyspider å·²ç»è‡ªåŠ¨ç”Ÿæˆäº†å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2019-09-17 21:18:13</span></span><br><span class="line"><span class="comment"># Project: 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @every(minutes=24 * 60)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.crawl(<span class="string">'__START_URL__'</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(age=10 * 24 * 60 * 60)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">'a[href^="http"]'</span>).items():</span><br><span class="line">            self.crawl(each.attr.href, callback=self.detail_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(priority=2)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detail_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">"url"</span>: response.url,</span><br><span class="line">            <span class="string">"title"</span>: response.doc(<span class="string">'title'</span>).text(),</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><ul><li><p><font color="#ff0000">class Handler()ï¼š</font>pyspider çˆ¬è™«çš„ä¸»ç±»ï¼Œå¯ä»¥åœ¨æ­¤å¤„å®šä¹‰çˆ¬å–ã€è§£æã€å­˜å‚¨çš„é€»è¾‘ã€‚æ•´ä¸ªçˆ¬è™«çš„åŠŸèƒ½åªéœ€è¦ä¸€ä¸ª Handler å³å¯å®Œæˆ</p></li><li><p><font color="#ff0000">crawl_config å±æ€§ï¼š</font>é¡¹ç›®çš„æ‰€æœ‰çˆ¬å–é…ç½®å°†ä¼šç»Ÿä¸€å®šä¹‰åˆ°è¿™é‡Œï¼Œå¦‚å®šä¹‰ headersã€è®¾ç½®ä»£ç†ç­‰ï¼Œé…ç½®ä¹‹åå…¨å±€ç”Ÿæ•ˆ</p></li><li><p><font color="#ff0000">on_start() æ–¹æ³•ï¼š</font>çˆ¬å–å…¥å£ï¼Œåˆå§‹çš„çˆ¬å–è¯·æ±‚ä¼šåœ¨è¿™é‡Œäº§ç”Ÿï¼Œè¯¥æ–¹æ³•é€šè¿‡è°ƒç”¨ <code>crawl()</code> æ–¹æ³•å³å¯æ–°å»ºä¸€ä¸ªçˆ¬å–è¯·æ±‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çˆ¬å–çš„ URLï¼Œå¦ä¸€ä¸ªå‚æ•° <code>callback</code> æŒ‡å®šäº†è¿™ä¸ªé¡µé¢çˆ¬å–æˆåŠŸåç”¨å“ªä¸ªæ–¹æ³•è¿›è¡Œè§£æï¼Œé»˜è®¤æŒ‡å®šä¸º <code>index_page()</code> æ–¹æ³•ï¼Œå³å¦‚æœè¿™ä¸ª URL å¯¹åº”çš„é¡µé¢çˆ¬å–æˆåŠŸäº†ï¼Œé‚£ Response å°†äº¤ç»™ <code>index_page()</code> æ–¹æ³•è§£æ</p></li><li><p><font color="#ff0000">index_page() æ–¹æ³•ï¼š</font>æ¥æ”¶ Response å‚æ•°ï¼ŒResponse å¯¹æ¥äº† pyqueryã€‚ç›´æ¥è°ƒç”¨ <code>doc()</code> æ–¹æ³•ä¼ å…¥ç›¸åº”çš„ CSS é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥åƒ pyquery ä¸€æ ·è§£ææ­¤é¡µé¢ï¼Œä»£ç ä¸­é»˜è®¤æ˜¯ <code>a[href^=&quot;http&quot;]</code>ï¼Œå³è§£æé¡µé¢çš„æ‰€æœ‰é“¾æ¥ï¼Œç„¶åå°†é“¾æ¥éå†ï¼Œå†æ¬¡è°ƒç”¨äº† <code>crawl()</code> æ–¹æ³•ç”Ÿæˆäº†æ–°çš„çˆ¬å–è¯·æ±‚ï¼ŒåŒæ—¶å†æŒ‡å®šäº† callback ä¸º detail_pageï¼Œè¡¨ç¤ºè¿™äº›é¡µé¢çˆ¬å–æˆåŠŸäº†å°±è°ƒç”¨ <code>detail_page()</code> æ–¹æ³•è§£æã€‚<code>index_page()</code> å®ç°äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€æ˜¯å°†çˆ¬å–çš„ç»“æœè¿›è¡Œè§£æï¼ŒäºŒæ˜¯ç”Ÿæˆæ–°çš„çˆ¬å–è¯·æ±‚</p></li><li><p><font color="#ff0000">detail_page() æ–¹æ³•ï¼š</font>åŒæ ·æ¥æ”¶ Response ä½œä¸ºå‚æ•°ã€‚<code>detail_page()</code> æŠ“å–çš„å°±æ˜¯è¯¦æƒ…é¡µçš„ä¿¡æ¯ï¼Œå°±ä¸ä¼šç”Ÿæˆæ–°çš„è¯·æ±‚ï¼Œåªå¯¹ Response å¯¹è±¡åšè§£æï¼Œè§£æä¹‹åå°†ç»“æœä»¥å­—å…¸çš„å½¢å¼è¿”å›ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è¿›è¡Œåç»­å¤„ç†ï¼Œå¦‚å°†ç»“æœä¿å­˜åˆ°æ•°æ®åº“ç­‰æ“ä½œ</p></li></ul><p>PSï¼špyspider é»˜è®¤çš„ web é¢„è§ˆé¡µé¢çª—å£è¾ƒå°ï¼Œå¯ä»¥æ‰¾åˆ° pyspider æ–‡ä»¶å¤¹æœ‰ä¸ª debug.min.css æ–‡ä»¶ï¼ˆå¦‚ï¼šE:\Python\Lib\site-packages\pyspider\webui\static\debug.min.cssï¼‰ï¼Œæœç´¢ iframeï¼Œå°†åŸæ ·å¼ï¼š<code>iframe{border-width:0;width:100%}</code> æ”¹ä¸º <code>iframe{border-width:0;width:100%;height:400px !important}</code> å³å¯ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜åå°±ä¼šç”Ÿæ•ˆï¼</p><hr><h1 id="ã€17-3ã€‘ä½¿ç”¨-pyspider-çˆ¬å–å»å“ªå„¿ç½‘"><a href="#ã€17-3ã€‘ä½¿ç”¨-pyspider-çˆ¬å–å»å“ªå„¿ç½‘" class="headerlink" title="ã€17.3ã€‘ä½¿ç”¨ pyspider çˆ¬å–å»å“ªå„¿ç½‘"></a><font color="#ff0000">ã€17.3ã€‘ä½¿ç”¨ pyspider çˆ¬å–å»å“ªå„¿ç½‘</font></h1><p>çˆ¬å–åœ°å€ï¼š<a href="http://travel.qunar.com/travelbook/list.htm" target="_blank" rel="noopener">http://travel.qunar.com/travelbook/list.htm</a><br>çˆ¬å–ç›®æ ‡ï¼šå»å“ªå„¿ç½‘æ—…æ¸¸æ”»ç•¥ï¼Œå‘å¸–ä½œè€…ã€æ ‡é¢˜ã€æ­£æ–‡ç­‰</p><hr><h2 id="ã€17-3-1ã€‘çˆ¬å–é¦–é¡µ"><a href="#ã€17-3-1ã€‘çˆ¬å–é¦–é¡µ" class="headerlink" title="ã€17.3.1ã€‘çˆ¬å–é¦–é¡µ"></a><font color="#1BC3FB">ã€17.3.1ã€‘çˆ¬å–é¦–é¡µ</font></h2><p>åˆ›å»ºä¸€ä¸ªåä¸º qunar çš„çˆ¬è™«é¡¹ç›®ï¼ŒStart URL è®¾ç½®ä¸º <a href="http://travel.qunar.com/travelbook/list.htm" target="_blank" rel="noopener">http://travel.qunar.com/travelbook/list.htm</a> ï¼Œç‚¹å‡» run å‡ºç°ä¸€ä¸ªçˆ¬å–è¯·æ±‚</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/04.png" alt="04"><br></fancybox><p>å·¦è¾¹è°ƒè¯•åŒºåŸŸå‡ºç°ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"process"</span>: &#123;</span><br><span class="line">    <span class="string">"callback"</span>: <span class="string">"on_start"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"project"</span>: <span class="string">"qunar"</span>,</span><br><span class="line">  <span class="string">"taskid"</span>: <span class="string">"data:,on_start"</span>,</span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"data:,on_start"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>callback ä¸º on_startï¼Œè¡¨ç¤ºæ­¤æ—¶æ‰§è¡Œäº† <code>on_start()</code> æ–¹æ³•ã€‚åœ¨ <code>on_start()</code> æ–¹æ³•ä¸­ï¼Œåˆ©ç”¨ <code>crawl()</code> æ–¹æ³•å³å¯ç”Ÿæˆä¸€ä¸ªçˆ¬å–è¯·æ±‚ï¼Œç‚¹å‡» index_page é“¾æ¥åé¢çš„ç®­å¤´ä¼šå‡ºç°è®¸å¤šæ–°çš„çˆ¬å–è¯·æ±‚ï¼Œå³é¦–é¡µæ‰€åŒ…å«çš„æ‰€æœ‰é“¾æ¥</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/05.png" alt="05"><br></fancybox><p>æ­¤æ—¶å·¦è¾¹è°ƒè¯•åŒºåŸŸä»£ç å˜ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"fetch"</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">"process"</span>: &#123;</span><br><span class="line">    <span class="string">"callback"</span>: <span class="string">"index_page"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"project"</span>: <span class="string">"qunar"</span>,</span><br><span class="line">  <span class="string">"schedule"</span>: &#123;</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">864000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"taskid"</span>: <span class="string">"73a789f99528a2bdc3ab83a13902962a"</span>,</span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"http://travel.qunar.com/travelbook/list.htm"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>callback å˜ä¸ºäº† index_pageï¼Œè¡¨ç¤ºæ­¤æ—¶æ‰§è¡Œäº† <code>index_page()</code> æ–¹æ³•ã€‚ä¼ å…¥ <code>index_page()</code> æ–¹æ³•çš„ response å‚æ•°ä¸ºåˆšæ‰ç”Ÿæˆçš„ç¬¬ä¸€ä¸ªçˆ¬å–è¯·æ±‚çš„ response å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>doc()</code> æ–¹æ³•ï¼Œä¼ å…¥æå–æ‰€æœ‰ a èŠ‚ç‚¹çš„ CSS é€‰æ‹©å™¨ï¼Œè·å– a èŠ‚ç‚¹çš„å±æ€§ hrefï¼Œå®ç°äº†é¡µé¢æ‰€æœ‰é“¾æ¥çš„æå–ï¼Œéšåéå†æ‰€æœ‰é“¾æ¥ï¼Œè°ƒç”¨ <code>crawl()</code> æ–¹æ³•ï¼ŒæŠŠæ¯ä¸ªé“¾æ¥æ„é€ æˆæ–°çš„çˆ¬å–è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ° follows æ–°ç”Ÿæˆäº† 229 ä¸ªçˆ¬å–è¯·æ±‚ã€‚ç‚¹å‡» web æŒ‰é’®å¯ä»¥ç›´æ¥é¢„è§ˆå½“å‰é¡µé¢ï¼Œç‚¹å‡» html æŒ‰é’®å¯ä»¥æŸ¥çœ‹æ­¤é¡µé¢æºä»£ç </p><hr><h2 id="ã€17-3-2ã€‘ä¿¡æ¯åŒ¹é…"><a href="#ã€17-3-2ã€‘ä¿¡æ¯åŒ¹é…" class="headerlink" title="ã€17.3.2ã€‘ä¿¡æ¯åŒ¹é…"></a><font color="#1BC3FB">ã€17.3.2ã€‘ä¿¡æ¯åŒ¹é…</font></h2><p>ä»£ç  <code>for each in response.doc(&#39;a[href^=&quot;http&quot;]&#39;).items():</code> å®ç°äº†å¯¹æ•´ä¸ªé¡µé¢é“¾æ¥çš„è·å–ï¼Œæˆ‘ä»¬éœ€è¦æå–ç½‘é¡µçš„æ”»ç•¥çš„æ ‡é¢˜ï¼Œå†…å®¹ç­‰ä¿¡æ¯ï¼Œé‚£ä¹ˆç›´æ¥æ›¿æ¢ <code>doc()</code> æ–¹æ³•é‡Œçš„åŒ¹é…è¯­å¥å³å¯ï¼Œpyspider æä¾›äº†éå¸¸æ–¹ä¾¿çš„ CSS é€‰æ‹©å™¨ï¼Œç‚¹å‡» <code>enable css selector helper</code> æŒ‰é’®åï¼Œé€‰æ‹©è¦åŒ¹é…çš„ä¿¡æ¯å¹¶ç‚¹å‡»ï¼Œå†ç‚¹å‡»ç®­å¤´ add to editor å³å¯å¾—åˆ°åŒ¹é…è¯­å¥</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/06.png" alt="06"><br></fancybox><p>å®Œæˆäº† CSS é€‰æ‹©å™¨çš„æ›¿æ¢ï¼Œç‚¹å‡» <code>save</code> ä¿å­˜ï¼Œå†æ¬¡ç‚¹å‡» <code>run</code> é‡æ–°æ‰§è¡Œ <code>index_page()</code> æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ° follows å˜ä¸ºäº† 10 ä¸ªï¼Œå³æŠ“å–åˆ°äº† 10 ç¯‡æ”»ç•¥</p><hr><h2 id="ã€17-3-3ã€‘æŠ“å–ä¸‹ä¸€é¡µæ•°æ®"><a href="#ã€17-3-3ã€‘æŠ“å–ä¸‹ä¸€é¡µæ•°æ®" class="headerlink" title="ã€17.3.3ã€‘æŠ“å–ä¸‹ä¸€é¡µæ•°æ®"></a><font color="#1BC3FB">ã€17.3.3ã€‘æŠ“å–ä¸‹ä¸€é¡µæ•°æ®</font></h2><p>æ¯ä¸€é¡µåªæœ‰ 10 ç¯‡æ”»ç•¥ï¼Œæƒ³è¦çˆ¬å–æ‰€æœ‰é¡µé¢çš„æ”»ç•¥ï¼Œå¿…é¡»è¦å¾—åˆ°ä¸‹ä¸€é¡µçš„æ•°æ®ï¼Œä¼˜åŒ– <code>index_page()</code> æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@config(age=10 * 24 * 60 * 60)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">'li &gt; .tit &gt; a'</span>).items():</span><br><span class="line">        self.crawl(each.attr.href, callback=self.detail_page)</span><br><span class="line">    next = response.doc(<span class="string">'.next'</span>).attr.href</span><br><span class="line">    self.crawl(next, callback=self.index_page)</span><br></pre></td></tr></table></figure><p>åŒ¹é…ä¸‹ä¸€é¡µæŒ‰é’®ï¼Œè·å–ä¸‹ä¸€é¡µæŒ‰é’®çš„ URL å¹¶èµ‹å€¼ç»™ nextï¼Œå°†è¯¥ URL ä¼ ç»™ <code>crawl()</code> æ–¹æ³•ï¼ŒæŒ‡å®šå›è°ƒå‡½æ•°ä¸º <code>index_page()</code> æ–¹æ³•ï¼Œè¿™æ ·ä¼šå†æ¬¡è°ƒç”¨ <code>index_page()</code> æ–¹æ³•ï¼Œæå–ä¸‹ä¸€é¡µçš„æ”»ç•¥æ ‡é¢˜</p><hr><h2 id="ã€17-3-4ã€‘æŠ“å–JSæ¸²æŸ“æ•°æ®"><a href="#ã€17-3-4ã€‘æŠ“å–JSæ¸²æŸ“æ•°æ®" class="headerlink" title="ã€17.3.4ã€‘æŠ“å–JSæ¸²æŸ“æ•°æ®"></a><font color="#1BC3FB">ã€17.3.4ã€‘æŠ“å–JSæ¸²æŸ“æ•°æ®</font></h2><p>éšä¾¿ç‚¹å‡»ä¸€ä¸ªè·å–åˆ°çš„æ”»ç•¥ï¼Œé¢„è§ˆè¯¥é¡µé¢ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å¤´å›¾ä¸€ç›´åœ¨åŠ è½½ä¸­ï¼Œåˆ‡æ¢åˆ° html æŸ¥çœ‹æºä»£ç é¡µé¢ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ²¡æœ‰ img èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤å¤„å°±æ˜¯åæœŸç»è¿‡ JavaScript æ¸²æŸ“åæ‰å‡ºç°çš„</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/07.png" alt="07"><br></fancybox><p>é’ˆå¯¹ JavaScript æ¸²æŸ“é¡µé¢ï¼Œå¯ä»¥é€šè¿‡ PhantomJS æ¥å®ç°ï¼Œå…·ä½“åˆ° pyspider ä¸­ï¼Œåªéœ€è¦åœ¨ <code>index_page()</code> çš„ <code>crawl()</code> æŠ“å–æ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªå‚æ•° <code>fetch_type</code> å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@config(age=10 * 24 * 60 * 60)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">'li &gt; .tit &gt; a'</span>).items():</span><br><span class="line">        self.crawl(each.attr.href, callback=self.detail_page, fetch_type=<span class="string">'js'</span>)</span><br><span class="line">    next = response.doc(<span class="string">'.next'</span>).attr.href</span><br><span class="line">    self.crawl(next, callback=self.index_page)</span><br></pre></td></tr></table></figure><p>ä¿å­˜ä¹‹åå†æ¬¡è¿è¡Œå³å¯çœ‹åˆ°æ­£å¸¸é¡µé¢</p><hr><h2 id="ã€17-3-5ã€‘æŠ“å–æ‰€æœ‰æ•°æ®"><a href="#ã€17-3-5ã€‘æŠ“å–æ‰€æœ‰æ•°æ®" class="headerlink" title="ã€17.3.5ã€‘æŠ“å–æ‰€æœ‰æ•°æ®"></a><font color="#1BC3FB">ã€17.3.5ã€‘æŠ“å–æ‰€æœ‰æ•°æ®</font></h2><p>æ”¹å†™ <code>detail_page()</code> æ–¹æ³•ï¼ŒåŒæ ·é€šè¿‡ CSS é€‰æ‹©å™¨æå– URLã€æ ‡é¢˜ã€æ—¥æœŸã€ä½œè€…ã€æ­£æ–‡ã€å›¾ç‰‡ç­‰ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@config(priority=2)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">'url'</span>: response.url,</span><br><span class="line">        <span class="string">'title'</span>: response.doc(<span class="string">'#booktitle'</span>).text(),</span><br><span class="line">        <span class="string">'date'</span>: response.doc(<span class="string">'.when .data'</span>).text(),</span><br><span class="line">        <span class="string">'day'</span>: response.doc(<span class="string">'.howlong .data'</span>).text(),</span><br><span class="line">        <span class="string">'who'</span>: response.doc(<span class="string">'.who .data'</span>).text(),</span><br><span class="line">        <span class="string">'text'</span>: response.doc(<span class="string">'#b_panel_schedule'</span>).text(),</span><br><span class="line">        <span class="string">'image'</span>: response.doc(<span class="string">'.cover_img'</span>).attr.src</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ã€17-3-6ã€‘å¯åŠ¨çˆ¬è™«é¡¹ç›®"><a href="#ã€17-3-6ã€‘å¯åŠ¨çˆ¬è™«é¡¹ç›®" class="headerlink" title="ã€17.3.6ã€‘å¯åŠ¨çˆ¬è™«é¡¹ç›®"></a><font color="#1BC3FB">ã€17.3.6ã€‘å¯åŠ¨çˆ¬è™«é¡¹ç›®</font></h2><p>è¯¥çˆ¬è™«é¡¹ç›®å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2019-09-18 09:48:29</span></span><br><span class="line"><span class="comment"># Project: qunar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span><span class="params">(BaseHandler)</span>:</span></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @every(minutes=24 * 60)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_start</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.crawl(<span class="string">'http://travel.qunar.com/travelbook/list.htm'</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(age=10 * 24 * 60 * 60)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">'li &gt; .tit &gt; a'</span>).items():</span><br><span class="line">            self.crawl(each.attr.href, callback=self.detail_page, fetch_type=<span class="string">'js'</span>)</span><br><span class="line">        next = response.doc(<span class="string">'.next'</span>).attr.href</span><br><span class="line">        self.crawl(next, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(priority=2)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detail_page</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">'url'</span>: response.url,</span><br><span class="line">            <span class="string">'title'</span>: response.doc(<span class="string">'#booktitle'</span>).text(),</span><br><span class="line">            <span class="string">'date'</span>: response.doc(<span class="string">'.when .data'</span>).text(),</span><br><span class="line">            <span class="string">'day'</span>: response.doc(<span class="string">'.howlong .data'</span>).text(),</span><br><span class="line">            <span class="string">'who'</span>: response.doc(<span class="string">'.who .data'</span>).text(),</span><br><span class="line">            <span class="string">'text'</span>: response.doc(<span class="string">'#b_panel_schedule'</span>).text(),</span><br><span class="line">            <span class="string">'image'</span>: response.doc(<span class="string">'.cover_img'</span>).attr.src</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ä¿å­˜ä»£ç åï¼Œå›åˆ°ä¸»ç•Œé¢ï¼Œå°†é¡¹ç›® status ä¿®æ”¹ä¸º RUNNING ï¼Œç‚¹å‡» actions çš„ run æŒ‰é’®å³å¯å¯åŠ¨çˆ¬è™«</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/08.png" alt="08"><br></fancybox><p>ç‚¹å‡» Active Tasksï¼Œå³å¯æŸ¥çœ‹æœ€è¿‘è¯·æ±‚çš„è¯¦ç»†çŠ¶å†µï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/09.png" alt="09"><br></fancybox><p>ç‚¹å‡» Resultsï¼Œå³å¯æŸ¥çœ‹æ‰€æœ‰çš„çˆ¬å–ç»“æœï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A49/10.png" alt="10"><br></fancybox><p>å¦å¤–ï¼Œå³ä¸Šè§’è¿˜å¯ä»¥é€‰æ‹© JSONã€CSV æ ¼å¼</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åä¸ƒç«  â€”â€” ã€çˆ¬è™«æ¡†æ¶ pyspider â€” åŸºæœ¬ä½¿ç”¨ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="pyspider" scheme="https://www.itrhx.com/tags/pyspider/"/>
    
  </entry>
  
  <entry>
    <title>Hexo åšå®¢æäº¤ç™¾åº¦ã€è°·æ­Œæœç´¢å¼•æ“æ”¶å½•</title>
    <link href="https://www.itrhx.com/2019/09/17/A48-submit-search-engine-inclusion/"/>
    <id>https://www.itrhx.com/2019/09/17/A48-submit-search-engine-inclusion/</id>
    <published>2019-09-17T07:59:46.143Z</published>
    <updated>2019-09-17T08:11:15.999Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="â—-å†™åœ¨å‰é¢ï¼ˆå¿…çœ‹ï¼‰"><a href="#â—-å†™åœ¨å‰é¢ï¼ˆå¿…çœ‹ï¼‰" class="headerlink" title="â— å†™åœ¨å‰é¢ï¼ˆå¿…çœ‹ï¼‰"></a><font color="#ff0000">â— å†™åœ¨å‰é¢ï¼ˆå¿…çœ‹ï¼‰</font></h1><p>ç½‘ç«™åœ¨æ²¡æœ‰æäº¤æœç´¢å¼•æ“æ”¶å½•ä¹‹å‰ï¼Œç›´æ¥æœç´¢ä½ ç½‘ç«™çš„å†…å®¹æ˜¯æœä¸åˆ°çš„ï¼Œåªæœ‰æäº¤æœç´¢å¼•æ“ä¹‹åï¼Œæœç´¢å¼•æ“æ‰èƒ½æ”¶å½•ä½ çš„ç«™ç‚¹ï¼Œé€šè¿‡çˆ¬è™«æŠ“å–ä½ ç½‘ç«™çš„ä¸œè¥¿ï¼Œ<font color="#ff0000">å¯¹äº hexo åšå®¢æ¥è¯´ï¼Œå¦‚æœä½ æ˜¯éƒ¨ç½²åœ¨ GitHub Pagesï¼Œé‚£ä¹ˆä½ æ˜¯æ— æ³•è¢«ç™¾åº¦æ”¶å½•çš„ï¼Œå› ä¸º GitHub ç¦æ­¢äº†ç™¾åº¦çˆ¬è™«</font>ï¼Œæœ€å¸¸è§çš„è§£å†³åŠæ³•æ˜¯åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pagesï¼Œå› ä¸ºç™¾åº¦çˆ¬è™«å¯ä»¥çˆ¬å–åˆ° Coding ä¸Šçš„å†…å®¹ï¼Œä»è€Œå®ç°ç™¾åº¦æ”¶å½•ï¼Œå¦‚æœä½ çš„ hexo åšå®¢è¿˜æ²¡æœ‰å®ç°åŒçº¿éƒ¨ç½²ï¼Œè¯·å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_36759224/article/details/100879609" target="_blank" rel="noopener">ã€ŠHexo åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages å¹¶å®ç°å…¨ç«™ HPPTSã€‹</a>ï¼Œå¦å¤–ç™¾åº¦æ”¶å½•çš„æ‰€éœ€çš„æ—¶é—´è¾ƒé•¿ï¼Œå¤§çº¦åŠä¸ªæœˆå·¦å³æ‰ä¼šçœ‹åˆ°æ•ˆæœï¼</p><hr><h1 id="â—-æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•"><a href="#â—-æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•" class="headerlink" title="â— æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•"></a><font color="#ff0000">â— æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•</font></h1><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥è¾“å…¥ <code>site:åŸŸå</code> æ¥æŸ¥çœ‹åŸŸåæ˜¯å¦è¢«æœç´¢å¼•æ“æ”¶å½•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¡¨ç¤ºæ²¡æœ‰æ”¶å½•ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/01.png" alt="01"><br></fancybox><hr><h1 id="â—-ç™¾åº¦èµ„æºå¹³å°æ·»åŠ ç½‘ç«™"><a href="#â—-ç™¾åº¦èµ„æºå¹³å°æ·»åŠ ç½‘ç«™" class="headerlink" title="â— ç™¾åº¦èµ„æºå¹³å°æ·»åŠ ç½‘ç«™"></a><font color="#ff0000">â— ç™¾åº¦èµ„æºå¹³å°æ·»åŠ ç½‘ç«™</font></h1><p>è®¿é—®<a href="https://ziyuan.baidu.com/" target="_blank" rel="noopener">ç™¾åº¦æœç´¢èµ„æºå¹³å°å®˜ç½‘</a>ï¼Œæ³¨å†Œæˆ–è€…ç™»é™†ç™¾åº¦è´¦å·ï¼Œä¾æ¬¡é€‰æ‹©ã€ç”¨æˆ·ä¸­å¿ƒã€‘-ã€ç«™ç‚¹ç®¡ç†ã€‘ï¼Œæ·»åŠ ä½ çš„ç½‘ç«™ï¼Œåœ¨æ·»åŠ ç«™ç‚¹æ—¶ä¼šè®©ä½ é€‰æ‹©åè®®å¤´ï¼ˆhttp æˆ–è€… httpsï¼‰ï¼Œå¦‚æœé€‰æ‹© httpsï¼Œå®ƒä¼šéªŒè¯ä½ çš„ç«™ç‚¹ï¼Œå¤§çº¦èƒ½åœ¨ä¸€å¤©ä¹‹å†…å®Œæˆï¼Œæˆ‘çš„ç½‘ç«™å·²ç»å®ç°äº†å…¨ç«™ httpsï¼Œå› æ­¤é€‰æ‹©äº† https åè®®ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆå§‹ç»ˆéªŒè¯å¤±è´¥ï¼Œå®åœ¨æ˜¯æ— è§£ï¼Œåªèƒ½é€‰æ‹© http åè®®äº†ï¼Œå¦‚æœä½ çš„ç«™ç‚¹ä¹Ÿå®ç°äº†å…¨ç«™ httpsï¼Œä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/02.png" alt="02"><br></fancybox><p>ä¹‹åä¼šè®©ä½ éªŒè¯ç½‘ç«™æ‰€æœ‰æƒï¼Œæä¾›ä¸‰ç§éªŒè¯æ–¹å¼ï¼š</p><ul><li>æ–‡ä»¶éªŒè¯ï¼šä¸‹è½½ç»™å®šçš„æ–‡ä»¶ï¼Œå°†å…¶æ”¾åˆ°æœ¬åœ°<font color="#ff0000">ä¸»é¢˜ç›®å½• source æ–‡ä»¶å¤¹</font>ï¼Œç„¶åéƒ¨ç½²ä¸Šå»å®ŒæˆéªŒè¯</li><li>HTML æ ‡ç­¾éªŒè¯ï¼šä¸€èˆ¬æ˜¯ç»™ä¸€ä¸ª meta æ ‡ç­¾ï¼Œæ”¾åˆ°é¦–é¡µ <code>&lt;head&gt;</code> ä¸ <code>&lt;/head&gt;</code> æ ‡ç­¾ä¹‹é—´å³å¯å®ŒæˆéªŒè¯</li><li>CNAME éªŒè¯ï¼šä¸ªäººè§‰å¾—è¿™ç§æ–¹æ³•æœ€ç®€å•ï¼Œå»åŸŸå DNS æ·»åŠ ä¸€ä¸ª CNAME è®°å½•å³å¯å®ŒæˆéªŒè¯</li></ul><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/03.png" alt="03"><br></fancybox><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/04.png" alt="04"><br></fancybox><hr><h1 id="â—-æäº¤ç™¾åº¦æœç´¢"><a href="#â—-æäº¤ç™¾åº¦æœç´¢" class="headerlink" title="â— æäº¤ç™¾åº¦æœç´¢"></a><font color="#ff0000">â— æäº¤ç™¾åº¦æœç´¢</font></h1><p>ç™¾åº¦æä¾›äº†è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ä¸¤ç§æ–¹å¼ï¼Œå…¶ä¸­è‡ªåŠ¨æäº¤åˆåˆ†ä¸ºä¸»åŠ¨æ¨é€ã€è‡ªåŠ¨æ¨é€å’Œ sitemap ä¸‰ç§æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯å®˜æ–¹ç»™å‡ºçš„è§£é‡Šï¼š</p><ul><li><p>ä¸»åŠ¨æ¨é€ï¼šæœ€ä¸ºå¿«é€Ÿçš„æäº¤æ–¹å¼ï¼Œæ¨èæ‚¨å°†ç«™ç‚¹å½“å¤©æ–°äº§å‡ºé“¾æ¥ç«‹å³é€šè¿‡æ­¤æ–¹å¼æ¨é€ç»™ç™¾åº¦ï¼Œä»¥ä¿è¯æ–°é“¾æ¥å¯ä»¥åŠæ—¶è¢«ç™¾åº¦æ”¶å½•</p></li><li><p>è‡ªåŠ¨æ¨é€ï¼šæ˜¯è½»é‡çº§é“¾æ¥æäº¤ç»„ä»¶ï¼Œå°†è‡ªåŠ¨æ¨é€çš„ JS ä»£ç æ”¾ç½®åœ¨ç«™ç‚¹æ¯ä¸€ä¸ªé¡µé¢æºä»£ç ä¸­ï¼Œå½“é¡µé¢è¢«è®¿é—®æ—¶ï¼Œé¡µé¢é“¾æ¥ä¼šè‡ªåŠ¨æ¨é€ç»™ç™¾åº¦ï¼Œæœ‰åˆ©äºæ–°é¡µé¢æ›´å¿«è¢«ç™¾åº¦å‘ç°</p></li><li><p>sitemapï¼šæ‚¨å¯ä»¥å®šæœŸå°†ç½‘ç«™é“¾æ¥æ”¾åˆ°sitemapä¸­ï¼Œç„¶åå°†sitemapæäº¤ç»™ç™¾åº¦ã€‚ç™¾åº¦ä¼šå‘¨æœŸæ€§çš„æŠ“å–æ£€æŸ¥æ‚¨æäº¤çš„sitemapï¼Œå¯¹å…¶ä¸­çš„é“¾æ¥è¿›è¡Œå¤„ç†ï¼Œä½†æ”¶å½•é€Ÿåº¦æ…¢äºä¸»åŠ¨æ¨é€</p></li><li><p>æ‰‹åŠ¨æäº¤ï¼šå¦‚æœæ‚¨ä¸æƒ³é€šè¿‡ç¨‹åºæäº¤ï¼Œé‚£ä¹ˆå¯ä»¥é‡‡ç”¨æ­¤ç§æ–¹å¼ï¼Œæ‰‹åŠ¨å°†é“¾æ¥æäº¤ç»™ç™¾åº¦</p></li></ul><p>å››ç§æäº¤æ–¹å¼å¯¹æ¯”ï¼š</p><table><thead><tr><th style="text-align:center">æ–¹å¼</th><th style="text-align:center">ä¸»åŠ¨æ¨é€</th><th style="text-align:center">è‡ªåŠ¨æ¨é€</th><th style="text-align:center">Sitemap</th><th style="text-align:center">æ‰‹åŠ¨æäº¤</th></tr></thead><tbody><tr><td style="text-align:center">é€Ÿåº¦</td><td style="text-align:center">æœ€å¿«</td><td style="text-align:center">â€”â€”</td><td style="text-align:center">â€”â€”</td><td style="text-align:center">â€”â€”</td></tr><tr><td style="text-align:center">å¼€å‘æˆæœ¬</td><td style="text-align:center">é«˜</td><td style="text-align:center">ä½</td><td style="text-align:center">ä¸­</td><td style="text-align:center">ä¸éœ€å¼€å‘</td></tr><tr><td style="text-align:center">å¯æäº¤é‡</td><td style="text-align:center">ä½</td><td style="text-align:center">é«˜</td><td style="text-align:center">é«˜</td><td style="text-align:center">ä½</td></tr><tr><td style="text-align:center">æ˜¯å¦å»ºè®®æäº¤å†å²è¿æ¥</td><td style="text-align:center">å¦</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">æ˜¯</td><td style="text-align:center">æ˜¯</td></tr><tr><td style="text-align:center">å’Œå…¶ä»–æäº¤æ–¹æ³•æ˜¯å¦æœ‰å†²çª</td><td style="text-align:center">æ— </td><td style="text-align:center">æ— </td><td style="text-align:center">æ— </td><td style="text-align:center">æ— </td></tr></tbody></table><p><strong>ä¸ªäººæ¨èåŒæ—¶ä½¿ç”¨ä¸»åŠ¨æ¨é€å’Œ sitemap æ–¹å¼</strong>ï¼Œä¸‹é¢å°†é€ä¸€ä»‹ç»è¿™å››ç§æäº¤æ–¹å¼çš„å…·ä½“å®ç°æ–¹æ³•</p><hr><h2 id="â—-ä¸»åŠ¨æ¨é€"><a href="#â—-ä¸»åŠ¨æ¨é€" class="headerlink" title="â— ä¸»åŠ¨æ¨é€"></a><font color="#1BC3FB">â— ä¸»åŠ¨æ¨é€</font></h2><p>åœ¨åšå®¢æ ¹ç›®å½•å®‰è£…æ’ä»¶ <code>npm install hexo-baidu-url-submit --save</code>ï¼Œç„¶ååœ¨æ ¹ç›®å½• <code>_config.yml</code> æ–‡ä»¶é‡Œå†™å…¥ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">baidu_url_submit:</span><br><span class="line">  count: 1               # æäº¤æœ€æ–°çš„å¤šå°‘ä¸ªé“¾æ¥</span><br><span class="line">  host: www.itrhx.com    # åœ¨ç™¾åº¦ç«™é•¿å¹³å°ä¸­æ·»åŠ çš„åŸŸå</span><br><span class="line">  token: your_token      # ç§˜é’¥</span><br><span class="line">  path: baidu_urls.txt   # æ–‡æœ¬æ–‡æ¡£çš„åœ°å€ï¼Œ æ–°é“¾æ¥ä¼šä¿å­˜åœ¨æ­¤æ–‡æœ¬æ–‡æ¡£é‡Œ</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„ <code>token</code> å¯ä»¥åœ¨ã€é“¾æ¥æäº¤ã€‘-ã€è‡ªåŠ¨æäº¤ã€‘-ã€ä¸»åŠ¨æ¨é€ã€‘ä¸‹é¢çœ‹åˆ°ï¼Œæ¥å£è°ƒç”¨åœ°å€æœ€åé¢ <code>token=xxxxx</code> å³ä¸ºä½ çš„ <code>token</code></p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/05.png" alt="05"><br></fancybox><p>åŒæ ·æ˜¯åœ¨æ ¹ç›®å½•çš„ <code>_config.yml</code> æ–‡ä»¶ï¼Œå¤§çº¦ç¬¬ 17 è¡Œå¤„ï¼Œurl è¦æ”¹ä¸ºåœ¨ç™¾åº¦ç«™é•¿å¹³å°æ·»åŠ çš„åŸŸåï¼Œä¹Ÿå°±æ˜¯ä½ ç½‘ç«™çš„é¦–é¡µåœ°å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># URL</span><br><span class="line">url: https://www.itrhx.com</span><br><span class="line">root: /</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br></pre></td></tr></table></figure><p>æœ€åï¼ŒåŠ å…¥æ–°çš„ deployerï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Deployment</span><br><span class="line">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="line">deploy:</span><br><span class="line">- type: git</span><br><span class="line">  repository:</span><br><span class="line">    github: git@github.com:TRHX/TRHX.github.io.git  # è¿™æ˜¯åŸæ¥çš„ github é…ç½®</span><br><span class="line">    coding: git@git.dev.tencent.com:TRHX/TRHX.git   # è¿™æ˜¯åŸæ¥çš„ coding é…ç½®</span><br><span class="line">  branch: master</span><br><span class="line">- type: baidu_url_submitter                         # è¿™æ˜¯æ–°åŠ çš„ä¸»åŠ¨æ¨é€</span><br></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œ <code>hexo g -d</code> éƒ¨ç½²ä¸€éå³å¯å®ç°ä¸»åŠ¨æ¨é€ï¼Œæ¨é€æˆåŠŸçš„æ ‡å¿—æ˜¯ï¼šåœ¨æ‰§è¡Œéƒ¨ç½²å‘½ä»¤æœ€åä¼šæ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"remain"</span>:4999953,<span class="string">"success"</span>:47&#125;</span><br><span class="line">INFO  Deploy <span class="keyword">done</span>: baidu_url_submitter</span><br></pre></td></tr></table></figure><p>è¿™è¡¨ç¤ºæœ‰ 47 ä¸ªé¡µé¢å·²ç»ä¸»åŠ¨æ¨é€æˆåŠŸï¼Œremain çš„æ„æ€æ˜¯å½“å¤©å‰©ä½™çš„å¯æ¨é€ url æ¡æ•°</p><p>ä¸»åŠ¨æ¨é€ç›¸å…³åŸç†ä»‹ç»ï¼š</p><ul><li>æ–°é“¾æ¥çš„äº§ç”Ÿï¼šhexo generate ä¼šäº§ç”Ÿä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«æœ€æ–°çš„é“¾æ¥</li><li>æ–°é“¾æ¥çš„æäº¤ï¼šhexo deploy ä¼šä»ä¸Šè¿°æ–‡ä»¶ä¸­è¯»å–é“¾æ¥ï¼Œæäº¤è‡³ç™¾åº¦æœç´¢å¼•æ“</li></ul><p>è¯¥æ’ä»¶çš„ GitHub åœ°å€ï¼š<a href="https://github.com/huiwang/hexo-baidu-url-submit" target="_blank" rel="noopener">https://github.com/huiwang/hexo-baidu-url-submit</a></p><hr><h2 id="â—-è‡ªåŠ¨æ¨é€"><a href="#â—-è‡ªåŠ¨æ¨é€" class="headerlink" title="â— è‡ªåŠ¨æ¨é€"></a><font color="#1BC3FB">â— è‡ªåŠ¨æ¨é€</font></h2><p>å…³äºè‡ªåŠ¨æ¨é€ç™¾åº¦å®˜ç½‘ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼šè‡ªåŠ¨æ¨é€æ˜¯ç™¾åº¦æœç´¢èµ„æºå¹³å°ä¸ºæé«˜ç«™ç‚¹æ–°å¢ç½‘é¡µå‘ç°é€Ÿåº¦æ¨å‡ºçš„å·¥å…·ï¼Œå®‰è£…è‡ªåŠ¨æ¨é€JSä»£ç çš„ç½‘é¡µï¼Œåœ¨é¡µé¢è¢«è®¿é—®æ—¶ï¼Œé¡µé¢URLå°†ç«‹å³è¢«æ¨é€ç»™ç™¾åº¦</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/06.png" alt="06"><br></fancybox><p>æ­¤æ—¶è¦æ³¨æ„ï¼Œæœ‰äº› hexo ä¸»é¢˜é›†æˆäº†è¿™é¡¹åŠŸèƒ½ï¼Œæ¯”å¦‚ next ä¸»é¢˜ï¼Œåœ¨ <code>themes\next\layout_scripts\</code> ä¸‹æœ‰ä¸ª <code>baidu_push.swig</code> æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¦‚ä¸‹ä»£ç ç²˜è´´åˆ°è¯¥æ–‡ä»¶ï¼Œç„¶ååœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶è®¾ç½® <code>baidu_push: true</code> å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> theme.baidu_push %&#125;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bp = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    <span class="keyword">var</span> curProtocol = <span class="built_in">window</span>.location.protocol.split(<span class="string">':'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (curProtocol === <span class="string">'https'</span>) &#123;</span><br><span class="line">        bp.src = <span class="string">'https://zz.bdstatic.com/linksubmit/push.js'</span>;        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        bp.src = <span class="string">'http://push.zhanzhang.baidu.com/push.js'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>)[<span class="number">0</span>];</span><br><span class="line">    s.parentNode.insertBefore(bp, s);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&#123;% endif %&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œå¤§éƒ¨åˆ†ä¸»é¢˜æ˜¯æ²¡æœ‰é›†æˆè¿™é¡¹åŠŸèƒ½çš„ï¼Œå¯¹äºå¤§éƒ¨åˆ†ä¸»é¢˜æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»¥ä¸‹ä»£ç ç²˜è´´åˆ° <code>head.ejs</code> æ–‡ä»¶çš„ <code>&lt;head&gt;</code> ä¸ <code>&lt;/head&gt;</code> æ ‡ç­¾ä¹‹é—´å³å¯ï¼Œä»è€Œå®ç°è‡ªåŠ¨æ¨é€ï¼ˆæ¯”å¦‚æˆ‘ä½¿ç”¨çš„æ˜¯ <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" rel="noopener">Material X</a> ä¸»é¢˜ï¼Œé‚£ä¹ˆåªéœ€è¦æŠŠä»£ç ç²˜è´´åˆ° <code>\themes\material-x\layout\_partial\head.ejs</code> ä¸­å³å¯ï¼‰</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> bp = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    <span class="keyword">var</span> curProtocol = <span class="built_in">window</span>.location.protocol.split(<span class="string">':'</span>)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (curProtocol === <span class="string">'https'</span>) &#123;</span><br><span class="line">        bp.src = <span class="string">'https://zz.bdstatic.com/linksubmit/push.js'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        bp.src = <span class="string">'http://push.zhanzhang.baidu.com/push.js'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"script"</span>)[<span class="number">0</span>];</span><br><span class="line">    s.parentNode.insertBefore(bp, s);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="â—-sitemap"><a href="#â—-sitemap" class="headerlink" title="â— sitemap"></a><font color="#1BC3FB">â— sitemap</font></h2><p>é¦–å…ˆæˆ‘ä»¬è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªç½‘ç«™åœ°å›¾ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save     </span><br><span class="line">npm install hexo-generator-baidu-sitemap --save</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿæ³¨æ„ä¸€ä¸‹ï¼Œå°†æ ¹ç›®å½•çš„ <code>_config.yml</code> æ–‡ä»¶ï¼Œå¤§çº¦ç¬¬ 17 è¡Œå¤„ï¼Œurl æ”¹ä¸ºåœ¨ç™¾åº¦ç«™é•¿å¹³å°æ·»åŠ çš„åŸŸåï¼Œä¹Ÿå°±æ˜¯ä½ ç½‘ç«™çš„é¦–é¡µåœ°å€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># URL</span><br><span class="line">url: https://www.itrhx.com</span><br><span class="line">root: /</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨å‘½ä»¤ <code>hexo g -d</code> å°†ç½‘ç«™éƒ¨ç½²ä¸Šå»ï¼Œç„¶åè®¿é—® <code>ä½ çš„é¦–é¡µ/sitemap.xml</code> æˆ–è€… <code>ä½ çš„é¦–é¡µ/baidusitemap.xml</code> å°±å¯ä»¥çœ‹åˆ°ç½‘ç«™åœ°å›¾äº†</p><p>æ¯”å¦‚æˆ‘çš„æ˜¯ï¼š<a href="https://www.itrhx.com/baidusitemap.xml">https://www.itrhx.com/baidusitemap.xml</a> æˆ–è€… <a href="https://www.itrhx.com/sitemap.xml">https://www.itrhx.com/sitemap.xml</a></p><p>å…¶ä¸­ <code>sitemap.xml</code> æ–‡ä»¶æ˜¯æœç´¢å¼•æ“é€šç”¨çš„ sitemap æ–‡ä»¶ï¼Œ<code>baidusitemap.xml</code> æ˜¯ç™¾åº¦ä¸“ç”¨çš„ sitemap æ–‡ä»¶</p><p>ç„¶åæ¥åˆ°ç™¾åº¦ç«™é•¿å¹³å°çš„ sitemap æäº¤é¡µé¢ï¼Œå°†ä½ çš„ sitemap åœ°å€æäº¤å³å¯ï¼Œå¦‚æœæˆåŠŸçš„è¯çŠ¶æ€ä¼šæ˜¾ç¤ºä¸ºæ­£å¸¸ï¼Œåˆæ¬¡æäº¤è¦ç­‰å‡ åˆ†é’Ÿï¼Œsitemap.xml ç›¸æ¯” baidusitemap.xml æ¥è¯´ç­‰å¾…æ—¶é—´ä¹Ÿä¼šæ›´é•¿ï¼Œå¦‚æœä»¥åä½ åšå®¢æœ‰æ–°çš„æ–‡ç« æˆ–å…¶ä»–é¡µé¢ï¼Œå¯ä»¥ç‚¹å‡»<strong>æ‰‹åŠ¨æ›´æ–°æ–‡ä»¶</strong>ï¼Œæ›´æ–°ä¸€ä¸‹æ–°çš„ sitemap</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/07.png" alt="07"><br></fancybox><hr><h2 id="â—-æ‰‹åŠ¨æäº¤"><a href="#â—-æ‰‹åŠ¨æäº¤" class="headerlink" title="â— æ‰‹åŠ¨æäº¤"></a><font color="#1BC3FB">â— æ‰‹åŠ¨æäº¤</font></h2><p>æ‰‹åŠ¨æäº¤ä¸éœ€è¦å…¶ä»–é¢å¤–æ“ä½œï¼Œç›´æ¥æŠŠéœ€è¦æ”¶å½•çš„é¡µé¢çš„ url æäº¤å³å¯ï¼Œè¿™ç§æ–¹æ³•æ•ˆç‡è¾ƒä½ï¼Œæ›´æ–°è¾ƒæ…¢ï¼Œä¸æ¨èä½¿ç”¨</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/08.png" alt="08"><br></fancybox><hr><h1 id="â—-æäº¤è°·æ­Œæœç´¢"><a href="#â—-æäº¤è°·æ­Œæœç´¢" class="headerlink" title="â— æäº¤è°·æ­Œæœç´¢"></a><font color="#ff0000">â— æäº¤è°·æ­Œæœç´¢</font></h1><p>æäº¤è°·æ­Œæœç´¢å¼•æ“æ¯”è¾ƒç®€å•ï¼Œåœ¨æäº¤ä¹‹å‰ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ <code>site:åŸŸå</code> æŸ¥çœ‹ç½‘ç«™æ˜¯å¦è¢«æ”¶å½•ï¼Œæˆ‘çš„ç½‘ç«™æ­å»ºäº†æœ‰å·®ä¸å¤šä¸€å¹´äº†ï¼Œä¹‹å‰ä¹Ÿæ²¡æäº¤è¿‡æ”¶å½•ï¼Œä¸è¿‡è°·æ­Œçˆ¬è™«çš„ç¡®æ˜¯å¼ºå¤§ï¼Œå³ä½¿æ²¡æœ‰æäº¤è¿‡ï¼Œç°åœ¨ä¹Ÿèƒ½çœ‹åˆ°æœ‰ä¸€ç™¾å¤šæ¡ç»“æœäº†ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/09.png" alt="09"><br></fancybox><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ç½‘ç«™æäº¤è°·æ­Œæœç´¢å¼•æ“æœç´¢ï¼Œè¿›å…¥<a href="https://www.google.com/webmasters/" target="_blank" rel="noopener">è°·æ­Œç«™é•¿å¹³å°</a>ï¼Œç™»å½•ä½ çš„è°·æ­Œè´¦å·ä¹‹åä¼šè®©ä½ éªŒè¯ç½‘ç«™æ‰€æœ‰æƒï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/10.png" alt="10"><br></fancybox><p>æœ‰ä¸¤ç§éªŒè¯æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ç½‘åŸŸå’Œç½‘å€å‰ç¼€ï¼Œä¸¤ç§èµ„æºç±»å‹åŒºåˆ«å¦‚ä¸‹ï¼š</p><table><thead><tr><th></th><th style="text-align:left"><center>ç½‘å€å‰ç¼€èµ„æº</center></th><th style="text-align:left"><center>ç½‘åŸŸèµ„æº</center></th></tr></thead><tbody><tr><td>è¯´æ˜</td><td style="text-align:left">ä»…åŒ…å«å…·æœ‰æŒ‡å®šå‰ç¼€ï¼ˆåŒ…æ‹¬åè®® http/httpsï¼‰çš„ç½‘å€ã€‚å¦‚æœå¸Œæœ›èµ„æºåŒ¹é…ä»»ä½•åè®®æˆ–å­ç½‘åŸŸï¼ˆhttp/https/www./m. ç­‰ï¼‰ï¼Œå»ºè®®æ”¹ä¸ºæ·»åŠ ç½‘åŸŸèµ„æºã€‚</td><td style="text-align:left">åŒ…æ‹¬æ‰€æœ‰å­ç½‘åŸŸï¼ˆmã€www ç­‰ï¼‰å’Œå¤šç§åè®®ï¼ˆhttpã€httpsã€ftpï¼‰çš„ç½‘åŸŸçº§èµ„æºã€‚</td></tr><tr><td>éªŒè¯</td><td style="text-align:left">å¤šç§ç±»å‹</td><td style="text-align:left">ä»… DNS è®°å½•éªŒè¯</td></tr><tr><td>ç¤ºä¾‹</td><td style="text-align:left">èµ„æº <a href="http://example.com/" target="_blank" rel="noopener">http://example.com/</a><br><br><font color="#ff0000">âœ”</font> <a href="http://example.com/dresses/1234" target="_blank" rel="noopener">http://example.com/dresses/1234</a><br><font color="#ff0000">X</font> <a href="https://example.com/dresses/1234" target="_blank" rel="noopener">https://example.com/dresses/1234</a><br><font color="#ff0000">X</font> <a href="http://www.example.com/dresses/1234" target="_blank" rel="noopener">http://www.example.com/dresses/1234</a></td><td style="text-align:left">èµ„æº example.com<br><br><font color="#ff0000">âœ”</font> <a href="http://example.com/dresses/1234" target="_blank" rel="noopener">http://example.com/dresses/1234</a><br><font color="#ff0000">âœ”</font> <a href="https://example.com/dresses/1234" target="_blank" rel="noopener">https://example.com/dresses/1234</a><br><font color="#ff0000">âœ”</font> <a href="http://www.example.com/dresses/1234" target="_blank" rel="noopener">http://www.example.com/dresses/1234</a><br><font color="#ff0000">âœ”</font> <a href="http://support.m.example.com/dresses/1234" target="_blank" rel="noopener">http://support.m.example.com/dresses/1234</a></td></tr></tbody></table><p>ç”±å¯¹æ¯”å¯çŸ¥é€‰æ‹©ç½‘åŸŸèµ„æºéªŒè¯æ–¹å¼æ¯”è¾ƒå¥½ï¼Œåªéœ€è¦ä¸€ä¸ªåŸŸåå°±å¯ä»¥åŒ¹é…åˆ°å¤šç§æ ¼å¼çš„ URLï¼Œä¹‹åä¼šç»™ä½ ä¸€ä¸ª TXT çš„è®°å½•å€¼ï¼Œå¤åˆ¶å®ƒåˆ°ä½ åŸŸå DNS å¢åŠ ä¸€ä¸ª TXT è®°å½•ï¼Œç‚¹å‡»éªŒè¯å³å¯</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/11.png" alt="11"><br></fancybox><p>æäº¤è°·æ­Œæ”¶å½•æ¯”è¾ƒç®€å•ï¼Œé€‰æ‹©ç«™ç‚¹åœ°å›¾ï¼Œå°†æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆçš„ sitemap æäº¤å°±è¡Œäº†ï¼Œè¿‡å‡ åˆ†é’Ÿåˆ·æ–°ä¸€ä¸‹çœ‹åˆ°æˆåŠŸå­—æ ·è¡¨ç¤ºæäº¤æˆåŠŸï¼</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A48/12.png" alt="12"><br></fancybox>]]></content>
    
    <summary type="html">
    
      ç½‘ç«™ SEO ä¼˜åŒ–ï¼ŒHexo åšå®¢æäº¤ç™¾åº¦ã€è°·æ­Œæœç´¢å¼•æ“æ”¶å½•
    
    </summary>
    
      <category term="Hexo" scheme="https://www.itrhx.com/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://www.itrhx.com/tags/Hexo/"/>
    
      <category term="SEO" scheme="https://www.itrhx.com/tags/SEO/"/>
    
  </entry>
  
  <entry>
    <title>Hexo åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages å¹¶å®ç°å…¨ç«™ HPPTS</title>
    <link href="https://www.itrhx.com/2019/09/16/A47-hexo-deployed-to-github-and-coding/"/>
    <id>https://www.itrhx.com/2019/09/16/A47-hexo-deployed-to-github-and-coding/</id>
    <published>2019-09-16T06:11:40.959Z</published>
    <updated>2019-09-19T07:24:46.575Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>éƒ¨ç½²åˆ° Coding Pages çš„å¥½å¤„ï¼šå›½å†…è®¿é—®é€Ÿåº¦æ›´å¿«ï¼Œå¯ä»¥æäº¤ç™¾åº¦æ”¶å½•ï¼ˆGitHub ç¦æ­¢äº†ç™¾åº¦çš„çˆ¬å–ï¼‰</p></blockquote><blockquote><p>éƒ¨ç½²åˆ° Coding Pages çš„åå¤„ï¼šå°±ä»Šå¹´æ¥è¯´ï¼ŒCoding ä¸å¤ªç¨³å®šï¼Œéšæ—¶æœ‰å®•æœºçš„å¯èƒ½ï¼Œç¾¤é‡Œçš„æœ‹å‹å·²ç»ç»å†è¿‡å‡ æ¬¡äº†ï¼Œä¸è¿‡ç›¸ä¿¡ä»¥åä¼šè¶Šæ¥è¶Šç¨³å®šçš„</p></blockquote><blockquote><p>éƒ¨ç½²è¿‡ç¨‹ä¸­å¸¸è§çš„é—®é¢˜ï¼šæ— æ³•å®ç°å…¨ç«™ HTTPSï¼ŒCoding ç”³è¯· SSL è¯ä¹¦å¤±è´¥ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šæç¤ºä¸æ˜¯å®‰å…¨é“¾æ¥</p></blockquote><blockquote><p>æœ¬æ–‡å‰æï¼šä½ å·²ç»å°† Hexo æˆåŠŸéƒ¨ç½²åˆ°äº† GitHub Pagesï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œè¯·å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_36759224/article/details/82121420" target="_blank" rel="noopener">ã€Šä½¿ç”¨Github Pageså’ŒHexoæ­å»ºè‡ªå·±çš„ç‹¬ç«‹åšå®¢ã€è¶…çº§è¯¦ç»†çš„å°ç™½æ•™ç¨‹ã€‘ã€‹</a></p></blockquote><blockquote><p>æœ¬æ–‡å°†å…¨é¢è®²è¿°å¦‚ä½•æˆåŠŸåŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages å¹¶å®ç°å…¨ç«™ HPPTSï¼ŒåŒæ—¶è§£å†³ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼</p></blockquote><hr><h1 id="1-åˆ›å»ºé¡¹ç›®"><a href="#1-åˆ›å»ºé¡¹ç›®" class="headerlink" title="1.åˆ›å»ºé¡¹ç›®"></a><font color="#ff0000">1.åˆ›å»ºé¡¹ç›®</font></h1><p>è¿›å…¥ <a href="https://coding.net/" target="_blank" rel="noopener">Coding å®˜ç½‘</a>ï¼Œç‚¹å‡»ä¸ªäººç‰ˆç™»é™†ï¼Œæ²¡æœ‰è´¦å·å°±æ³¨å†Œä¸€ä¸ªå¹¶ç™»å½•ï¼Œç”±äº Coding å·²ç»è¢«è…¾è®¯æ”¶è´­äº†ï¼Œæ‰€ä»¥ç™»å½•å°±ä¼šæ¥åˆ°è…¾è®¯äº‘å¼€å‘è€…å¹³å°ï¼Œç‚¹å‡»åˆ›å»ºé¡¹ç›®</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/01.jpg" alt="01"><br></fancybox><p>é¡¹ç›®åç§°å»ºè®®å’Œä½ çš„ç”¨æˆ·åä¸€è‡´ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šåˆ°æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡ <code>user_name.coding.me</code> è®¿é—®ä½ çš„åšå®¢ï¼Œå¦‚æœé¡¹ç›®åä¸ç”¨æˆ·åä¸ä¸€è‡´ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>user_name.coding.me/project_name</code> æ‰èƒ½è®¿é—®ï¼Œé¡¹ç›®æè¿°å¯ä»¥éšä¾¿å†™</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/02.jpg" alt="02"><br></fancybox><hr><h1 id="2-é…ç½®å…¬é’¥"><a href="#2-é…ç½®å…¬é’¥" class="headerlink" title="2.é…ç½®å…¬é’¥"></a><font color="#ff0000">2.é…ç½®å…¬é’¥</font></h1><p>é…ç½® SSH å…¬é’¥æ–¹æ³•ä¸ GitHub Pages çš„æ–¹å¼å·®ä¸å¤šï¼Œç‚¹å‡»ä½ çš„å¤´åƒï¼Œä¾æ¬¡é€‰æ‹©ã€ä¸ªäººè®¾ç½®ã€‘-ã€SSHå…¬é’¥ã€‘-ã€æ–°å¢å…¬é’¥ã€‘</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/03.jpg" alt="03"><br></fancybox><p>å‰é¢éƒ¨ç½²åˆ° GitHub Pages çš„æ—¶å€™å°±å·²ç»æœ‰äº†ä¸€å¯¹å…¬é’¥ï¼Œæˆ‘ä»¬ç›´æ¥å°†è¯¥å…¬é’¥ç²˜è´´è¿›å»å°±è¡Œï¼Œå…¬é’¥åç§°å¯ä»¥éšä¾¿å†™ï¼Œé€‰ä¸­æ°¸ä¹…æœ‰æ•ˆé€‰é¡¹</p><p>PSï¼šå…¬é’¥å‚¨å­˜ä½ç½®ä¸€èˆ¬åœ¨ <font color="#ff0000">C:\Users\ç”¨æˆ·å\.ssh</font> ç›®å½•ä¸‹çš„ <font color="#ff0000">id_rsa.pub</font> æ–‡ä»¶é‡Œï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€å¤åˆ¶å…¶å†…å®¹å³å¯</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/04.jpg" alt="04"><br></fancybox><p>æ·»åŠ å…¬é’¥åï¼Œæˆ‘ä»¬å¯ä»¥å³é”® <code>Get Bash</code>ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@git.coding.net</span><br></pre></td></tr></table></figure><p>è‹¥å‡ºç°ä»¥ä¸‹æç¤ºï¼Œåˆ™è¯æ˜é…ç½®æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Coding æç¤º: Hello XXX, You<span class="string">'ve connected to Coding.net via SSH. This is a personal key.</span></span><br><span class="line"><span class="string">XXXï¼Œä½ å¥½ï¼Œä½ å·²ç»é€šè¿‡ SSH åè®®è®¤è¯ Coding.net æœåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ªäººå…¬é’¥</span></span><br></pre></td></tr></table></figure><hr><h1 id="3-é…ç½®-config-yml"><a href="#3-é…ç½®-config-yml" class="headerlink" title="3.é…ç½® _config.yml"></a><font color="#ff0000">3.é…ç½® _config.yml</font></h1><p>è¿›å…¥ä½ çš„é¡¹ç›®ï¼Œåœ¨å³ä¸‹è§’æœ‰é€‰æ‹©è¿æ¥æ–¹å¼ï¼Œé€‰æ‹© SSH æ–¹å¼ï¼ˆHTTPS æ–¹å¼ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æœ‰æ—¶å€™å¯èƒ½è¿æ¥ä¸ä¸Šï¼ŒSSH è¿æ¥ä¸å®¹æ˜“å‡ºé—®é¢˜ï¼‰ï¼Œä¸€é”®å¤åˆ¶ï¼Œç„¶åæ‰“å¼€ä½ æœ¬åœ°åšå®¢æ ¹ç›®å½•çš„ <code>_config.yml</code> æ–‡ä»¶ï¼Œæ‰¾åˆ° <code>deploy</code> å…³é”®å­—ï¼Œæ·»åŠ  coding åœ°å€ï¼š<code>coding: git@git.dev.tencent.com:user_name/user_name.git</code>ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšå¤åˆ¶çš„ SSH åœ°å€</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/05.jpg" alt="05"><br></fancybox><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/06.jpg" alt="06"><br></fancybox><p>æ·»åŠ å®Œæˆåå…ˆæ‰§è¡Œå‘½ä»¤ <code>hexo clean</code> æ¸…ç†ä¸€ä¸‹ç¼“å­˜ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ <code>hexo g -d</code> å°†åšå®¢åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pagesï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºè¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/13.jpg" alt="13"><br></fancybox><h1 id="4-å¼€å¯-Coding-Pages"><a href="#4-å¼€å¯-Coding-Pages" class="headerlink" title="4.å¼€å¯ Coding Pages"></a><font color="#ff0000">4.å¼€å¯ Coding Pages</font></h1><p>è¿›å…¥ä½ çš„é¡¹ç›®ï¼Œåœ¨ä»£ç æ ä¸‹é€‰æ‹© Pages æœåŠ¡ï¼Œä¸€é”®å¼€å¯ Coding Pagesï¼Œç­‰å¾…å‡ ç§’ååˆ·æ–°ç½‘é¡µå³å¯çœ‹åˆ°å·²ç»å¼€å¯çš„ Coding Pagesï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å°±å¯ä»¥é€šè¿‡ xxxx.coding.meï¼ˆæ¯”å¦‚æˆ‘çš„æ˜¯ trhx.coding.meï¼‰è®¿é—®ä½ çš„ Coding Pages é¡µé¢äº†</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/07.jpg" alt="07"><br></fancybox><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/08.jpg" alt="08"><br></fancybox><h1 id="5-ç»‘å®šåŸŸåå¹¶å¼€å¯-HPPTS"><a href="#5-ç»‘å®šåŸŸåå¹¶å¼€å¯-HPPTS" class="headerlink" title="5.ç»‘å®šåŸŸåå¹¶å¼€å¯ HPPTS"></a><font color="#ff0000">5.ç»‘å®šåŸŸåå¹¶å¼€å¯ HPPTS</font></h1><p>é¦–å…ˆåœ¨ä½ çš„åŸŸå DNS è®¾ç½®ä¸­æ·»åŠ ä¸€æ¡ CNAME è®°å½•æŒ‡å‘ xxxx.coding.meï¼Œè§£æè·¯çº¿é€‰æ‹©é»˜è®¤ï¼Œå°† GitHub çš„è§£æè·¯çº¿æ”¹ä¸ºå¢ƒå¤–ï¼Œè¿™æ ·å¢ƒå¤–è®¿é—®å°±ä¼šèµ° GitHubï¼Œå¢ƒå†…å°±ä¼šèµ° Codingï¼Œä¹Ÿæœ‰äººè¯´é˜¿é‡Œäº‘æ˜¯æ™ºèƒ½è§£æï¼Œè‡ªåŠ¨åˆ†é…è·¯çº¿ï¼Œå¦‚æœè§£æè·¯çº¿éƒ½æ˜¯é»˜è®¤ï¼Œå¢ƒå¤–è®¿é—®åŒæ ·ä¼šæ™ºèƒ½é€‰æ‹©èµ° GitHubï¼Œå¢ƒå†…èµ° Codingï¼Œæˆ‘æ²¡æœ‰éªŒè¯è¿‡ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œæˆ‘çš„è§£æå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/09.jpg" alt="09"><br></fancybox><p>ç„¶åç‚¹å‡»é™æ€ Pages åº”ç”¨å³ä¸Šè§’çš„è®¾ç½®ï¼Œè¿›å…¥è®¾ç½®é¡µé¢ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æœä½ ä¹‹å‰å·²ç»éƒ¨ç½²åˆ°äº† GitHub Pages å¹¶å¼€å¯äº† HTTPSï¼Œé‚£ä¹ˆç›´æ¥åœ¨è®¾ç½®é¡µé¢ç»‘å®šä½ è‡ªå·±çš„åŸŸåï¼ŒSSL/TLS å®‰å…¨è¯ä¹¦å°±ä¼šæ˜¾ç¤ºç”³è¯·é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ²¡æœ‰ç”³è¯·åˆ° SSL è¯ä¹¦ï¼Œå½“ä½ è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæç¤ºä¸æ˜¯å®‰å…¨è¿æ¥</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/10.jpg" alt="10"><br></fancybox><p>ç”³è¯·é”™è¯¯åŸå› æ˜¯ï¼šåœ¨éªŒè¯åŸŸåæ‰€æœ‰æƒæ—¶ä¼šå®šä½åˆ° Github Pages çš„ä¸»æœºä¸Šå¯¼è‡´ SSL è¯ä¹¦ç”³è¯·å¤±è´¥</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ï¼š<font color="#ff0000">å…ˆå»åŸŸå DNS æŠŠ GitHub çš„è§£ææš‚åœæ‰ï¼Œç„¶åå†é‡æ–°ç”³è¯· SSL è¯ä¹¦</font>ï¼Œå¤§çº¦åç§’å·¦å³å°±èƒ½ç”³è¯·æˆåŠŸï¼Œç„¶åå¼€å¯å¼ºåˆ¶ HTTPS è®¿é—®</p><p>è¿™é‡Œä¹Ÿå»ºè®®åŒæ—¶ç»‘å®šæœ‰ www å‰ç¼€åæ²¡æœ‰ www å‰ç¼€çš„ï¼Œç„¶ååœ¨åŸŸå DNS æ·»åŠ ä¸€ä¸ª CNAME æˆ–è€… A è®°å½•ï¼Œè®°å½•å€¼ä¸º @ï¼Œè¿™æ ·ä¸ç®¡ç”¨æˆ·æ˜¯å¦è¾“å…¥ www å‰ç¼€éƒ½å¯ä»¥è®¿é—®äº†</p><p>åœ¨åšå®¢èµ„æºå¼•ç”¨çš„æ—¶å€™ä¹Ÿè¦æ³¨æ„æ‰€æœ‰èµ„æºçš„ URL å¿…é¡»æ˜¯ä»¥ https:// å¼€å¤´ï¼Œä¸ç„¶æµè§ˆå™¨ä¾æ—§ä¼šæç¤ºä¸å®‰å…¨ï¼</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/11.jpg" alt="11"><br></fancybox><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ Hexo åšå®¢å°±æˆåŠŸåŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages äº†ï¼Œå¹¶ä¸”ä¹Ÿå®ç°äº†å…¨ç«™ HPPTSï¼Œæœ€åæ¥ä¸€å¼  GitHub Pages å’Œ Coding Pages åœ¨å›½å†…çš„é€Ÿåº¦å¯¹æ¯”å›¾ï¼Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°é€Ÿåº¦çš„æå‡</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A47/12.jpg" alt="12"><br></fancybox>]]></content>
    
    <summary type="html">
    
      Hexo åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages å¹¶å®ç°å…¨ç«™ HPPTS
    
    </summary>
    
      <category term="Hexo" scheme="https://www.itrhx.com/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://www.itrhx.com/tags/Hexo/"/>
    
      <category term="Coding Pages" scheme="https://www.itrhx.com/tags/Coding-Pages/"/>
    
      <category term="GitHub Pages" scheme="https://www.itrhx.com/tags/GitHub-Pages/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C16</title>
    <link href="https://www.itrhx.com/2019/09/14/A46-Python3-spider-C16/"/>
    <id>https://www.itrhx.com/2019/09/14/A46-Python3-spider-C16/</id>
    <published>2019-09-13T16:44:50.577Z</published>
    <updated>2019-09-24T12:43:19.863Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åå…­ç«  â€”â€” ã€æ•°æ®å‚¨å­˜ç³»åˆ— â€” Redisã€‘</font></center></blockquote><a id="more"></a><hr><h1 id="ã€16-1ã€‘å…³äº-Redis"><a href="#ã€16-1ã€‘å…³äº-Redis" class="headerlink" title="ã€16.1ã€‘å…³äº Redis"></a><font color="#ff0000">ã€16.1ã€‘å…³äº Redis</font></h1><p>Redis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ•ˆçš„é”®å€¼å‹ï¼ˆkey-valueï¼‰éå…³ç³»å‹æ•°æ®åº“ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„ value ç±»å‹éå¸¸å¤šï¼ŒåŒ…æ‹¬ string(å­—ç¬¦ä¸²)ã€list(é“¾è¡¨)ã€set(é›†åˆ)ã€zset(sorted set â€“æœ‰åºé›†åˆ) å’Œ hashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ï¼Œå®ƒçš„æ€§èƒ½ååˆ†ä¼˜è¶Šï¼Œå¯ä»¥æ”¯æŒæ¯ç§’åå‡ ä¸‡æ­¤çš„è¯»/å†™æ“ä½œï¼Œå…¶æ€§èƒ½è¿œè¶…æ•°æ®åº“ï¼Œå¹¶ä¸”è¿˜æ”¯æŒé›†ç¾¤ã€åˆ†å¸ƒå¼ã€ä¸»ä»åŒæ­¥ç­‰é…ç½®ï¼ŒåŸåˆ™ä¸Šå¯ä»¥æ— é™æ‰©å±•ï¼Œè®©æ›´å¤šçš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒä¸€å®šçš„äº‹åŠ¡èƒ½åŠ›ï¼Œè¿™ä¿è¯äº†é«˜å¹¶å‘çš„åœºæ™¯ä¸‹æ•°æ®çš„å®‰å…¨å’Œä¸€è‡´æ€§ã€‚</p><hr><h1 id="ã€16-2ã€‘ä½¿ç”¨-Redis"><a href="#ã€16-2ã€‘ä½¿ç”¨-Redis" class="headerlink" title="ã€16.2ã€‘ä½¿ç”¨ Redis"></a><font color="#ff0000">ã€16.2ã€‘ä½¿ç”¨ Redis</font></h1><p>é¦–å…ˆå®‰è£… Redis å’Œ redis-py åº“ï¼Œç®¡ç† Redis å¯ä»¥ä½¿ç”¨å¯è§†åŒ–å·¥å…· Redis Desktop Managerï¼Œè¯¥å·¥å…·ç°åœ¨æ”¶è´¹äº†ï¼Œåˆ†äº«ä¸ª 0.8.8.384 çš„å…è´¹ç‰ˆæœ¬</p><p>å®‰è£… redis-py åº“ï¼š<code>pip install redis</code><br>Redis å®˜ç½‘ï¼š<a href="https://redis.io" target="_blank" rel="noopener">https://redis.io</a><br>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://redis.io/documentation" target="_blank" rel="noopener">https://redis.io/documentation</a><br>ä¸­æ–‡å®˜ç½‘ï¼š<a href="http://www.redis.cn" target="_blank" rel="noopener">http://www.redis.cn</a><br>ä¸­æ–‡æ•™ç¨‹ï¼š<a href="http://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/redis/redis-tutorial.html</a><br>GitHubï¼š<a href="https://github.com/antirez/redis" target="_blank" rel="noopener">https://github.com/antirez/redis</a><br>Redis Windowsä¸‹è½½åœ°å€ä¸€ï¼š<a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener">https://github.com/microsoftarchive/redis/releases</a> ï¼ˆæœ€æ–°ç‰ˆ 3.2.100ï¼Œä¼¼ä¹ä¸å†æ›´æ–°ï¼‰<br>Redis Windowsä¸‹è½½åœ°å€äºŒï¼š<a href="https://github.com/tporadowski/redis/releases" target="_blank" rel="noopener">https://github.com/tporadowski/redis/releases</a> ï¼ˆæœ€æ–°ç‰ˆï¼‰<br>Redis Desktop Manager å®˜ç½‘ï¼š<a href="https://redisdesktop.com/" target="_blank" rel="noopener">https://redisdesktop.com/</a><br>Redis Desktop Manager 0.8.8.384 å…è´¹ç‰ˆï¼š<a href="https://pan.baidu.com/s/18MKeCqT0MG0hc89jfkpIkA" target="_blank" rel="noopener">https://pan.baidu.com/s/18MKeCqT0MG0hc89jfkpIkA</a> ï¼ˆæå–ç ï¼š3ovcï¼‰</p><p>åˆ©ç”¨ Python è¿æ¥ Redis ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis</span><br><span class="line"></span><br><span class="line">redis = StrictRedis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'000000'</span>)</span><br><span class="line">redis.set(<span class="string">'name'</span>, <span class="string">'TRHX'</span>)</span><br><span class="line">print(redis.get(<span class="string">'name'</span>))</span><br></pre></td></tr></table></figure><p>ä¼ å…¥ Redis çš„åœ°å€ã€è¿è¡Œç«¯å£ã€ä½¿ç”¨çš„æ•°æ®åº“å’Œå¯†ç ï¼Œ 4 ä¸ªå‚æ•°é»˜è®¤å€¼åˆ†åˆ«ä¸º localhostã€6379ã€0 å’Œ Noneï¼Œå£°æ˜ä¸€ä¸ª StrictRedis å¯¹è±¡ï¼Œè°ƒç”¨ set() æ–¹æ³•ï¼Œè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b'TRHX'</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ ConnectionPool æ¥è¿æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis, ConnectionPool  </span><br><span class="line"></span><br><span class="line">pool = ConnectionPool(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>, password=<span class="string">'000000'</span>)  </span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br></pre></td></tr></table></figure><p>ConnectionPool ä¹Ÿæ”¯æŒé€šè¿‡ URL æ¥æ„å»ºï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis://[:password]@host:port/db  <span class="comment"># åˆ›å»º Redis TCP è¿æ¥</span></span><br><span class="line">rediss://[:password]@host:port/db  <span class="comment"># åˆ›å»º Redis TCP+SSL è¿æ¥</span></span><br><span class="line">unix://[:password]@/path/to/socket.sock?db=db  # åˆ›å»º Redis UNIX socket è¿æ¥</span><br></pre></td></tr></table></figure><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis, ConnectionPool</span><br><span class="line"></span><br><span class="line">url = <span class="string">'redis://:000000@localhost:6379/0'</span>  </span><br><span class="line">pool = ConnectionPool.from_url(url)  </span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯æœ‰å…³çš„é”®æ“ä½œã€å­—ç¬¦ä¸²æ“ä½œã€åˆ—è¡¨æ“ä½œã€é›†åˆæ“ä½œã€æ•£åˆ—æ“ä½œçš„å„ç§æ–¹æ³•ï¼Œè®°å½•ä¸€ä¸‹ï¼Œæ–¹ä¾¿æŸ¥é˜…<br>æ¥æºï¼šã€ŠPython3 ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜ï¼ˆå´”åº†æ‰è‘—ï¼‰ã€‹<br>Redis å‘½ä»¤å‚è€ƒï¼š<a href="http://redisdoc.com/" target="_blank" rel="noopener">http://redisdoc.com/</a> ã€<a href="http://doc.redisfans.com/" target="_blank" rel="noopener">http://doc.redisfans.com/</a></p><hr><h1 id="ã€16-3ã€‘Keyï¼ˆé”®ï¼‰æ“ä½œ"><a href="#ã€16-3ã€‘Keyï¼ˆé”®ï¼‰æ“ä½œ" class="headerlink" title="ã€16.3ã€‘Keyï¼ˆé”®ï¼‰æ“ä½œ"></a><font color="#ff0000">ã€16.3ã€‘Keyï¼ˆé”®ï¼‰æ“ä½œ</font></h1><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>exists(name)</td><td>åˆ¤æ–­ä¸€ä¸ªé”®æ˜¯å¦å­˜åœ¨</td><td>nameï¼šé”®å</td><td>redis.exists(â€˜nameâ€™)</td><td>æ˜¯å¦å­˜åœ¨ name è¿™ä¸ªé”®</td><td>True</td></tr><tr><td>delete(name)</td><td>åˆ é™¤ä¸€ä¸ªé”®</td><td>nameï¼šé”®å</td><td>redis.delete(â€˜nameâ€™)</td><td>åˆ é™¤ name è¿™ä¸ªé”®</td><td>1</td></tr><tr><td>type(name)</td><td>åˆ¤æ–­é”®ç±»å‹</td><td>nameï¼šé”®å</td><td>redis.type(â€˜nameâ€™)</td><td>åˆ¤æ–­ name è¿™ä¸ªé”®ç±»å‹</td><td>bâ€™stringâ€™</td></tr><tr><td>keys(pattern)</td><td>è·å–æ‰€æœ‰ç¬¦åˆè§„åˆ™çš„é”®</td><td>patternï¼šåŒ¹é…è§„åˆ™</td><td>redis.keys(â€˜n*â€™)</td><td>è·å–æ‰€æœ‰ä»¥ n å¼€å¤´çš„é”®</td><td>[bâ€™nameâ€™]</td></tr><tr><td>randomkey()</td><td>è·å–éšæœºçš„ä¸€ä¸ªé”®</td><td></td><td>randomkey()</td><td>è·å–éšæœºçš„ä¸€ä¸ªé”®</td><td>bâ€™nameâ€™</td></tr><tr><td>rename(src, dst)</td><td>é‡å‘½åé”®</td><td>srcï¼šåŸé”®åï¼›dstï¼šæ–°é”®å</td><td>redis.rename(â€˜nameâ€™, â€˜nicknameâ€™)</td><td>å°† name é‡å‘½åä¸º nickname</td><td>True</td></tr><tr><td>dbsize()</td><td>è·å–å½“å‰æ•°æ®åº“ä¸­é”®çš„æ•°ç›®</td><td></td><td>dbsize()</td><td>è·å–å½“å‰æ•°æ®åº“ä¸­é”®çš„æ•°ç›®</td><td>100</td></tr><tr><td>expire(name, time)</td><td>è®¾å®šé”®çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’</td><td>nameï¼šé”®åï¼›timeï¼šç§’æ•°</td><td>redis.expire(â€˜nameâ€™, 2)</td><td>å°† name é”®çš„è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º 2 ç§’</td><td>True</td></tr><tr><td>ttl(name)</td><td>è·å–é”®çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œ-1 è¡¨ç¤ºæ°¸ä¹…ä¸è¿‡æœŸ</td><td>nameï¼šé”®å</td><td>redis.ttl(â€˜nameâ€™)</td><td>è·å– name è¿™ä¸ªé”®çš„è¿‡æœŸæ—¶é—´</td><td>-1</td></tr><tr><td>move(name, db)</td><td>å°†é”®ç§»åŠ¨åˆ°å…¶ä»–æ•°æ®åº“</td><td>nameï¼šé”®åï¼›dbï¼šæ•°æ®åº“ä»£å·</td><td>move(â€˜nameâ€™, 2)</td><td>å°† name ç§»åŠ¨åˆ° 2 å·æ•°æ®åº“</td><td>True</td></tr><tr><td>flushdb()</td><td>åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®</td><td></td><td>flushdb()</td><td>åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®</td><td>True</td></tr><tr><td>flushall()</td><td>åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®</td><td></td><td>flushall()</td><td>åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰é”®</td><td>True</td></tr></tbody></table><hr><h1 id="ã€16-4ã€‘Stringï¼ˆå­—ç¬¦ä¸²ï¼‰æ“ä½œ"><a href="#ã€16-4ã€‘Stringï¼ˆå­—ç¬¦ä¸²ï¼‰æ“ä½œ" class="headerlink" title="ã€16.4ã€‘Stringï¼ˆå­—ç¬¦ä¸²ï¼‰æ“ä½œ"></a><font color="#ff0000">ã€16.4ã€‘Stringï¼ˆå­—ç¬¦ä¸²ï¼‰æ“ä½œ</font></h1><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>set(name, value)</td><td>ç»™æ•°æ®åº“ä¸­é”®åä¸º name çš„ string èµ‹äºˆå€¼ value</td><td>nameï¼šé”®åï¼›valueï¼šå€¼</td><td>redis.set(â€˜nameâ€™, â€˜Bobâ€™)</td><td>ç»™ name è¿™ä¸ªé”®çš„ value èµ‹å€¼ä¸º Bob</td><td>True</td></tr><tr><td>get(name)</td><td>è¿”å›æ•°æ®åº“ä¸­é”®åä¸º name çš„ string çš„ value</td><td>nameï¼šé”®å</td><td>redis.get(â€˜nameâ€™)</td><td>è¿”å› name è¿™ä¸ªé”®çš„ value</td><td>bâ€™Bobâ€™</td></tr><tr><td>getset(name, value)</td><td>ç»™æ•°æ®åº“ä¸­é”®åä¸º name çš„ string èµ‹äºˆå€¼ value å¹¶è¿”å›ä¸Šæ¬¡çš„ value</td><td>nameï¼šé”®åï¼›valueï¼šæ–°å€¼</td><td>redis.getset(â€˜nameâ€™, â€˜Mikeâ€™)</td><td>èµ‹å€¼ name ä¸º Mike å¹¶å¾—åˆ°ä¸Šæ¬¡çš„ value</td><td>bâ€™Bobâ€™</td></tr><tr><td>mget(keys, *args)</td><td>è¿”å›å¤šä¸ªé”®å¯¹åº”çš„ value ç»„æˆçš„åˆ—è¡¨</td><td>keysï¼šé”®ååºåˆ—</td><td>redis.mget([â€˜nameâ€™, â€˜nicknameâ€™])</td><td>è¿”å› name å’Œ nickname çš„ value</td><td>[bâ€™Mikeâ€™, bâ€™Mikerâ€™]</td></tr><tr><td>setnx(name, value)</td><td>å¦‚æœä¸å­˜åœ¨è¿™ä¸ªé”®å€¼å¯¹ï¼Œåˆ™æ›´æ–° valueï¼Œå¦åˆ™ä¸å˜</td><td>nameï¼šé”®å</td><td>redis.setnx(â€˜newnameâ€™, â€˜Jamesâ€™)</td><td>å¦‚æœ newname è¿™ä¸ªé”®ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®å€¼ä¸º James</td><td>ç¬¬ä¸€æ¬¡è¿è¡Œç»“æœæ˜¯ Trueï¼Œç¬¬äºŒæ¬¡è¿è¡Œç»“æœæ˜¯ False</td></tr><tr><td>setex(name, time, value)</td><td>è®¾ç½®å¯ä»¥å¯¹åº”çš„å€¼ä¸º string ç±»å‹çš„ valueï¼Œå¹¶æŒ‡å®šæ­¤é”®å€¼å¯¹åº”çš„æœ‰æ•ˆæœŸ</td><td>nameï¼šé”®åï¼›timeï¼šæœ‰æ•ˆæœŸï¼›valueï¼šå€¼</td><td>redis.setex(â€˜nameâ€™, 1, â€˜Jamesâ€™)</td><td>å°† name è¿™ä¸ªé”®çš„å€¼è®¾ä¸º Jamesï¼Œæœ‰æ•ˆæœŸä¸º 1 ç§’</td><td>True</td></tr><tr><td>setrange(name, offset, value)</td><td>è®¾ç½®æŒ‡å®šé”®çš„ value å€¼çš„å­å­—ç¬¦ä¸²</td><td>nameï¼šé”®åï¼›offsetï¼šåç§»é‡ï¼›valueï¼šå€¼</td><td>redis.set(â€˜nameâ€™, â€˜Helloâ€™) redis.setrange (â€˜nameâ€™, 6, â€˜Worldâ€™)</td><td>è®¾ç½® name ä¸º Hello å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨ index ä¸º 6 çš„ä½ç½®è¡¥ World</td><td>11ï¼Œä¿®æ”¹åçš„å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>mset(mapping)</td><td>æ‰¹é‡èµ‹å€¼</td><td>mappingï¼šå­—å…¸æˆ–å…³é”®å­—å‚æ•°</td><td>redis.mset({â€˜name1â€™: â€˜Durantâ€™, â€˜name2â€™: â€˜Jamesâ€™})</td><td>å°† name1 è®¾ä¸º Durantï¼Œname2 è®¾ä¸º James</td><td>True</td></tr><tr><td>msetnx(mapping)</td><td>é”®å‡ä¸å­˜åœ¨æ—¶æ‰æ‰¹é‡èµ‹å€¼</td><td>mappingï¼šå­—å…¸æˆ–å…³é”®å­—å‚æ•°</td><td>redis.msetnx({â€˜name3â€™: â€˜Smithâ€™, â€˜name4â€™: â€˜Curryâ€™})</td><td>åœ¨ name3 å’Œ name4 å‡ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰è®¾ç½®äºŒè€…å€¼</td><td>True</td></tr><tr><td>incr(name, amount=1)</td><td>é”®åä¸º name çš„ value å¢å€¼æ“ä½œï¼Œé»˜è®¤ä¸º 1ï¼Œé”®ä¸å­˜åœ¨åˆ™è¢«åˆ›å»ºå¹¶è®¾ä¸º amount</td><td>nameï¼šé”®åï¼›amountï¼šå¢é•¿çš„å€¼</td><td>redis.incr(â€˜ageâ€™, 1)</td><td>age å¯¹åº”çš„å€¼å¢ 1ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå¹¶è®¾ç½®ä¸º 1</td><td>1ï¼Œå³ä¿®æ”¹åçš„å€¼</td></tr><tr><td>decr(name, amount=1)</td><td>é”®åä¸º name çš„ value å‡å€¼æ“ä½œï¼Œé»˜è®¤ä¸º 1ï¼Œé”®ä¸å­˜åœ¨åˆ™è¢«åˆ›å»ºå¹¶å°† value è®¾ç½®ä¸º - amount</td><td>nameï¼šé”®åï¼›amountï¼šå‡å°‘çš„å€¼</td><td>redis.decr(â€˜ageâ€™, 1)</td><td>age å¯¹åº”çš„å€¼å‡ 1ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå¹¶è®¾ç½®ä¸º-1</td><td>-1ï¼Œå³ä¿®æ”¹åçš„å€¼</td></tr><tr><td>append(key, value)</td><td>é”®åä¸º key çš„ string çš„å€¼é™„åŠ  value</td><td>keyï¼šé”®å</td><td>redis.append(â€˜nicknameâ€™, â€˜OKâ€™)</td><td>å‘é”®åä¸º nickname çš„å€¼åè¿½åŠ  OK</td><td>13ï¼Œå³ä¿®æ”¹åçš„å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>substr(name, start, end=-1)</td><td>è¿”å›é”®åä¸º name çš„ string çš„å­å­—ç¬¦ä¸²</td><td>nameï¼šé”®åï¼›startï¼šèµ·å§‹ç´¢å¼•ï¼›endï¼šç»ˆæ­¢ç´¢å¼•ï¼Œé»˜è®¤ä¸º-1ï¼Œè¡¨ç¤ºæˆªå–åˆ°æœ«å°¾</td><td>redis.substr(â€˜nameâ€™, 1, 4)</td><td>è¿”å›é”®åä¸º name çš„å€¼çš„å­—ç¬¦ä¸²ï¼Œæˆªå–ç´¢å¼•ä¸º 1~4 çš„å­—ç¬¦</td><td>bâ€™elloâ€™</td></tr><tr><td>getrange(key, start, end)</td><td>è·å–é”®çš„ value å€¼ä» start åˆ° end çš„å­å­—ç¬¦ä¸²</td><td>keyï¼šé”®åï¼›startï¼šèµ·å§‹ç´¢å¼•ï¼›endï¼šç»ˆæ­¢ç´¢å¼•</td><td>redis.getrange(â€˜nameâ€™, 1, 4)</td><td>è¿”å›é”®åä¸º name çš„å€¼çš„å­—ç¬¦ä¸²ï¼Œæˆªå–ç´¢å¼•ä¸º 1~4 çš„å­—ç¬¦</td><td>bâ€™ello</td></tr></tbody></table><hr><h1 id="ã€16-5ã€‘Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰æ“ä½œ"><a href="#ã€16-5ã€‘Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰æ“ä½œ" class="headerlink" title="ã€16.5ã€‘Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰æ“ä½œ"></a><font color="#ff0000">ã€16.5ã€‘Hashï¼ˆå“ˆå¸Œè¡¨ï¼‰æ“ä½œ</font></h1><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>hset(name, key, value)</td><td>å‘é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­æ·»åŠ æ˜ å°„</td><td>nameï¼šé”®åï¼›keyï¼šæ˜ å°„é”®åï¼›valueï¼šæ˜ å°„é”®å€¼</td><td>hset(â€˜priceâ€™, â€˜cakeâ€™, 5)</td><td>å‘é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­æ·»åŠ æ˜ å°„å…³ç³»ï¼Œcake çš„å€¼ä¸º 5</td><td>1ï¼Œå³æ·»åŠ çš„æ˜ å°„ä¸ªæ•°</td></tr><tr><td>hsetnx(name, key, value)</td><td>å¦‚æœæ˜ å°„é”®åä¸å­˜åœ¨ï¼Œåˆ™å‘é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­æ·»åŠ æ˜ å°„</td><td>nameï¼šé”®åï¼›keyï¼šæ˜ å°„é”®åï¼›valueï¼šæ˜ å°„é”®å€¼</td><td>hsetnx(â€˜priceâ€™, â€˜bookâ€™, 6)</td><td>å‘é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­æ·»åŠ æ˜ å°„å…³ç³»ï¼Œbook çš„å€¼ä¸º 6</td><td>1ï¼Œå³æ·»åŠ çš„æ˜ å°„ä¸ªæ•°</td></tr><tr><td>hget(name, key)</td><td>è¿”å›é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­ key å¯¹åº”çš„å€¼</td><td>nameï¼šé”®åï¼›keyï¼šæ˜ å°„é”®å</td><td>redis.hget(â€˜priceâ€™, â€˜cakeâ€™)</td><td>è·å–é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­é”®åä¸º cake çš„å€¼</td><td>5</td></tr><tr><td>hmget(name, keys, *args)</td><td>è¿”å›é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­å„ä¸ªé”®å¯¹åº”çš„å€¼</td><td>nameï¼šé”®åï¼›keysï¼šé”®ååºåˆ—</td><td>redis.hmget(â€˜priceâ€™, [â€˜appleâ€™, â€˜orangeâ€™])</td><td>è·å–é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­ apple å’Œ orange çš„å€¼</td><td>[bâ€™3â€™, bâ€™7â€™]</td></tr><tr><td>hmset(name, mapping)</td><td>å‘é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­æ‰¹é‡æ·»åŠ æ˜ å°„</td><td>nameï¼šé”®åï¼›mappingï¼šæ˜ å°„å­—å…¸</td><td>redis.hmset(â€˜priceâ€™, {â€˜bananaâ€™: 2, â€˜pearâ€™: 6})</td><td>å‘é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­æ‰¹é‡æ·»åŠ æ˜ å°„</td><td>True</td></tr><tr><td>hincrby(name, key, amount=1)</td><td>å°†é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­æ˜ å°„çš„å€¼å¢åŠ  amount</td><td>nameï¼šé”®åï¼›keyï¼šæ˜ å°„é”®åï¼›amountï¼šå¢é•¿é‡</td><td>redis.hincrby(â€˜priceâ€™, â€˜appleâ€™, 3)</td><td>key ä¸º price çš„æ•£åˆ—è¡¨ä¸­ apple çš„å€¼å¢åŠ  3</td><td>6ï¼Œä¿®æ”¹åçš„å€¼</td></tr><tr><td>hexists(name, key)</td><td>é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨é”®åä¸ºé”®çš„æ˜ å°„</td><td>nameï¼šé”®åï¼›keyï¼šæ˜ å°„é”®å</td><td>redis.hexists(â€˜priceâ€™, â€˜bananaâ€™)</td><td>é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­ banana çš„å€¼æ˜¯å¦å­˜åœ¨</td><td>True</td></tr><tr><td>hdel(name, *keys)</td><td>åœ¨é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­ï¼Œåˆ é™¤é”®åä¸ºé”®çš„æ˜ å°„</td><td>nameï¼šé”®åï¼›keysï¼šé”®ååºåˆ—</td><td>redis.hdel(â€˜priceâ€™, â€˜bananaâ€™)</td><td>ä»é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­åˆ é™¤é”®åä¸º banana çš„æ˜ å°„</td><td>True</td></tr><tr><td>hlen(name)</td><td>ä»é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­è·å–æ˜ å°„ä¸ªæ•°</td><td>nameï¼šé”®å</td><td>redis.hlen(â€˜priceâ€™)</td><td>ä»é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­è·å–æ˜ å°„ä¸ªæ•°</td><td>6</td></tr><tr><td>hkeys(name)</td><td>ä»é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å</td><td>nameï¼šé”®å</td><td>redis.hkeys(â€˜priceâ€™)</td><td>ä»é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å</td><td>[bâ€™cakeâ€™, bâ€™bookâ€™, bâ€™bananaâ€™, bâ€™pearâ€™]</td></tr><tr><td>hvals(name)</td><td>ä»é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼</td><td>nameï¼šé”®å</td><td>redis.hvals(â€˜priceâ€™)</td><td>ä»é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼</td><td>[bâ€™5â€™, bâ€™6â€™, bâ€™2â€™, bâ€™6â€™]</td></tr><tr><td>hgetall(name)</td><td>ä»é”®åä¸º name çš„æ•£åˆ—è¡¨ä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼å¯¹</td><td>nameï¼šé”®å</td><td>redis.hgetall(â€˜priceâ€™)</td><td>ä»é”®åä¸º price çš„æ•£åˆ—è¡¨ä¸­è·å–æ‰€æœ‰æ˜ å°„é”®å€¼å¯¹</td><td>{bâ€™cakeâ€™: bâ€™5â€™, bâ€™bookâ€™: bâ€™6â€™, bâ€™orangeâ€™: bâ€™7â€™, bâ€™pearâ€™: bâ€™6â€™}</td></tr></tbody></table><hr><h1 id="ã€16-6ã€‘Listï¼ˆåˆ—è¡¨ï¼‰æ“ä½œ"><a href="#ã€16-6ã€‘Listï¼ˆåˆ—è¡¨ï¼‰æ“ä½œ" class="headerlink" title="ã€16.6ã€‘Listï¼ˆåˆ—è¡¨ï¼‰æ“ä½œ"></a><font color="#ff0000">ã€16.6ã€‘Listï¼ˆåˆ—è¡¨ï¼‰æ“ä½œ</font></h1><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>rpush(name, *values)</td><td>åœ¨é”®åä¸º name çš„åˆ—è¡¨æœ«å°¾æ·»åŠ å€¼ä¸º value çš„å…ƒç´ ï¼Œå¯ä»¥ä¼ å¤šä¸ª</td><td>nameï¼šé”®åï¼›valuesï¼šå€¼</td><td>redis.rpush(â€˜listâ€™, 1, 2, 3)</td><td>å‘é”®åä¸º list çš„åˆ—è¡¨å°¾æ·»åŠ  1ã€2ã€3</td><td>3ï¼Œåˆ—è¡¨å¤§å°</td></tr><tr><td>lpush(name, *values)</td><td>åœ¨é”®åä¸º name çš„åˆ—è¡¨å¤´æ·»åŠ å€¼ä¸º value çš„å…ƒç´ ï¼Œå¯ä»¥ä¼ å¤šä¸ª</td><td>nameï¼šé”®åï¼›valuesï¼šå€¼</td><td>redis.lpush(â€˜listâ€™, 0)</td><td>å‘é”®åä¸º list çš„åˆ—è¡¨å¤´éƒ¨æ·»åŠ  0</td><td>4ï¼Œåˆ—è¡¨å¤§å°</td></tr><tr><td>llen(name)</td><td>è¿”å›é”®åä¸º name çš„åˆ—è¡¨çš„é•¿åº¦</td><td>nameï¼šé”®å</td><td>redis.llen(â€˜listâ€™)</td><td>è¿”å›é”®åä¸º list çš„åˆ—è¡¨çš„é•¿åº¦</td><td>4</td></tr><tr><td>lrange(name, start, end)</td><td>è¿”å›é”®åä¸º name çš„åˆ—è¡¨ä¸­ start è‡³ end ä¹‹é—´çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›startï¼šèµ·å§‹ç´¢å¼•ï¼›endï¼šç»ˆæ­¢ç´¢å¼•</td><td>redis.lrange(â€˜listâ€™, 1, 3)</td><td>è¿”å›èµ·å§‹ç´¢å¼•ä¸º 1 ç»ˆæ­¢ç´¢å¼•ä¸º 3 çš„ç´¢å¼•èŒƒå›´å¯¹åº”çš„åˆ—è¡¨</td><td>[bâ€™3â€™, bâ€™2â€™, bâ€™1â€™]</td></tr><tr><td>ltrim(name, start, end)</td><td>æˆªå–é”®åä¸º name çš„åˆ—è¡¨ï¼Œä¿ç•™ç´¢å¼•ä¸º start åˆ° end çš„å†…å®¹</td><td>nameï¼šé”®åï¼›startï¼šèµ·å§‹ç´¢å¼•ï¼›endï¼šç»ˆæ­¢ç´¢å¼•</td><td>ltrim(â€˜listâ€™, 1, 3)</td><td>ä¿ç•™é”®åä¸º list çš„ç´¢å¼•ä¸º 1 åˆ° 3 çš„å…ƒç´ </td><td>True</td></tr><tr><td>lindex(name, index)</td><td>è¿”å›é”®åä¸º name çš„åˆ—è¡¨ä¸­ index ä½ç½®çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›indexï¼šç´¢å¼•</td><td>redis.lindex(â€˜listâ€™, 1)</td><td>è¿”å›é”®åä¸º list çš„åˆ—è¡¨ç´¢å¼•ä¸º 1 çš„å…ƒç´ </td><td>bâ€™2â€™</td></tr><tr><td>lset(name, index, value)</td><td>ç»™é”®åä¸º name çš„åˆ—è¡¨ä¸­ index ä½ç½®çš„å…ƒç´ èµ‹å€¼ï¼Œè¶Šç•Œåˆ™æŠ¥é”™</td><td>nameï¼šé”®åï¼›indexï¼šç´¢å¼•ä½ç½®ï¼›valueï¼šå€¼</td><td>redis.lset(â€˜listâ€™, 1, 5)</td><td>å°†é”®åä¸º list çš„åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 1 çš„ä½ç½®èµ‹å€¼ä¸º 5</td><td>True</td></tr><tr><td>lrem(name, count, value)</td><td>åˆ é™¤ count ä¸ªé”®çš„åˆ—è¡¨ä¸­å€¼ä¸º value çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›countï¼šåˆ é™¤ä¸ªæ•°ï¼›valueï¼šå€¼</td><td>redis.lrem(â€˜listâ€™, 2, 3)</td><td>å°†é”®åä¸º list çš„åˆ—è¡¨åˆ é™¤ä¸¤ä¸ª 3</td><td>1ï¼Œå³åˆ é™¤çš„ä¸ªæ•°</td></tr><tr><td>lpop(name)</td><td>è¿”å›å¹¶åˆ é™¤é”®åä¸º name çš„åˆ—è¡¨ä¸­çš„é¦–å…ƒç´ </td><td>nameï¼šé”®å</td><td>redis.lpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸º list çš„åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td><td>bâ€™5â€™</td></tr><tr><td>rpop(name)</td><td>è¿”å›å¹¶åˆ é™¤é”®åä¸º name çš„åˆ—è¡¨ä¸­çš„å°¾å…ƒç´ </td><td>nameï¼šé”®å</td><td>redis.rpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸º list çš„åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ </td><td>bâ€™2â€™</td></tr><tr><td>blpop(keys, timeout=0)</td><td>è¿”å›å¹¶åˆ é™¤åç§°åœ¨ keys ä¸­çš„ list ä¸­çš„é¦–ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡ç­‰å¾…</td><td>keysï¼šé”®ååºåˆ—ï¼›timeoutï¼šè¶…æ—¶ç­‰å¾…æ—¶é—´ï¼Œ0 ä¸ºä¸€ç›´ç­‰å¾…</td><td>redis.blpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤é”®åä¸º list çš„åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td><td>[bâ€™5â€™]</td></tr><tr><td>brpop(keys, timeout=0)</td><td>è¿”å›å¹¶åˆ é™¤é”®åä¸º name çš„åˆ—è¡¨ä¸­çš„å°¾å…ƒç´ ï¼Œå¦‚æœ list ä¸ºç©ºï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡ç­‰å¾…</td><td>keysï¼šé”®ååºåˆ—ï¼›timeoutï¼šè¶…æ—¶ç­‰å¾…æ—¶é—´ï¼Œ0 ä¸ºä¸€ç›´ç­‰å¾…</td><td>redis.brpop(â€˜listâ€™)</td><td>è¿”å›å¹¶åˆ é™¤åä¸º list çš„åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ </td><td>[bâ€™2â€™]</td></tr><tr><td>rpoplpush(src, dst)</td><td>è¿”å›å¹¶åˆ é™¤åç§°ä¸º src çš„åˆ—è¡¨çš„å°¾å…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°åç§°ä¸º dst çš„åˆ—è¡¨å¤´éƒ¨</td><td>srcï¼šæºåˆ—è¡¨çš„é”®ï¼›dstï¼šç›®æ ‡åˆ—è¡¨çš„ key</td><td>redis.rpoplpush(â€˜listâ€™, â€˜list2â€™)</td><td>å°†é”®åä¸º list çš„åˆ—è¡¨å°¾å…ƒç´ åˆ é™¤å¹¶å°†å…¶æ·»åŠ åˆ°é”®åä¸º list2 çš„åˆ—è¡¨å¤´éƒ¨ï¼Œç„¶åè¿”å›</td><td>bâ€™2â€™</td></tr></tbody></table><hr><h1 id="ã€16-7ã€‘Setï¼ˆé›†åˆï¼‰æ“ä½œ"><a href="#ã€16-7ã€‘Setï¼ˆé›†åˆï¼‰æ“ä½œ" class="headerlink" title="ã€16.7ã€‘Setï¼ˆé›†åˆï¼‰æ“ä½œ"></a><font color="#ff0000">ã€16.7ã€‘Setï¼ˆé›†åˆï¼‰æ“ä½œ</font></h1><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>sadd(name, *values)</td><td>å‘é”®åä¸º name çš„é›†åˆä¸­æ·»åŠ å…ƒç´ </td><td>nameï¼šé”®åï¼›valuesï¼šå€¼ï¼Œå¯ä¸ºå¤šä¸ª</td><td>redis.sadd(â€˜tagsâ€™, â€˜Bookâ€™, â€˜Teaâ€™, â€˜Coffeeâ€™)</td><td>å‘é”®åä¸º tags çš„é›†åˆä¸­æ·»åŠ  Bookã€Tea å’Œ Coffee è¿™ 3 ä¸ªå†…å®¹</td><td>3ï¼Œå³æ’å…¥çš„æ•°æ®ä¸ªæ•°</td></tr><tr><td>srem(name, *values)</td><td>ä»é”®åä¸º name çš„é›†åˆä¸­åˆ é™¤å…ƒç´ </td><td>nameï¼šé”®åï¼›valuesï¼šå€¼ï¼Œå¯ä¸ºå¤šä¸ª</td><td>redis.srem(â€˜tagsâ€™, â€˜Bookâ€™)</td><td>ä»é”®åä¸º tags çš„é›†åˆä¸­åˆ é™¤ Book</td><td>1ï¼Œå³åˆ é™¤çš„æ•°æ®ä¸ªæ•°</td></tr><tr><td>spop(name)</td><td>éšæœºè¿”å›å¹¶åˆ é™¤é”®åä¸º name çš„é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ </td><td>nameï¼šé”®å</td><td>redis.spop(â€˜tagsâ€™)</td><td>ä»é”®åä¸º tags çš„é›†åˆä¸­éšæœºåˆ é™¤å¹¶è¿”å›è¯¥å…ƒç´ </td><td>bâ€™Teaâ€™</td></tr><tr><td>smove(src, dst, value)</td><td>ä» src å¯¹åº”çš„é›†åˆä¸­ç§»é™¤å…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ° dst å¯¹åº”çš„é›†åˆä¸­</td><td>srcï¼šæºé›†åˆï¼›dstï¼šç›®æ ‡é›†åˆï¼›valueï¼šå…ƒç´ å€¼</td><td>redis.smove(â€˜tagsâ€™, â€˜tags2â€™, â€˜Coffeeâ€™)</td><td>ä»é”®åä¸º tags çš„é›†åˆä¸­åˆ é™¤å…ƒç´  Coffee å¹¶å°†å…¶æ·»åŠ åˆ°é”®ä¸º tags2 çš„é›†åˆ</td><td>True</td></tr><tr><td>scard(name)</td><td>è¿”å›é”®åä¸º name çš„é›†åˆçš„å…ƒç´ ä¸ªæ•°</td><td>nameï¼šé”®å</td><td>redis.scard(â€˜tagsâ€™)</td><td>è·å–é”®åä¸º tags çš„é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°</td><td>3</td></tr><tr><td>sismember(name, value)</td><td>æµ‹è¯• member æ˜¯å¦æ˜¯é”®åä¸º name çš„é›†åˆçš„å…ƒç´ </td><td>nameï¼šé”®å€¼</td><td>redis.sismember(â€˜tagsâ€™, â€˜Bookâ€™)</td><td>åˆ¤æ–­ Book æ˜¯å¦æ˜¯é”®åä¸º tags çš„é›†åˆå…ƒç´ </td><td>True</td></tr><tr><td>sinter(keys, *args)</td><td>è¿”å›æ‰€æœ‰ç»™å®šé”®çš„é›†åˆçš„äº¤é›†</td><td>keysï¼šé”®ååºåˆ—</td><td>redis.sinter([â€˜tagsâ€™, â€˜tags2â€™])</td><td>è¿”å›é”®åä¸º tags çš„é›†åˆå’Œé”®åä¸º tags2 çš„é›†åˆçš„äº¤é›†</td><td>{bâ€™Coffeeâ€™}</td></tr><tr><td>sinterstore(dest, keys, *args)</td><td>æ±‚äº¤é›†å¹¶å°†äº¤é›†ä¿å­˜åˆ° dest çš„é›†åˆ</td><td>destï¼šç»“æœé›†åˆï¼›keysï¼šé”®ååºåˆ—</td><td>redis.sinterstore (â€˜inttagâ€™, [â€˜tagsâ€™, â€˜tags2â€™])</td><td>æ±‚é”®åä¸º tags çš„é›†åˆå’Œé”®åä¸º tags2 çš„é›†åˆçš„äº¤é›†å¹¶å°†å…¶ä¿å­˜ä¸º inttag</td><td>1</td></tr><tr><td>sunion(keys, *args)</td><td>è¿”å›æ‰€æœ‰ç»™å®šé”®çš„é›†åˆçš„å¹¶é›†</td><td>keysï¼šé”®ååºåˆ—</td><td>redis.sunion([â€˜tagsâ€™, â€˜tags2â€™])</td><td>è¿”å›é”®åä¸º tags çš„é›†åˆå’Œé”®åä¸º tags2 çš„é›†åˆçš„å¹¶é›†</td><td>{bâ€™Coffeeâ€™, bâ€™Bookâ€™, bâ€™Penâ€™}</td></tr><tr><td>sunionstore(dest, keys, *args)</td><td>æ±‚å¹¶é›†å¹¶å°†å¹¶é›†ä¿å­˜åˆ° dest çš„é›†åˆ</td><td>destï¼šç»“æœé›†åˆï¼›keysï¼šé”®ååºåˆ—</td><td>redis.sunionstore (â€˜inttagâ€™, [â€˜tagsâ€™, â€˜tags2â€™])</td><td>æ±‚é”®åä¸º tags çš„é›†åˆå’Œé”®åä¸º tags2 çš„é›†åˆçš„å¹¶é›†å¹¶å°†å…¶ä¿å­˜ä¸º inttag</td><td>3</td></tr><tr><td>sdiff(keys, *args)</td><td>è¿”å›æ‰€æœ‰ç»™å®šé”®çš„é›†åˆçš„å·®é›†</td><td>keysï¼šé”®ååºåˆ—</td><td>redis.sdiff([â€˜tagsâ€™, â€˜tags2â€™])</td><td>è¿”å›é”®åä¸º tags çš„é›†åˆå’Œé”®åä¸º tags2 çš„é›†åˆçš„å·®é›†</td><td>{bâ€™Bookâ€™, bâ€™Penâ€™}</td></tr><tr><td>sdiffstore(dest, keys, *args)</td><td>æ±‚å·®é›†å¹¶å°†å·®é›†ä¿å­˜åˆ° dest é›†åˆ</td><td>destï¼šç»“æœé›†åˆï¼›keysï¼šé”®ååºåˆ—</td><td>redis.sdiffstore (â€˜inttagâ€™, [â€˜tagsâ€™, â€˜tags2â€™])</td><td>æ±‚é”®åä¸º tags çš„é›†åˆå’Œé”®åä¸º tags2 çš„é›†åˆçš„å·®é›†å¹¶å°†å…¶ä¿å­˜ä¸º inttag</td><td>3</td></tr><tr><td>smembers(name)</td><td>è¿”å›é”®åä¸º name çš„é›†åˆçš„æ‰€æœ‰å…ƒç´ </td><td>nameï¼šé”®å</td><td>redis.smembers(â€˜tagsâ€™)</td><td>è¿”å›é”®åä¸º tags çš„é›†åˆçš„æ‰€æœ‰å…ƒç´ </td><td>{bâ€™Penâ€™, bâ€™Bookâ€™, bâ€™Coffeeâ€™}</td></tr><tr><td>srandmember(name)</td><td>éšæœºè¿”å›é”®åä¸º name çš„é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œä½†ä¸åˆ é™¤å…ƒç´ </td><td>nameï¼šé”®å€¼</td><td>redis.srandmember(â€˜tagsâ€™)</td><td>éšæœºè¿”å›é”®åä¸º tags çš„é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ </td><td>Srandmember (name)</td></tr></tbody></table><hr><h1 id="ã€16-8ã€‘SortedSetï¼ˆæœ‰åºé›†åˆï¼‰æ“ä½œ"><a href="#ã€16-8ã€‘SortedSetï¼ˆæœ‰åºé›†åˆï¼‰æ“ä½œ" class="headerlink" title="ã€16.8ã€‘SortedSetï¼ˆæœ‰åºé›†åˆï¼‰æ“ä½œ"></a><font color="#ff0000">ã€16.8ã€‘SortedSetï¼ˆæœ‰åºé›†åˆï¼‰æ“ä½œ</font></h1><table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>å‚æ•°è¯´æ˜</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹è¯´æ˜</th><th>ç¤ºä¾‹ç»“æœ</th></tr></thead><tbody><tr><td>zadd(name, args, *kwargs)</td><td>å‘é”®åä¸º name çš„ zset ä¸­æ·»åŠ å…ƒç´  memberï¼Œscore ç”¨äºæ’åºã€‚å¦‚æœè¯¥å…ƒç´ å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶é¡ºåº</td><td>nameï¼šé”®åï¼›argsï¼šå¯å˜å‚æ•°</td><td>redis.zadd(â€˜gradeâ€™, 100, â€˜Bobâ€™, 98, â€˜Mikeâ€™)</td><td>å‘é”®åä¸º grade çš„ zset ä¸­æ·»åŠ  Bobï¼ˆå…¶ score ä¸º 100ï¼‰ï¼Œå¹¶æ·»åŠ  Mikeï¼ˆå…¶ score ä¸º 98ï¼‰</td><td>2ï¼Œå³æ·»åŠ çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zrem(name, *values)</td><td>åˆ é™¤é”®åä¸º name çš„ zset ä¸­çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›valuesï¼šå…ƒç´ </td><td>redis.zrem(â€˜gradeâ€™, â€˜Mikeâ€™)</td><td>ä»é”®åä¸º grade çš„ zset ä¸­åˆ é™¤ Mike</td><td>1ï¼Œå³åˆ é™¤çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zincrby(name, value, amount=1)</td><td>å¦‚æœåœ¨é”®åä¸º name çš„ zset ä¸­å·²ç»å­˜åœ¨å…ƒç´  valueï¼Œåˆ™å°†è¯¥å…ƒç´ çš„ score å¢åŠ  amountï¼›å¦åˆ™å‘è¯¥é›†åˆä¸­æ·»åŠ è¯¥å…ƒç´ ï¼Œå…¶ score çš„å€¼ä¸º amount</td><td>nameï¼šé”®åï¼›valueï¼šå…ƒç´ ï¼›amountï¼šå¢é•¿çš„ score å€¼</td><td>redis.zincrby(â€˜gradeâ€™, â€˜Bobâ€™, -2)</td><td>é”®åä¸º grade çš„ zset ä¸­ Bob çš„ score å‡ 2</td><td>98.0ï¼Œå³ä¿®æ”¹åçš„å€¼</td></tr><tr><td>zrank(name, value)</td><td>è¿”å›é”®åä¸º name çš„ zset ä¸­å…ƒç´ çš„æ’åï¼ŒæŒ‰ score ä»å°åˆ°å¤§æ’åºï¼Œå³åæ¬¡</td><td>nameï¼šé”®åï¼›valueï¼šå…ƒç´ å€¼</td><td>redis.zrank(â€˜gradeâ€™, â€˜Amyâ€™)</td><td>å¾—åˆ°é”®åä¸º grade çš„ zset ä¸­ Amy çš„æ’å</td><td>1</td></tr><tr><td>zrevrank(name, value)</td><td>è¿”å›é”®ä¸º name çš„ zset ä¸­å…ƒç´ çš„å€’æ•°æ’åï¼ˆæŒ‰ score ä»å¤§åˆ°å°æ’åºï¼‰ï¼Œå³åæ¬¡</td><td>nameï¼šé”®åï¼›valueï¼šå…ƒç´ å€¼</td><td>redis.zrevrank (â€˜gradeâ€™, â€˜Amyâ€™)</td><td>å¾—åˆ°é”®åä¸º grade çš„ zset ä¸­ Amy çš„å€’æ•°æ’å</td><td>2</td></tr><tr><td>zrevrange(name, start, end, withscores= False)</td><td>è¿”å›é”®åä¸º name çš„ zsetï¼ˆæŒ‰ score ä»å¤§åˆ°å°æ’åºï¼‰ä¸­ index ä» start åˆ° end çš„æ‰€æœ‰å…ƒç´ </td><td>nameï¼šé”®å€¼ï¼›startï¼šå¼€å§‹ç´¢å¼•ï¼›endï¼šç»“æŸç´¢å¼•ï¼›withscoresï¼šæ˜¯å¦å¸¦ score</td><td>redis.zrevrange (â€˜gradeâ€™, 0, 3)</td><td>è¿”å›é”®åä¸º grade çš„ zset ä¸­å‰å››åå…ƒç´ </td><td>[bâ€™Bobâ€™, bâ€™Mikeâ€™, bâ€™Amyâ€™, bâ€™Jamesâ€™]</td></tr><tr><td>zrangebyscore (name, min, max, start=None, num=None, withscores=False)</td><td>è¿”å›é”®åä¸º name çš„ zset ä¸­ score åœ¨ç»™å®šåŒºé—´çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›minï¼šæœ€ä½ scoreï¼›maxï¼šæœ€é«˜ scoreï¼›startï¼šèµ·å§‹ç´¢å¼•ï¼›numï¼šä¸ªæ•°ï¼›withscoresï¼šæ˜¯å¦å¸¦ score</td><td>redis.zrangebyscore (â€˜gradeâ€™, 80, 95)</td><td>è¿”å›é”®åä¸º grade çš„ zset ä¸­ score åœ¨ 80 å’Œ 95 ä¹‹é—´çš„å…ƒç´ </td><td>[bâ€™Bobâ€™, bâ€™Mikeâ€™, bâ€™Amyâ€™, bâ€™Jamesâ€™]</td></tr><tr><td>zcount(name, min, max)</td><td>è¿”å›é”®åä¸º name çš„ zset ä¸­ score åœ¨ç»™å®šåŒºé—´çš„æ•°é‡</td><td>nameï¼šé”®åï¼›minï¼šæœ€ä½ scoreï¼›maxï¼šæœ€é«˜ score</td><td>redis.zcount(â€˜gradeâ€™, 80, 95)</td><td>è¿”å›é”®åä¸º grade çš„ zset ä¸­ score åœ¨ 80 åˆ° 95 çš„å…ƒç´ ä¸ªæ•°</td><td>2</td></tr><tr><td>zcard(name)</td><td>è¿”å›é”®åä¸º name çš„ zset çš„å…ƒç´ ä¸ªæ•°</td><td>nameï¼šé”®å</td><td>redis.zcard(â€˜gradeâ€™)</td><td>è·å–é”®åä¸º grade çš„ zset ä¸­å…ƒç´ çš„ä¸ªæ•°</td><td>3</td></tr><tr><td>zremrangebyrank (name, min, max)</td><td>åˆ é™¤é”®åä¸º name çš„ zset ä¸­æ’ååœ¨ç»™å®šåŒºé—´çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›minï¼šæœ€ä½ä½æ¬¡ï¼›maxï¼šæœ€é«˜ä½æ¬¡</td><td>redis.zremrangebyrank (â€˜gradeâ€™, 0, 0)</td><td>åˆ é™¤é”®åä¸º grade çš„ zset ä¸­æ’åç¬¬ä¸€çš„å…ƒç´ </td><td>1ï¼Œå³åˆ é™¤çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zremrangebyscore (name, min, max)</td><td>åˆ é™¤é”®åä¸º name çš„ zset ä¸­ score åœ¨ç»™å®šåŒºé—´çš„å…ƒç´ </td><td>nameï¼šé”®åï¼›minï¼šæœ€ä½ scoreï¼›maxï¼šæœ€é«˜ score</td><td>redis.zremrangebyscore (â€˜gradeâ€™, 80, 90)</td><td>åˆ é™¤ score åœ¨ 80 åˆ° 90 ä¹‹é—´çš„å…ƒç´ </td><td>1ï¼Œå³åˆ é™¤çš„å…ƒç´ ä¸ªæ•°</td></tr></tbody></table><hr><h1 id="ã€16-9ã€‘RedisDump"><a href="#ã€16-9ã€‘RedisDump" class="headerlink" title="ã€16.9ã€‘RedisDump"></a><font color="#ff0000">ã€16.9ã€‘RedisDump</font></h1><p>RedisDump æ˜¯ Redis ä¸€ä¸ªæ•°æ®å¯¼å…¥å¯¼å‡ºå·¥å…·ï¼Œæ˜¯åŸºäº Ruby å®ç°çš„ï¼Œé¦–å…ˆè®¿é—® Ruby å®˜ç½‘å®‰è£…å¯¹åº”æ“ä½œç³»ç»Ÿçš„ Rubyï¼š<a href="http://www.ruby-lang.org/zh_cn/downloads/" target="_blank" rel="noopener">http://www.ruby-lang.org/zh_cn/downloads/</a> ï¼Œå®‰è£…å®Œæˆå³å¯ä½¿ç”¨ gem å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç±»ä¼¼äº Python å½“ä¸­çš„ pip å‘½ä»¤ï¼Œä½¿ç”¨ <code>gem install redis-dump</code> å³å¯å®Œæˆ RedisDump çš„å®‰è£…ï¼Œå®‰è£…å®Œæˆåå°±å¯ä»¥ä½¿ç”¨å¯¼å‡ºæ•°æ® <code>redis-dump</code> å‘½ä»¤å’Œå¯¼å…¥æ•°æ® <code>redis-load</code> å‘½ä»¤äº†</p><hr><h2 id="ã€16-9-1ã€‘å¯¼å‡ºæ•°æ®-redis-dump"><a href="#ã€16-9-1ã€‘å¯¼å‡ºæ•°æ®-redis-dump" class="headerlink" title="ã€16.9.1ã€‘å¯¼å‡ºæ•°æ® redis-dump"></a><font color="#1BC3FB">ã€16.9.1ã€‘å¯¼å‡ºæ•°æ® redis-dump</font></h2><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ <code>redis-dump -h</code> å¯ä»¥æŸ¥çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Usage: E:/Ruby26-x64/bin/redis-dump [global options] COMMAND [command options]</span><br><span class="line">    -u, --uri=S                      Redis URI (e.g. redis://hostname[:port])</span><br><span class="line">    -d, --database=S                 Redis database (e.g. -d 15)</span><br><span class="line">    -a, --password=S                 Redis password (e.g. -a 'my@pass/word')</span><br><span class="line">    -s, --sleep=S                    Sleep for S seconds after dumping (for debugging)</span><br><span class="line">    -c, --count=S                    Chunk size (default: 10000)</span><br><span class="line">    -f, --filter=S                   Filter selected keys (passed directly to redis' KEYS command)</span><br><span class="line">    -b, --base64                     Encode key values as base64 (useful for binary values)</span><br><span class="line">    -O, --without_optimizations      Disable run time optimizations</span><br><span class="line">    -V, --version                    Display version</span><br><span class="line">    -D, --debug</span><br><span class="line">        --nosafe</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è§£é‡Šï¼š</p><ul><li>-u Redis è¿æ¥å­—ç¬¦ä¸²</li><li>-d æ•°æ®åº“ä»£å·</li><li>-a æ•°æ®åº“å¯†ç </li><li>-s å¯¼å‡ºä¹‹åçš„ä¼‘çœ æ—¶é—´</li><li>-c åˆ†å—å¤§å°ï¼Œé»˜è®¤æ˜¯ 10000</li><li>-f å¯¼å‡ºæ—¶çš„è¿‡æ»¤å™¨</li><li>-b å°†é”®å€¼ç¼–ç ä¸º base64ï¼ˆå¯¹äºŒè¿›åˆ¶å€¼æœ‰ç”¨ï¼‰</li><li>-O ç¦ç”¨è¿è¡Œæ—¶ä¼˜åŒ–</li><li>-V æ˜¾ç¤ºç‰ˆæœ¬</li><li>-D å¼€å¯è°ƒè¯•</li></ul><p>å¯¼å‡ºæ•°æ®ç¤ºä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis-dump</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šç«¯å£</span></span><br><span class="line">redis-dump -u 127.0.0.1:6379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šç«¯å£å’Œå¯†ç </span></span><br><span class="line">redis-dump -u :password@127.0.0.1:6379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºæŒ‡å®šæ•°æ®åº“</span></span><br><span class="line">redis-dump -u 127.0.0.1:6379 -d 3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºåŒ…å«ç‰¹å®šå€¼çš„æ•°æ®</span></span><br><span class="line">redis-dump -u 127.0.0.1:6379 -f age</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡ºæ‰€æœ‰æ•°æ®</span></span><br><span class="line">&#123;"db":0,"key":"name5","ttl":-1,"type":"string","value":"DDD","size":3&#125;</span><br><span class="line">&#123;"db":0,"key":"name2","ttl":-1,"type":"string","value":"AAA","size":3&#125;</span><br><span class="line">&#123;"db":0,"key":"name4","ttl":-1,"type":"string","value":"CCC","size":3&#125;</span><br><span class="line">&#123;"db":0,"key":"name6","ttl":-1,"type":"string","value":"CCC","size":3&#125;</span><br><span class="line">&#123;"db":0,"key":"name","ttl":-1,"type":"string","value":"TRHX","size":4&#125;</span><br><span class="line">&#123;"db":0,"key":"name3","ttl":-1,"type":"string","value":"BBB","size":3&#125;</span><br><span class="line">&#123;"db":1,"key":"name2","ttl":-1,"type":"string","value":"BBB","size":3&#125;</span><br><span class="line">&#123;"db":1,"key":"name1","ttl":-1,"type":"string","value":"AAA","size":3&#125;</span><br><span class="line">&#123;"db":2,"key":"name2","ttl":-1,"type":"string","value":"BBB","size":3&#125;</span><br><span class="line">&#123;"db":2,"key":"name1","ttl":-1,"type":"string","value":"AAA","size":3&#125;</span><br><span class="line">&#123;"db":3,"key":"name2","ttl":-1,"type":"string","value":"HHH","size":3&#125;</span><br><span class="line">&#123;"db":3,"key":"name1","ttl":-1,"type":"string","value":"RRR","size":3&#125;</span><br><span class="line">&#123;"db":4,"key":"age","ttl":-1,"type":"string","value":"20","size":2&#125;</span><br><span class="line">&#123;"db":4,"key":"age2","ttl":-1,"type":"string","value":"19","size":2&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡º 3 å·æ•°æ®åº“</span></span><br><span class="line">&#123;"db":3,"key":"name2","ttl":-1,"type":"string","value":"HHH","size":3&#125;</span><br><span class="line">&#123;"db":3,"key":"name1","ttl":-1,"type":"string","value":"RRR","size":3&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯¼å‡º key åŒ…å« age çš„æ•°æ®</span></span><br><span class="line">&#123;"db":4,"key":"age","ttl":-1,"type":"string","value":"20","size":2&#125;</span><br><span class="line">&#123;"db":4,"key":"age2","ttl":-1,"type":"string","value":"19","size":2&#125;</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºæ‰€æœ‰æ•°æ®ä¸º JSON æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-dump -u 127.0.0.1:6379 &gt; db_full.json</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤å°†ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸º db_full.json çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name5"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"DDD"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"AAA"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name4"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"CCC"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name6"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"CCC"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"TRHX"</span>,<span class="attr">"size"</span>:<span class="number">4</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name3"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"BBB"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">1</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"BBB"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">1</span>,<span class="attr">"key"</span>:<span class="string">"name1"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"AAA"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">2</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"BBB"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">2</span>,<span class="attr">"key"</span>:<span class="string">"name1"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"AAA"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">3</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"HHH"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">3</span>,<span class="attr">"key"</span>:<span class="string">"name1"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"RRR"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">4</span>,<span class="attr">"key"</span>:<span class="string">"age"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"20"</span>,<span class="attr">"size"</span>:<span class="number">2</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">4</span>,<span class="attr">"key"</span>:<span class="string">"age2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"19"</span>,<span class="attr">"size"</span>:<span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‚æ•° -d æŒ‡å®šæŸä¸ªæ•°æ®åº“çš„æ‰€æœ‰æ•°æ®å¯¼å‡ºä¸º JSON æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-dump -u 127.0.0.1:6379 -d 4 &gt; db_db4.json</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šå°† 4 å·æ•°æ®åº“çš„æ•°æ®å¯¼å‡ºåˆ° db_db4.json æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">4</span>,<span class="attr">"key"</span>:<span class="string">"age"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"20"</span>,<span class="attr">"size"</span>:<span class="number">2</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">4</span>,<span class="attr">"key"</span>:<span class="string">"age2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"19"</span>,<span class="attr">"size"</span>:<span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å‚æ•° -f è¿‡æ»¤æ•°æ®ï¼Œåªå¯¼å‡ºç‰¹å®šçš„æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-dump -u 127.0.0.1:6379 -f name &gt; db_name.json</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šå¯¼å‡º key åŒ…å« name çš„æ•°æ®åˆ° db_name.json æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name5"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"DDD"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"AAA"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name4"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"CCC"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name6"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"CCC"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"TRHX"</span>,<span class="attr">"size"</span>:<span class="number">4</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">0</span>,<span class="attr">"key"</span>:<span class="string">"name3"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"BBB"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">1</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"BBB"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">1</span>,<span class="attr">"key"</span>:<span class="string">"name1"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"AAA"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">2</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"BBB"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">2</span>,<span class="attr">"key"</span>:<span class="string">"name1"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"AAA"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">3</span>,<span class="attr">"key"</span>:<span class="string">"name2"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"HHH"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br><span class="line">&#123;<span class="attr">"db"</span>:<span class="number">3</span>,<span class="attr">"key"</span>:<span class="string">"name1"</span>,<span class="attr">"ttl"</span>:<span class="number">-1</span>,<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"value"</span>:<span class="string">"RRR"</span>,<span class="attr">"size"</span>:<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="ã€16-9-2ã€‘å¯¼å…¥æ•°æ®-redis-load"><a href="#ã€16-9-2ã€‘å¯¼å…¥æ•°æ®-redis-load" class="headerlink" title="ã€16.9.2ã€‘å¯¼å…¥æ•°æ® redis-load"></a><font color="#1BC3FB">ã€16.9.2ã€‘å¯¼å…¥æ•°æ® redis-load</font></h2><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ <code>redis-load -h</code> å¯ä»¥æŸ¥çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-load --help  </span><br><span class="line">  Try: redis-load [global options] COMMAND [command options]   </span><br><span class="line">    -u, --uri=S                      Redis URI (e.g. redis://hostname[:port])  </span><br><span class="line">    -d, --database=S                 Redis database (e.g. -d 15)  </span><br><span class="line">    -s, --sleep=S                    Sleep for S seconds after dumping (for debugging)  </span><br><span class="line">    -n, --no_check_utf8  </span><br><span class="line">    -V, --version                    Display version  </span><br><span class="line">    -D, --debug  </span><br><span class="line">        --nosafe</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è§£é‡Šï¼š</p><ul><li>-u Redis è¿æ¥å­—ç¬¦ä¸²</li><li>-d æ•°æ®åº“ä»£å·ï¼Œé»˜è®¤æ˜¯å…¨éƒ¨</li><li>-s å¯¼å‡ºä¹‹åçš„ä¼‘çœ æ—¶é—´</li><li>-n ä¸æ£€æµ‹ UTF-8 ç¼–ç </li><li>-V æ˜¾ç¤ºç‰ˆæœ¬</li><li>-D å¼€å¯è°ƒè¯•</li></ul><p>å¯¼å…¥ç¤ºä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°† test.json æ–‡ä»¶æ‰€æœ‰å†…å®¹å¯¼å…¥åˆ°æ•°æ®åº“</span></span><br><span class="line">&lt; test.json redis-load -u 127.0.0.1:6379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°† test.json æ–‡ä»¶ db å€¼ä¸º 6 çš„æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“ </span></span><br><span class="line">&lt; test.json redis-load -u 127.0.0.1:6379 -d 6</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œä»¥ä¸‹æ–¹æ³•ä¹Ÿèƒ½å¯¼å…¥æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°† test.json æ–‡ä»¶æ‰€æœ‰å†…å®¹å¯¼å…¥åˆ°æ•°æ®åº“</span></span><br><span class="line">cat test.json | redis-load -u 127.0.0.1:6379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°† test.json æ–‡ä»¶ db å€¼ä¸º 6 çš„æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“ </span></span><br><span class="line">cat test.json | redis-load -u 127.0.0.1:6379 -d 6</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>cat</code> æ˜¯ Linux ç³»ç»Ÿä¸“æœ‰çš„å‘½ä»¤ï¼Œåœ¨ Windows ç³»ç»Ÿé‡Œæ²¡æœ‰ <code>cat</code> è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ Windows æ‰¹å¤„ç†å‘½ä»¤ <code>type</code> ä»£æ›¿ <code>cat</code></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åå…­ç«  â€”â€” ã€æ•°æ®å‚¨å­˜ç³»åˆ— â€” Redisã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="Redis" scheme="https://www.itrhx.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C15</title>
    <link href="https://www.itrhx.com/2019/09/10/A45-Python3-spider-C15/"/>
    <id>https://www.itrhx.com/2019/09/10/A45-Python3-spider-C15/</id>
    <published>2019-09-10T11:46:13.293Z</published>
    <updated>2019-09-24T12:41:02.822Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åäº”ç«  â€”â€” ã€ä»£ç†çš„åŸºæœ¬ä½¿ç”¨ã€‘</font></center></blockquote><a id="more"></a><hr><h1 id="ã€15-1ã€‘ä»£ç†åˆè¯†"><a href="#ã€15-1ã€‘ä»£ç†åˆè¯†" class="headerlink" title="ã€15.1ã€‘ä»£ç†åˆè¯†"></a><font color="#ff0000">ã€15.1ã€‘ä»£ç†åˆè¯†</font></h1><p>å¤§å¤šæ•°ç½‘ç«™éƒ½æœ‰åçˆ¬è™«æœºåˆ¶ï¼Œå¦‚æœä¸€æ®µæ—¶é—´å†…åŒä¸€ä¸ª IP å‘é€çš„è¯·æ±‚è¿‡å¤šï¼ŒæœåŠ¡å™¨å°±ä¼šæ‹’ç»è®¿é—®ï¼Œç›´æ¥ç¦å°è¯¥ IPï¼Œæ­¤æ—¶ï¼Œè®¾ç½®ä»£ç†å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç½‘ç»œä¸Šæœ‰è®¸å¤šå…è´¹ä»£ç†å’Œä»˜è´¹ä»£ç†ï¼Œæ¯”å¦‚<a href="https://www.xicidaili.com/" target="_blank" rel="noopener">è¥¿åˆºä»£ç†</a>ï¼Œ<a href="http://www.goubanjia.com/" target="_blank" rel="noopener">å…¨ç½‘ä»£ç† IP</a>ï¼Œ<a href="https://www.kuaidaili.com/" target="_blank" rel="noopener">å¿«ä»£ç†</a>ç­‰ï¼Œè®¾ç½®ä»£ç†éœ€è¦ç”¨åˆ°çš„å°±æ˜¯ä»£ç† IP åœ°å€å’Œç«¯å£å·ï¼Œå¦‚æœç”µè„‘ä¸Šè£…æœ‰ä»£ç†è½¯ä»¶ï¼ˆä¾‹å¦‚ï¼šé…¸é…¸ä¹³SSRï¼‰ï¼Œè½¯ä»¶ä¸€èˆ¬ä¼šåœ¨æœ¬æœºåˆ›å»º HTTP æˆ– SOCKS ä»£ç†æœåŠ¡ï¼Œç›´æ¥ä½¿ç”¨æ­¤ä»£ç†ä¹Ÿå¯ä»¥</p><h1 id="ã€15-2ã€‘urllib-åº“ä½¿ç”¨ä»£ç†"><a href="#ã€15-2ã€‘urllib-åº“ä½¿ç”¨ä»£ç†" class="headerlink" title="ã€15.2ã€‘urllib åº“ä½¿ç”¨ä»£ç†"></a><font color="#ff0000">ã€15.2ã€‘urllib åº“ä½¿ç”¨ä»£ç†</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:1080'</span></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = opener.open(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><p><a href="http://httpbin.org/get" target="_blank" rel="noopener">http://httpbin.org/get</a> æ˜¯ä¸€ä¸ªè¯·æ±‚æµ‹è¯•ç«™ç‚¹ï¼Œå€ŸåŠ© ProxyHandler è®¾ç½®ä»£ç†ï¼Œå‚æ•°ä¸ºå­—å…¸ç±»å‹ï¼Œé”®åä¸ºåè®®ç±»å‹ï¼Œé”®å€¼ä¸ºä»£ç†ï¼Œä»£ç†çš„å†™æ³•ï¼š<code>proxy = &#39;127.0.0.1:1080&#39;</code>ï¼Œå…¶ä¸­ 127.0.0.1 ä¸º IP åœ°å€ï¼Œ1080 ä¸ºç«¯å£å·ï¼Œè¿™é‡Œè¡¨ç¤ºæœ¬æœºçš„ä»£ç†è½¯ä»¶å·²ç»åœ¨æœ¬åœ° 1080 ç«¯å£åˆ›å»ºäº†ä»£ç†æœåŠ¡ï¼Œä»£ç†å‰é¢éœ€è¦åŠ ä¸Š http æˆ–è€… https åè®®ï¼Œå½“è¯·æ±‚çš„é“¾æ¥ä¸º http åè®®æ—¶ï¼ŒProxyHandler ä¼šè‡ªåŠ¨è°ƒç”¨ http ä»£ç†ï¼ŒåŒç†ï¼Œå½“è¯·æ±‚çš„é“¾æ¥ä¸º https åè®®æ—¶ï¼ŒProxyHandler ä¼šè‡ªåŠ¨è°ƒç”¨ https ä»£ç†ï¼Œ<code>build_opener()</code> æ–¹æ³•ä¼ å…¥ ProxyHandler å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ª openerï¼Œè°ƒç”¨ <code>open()</code> æ–¹æ³•ä¼ å…¥ä¸€ä¸ª url å³å¯é€šè¿‡ä»£ç†è®¿é—®è¯¥é“¾æ¥ï¼Œè¿è¡Œç»“æœä¸ºä¸€ä¸ª JSONï¼Œorigin å­—æ®µä¸ºæ­¤æ—¶å®¢æˆ·ç«¯çš„ IP</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"identity"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Python-urllib/3.6"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"168.70.60.141, 168.70.60.141"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯éœ€è¦è®¤è¯çš„ä»£ç†ï¼Œåªéœ€è¦åœ¨ä»£ç†å‰é¢åŠ å…¥ä»£ç†è®¤è¯çš„ç”¨æˆ·åå¯†ç å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'username:password@127.0.0.1:1080'</span></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = opener.open(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><p>å¦‚æœä»£ç†æ˜¯ SOCKS5 ç±»å‹ï¼Œéœ€è¦ç”¨åˆ° <code>socks</code> æ¨¡å—ï¼Œè®¾ç½®ä»£ç†æ–¹æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>æ‰©å±•ï¼šSOCKS5 æ˜¯ä¸€ä¸ªä»£ç†åè®®ï¼Œå®ƒåœ¨ä½¿ç”¨TCP/IPåè®®é€šè®¯çš„å‰ç«¯æœºå™¨å’ŒæœåŠ¡å™¨æœºå™¨ä¹‹é—´æ‰®æ¼”ä¸€ä¸ªä¸­ä»‹è§’è‰²ï¼Œä½¿å¾—å†…éƒ¨ç½‘ä¸­çš„å‰ç«¯æœºå™¨å˜å¾—èƒ½å¤Ÿè®¿é—® Internet ç½‘ä¸­çš„æœåŠ¡å™¨ï¼Œæˆ–è€…ä½¿é€šè®¯æ›´åŠ å®‰å…¨</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socks</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"></span><br><span class="line">socks.set_default_proxy(socks.SOCKS5, <span class="string">'127.0.0.1'</span>, <span class="number">1080</span>)</span><br><span class="line">socket.socket = socks.socksocket</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><h1 id="ã€15-3ã€‘requests-åº“ä½¿ç”¨ä»£ç†"><a href="#ã€15-3ã€‘requests-åº“ä½¿ç”¨ä»£ç†" class="headerlink" title="ã€15.3ã€‘requests åº“ä½¿ç”¨ä»£ç†"></a><font color="#ff0000">ã€15.3ã€‘requests åº“ä½¿ç”¨ä»£ç†</font></h1><p>requests åº“ä½¿ç”¨ä»£ç†åªéœ€è¦ä¼ å…¥ proxies å‚æ•°å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:1080'</span></span><br><span class="line">proxies = (&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'http://httpbin.org/get'</span>, proxies=proxies)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ChunkedEncodingError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"python-requests/2.22.0"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"168.70.60.141, 168.70.60.141"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œå¦‚æœæ˜¯éœ€è¦è®¤è¯çš„ä»£ç†ï¼Œä¹Ÿåªéœ€è¦åœ¨ä»£ç†å‰é¢åŠ å…¥ä»£ç†è®¤è¯çš„ç”¨æˆ·åå¯†ç å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'username:password@127.0.0.1:1080'</span></span><br><span class="line">proxies = (&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'http://httpbin.org/get'</span>, proxies=proxies)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ChunkedEncodingError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre></td></tr></table></figure><p>å¦‚æœä»£ç†æ˜¯ SOCKS5 ç±»å‹ï¼Œéœ€è¦ç”¨åˆ°  <code>requests[socks]</code> æ¨¡å—æˆ–è€… <code>socks</code> æ¨¡å—ï¼Œä½¿ç”¨ <code>requests[socks]</code> æ¨¡å—æ—¶è®¾ç½®ä»£ç†æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:1080'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://'</span> + proxy</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'http://httpbin.org/get'</span>, proxies=proxies)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>socks</code> æ¨¡å—æ—¶è®¾ç½®ä»£ç†æ–¹æ³•å¦‚ä¸‹ï¼ˆæ­¤ç±»æ–¹æ³•ä¸ºå…¨å±€è®¾ç½®ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> socks</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">socks.set_default_proxy(socks.SOCKS5, <span class="string">'127.0.0.1'</span>, <span class="number">1080</span>)</span><br><span class="line">socket.socket = socks.socksocket</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre></td></tr></table></figure><h1 id="ã€15-4ã€‘Selenium-ä½¿ç”¨ä»£ç†"><a href="#ã€15-4ã€‘Selenium-ä½¿ç”¨ä»£ç†" class="headerlink" title="ã€15.4ã€‘Selenium ä½¿ç”¨ä»£ç†"></a><font color="#ff0000">ã€15.4ã€‘Selenium ä½¿ç”¨ä»£ç†</font></h1><h2 id="ã€15-4-1ã€‘Chrome"><a href="#ã€15-4-1ã€‘Chrome" class="headerlink" title="ã€15.4.1ã€‘Chrome"></a><font color="#1BC3FB">ã€15.4.1ã€‘Chrome</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:1080'</span></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line">chrome_options.add_argument(<span class="string">'--proxy-server=http://'</span> + proxy)</span><br><span class="line">path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">browser = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">browser.get(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ ChromeOptions æ¥è®¾ç½®ä»£ç†ï¼Œåœ¨åˆ›å»º Chrome å¯¹è±¡çš„æ—¶å€™ç”¨ chrome_options å‚æ•°ä¼ é€’å³å¯ï¼Œè®¿é—®ç›®æ ‡é“¾æ¥åæ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"168.70.60.141, 168.70.60.141"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è®¤è¯ä»£ç†ï¼Œåˆ™è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line">ip = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">1080</span></span><br><span class="line">username = <span class="string">'username'</span></span><br><span class="line">password = <span class="string">'password'</span></span><br><span class="line"></span><br><span class="line">manifest_json = <span class="string">"""&#123;"version":"1.0.0","manifest_version": 2,"name":"Chrome Proxy","permissions": ["proxy","tabs","unlimitedStorage","storage","&lt;all_urls&gt;","webRequest","webRequestBlocking"],"background": &#123;"scripts": ["background.js"]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">background_js =<span class="string">"""</span></span><br><span class="line"><span class="string">var config = &#123;</span></span><br><span class="line"><span class="string">        mode: "fixed_servers",</span></span><br><span class="line"><span class="string">        rules: &#123;</span></span><br><span class="line"><span class="string">          singleProxy: &#123;</span></span><br><span class="line"><span class="string">            scheme: "http",</span></span><br><span class="line"><span class="string">            host: "%(ip) s",</span></span><br><span class="line"><span class="string">            port: %(port) s</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.proxy.settings.set(&#123;value: config, scope: "regular"&#125;, function() &#123;&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function callbackFn(details) &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        authCredentials: &#123;username: "%(username) s",</span></span><br><span class="line"><span class="string">            password: "%(password) s"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.webRequest.onAuthRequired.addListener(</span></span><br><span class="line"><span class="string">            callbackFn,</span></span><br><span class="line"><span class="string">            &#123;urls: ["&lt;all_urls&gt;"]&#125;,</span></span><br><span class="line"><span class="string">            ['blocking']</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">"""</span> % &#123;<span class="string">'ip'</span>: ip, <span class="string">'port'</span>: port, <span class="string">'username'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line"></span><br><span class="line">plugin_file = <span class="string">'proxy_auth_plugin.zip'</span></span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(plugin_file, <span class="string">'w'</span>) <span class="keyword">as</span> zp:</span><br><span class="line">    zp.writestr(<span class="string">"manifest.json"</span>, manifest_json)</span><br><span class="line">    zp.writestr(<span class="string">"background.js"</span>, background_js)</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">"--start-maximized"</span>)</span><br><span class="line">path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">chrome_options.add_extension(plugin_file)</span><br><span class="line">browser = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">browser.get(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª manifest.json é…ç½®æ–‡ä»¶å’Œ background.js è„šæœ¬æ¥è®¾ç½®è®¤è¯ä»£ç†ã€‚è¿è¡Œä»£ç ä¹‹åæœ¬åœ°ä¼šç”Ÿæˆä¸€ä¸ª proxy_auth_plugin.zip æ–‡ä»¶æ¥ä¿å­˜å½“å‰é…ç½®</p><h2 id="ã€15-4-1ã€‘PhantomJS"><a href="#ã€15-4-1ã€‘PhantomJS" class="headerlink" title="ã€15.4.1ã€‘PhantomJS"></a><font color="#1BC3FB">ã€15.4.1ã€‘PhantomJS</font></h2><p>å€ŸåŠ© service_args å‚æ•°ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤è¡Œå‚æ•°å³å¯è®¾ç½®ä»£ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">service_args = [</span><br><span class="line">    <span class="string">'--proxy=127.0.0.1:1080'</span>,</span><br><span class="line">    <span class="string">'--proxy-type=http'</span></span><br><span class="line">]</span><br><span class="line">path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\phantomjs-2.1.1\bin\phantomjs.exe'</span></span><br><span class="line">browser = webdriver.PhantomJS(executable_path=path, service_args=service_args)</span><br><span class="line">browser.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(browser.page_source)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,en,*"</span>, </span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"168.70.60.141, 168.70.60.141"</span>, </span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯éœ€è¦è®¤è¯çš„ä»£ç†ï¼Œåªéœ€è¦åœ¨ service_args å‚æ•°åŠ å…¥ â€“proxy-auth é€‰é¡¹å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">service_args = [</span><br><span class="line">    <span class="string">'--proxy=127.0.0.1:1080'</span>,</span><br><span class="line">    <span class="string">'--proxy-type=http'</span>,</span><br><span class="line">    <span class="string">'--proxy-auth=username:password'</span></span><br><span class="line">]</span><br><span class="line">path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\phantomjs-2.1.1\bin\phantomjs.exe'</span></span><br><span class="line">browser = webdriver.PhantomJS(executable_path=path, service_args=service_args)</span><br><span class="line">browser.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(browser.page_source)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åäº”ç«  â€”â€” ã€ä»£ç†çš„åŸºæœ¬ä½¿ç”¨ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="ä»£ç†" scheme="https://www.itrhx.com/tags/%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C14</title>
    <link href="https://www.itrhx.com/2019/09/08/A44-Python3-spider-C14/"/>
    <id>https://www.itrhx.com/2019/09/08/A44-Python3-spider-C14/</id>
    <published>2019-09-07T17:38:41.491Z</published>
    <updated>2019-09-24T12:43:31.445Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åå››ç«  â€”â€” ã€éªŒè¯ç å¯¹æŠ—ç³»åˆ— â€” ç‚¹è§¦éªŒè¯ç ã€‘</font></center></blockquote><a id="more"></a><hr><h1 id="ã€14-1ã€‘å…³äºç‚¹è§¦éªŒè¯ç "><a href="#ã€14-1ã€‘å…³äºç‚¹è§¦éªŒè¯ç " class="headerlink" title="ã€14.1ã€‘å…³äºç‚¹è§¦éªŒè¯ç "></a><font color="#ff0000">ã€14.1ã€‘å…³äºç‚¹è§¦éªŒè¯ç </font></h1><p>ç‚¹è§¦éªŒè¯ç æ˜¯ç”±æ­å·å¾®è§¦ç§‘æŠ€æœ‰é™å…¬å¸ç ”å‘çš„æ–°ä¸€ä»£çš„äº’è”ç½‘éªŒè¯ç ï¼Œä½¿ç”¨ç‚¹å‡»çš„å½¢å¼å®ŒæˆéªŒè¯ï¼Œé‡‡ç”¨ä¸“åˆ©çš„å°åˆ·ç®—æ³•ä»¥åŠåŠ å¯†ç®—æ³•ï¼Œä¿è¯æ¯æ¬¡è¯·æ±‚åˆ°çš„éªŒè¯å›¾å…·æœ‰æé«˜çš„å®‰å…¨æ€§ï¼Œå¸¸è§çš„ç‚¹è§¦éªŒè¯ç å¦‚ä¸‹ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A44/01.png" alt="01"><br></fancybox><hr><h1 id="ã€14-2ã€‘ç‚¹è§¦éªŒè¯ç æ”»å…‹æ€è·¯"><a href="#ã€14-2ã€‘ç‚¹è§¦éªŒè¯ç æ”»å…‹æ€è·¯" class="headerlink" title="ã€14.2ã€‘ç‚¹è§¦éªŒè¯ç æ”»å…‹æ€è·¯"></a><font color="#ff0000">ã€14.2ã€‘ç‚¹è§¦éªŒè¯ç æ”»å…‹æ€è·¯</font></h1><p>ç‚¹è§¦éªŒè¯ç ç›¸å¯¹å…¶ä»–ç±»å‹éªŒè¯ç æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœä¾é  OCR å›¾åƒè¯†åˆ«ç‚¹è§¦éªŒè¯ç ï¼Œåˆ™è¯†åˆ«éš¾åº¦éå¸¸å¤§ï¼Œæ­¤æ—¶å°±è¦ç”¨åˆ°äº’è”ç½‘çš„éªŒè¯ç æœåŠ¡å¹³å°ï¼Œè¿™äº›æœåŠ¡å¹³å°å…¨éƒ¨éƒ½æ˜¯äººå·¥åœ¨çº¿è¯†åˆ«ï¼Œå‡†ç¡®ç‡éå¸¸é«˜ï¼ŒåŸç†å°±æ˜¯å…ˆå°†éªŒè¯ç å›¾ç‰‡æäº¤ç»™å¹³å°ï¼Œå¹³å°ä¼šè¿”å›è¯†åˆ«ç»“æœåœ¨å›¾ç‰‡ä¸­çš„åæ ‡ä½ç½®ï¼Œç„¶åæˆ‘ä»¬å†è§£æåæ ‡æ¨¡æ‹Ÿç‚¹å‡»å³å¯ï¼Œå¸¸è§çš„æ‰“ç å¹³å°æœ‰è¶…çº§é¹°ã€äº‘æ‰“ç ç­‰ï¼Œæ‰“ç å¹³å°æ˜¯æ”¶è´¹çš„ï¼Œæ‹¿è¶…çº§é¹°æ¥è¯´ï¼Œ1å…ƒ = 1000é¢˜åˆ†ï¼Œè¯†åˆ«ä¸€æ¬¡éªŒè¯ç å°†èŠ±è´¹ä¸€å®šçš„é¢˜åˆ†ï¼Œä¸åŒç±»å‹éªŒè¯ç éœ€è¦çš„é¢˜åˆ†ä¸åŒï¼ŒéªŒè¯ç è¶Šå¤æ‚æ‰€éœ€é¢˜åˆ†è¶Šé«˜ï¼Œæ¯”å¦‚ 7 ä½ä¸­æ–‡æ±‰å­—éœ€è¦ 70 é¢˜åˆ†ï¼Œå¸¸è§ 4 ~ 6 ä½è‹±æ–‡æ•°å­—åªè¦ 10 é¢˜åˆ†ï¼Œå…¶ä»–æ‰“ç å¹³å°ä»·æ ¼ä¹Ÿéƒ½å·®ä¸å¤š</p><p>ä»¥ä¸‹ä»¥<a href="http://www.chaojiying.com/" target="_blank" rel="noopener">è¶…çº§é¹°æ‰“ç å¹³å°</a>å’Œ<a href="https://www.12306.cn/" target="_blank" rel="noopener">ä¸­å›½é“è·¯12306å®˜ç½‘</a>æ¥åšç»ƒä¹ </p><hr><h1 id="ã€14-3ã€‘æ¨¡æ‹Ÿç™»å½•-12306-â€”-æ€»ä½“æ€è·¯"><a href="#ã€14-3ã€‘æ¨¡æ‹Ÿç™»å½•-12306-â€”-æ€»ä½“æ€è·¯" class="headerlink" title="ã€14.3ã€‘æ¨¡æ‹Ÿç™»å½• 12306 â€” æ€»ä½“æ€è·¯"></a><font color="#ff0000">ã€14.3ã€‘æ¨¡æ‹Ÿç™»å½• 12306 â€” æ€»ä½“æ€è·¯</font></h1><p>é¦–å…ˆåœ¨è¶…çº§é¹°æ‰“ç å¹³å°æ³¨å†Œè´¦å·å¹¶ç”³è¯·ä¸€ä¸ªè½¯ä»¶ IDï¼Œå®˜ç½‘ï¼š<a href="http://www.chaojiying.com/" target="_blank" rel="noopener">http://www.chaojiying.com/</a> ï¼Œå…ˆå……å€¼ä¸€å—é’±å¾—åˆ° 1000 é¢˜åˆ†ï¼Œè§‚å¯Ÿ 12306 å®˜ç½‘ï¼Œå‘ç°éªŒè¯ç æ˜¯è¦æˆ‘ä»¬ç‚¹å‡»æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å›¾ç‰‡ï¼Œä¸€èˆ¬æœ‰ 1~4 å¼ å›¾ç‰‡æ»¡è¶³è¦æ±‚ï¼Œç”±æ­¤å¯ç¡®å®šåœ¨è¶…çº§é¹°æ‰“ç å¹³å°çš„éªŒè¯ç ç±»å‹ä¸º 9004ï¼ˆåæ ‡å¤šé€‰,è¿”å›1~4ä¸ªåæ ‡,å¦‚:x1,y1|x2,y2|x3,y3ï¼‰ï¼Œ è·å–å…¶ Python APIï¼š<a href="http://www.chaojiying.com/download/Chaojiying_Python.rar" target="_blank" rel="noopener">http://www.chaojiying.com/download/Chaojiying_Python.rar</a> ï¼Œç„¶åç”¨ Selenium æ¨¡æ‹Ÿç™»é™†ï¼Œè·å–åˆ°éªŒè¯ç ï¼Œå¹¶å°†éªŒè¯ç å‘é€ç»™è¶…çº§é¹°åå°ï¼Œè¿”å›è¯†åˆ«å›¾ç‰‡çš„åæ ‡ï¼Œæœ€åæ¨¡æ‹Ÿç‚¹å‡»å³å¯ï¼Œæ•´ä¸ªè¿‡ç¨‹çš„å®ç°ç”±ä¸»ç¨‹åº <code>12306.py</code> å’Œè¶…çº§é¹° API <code>chaojiying.py</code> ç»„æˆ</p><p>æ•´ä¸ªç¨‹åºåŒ…å«çš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">()</span>:</span> åˆå§‹åŒ– WebDriverã€Chaojiying å¯¹è±¡ç­‰</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">()</span>:</span> ç ´è§£å…¥å£ã€è·å–ã€è¯†åˆ«éªŒè¯ç ã€æ¨¡æ‹Ÿç™»å½•</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">()</span>:</span> è´¦å·å¯†ç è¾“å…¥</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_screenshot</span><span class="params">()</span>:</span> æ•´ä¸ªé¡µé¢æˆªå›¾</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_element</span><span class="params">()</span>:</span> è·å–éªŒè¯ç ä½ç½®</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_position</span><span class="params">()</span>:</span> è·å–éªŒè¯ç åæ ‡</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_image</span><span class="params">()</span>:</span> å‰ªè£éªŒè¯ç éƒ¨åˆ†</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_points</span><span class="params">(self, captcha_result)</span>:</span> åˆ†æè¶…çº§é¹°è¿”å›çš„åæ ‡</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">touch_click_words</span><span class="params">(self, locations)</span>:</span> æ¨¡æ‹Ÿç‚¹å‡»ç¬¦åˆè¦æ±‚çš„å›¾ç‰‡</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span> ç‚¹å‡»ç™»é™†æŒ‰é’®ï¼Œå®Œæˆæ¨¡æ‹Ÿç™»å½•</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªç¨‹åºç”¨åˆ°çš„åº“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> chaojiying <span class="keyword">import</span> Chaojiying</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br></pre></td></tr></table></figure><hr><h1 id="ã€14-4ã€‘ä¸»å‡½æ•°"><a href="#ã€14-4ã€‘ä¸»å‡½æ•°" class="headerlink" title="ã€14.4ã€‘ä¸»å‡½æ•°"></a><font color="#ff0000">ã€14.4ã€‘ä¸»å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    crack = CrackTouClick()</span><br><span class="line">    crack.crack()</span><br></pre></td></tr></table></figure><hr><h1 id="ã€14-5ã€‘åˆå§‹åŒ–å‡½æ•°"><a href="#ã€14-5ã€‘åˆå§‹åŒ–å‡½æ•°" class="headerlink" title="ã€14.5ã€‘åˆå§‹åŒ–å‡½æ•°"></a><font color="#ff0000">ã€14.5ã€‘åˆå§‹åŒ–å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">USERNAME = <span class="string">'155********'</span></span><br><span class="line">PASSWORD = <span class="string">'***********'</span></span><br><span class="line"></span><br><span class="line">CHAOJIYING_USERNAME = <span class="string">'*******'</span></span><br><span class="line">CHAOJIYING_PASSWORD = <span class="string">'*******'</span></span><br><span class="line">CHAOJIYING_SOFT_ID = <span class="string">'********'</span></span><br><span class="line">CHAOJIYING_KIND = <span class="string">'9004'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrackTouClick</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.url = <span class="string">'https://kyfw.12306.cn/otn/resources/login.html'</span></span><br><span class="line">        path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">        chrome_options = Options()</span><br><span class="line">        chrome_options.add_argument(<span class="string">'--start-maximized'</span>)</span><br><span class="line">        self.browser = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">        self.wait = WebDriverWait(self.browser, <span class="number">20</span>)</span><br><span class="line">        self.email = USERNAME</span><br><span class="line">        self.password = PASSWORD</span><br><span class="line">        self.chaojiying = Chaojiying_Client(CHAOJIYING_USERNAME, CHAOJIYING_PASSWORD, CHAOJIYING_SOFT_ID)</span><br></pre></td></tr></table></figure><p>å®šä¹‰ 12306 è´¦å·ï¼ˆ<code>USERNAME</code>ï¼‰ã€å¯†ç ï¼ˆ<code>PASSWORD</code>ï¼‰ã€è¶…çº§é¹°ç”¨æˆ·åï¼ˆ<code>CHAOJIYING_USERNAME</code>ï¼‰ã€è¶…çº§é¹°ç™»å½•å¯†ç ï¼ˆ<code>CHAOJIYING_PASSWORD</code>ï¼‰ã€è¶…çº§é¹°è½¯ä»¶ IDï¼ˆ<code>CHAOJIYING_SOFT_ID</code>ï¼‰ã€éªŒè¯ç ç±»å‹ï¼ˆ<code>CHAOJIYING_KIND</code>ï¼‰ï¼Œç™»å½•é“¾æ¥ urlï¼š<a href="https://kyfw.12306.cn/otn/resources/login.html" target="_blank" rel="noopener">https://kyfw.12306.cn/otn/resources/login.html</a> ï¼Œè°·æ­Œæµè§ˆå™¨é©±åŠ¨çš„ç›®å½•ï¼ˆ<code>path</code>ï¼‰ï¼Œæµè§ˆå™¨å¯åŠ¨å‚æ•°ï¼Œå¹¶å°†ç›¸å…³å‚æ•°ä¼ é€’ç»™è¶…çº§é¹° API</p><hr><h1 id="ã€14-6ã€‘ç ´è§£å…¥å£å‡½æ•°"><a href="#ã€14-6ã€‘ç ´è§£å…¥å£å‡½æ•°" class="headerlink" title="ã€14.6ã€‘ç ´è§£å…¥å£å‡½æ•°"></a><font color="#ff0000">ã€14.6ã€‘ç ´è§£å…¥å£å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.open()</span><br><span class="line">    image = self.get_touclick_image()</span><br><span class="line">    bytes_array = BytesIO()</span><br><span class="line">    image.save(bytes_array, format=<span class="string">'PNG'</span>)</span><br><span class="line">    result = self.chaojiying.PostPic(bytes_array.getvalue(), CHAOJIYING_KIND)</span><br><span class="line">    print(result)</span><br><span class="line">    locations = self.get_points(result)</span><br><span class="line">    self.touch_click_words(locations)</span><br><span class="line">    self.login()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        success = self.wait.until(EC.text_to_be_present_in_element((By.CSS_SELECTOR, <span class="string">'.welcome-name'</span>), <span class="string">'ç”¨æˆ·å§“å'</span>))</span><br><span class="line">        print(success)</span><br><span class="line">        cc = self.browser.find_element(By.CSS_SELECTOR, <span class="string">'.welcome-name'</span>)</span><br><span class="line">        print(cc.text)</span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        self.chaojiying.ReportError(result[<span class="string">'pic_id'</span>])</span><br><span class="line">        self.crack()</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ <code>open()</code> å‡½æ•°è¾“å…¥è´¦å·å¯†ç </p><p>è°ƒç”¨ <code>get_touclick_image()</code> å‡½æ•°è·å–éªŒè¯ç å›¾ç‰‡</p><p>åˆ©ç”¨è¶…çº§é¹° Python API <code>PostPic()</code> æ–¹æ³•å³å¯æŠŠå›¾ç‰‡å‘é€ç»™è¶…çº§é¹°åå°ï¼Œå‘é€çš„å›¾åƒæ˜¯å­—èŠ‚æµæ ¼å¼ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª JSONï¼Œå¦‚æœè¯†åˆ«æˆåŠŸï¼Œå…¸å‹çš„è¿”å›ç»“æœç±»ä¼¼äºï¼š<code>{&#39;err_no&#39;: 0, &#39;err_str&#39;: &#39;OK&#39;, &#39;pic_id&#39;: &#39;6002001380949200001&#39;, &#39;pic_str&#39;: &#39;132,127|56,77&#39;, &#39;md5&#39;: &#39;1f8e1d4bef8b11484cb1f1f34299865b&#39;}</code>ï¼Œå…¶ä¸­ï¼Œpic_str å°±æ˜¯è¯†åˆ«çš„æ–‡å­—çš„åæ ‡ï¼Œæ˜¯ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›çš„ï¼Œæ¯ä¸ªåæ ‡éƒ½ä»¥ | åˆ†éš”</p><p>è°ƒç”¨ <code>get_points()</code> å‡½æ•°è§£æè¶…çº§é¹°è¯†åˆ«ç»“æœ</p><p>è°ƒç”¨ <code>touch_click_words()</code> å‡½æ•°å¯¹ç¬¦åˆè¦æ±‚çš„å›¾ç‰‡è¿›è¡Œç‚¹å‡»ï¼Œç„¶åç‚¹å‡»ç™»é™†æŒ‰é’®æ¨¡æ‹Ÿç™»é™†</p><p>ä½¿ç”¨ <code>try-except</code> è¯­å¥åˆ¤æ–­æ˜¯å¦å‡ºç°äº†ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ¤æ–­ä¾æ®æ˜¯æ˜¯å¦æœ‰ç”¨æˆ·å§“åçš„å‡ºç°ï¼Œå‡ºç°çš„å§“åå’Œå®é™…å§“åä¸€è‡´åˆ™ç™»å½•æˆåŠŸï¼Œå¦‚æœå¤±è´¥äº†å°±é‡è¯•ï¼Œè¶…çº§é¹°ä¼šè¿”å›è¯¥åˆ†å€¼</p><hr><h1 id="ã€14-7ã€‘è´¦å·å¯†ç è¾“å…¥å‡½æ•°"><a href="#ã€14-7ã€‘è´¦å·å¯†ç è¾“å…¥å‡½æ•°" class="headerlink" title="ã€14.7ã€‘è´¦å·å¯†ç è¾“å…¥å‡½æ•°"></a><font color="#ff0000">ã€14.7ã€‘è´¦å·å¯†ç è¾“å…¥å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.browser.get(self.url)</span><br><span class="line">    login = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.login-hd-account'</span>)))</span><br><span class="line">    login.click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    username = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'input#J-userName'</span>)))</span><br><span class="line">    password = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'input#J-password'</span>)))</span><br><span class="line">    username.send_keys(self.email)</span><br><span class="line">    password.send_keys(self.password)</span><br></pre></td></tr></table></figure><p>åˆ†æé¡µé¢å¯çŸ¥ï¼Œç™»é™†é¡µé¢ URL ä¸ºï¼š<a href="https://kyfw.12306.cn/otn/resources/login.html" target="_blank" rel="noopener">https://kyfw.12306.cn/otn/resources/login.html</a> ï¼Œè¯¥é¡µé¢é»˜è®¤å‡ºç°çš„æ˜¯æ‰«æäºŒç»´ç ç™»é™†ï¼Œæ‰€ä»¥è¦å…ˆç‚¹å‡»è´¦å·ç™»å½•ï¼Œæ‰¾åˆ°è¯¥ CSS å…ƒç´ ä¸º <code>login-hd-account</code>ï¼Œè°ƒç”¨ <code>click()</code> æ–¹æ³•å®ç°æ¨¡æ‹Ÿç‚¹å‡»ï¼Œæ­¤æ—¶å‡ºç°è´¦å·å¯†ç è¾“å…¥æ¡†ï¼ŒåŒæ ·æ‰¾åˆ°å…¶ ID åˆ†åˆ«ä¸º <code>J-userName</code> å’Œ <code>J-password</code>ï¼Œè°ƒç”¨ <code>send_keys()</code> æ–¹æ³•è¾“å…¥è´¦å·å¯†ç </p><hr><h1 id="ã€14-8ã€‘é¡µé¢æˆªå›¾å‡½æ•°"><a href="#ã€14-8ã€‘é¡µé¢æˆªå›¾å‡½æ•°" class="headerlink" title="ã€14.8ã€‘é¡µé¢æˆªå›¾å‡½æ•°"></a><font color="#ff0000">ã€14.8ã€‘é¡µé¢æˆªå›¾å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_screenshot</span><span class="params">(self)</span>:</span></span><br><span class="line">    screenshot = self.browser.get_screenshot_as_png()</span><br><span class="line">    screenshot = Image.open(BytesIO(screenshot))</span><br><span class="line">    <span class="keyword">return</span> screenshot</span><br></pre></td></tr></table></figure><p>å¯¹æ•´ä¸ªé¡µé¢è¿›è¡Œæˆªå›¾</p><hr><h1 id="ã€14-9ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°"><a href="#ã€14-9ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°" class="headerlink" title="ã€14.9ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°"></a><font color="#ff0000">ã€14.9ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_element</span><span class="params">(self)</span>:</span></span><br><span class="line">    element = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.login-pwd-code'</span>)))</span><br><span class="line">    <span class="keyword">return</span> element</span><br></pre></td></tr></table></figure><p>åŒæ ·åˆ†æé¡µé¢ï¼ŒéªŒè¯ç æ‰€åœ¨ä½ç½®çš„ CSS ä¸º <code>login-pwd-code</code></p><hr><h1 id="ã€14-10ã€‘è·å–éªŒè¯ç åæ ‡å‡½æ•°"><a href="#ã€14-10ã€‘è·å–éªŒè¯ç åæ ‡å‡½æ•°" class="headerlink" title="ã€14.10ã€‘è·å–éªŒè¯ç åæ ‡å‡½æ•°"></a><font color="#ff0000">ã€14.10ã€‘è·å–éªŒè¯ç åæ ‡å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_position</span><span class="params">(self)</span>:</span></span><br><span class="line">    element = self.get_touclick_element()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    location = element.location</span><br><span class="line">    size = element.size</span><br><span class="line">    top, bottom, left, right = location[<span class="string">'y'</span>], location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>], location[<span class="string">'x'</span>], location[<span class="string">'x'</span>] + size[<span class="string">'width'</span>]</span><br><span class="line">    <span class="keyword">return</span> (top, bottom, left, right)</span><br></pre></td></tr></table></figure><p>location å±æ€§å¯ä»¥è¿”å›è¯¥å›¾ç‰‡å¯¹è±¡åœ¨æµè§ˆå™¨ä¸­çš„ä½ç½®ï¼Œåæ ‡è½´æ˜¯ä»¥å±å¹•å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œx è½´å‘å³é€’å¢ï¼Œy è½´å‘ä¸‹é€’å¢ï¼Œsize å±æ€§å¯ä»¥è¿”å›è¯¥å›¾ç‰‡å¯¹è±¡çš„é«˜åº¦å’Œå®½åº¦ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°éªŒè¯ç çš„ä½ç½®ä¿¡æ¯</p><hr><h1 id="ã€14-11ã€‘éªŒè¯ç å‰ªè£å‡½æ•°"><a href="#ã€14-11ã€‘éªŒè¯ç å‰ªè£å‡½æ•°" class="headerlink" title="ã€14.11ã€‘éªŒè¯ç å‰ªè£å‡½æ•°"></a><font color="#ff0000">ã€14.11ã€‘éªŒè¯ç å‰ªè£å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_image</span><span class="params">(self, name=<span class="string">'12306.png'</span>)</span>:</span></span><br><span class="line">    top, bottom, left, right = self.get_position()</span><br><span class="line">    screenshot = self.get_screenshot()</span><br><span class="line">    captcha = screenshot.crop((left, top, right, bottom))</span><br><span class="line">    captcha.save(name)</span><br><span class="line">    <span class="keyword">return</span> captcha</span><br></pre></td></tr></table></figure><p>æ ¹æ®éªŒè¯ç çš„åæ ‡ä¿¡æ¯ï¼Œå¯¹é¡µé¢æˆªå›¾è¿›è¡Œå‰ªè£ï¼Œå¾—åˆ°éªŒè¯ç éƒ¨åˆ†ï¼Œå°†å…¶ä¿å­˜ä¸º 12306.png</p><hr><h1 id="ã€14-12ã€‘éªŒè¯ç åæ ‡è§£æå‡½æ•°"><a href="#ã€14-12ã€‘éªŒè¯ç åæ ‡è§£æå‡½æ•°" class="headerlink" title="ã€14.12ã€‘éªŒè¯ç åæ ‡è§£æå‡½æ•°"></a><font color="#ff0000">ã€14.12ã€‘éªŒè¯ç åæ ‡è§£æå‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_points</span><span class="params">(self, captcha_result)</span>:</span></span><br><span class="line">    groups = captcha_result.get(<span class="string">'pic_str'</span>).split(<span class="string">'|'</span>)</span><br><span class="line">    locations = [[int(number) <span class="keyword">for</span> number <span class="keyword">in</span> group.split(<span class="string">','</span>)] <span class="keyword">for</span> group <span class="keyword">in</span> groups]</span><br><span class="line">    <span class="keyword">return</span> locations</span><br></pre></td></tr></table></figure><p><code>get_points()</code> æ–¹æ³•å°†è¶…çº§é¹°çš„éªŒè¯ç è¯†åˆ«ç»“æœå˜æˆåˆ—è¡¨çš„å½¢å¼</p><hr><h1 id="ã€14-13ã€‘éªŒè¯ç æ¨¡æ‹Ÿç‚¹å‡»å‡½æ•°"><a href="#ã€14-13ã€‘éªŒè¯ç æ¨¡æ‹Ÿç‚¹å‡»å‡½æ•°" class="headerlink" title="ã€14.13ã€‘éªŒè¯ç æ¨¡æ‹Ÿç‚¹å‡»å‡½æ•°"></a><font color="#ff0000">ã€14.13ã€‘éªŒè¯ç æ¨¡æ‹Ÿç‚¹å‡»å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">touch_click_words</span><span class="params">(self, locations)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> location <span class="keyword">in</span> locations:</span><br><span class="line">        print(location)</span><br><span class="line">        ActionChains(self.browser).move_to_element_with_offset(self.get_touclick_element(), location[<span class="number">0</span>]/<span class="number">1.25</span>, location[<span class="number">1</span>]/<span class="number">1.25</span>).click().perform()</span><br></pre></td></tr></table></figure><p><code>touch_click_words()</code> æ–¹æ³•é€šè¿‡è°ƒç”¨ <code>move_to_element_with_offset()</code> æ–¹æ³•ä¾æ¬¡ä¼ å…¥è§£æåçš„åæ ‡ï¼Œç‚¹å‡»å³å¯</p><hr><h1 id="ã€14-14ã€‘æ¨¡æ‹Ÿç‚¹å‡»ç™»é™†å‡½æ•°"><a href="#ã€14-14ã€‘æ¨¡æ‹Ÿç‚¹å‡»ç™»é™†å‡½æ•°" class="headerlink" title="ã€14.14ã€‘æ¨¡æ‹Ÿç‚¹å‡»ç™»é™†å‡½æ•°"></a><font color="#ff0000">ã€14.14ã€‘æ¨¡æ‹Ÿç‚¹å‡»ç™»é™†å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">    submit = self.wait.until(EC.element_to_be_clickable((By.ID, <span class="string">'J-login'</span>)))</span><br><span class="line">    submit.click()</span><br></pre></td></tr></table></figure><p>åˆ†æé¡µé¢ï¼Œæ‰¾åˆ°ç™»é™†æŒ‰é’®çš„ ID ä¸º <code>J-login</code>ï¼Œè°ƒç”¨ <code>click()</code> æ–¹æ³•æ¨¡æ‹Ÿç‚¹å‡»æŒ‰é’®å®ç°ç™»å½•</p><hr><h1 id="ã€14-15ã€‘æ•ˆæœå®ç°åŠ¨å›¾"><a href="#ã€14-15ã€‘æ•ˆæœå®ç°åŠ¨å›¾" class="headerlink" title="ã€14.15ã€‘æ•ˆæœå®ç°åŠ¨å›¾"></a><font color="#ff0000">ã€14.15ã€‘æ•ˆæœå®ç°åŠ¨å›¾</font></h1><p>æœ€ç»ˆå®ç°æ•ˆæœå›¾ï¼šï¼ˆå…³é”®ä¿¡æ¯å·²ç»è¿‡æ‰“ç å¤„ç†ï¼‰</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A44/12306.gif" alt="02"><br></fancybox><hr><h1 id="ã€14-16ã€‘å®Œæ•´ä»£ç "><a href="#ã€14-16ã€‘å®Œæ•´ä»£ç " class="headerlink" title="ã€14.16ã€‘å®Œæ•´ä»£ç "></a><font color="#ff0000">ã€14.16ã€‘å®Œæ•´ä»£ç </font></h1><p><code>12306.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> chaojiying <span class="keyword">import</span> Chaojiying_Client</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"></span><br><span class="line">USERNAME = <span class="string">'155********'</span></span><br><span class="line">PASSWORD = <span class="string">'***********'</span></span><br><span class="line"></span><br><span class="line">CHAOJIYING_USERNAME = <span class="string">'***********'</span></span><br><span class="line">CHAOJIYING_PASSWORD = <span class="string">'***********'</span></span><br><span class="line">CHAOJIYING_SOFT_ID = <span class="string">'******'</span></span><br><span class="line">CHAOJIYING_KIND = <span class="string">'9004'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrackTouClick</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>     <span class="comment">#ç™»é™†</span></span><br><span class="line">        self.url = <span class="string">'https://kyfw.12306.cn/otn/resources/login.html'</span></span><br><span class="line">        path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">        chrome_options = Options()</span><br><span class="line">        chrome_options.add_argument(<span class="string">'--start-maximized'</span>)</span><br><span class="line">        self.browser = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">        self.wait = WebDriverWait(self.browser, <span class="number">20</span>)</span><br><span class="line">        self.email = USERNAME</span><br><span class="line">        self.password = PASSWORD</span><br><span class="line">        self.chaojiying = Chaojiying_Client(CHAOJIYING_USERNAME, CHAOJIYING_PASSWORD, CHAOJIYING_SOFT_ID)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crack</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.open()</span><br><span class="line">        image = self.get_touclick_image()</span><br><span class="line">        bytes_array = BytesIO()</span><br><span class="line">        image.save(bytes_array, format=<span class="string">'PNG'</span>)</span><br><span class="line">        result = self.chaojiying.PostPic(bytes_array.getvalue(), CHAOJIYING_KIND)</span><br><span class="line">        print(result)</span><br><span class="line">        locations = self.get_points(result)</span><br><span class="line">        self.touch_click_words(locations)</span><br><span class="line">        self.login()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            success = self.wait.until(EC.text_to_be_present_in_element((By.CSS_SELECTOR, <span class="string">'.welcome-name'</span>), <span class="string">'è°­ä»ä¾¯'</span>))</span><br><span class="line">            print(success)</span><br><span class="line">            cc = self.browser.find_element(By.CSS_SELECTOR, <span class="string">'.welcome-name'</span>)</span><br><span class="line">            print(cc.text)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> TimeoutException:</span><br><span class="line">            self.chaojiying.ReportError(result[<span class="string">'pic_id'</span>])</span><br><span class="line">            self.crack()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.browser.get(self.url)</span><br><span class="line">        login = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.login-hd-account'</span>)))</span><br><span class="line">        login.click()</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        username = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'input#J-userName'</span>)))</span><br><span class="line">        password = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'input#J-password'</span>)))</span><br><span class="line">        username.send_keys(self.email)</span><br><span class="line">        password.send_keys(self.password)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_screenshot</span><span class="params">(self)</span>:</span></span><br><span class="line">        screenshot = self.browser.get_screenshot_as_png()</span><br><span class="line">        screenshot = Image.open(BytesIO(screenshot))</span><br><span class="line">        <span class="keyword">return</span> screenshot</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_touclick_element</span><span class="params">(self)</span>:</span></span><br><span class="line">        element = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.login-pwd-code'</span>)))</span><br><span class="line">        <span class="keyword">return</span> element</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_position</span><span class="params">(self)</span>:</span></span><br><span class="line">        element = self.get_touclick_element()</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        location = element.location</span><br><span class="line">        size = element.size</span><br><span class="line">        top, bottom, left, right = location[<span class="string">'y'</span>], location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>], location[<span class="string">'x'</span>], location[<span class="string">'x'</span>] + size[<span class="string">'width'</span>]</span><br><span class="line">        <span class="keyword">return</span> (top, bottom, left, right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_touclick_image</span><span class="params">(self, name=<span class="string">'12306.png'</span>)</span>:</span></span><br><span class="line">        top, bottom, left, right = self.get_position()</span><br><span class="line">        screenshot = self.get_screenshot()</span><br><span class="line">        captcha = screenshot.crop((left, top, right, bottom))</span><br><span class="line">        captcha.save(name)</span><br><span class="line">        <span class="keyword">return</span> captcha</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_points</span><span class="params">(self, captcha_result)</span>:</span></span><br><span class="line">        groups = captcha_result.get(<span class="string">'pic_str'</span>).split(<span class="string">'|'</span>)</span><br><span class="line">        locations = [[int(number) <span class="keyword">for</span> number <span class="keyword">in</span> group.split(<span class="string">','</span>)] <span class="keyword">for</span> group <span class="keyword">in</span> groups]</span><br><span class="line">        <span class="keyword">return</span> locations</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">touch_click_words</span><span class="params">(self, locations)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> location <span class="keyword">in</span> locations:</span><br><span class="line">            print(location)</span><br><span class="line">            ActionChains(self.browser).move_to_element_with_offset(self.get_touclick_element(), location[<span class="number">0</span>]/<span class="number">1.25</span>, location[<span class="number">1</span>]/<span class="number">1.25</span>).click().perform()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        submit = self.wait.until(EC.element_to_be_clickable((By.ID, <span class="string">'J-login'</span>)))</span><br><span class="line">        submit.click()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    crack = CrackTouClick()</span><br><span class="line">    crack.crack()</span><br></pre></td></tr></table></figure><p><code>chaojiying.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chaojiying_Client</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password, soft_id)</span>:</span></span><br><span class="line">        self.username = username</span><br><span class="line">        password = password.encode(<span class="string">'utf8'</span>)</span><br><span class="line">        self.password = md5(password).hexdigest()</span><br><span class="line">        self.soft_id = soft_id</span><br><span class="line">        self.base_params = &#123;</span><br><span class="line">            <span class="string">'user'</span>: self.username,</span><br><span class="line">            <span class="string">'pass2'</span>: self.password,</span><br><span class="line">            <span class="string">'softid'</span>: self.soft_id,</span><br><span class="line">        &#125;</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">'Connection'</span>: <span class="string">'Keep-Alive'</span>,</span><br><span class="line">            <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PostPic</span><span class="params">(self, im, codetype)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        im: å›¾ç‰‡å­—èŠ‚</span></span><br><span class="line"><span class="string">        codetype: é¢˜ç›®ç±»å‹ å‚è€ƒ http://www.chaojiying.com/price.html</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'codetype'</span>: codetype,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        files = &#123;<span class="string">'userfile'</span>: (<span class="string">'ccc.jpg'</span>, im)&#125;</span><br><span class="line">        r = requests.post(<span class="string">'http://upload.chaojiying.net/Upload/Processing.php'</span>, data=params, files=files, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ReportError</span><span class="params">(self, im_id)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        im_id:æŠ¥é”™é¢˜ç›®çš„å›¾ç‰‡ID</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'id'</span>: im_id,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        r = requests.post(<span class="string">'http://upload.chaojiying.net/Upload/ReportError.php'</span>, data=params, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åå››ç«  â€”â€” ã€éªŒè¯ç å¯¹æŠ—ç³»åˆ— â€” ç‚¹è§¦éªŒè¯ç ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="ç‚¹è§¦éªŒè¯ç " scheme="https://www.itrhx.com/tags/%E7%82%B9%E8%A7%A6%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C13</title>
    <link href="https://www.itrhx.com/2019/09/07/A43-Python3-spider-C13/"/>
    <id>https://www.itrhx.com/2019/09/07/A43-Python3-spider-C13/</id>
    <published>2019-09-06T19:52:14.161Z</published>
    <updated>2019-09-24T12:40:56.234Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åä¸‰ç«  â€”â€” ã€éªŒè¯ç å¯¹æŠ—ç³»åˆ— â€” æ»‘åŠ¨éªŒè¯ç ã€‘</font></center></blockquote><a id="more"></a><hr><h1 id="ã€13-1ã€‘å…³äºæ»‘åŠ¨éªŒè¯ç "><a href="#ã€13-1ã€‘å…³äºæ»‘åŠ¨éªŒè¯ç " class="headerlink" title="ã€13.1ã€‘å…³äºæ»‘åŠ¨éªŒè¯ç "></a><font color="#ff0000">ã€13.1ã€‘å…³äºæ»‘åŠ¨éªŒè¯ç </font></h1><p>æ»‘åŠ¨éªŒè¯ç å±äºè¡Œä¸ºå¼éªŒè¯ç ï¼Œéœ€è¦é€šè¿‡ç”¨æˆ·çš„æ“ä½œè¡Œä¸ºæ¥å®ŒæˆéªŒè¯ï¼Œä¸€èˆ¬æ˜¯æ ¹æ®æç¤ºç”¨é¼ æ ‡å°†æ»‘å—æ‹–åŠ¨åˆ°æŒ‡å®šçš„ä½ç½®å®ŒæˆéªŒè¯ï¼Œæ­¤ç±»éªŒè¯ç èƒŒæ™¯å›¾ç‰‡é‡‡ç”¨å¤šç§å›¾åƒåŠ å¯†æŠ€æœ¯ï¼Œä¸”æ·»åŠ äº†å¾ˆå¤šéšæœºæ•ˆæœï¼Œèƒ½æœ‰æ•ˆé˜²æ­¢OCRæ–‡å­—è¯†åˆ«ï¼Œå¦å¤–ï¼ŒéªŒè¯ç ä¸Šçš„æ–‡å­—é‡‡ç”¨äº†éšæœºå°åˆ·æŠ€æœ¯ï¼Œèƒ½å¤Ÿéšæœºé‡‡ç”¨å¤šç§å­—ä½“ã€å¤šç§å˜å½¢çš„å®æ—¶éšæœºå°åˆ·ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£ï¼›æ–—é±¼ã€å“”å“©å“”å“©ã€æ·˜å®ç­‰å¹³å°éƒ½ä½¿ç”¨äº†æ»‘åŠ¨éªŒè¯ç </p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A43/01.png" alt="01"><br></fancybox><hr><h1 id="ã€13-2ã€‘æ»‘åŠ¨éªŒè¯ç æ”»å…‹æ€è·¯"><a href="#ã€13-2ã€‘æ»‘åŠ¨éªŒè¯ç æ”»å…‹æ€è·¯" class="headerlink" title="ã€13.2ã€‘æ»‘åŠ¨éªŒè¯ç æ”»å…‹æ€è·¯"></a><font color="#ff0000">ã€13.2ã€‘æ»‘åŠ¨éªŒè¯ç æ”»å…‹æ€è·¯</font></h1><p>åˆ©ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…· Selenium ç›´æ¥æ¨¡æ‹Ÿäººçš„è¡Œä¸ºæ–¹å¼æ¥å®ŒæˆéªŒè¯ï¼Œé¦–å…ˆè¦åˆ†æé¡µé¢ï¼Œæƒ³åŠæ³•æ‰¾åˆ°æ»‘åŠ¨éªŒè¯ç çš„å®Œæ•´å›¾ç‰‡ã€å¸¦æœ‰ç¼ºå£çš„å›¾ç‰‡å’Œéœ€è¦æ»‘åŠ¨çš„å›¾ç‰‡ï¼Œé€šè¿‡å¯¹æ¯”åŸå§‹çš„å›¾ç‰‡å’Œå¸¦æ»‘å—ç¼ºå£çš„å›¾ç‰‡çš„åƒç´ ï¼Œåƒç´ ä¸åŒçš„åœ°æ–¹å°±æ˜¯ç¼ºå£ä½ç½®ï¼Œè®¡ç®—å‡ºæ»‘å—ç¼ºå£çš„ä½ç½®ï¼Œå¾—åˆ°æ‰€éœ€è¦æ»‘åŠ¨çš„è·ç¦»ï¼Œæœ€ååˆ©ç”¨ Selenium è¿›è¡Œå¯¹æ»‘å—çš„æ‹–æ‹½ï¼Œæ‹–æ‹½æ—¶è¦æ¨¡ä»¿äººçš„è¡Œä¸ºï¼Œç”±äºæœ‰ä¸ªå¯¹å‡†è¿‡ç¨‹ï¼Œæ‰€ä»¥æ˜¯å…ˆå¿«åæ…¢ï¼ŒåŒ€é€Ÿç§»åŠ¨ã€éšæœºé€Ÿåº¦ç§»åŠ¨éƒ½ä¸ä¼šæˆåŠŸ</p><p>ä»¥ä¸‹ä»¥å“”å“©å“”å“©ä¸ºä¾‹æ¥åšæ¨¡æ‹Ÿç™»å½•ç»ƒä¹ </p><hr><h1 id="ã€13-3ã€‘æ¨¡æ‹Ÿç™»å½•-bilibili-â€”-æ€»ä½“æ€è·¯"><a href="#ã€13-3ã€‘æ¨¡æ‹Ÿç™»å½•-bilibili-â€”-æ€»ä½“æ€è·¯" class="headerlink" title="ã€13.3ã€‘æ¨¡æ‹Ÿç™»å½• bilibili â€” æ€»ä½“æ€è·¯"></a><font color="#ff0000">ã€13.3ã€‘æ¨¡æ‹Ÿç™»å½• bilibili â€” æ€»ä½“æ€è·¯</font></h1><p>é¦–å…ˆä½¿ç”¨ Selenium æ¨¡æ‹Ÿç™»é™† bilibiliï¼Œè‡ªåŠ¨è¾“å…¥è´¦å·å¯†ç ï¼ŒæŸ¥æ‰¾åˆ°ç™»é™†æŒ‰é’®å¹¶ç‚¹å‡»ï¼Œä½¿å…¶å‡ºç°æ»‘åŠ¨éªŒè¯ç ï¼Œæ­¤æ—¶åˆ†æé¡µé¢ï¼Œæ»‘åŠ¨éªŒè¯ç»„ä»¶æ˜¯ç”±3ä¸ª canvas ç»„æˆï¼Œåˆ†åˆ«ä»£è¡¨å®Œæ•´å›¾ç‰‡ã€å¸¦æœ‰ç¼ºå£çš„å›¾ç‰‡å’Œéœ€è¦æ»‘åŠ¨çš„å›¾ç‰‡ï¼Œ3ä¸ª canvas å…ƒç´ åŒ…å« CSS  <code>display</code> å±æ€§ï¼Œ<code>display:block</code> ä¸ºå¯è§ï¼Œ<code>display:none</code> ä¸ºä¸å¯è§ï¼Œåˆ†åˆ«è·å–ä¸‰å¼ å›¾ç‰‡æ—¶è¦å°†å…¶ä»–ä¸¤å¼ å›¾ç‰‡è®¾ç½®ä¸º <code>display:none</code>ï¼Œè·å–å…ƒç´ ä½ç½®åå³å¯å¯¹å›¾ç‰‡æˆªå›¾å¹¶ä¿å­˜ï¼Œé€šè¿‡å›¾ç‰‡åƒç´ å¯¹æ¯”ï¼Œæ‰¾åˆ°ç¼ºå£ä½ç½®å³ä¸ºæ»‘å—è¦ç§»åŠ¨çš„è·ç¦»ï¼Œéšåæ„é€ æ»‘åŠ¨è½¨è¿¹ï¼ŒæŒ‰ç…§å…ˆåŠ é€Ÿåå‡é€Ÿçš„æ–¹å¼ç§»åŠ¨æ»‘å—å®ŒæˆéªŒè¯ã€‚</p><p>æ•´ä¸ªç¨‹åºåŒ…å«çš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">()</span>:</span> åˆå§‹åŒ–å‡½æ•°ï¼Œå®šä¹‰å…¨å±€å˜é‡</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span> ç™»å½•å‡½æ•°ï¼Œè¾“å…¥è´¦å·å¯†ç å¹¶ç‚¹å‡»ç™»å½•</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_element</span><span class="params">()</span>:</span> éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°ï¼ŒæŸ¥æ‰¾ä¸‰å¼ å›¾çš„å…ƒç´ </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hide_element</span><span class="params">()</span>:</span> è®¾ç½®å…ƒç´ ä¸å¯è§å‡½æ•°</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_element</span><span class="params">()</span>:</span> è®¾ç½®å…ƒç´ å¯è§å‡½æ•°</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_screenshot</span><span class="params">()</span>:</span> éªŒè¯ç æˆªå›¾å‡½æ•°ï¼Œæˆªå–ä¸‰å¼ å›¾å¹¶ä¿å­˜</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slide</span><span class="params">()</span>:</span> æ»‘åŠ¨å‡½æ•°</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_pixel_equal</span><span class="params">()</span>:</span> åƒç´ åˆ¤æ–­å‡½æ•°ï¼Œå¯»æ‰¾ç¼ºå£ä½ç½®</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_distance</span><span class="params">()</span>:</span> è®¡ç®—æ»‘å—ç§»åŠ¨è·ç¦»å‡½æ•°</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_track</span><span class="params">()</span>:</span> æ„é€ ç§»åŠ¨è½¨è¿¹å‡½æ•°</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move_to_gap</span><span class="params">()</span>:</span> æ¨¡æ‹Ÿæ‹–åŠ¨å‡½æ•°</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªç¨‹åºç”¨åˆ°çš„åº“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure><hr><h1 id="ã€13-4ã€‘ä¸»å‡½æ•°"><a href="#ã€13-4ã€‘ä¸»å‡½æ•°" class="headerlink" title="ã€13.4ã€‘ä¸»å‡½æ•°"></a><font color="#ff0000">ã€13.4ã€‘ä¸»å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    init()</span><br><span class="line">    login()</span><br><span class="line">    find_element()</span><br><span class="line">    slide()</span><br></pre></td></tr></table></figure><hr><h1 id="ã€13-5ã€‘åˆå§‹åŒ–å‡½æ•°"><a href="#ã€13-5ã€‘åˆå§‹åŒ–å‡½æ•°" class="headerlink" title="ã€13.5ã€‘åˆå§‹åŒ–å‡½æ•°"></a><font color="#ff0000">ã€13.5ã€‘åˆå§‹åŒ–å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> url, browser, username, password, wait</span><br><span class="line">    url = <span class="string">'https://passport.bilibili.com/login'</span></span><br><span class="line">    path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">    chrome_options = Options()</span><br><span class="line">    chrome_options.add_argument(<span class="string">'--start-maximized'</span>)</span><br><span class="line">    browser = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">    username = <span class="string">'155********'</span></span><br><span class="line">    password = <span class="string">'***********'</span></span><br><span class="line">    wait = WebDriverWait(browser, <span class="number">20</span>)</span><br></pre></td></tr></table></figure><p>global å…³é”®å­—å®šä¹‰äº†å…¨å±€å˜é‡ï¼Œéšåæ˜¯ç™»å½•é¡µé¢urlã€è°·æ­Œæµè§ˆå™¨é©±åŠ¨çš„ç›®å½•pathã€å®ä¾‹åŒ– Chrome æµè§ˆå™¨ã€è®¾ç½®æµè§ˆå™¨åˆ†è¾¨ç‡æœ€å¤§åŒ–ã€ç”¨æˆ·åã€å¯†ç ã€WebDriverWait() æ–¹æ³•è®¾ç½®ç­‰å¾…è¶…æ—¶</p><hr><h1 id="ã€13-6ã€‘ç™»å½•å‡½æ•°"><a href="#ã€13-6ã€‘ç™»å½•å‡½æ•°" class="headerlink" title="ã€13.6ã€‘ç™»å½•å‡½æ•°"></a><font color="#ff0000">ã€13.6ã€‘ç™»å½•å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    browser.get(url)</span><br><span class="line">    user = wait.until(EC.presence_of_element_located((By.ID, <span class="string">'login-username'</span>)))</span><br><span class="line">    passwd = wait.until(EC.presence_of_element_located((By.ID, <span class="string">'login-passwd'</span>)))</span><br><span class="line">    user.send_keys(username)</span><br><span class="line">    passwd.send_keys(password)</span><br><span class="line">    login_btn = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'a.btn.btn-login'</span>)))</span><br><span class="line">    time.sleep(random.random() * <span class="number">3</span>)</span><br><span class="line">    login_btn.click()</span><br></pre></td></tr></table></figure><p>ç­‰å¾…ç”¨æˆ·åè¾“å…¥æ¡†å’Œå¯†ç è¾“å…¥æ¡†å¯¹åº”çš„ ID èŠ‚ç‚¹åŠ è½½å‡ºæ¥ï¼Œåˆ†æé¡µé¢å¯çŸ¥ï¼Œç”¨æˆ·åè¾“å…¥æ¡† <code>id=&quot;login-username&quot;</code>ï¼Œå¯†ç è¾“å…¥æ¡† <code>id=&quot;login-passwd&quot;</code>ï¼Œè·å–è¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè°ƒç”¨ <code>send_keys()</code> æ–¹æ³•è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œéšåè·å–ç™»å½•æŒ‰é’®ï¼Œåˆ†æé¡µé¢å¯çŸ¥ç™»å½•æŒ‰é’® <code>class=&quot;btn btn-login&quot;</code>ï¼Œéšæœºäº§ç”Ÿä¸€ä¸ªæ•°å¹¶å°†å…¶æ‰©å¤§ä¸‰å€ä½œä¸ºæš‚åœæ—¶é—´ï¼Œæœ€åè°ƒç”¨ <code>click()</code> æ–¹æ³•å®ç°ç™»å½•æŒ‰é’®çš„ç‚¹å‡»</p><hr><h1 id="ã€13-7ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°"><a href="#ã€13-7ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°" class="headerlink" title="ã€13.7ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°"></a><font color="#ff0000">ã€13.7ã€‘éªŒè¯ç å…ƒç´ æŸ¥æ‰¾å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_element</span><span class="params">()</span>:</span></span><br><span class="line">    c_background = wait.until(</span><br><span class="line">        EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'canvas.geetest_canvas_bg.geetest_absolute'</span>)))</span><br><span class="line">    c_slice = wait.until(</span><br><span class="line">        EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'canvas.geetest_canvas_slice.geetest_absolute'</span>)))</span><br><span class="line">    c_full_bg = wait.until(</span><br><span class="line">        EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'canvas.geetest_canvas_fullbg.geetest_fade.geetest_absolute'</span>)))</span><br><span class="line">    hide_element(c_slice)</span><br><span class="line">    save_screenshot(c_background, <span class="string">'back'</span>)</span><br><span class="line">    show_element(c_slice)</span><br><span class="line">    save_screenshot(c_slice, <span class="string">'slice'</span>)</span><br><span class="line">    show_element(c_full_bg)</span><br><span class="line">    save_screenshot(c_full_bg, <span class="string">'full'</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è·å–éªŒè¯ç çš„ä¸‰å¼ å›¾ç‰‡ï¼Œåˆ†åˆ«æ˜¯å®Œæ•´çš„å›¾ç‰‡ã€å¸¦æœ‰ç¼ºå£çš„å›¾ç‰‡å’Œéœ€è¦æ»‘åŠ¨çš„å›¾ç‰‡ï¼Œåˆ†æé¡µé¢ä»£ç ï¼Œè¿™ä¸‰å¼ å›¾ç‰‡æ˜¯ç”± 3 ä¸ª canvas ç»„æˆï¼Œ3 ä¸ª canvas å…ƒç´ åŒ…å« CSS  <code>display</code> å±æ€§ï¼Œ<code>display:block</code> ä¸ºå¯è§ï¼Œ<code>display:none</code> ä¸ºä¸å¯è§ï¼Œåœ¨åˆ†åˆ«è·å–ä¸‰å¼ å›¾ç‰‡æ—¶è¦å°†å…¶ä»–ä¸¤å¼ å›¾ç‰‡è®¾ç½®ä¸º <code>display:none</code>ï¼Œè¿™æ ·åšæ‰èƒ½å•ç‹¬æå–åˆ°æ¯å¼ å›¾ç‰‡ï¼Œå®šä½ä¸‰å¼ å›¾ç‰‡çš„ class åˆ†åˆ«ä¸ºï¼šå¸¦æœ‰ç¼ºå£çš„å›¾ç‰‡ï¼ˆc_backgroundï¼‰ï¼š<code>geetest_canvas_bg geetest_absolute</code>ã€éœ€è¦æ»‘åŠ¨çš„å›¾ç‰‡ï¼ˆc_sliceï¼‰ï¼š<code>geetest_canvas_slice geetest_absolute</code>ã€å®Œæ•´å›¾ç‰‡ï¼ˆc_full_bgï¼‰ï¼š<code>geetest_canvas_fullbg geetest_fade geetest_absolute</code>ï¼Œéšåä¼ å€¼ç»™ <code>save_screenshot()</code> å‡½æ•°ï¼Œè¿›ä¸€æ­¥å¯¹éªŒè¯ç è¿›è¡Œå¤„ç†</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A43/02.png" alt="02"><br></fancybox><hr><h1 id="ã€13-8ã€‘å…ƒç´ å¯è§æ€§è®¾ç½®å‡½æ•°"><a href="#ã€13-8ã€‘å…ƒç´ å¯è§æ€§è®¾ç½®å‡½æ•°" class="headerlink" title="ã€13.8ã€‘å…ƒç´ å¯è§æ€§è®¾ç½®å‡½æ•°"></a><font color="#ff0000">ã€13.8ã€‘å…ƒç´ å¯è§æ€§è®¾ç½®å‡½æ•°</font></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®å…ƒç´ ä¸å¯è§</span><br><span class="line">def hide_element(element):</span><br><span class="line">    browser.execute_script(&quot;arguments[0].style=arguments[1]&quot;, element, &quot;display: none;&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># è®¾ç½®å…ƒç´ å¯è§</span><br><span class="line">def show_element(element):</span><br><span class="line">    browser.execute_script(&quot;arguments[0].style=arguments[1]&quot;, element, &quot;display: block;&quot;)</span><br></pre></td></tr></table></figure><hr><h1 id="ã€13-9ã€‘éªŒè¯ç æˆªå›¾å‡½æ•°"><a href="#ã€13-9ã€‘éªŒè¯ç æˆªå›¾å‡½æ•°" class="headerlink" title="ã€13.9ã€‘éªŒè¯ç æˆªå›¾å‡½æ•°"></a><font color="#ff0000">ã€13.9ã€‘éªŒè¯ç æˆªå›¾å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_screenshot</span><span class="params">(obj, name)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pic_url = browser.save_screenshot(<span class="string">'.\\bilibili.png'</span>)</span><br><span class="line">        print(<span class="string">"%s:æˆªå›¾æˆåŠŸ!"</span> % pic_url)</span><br><span class="line">        left = obj.location[<span class="string">'x'</span>]</span><br><span class="line">        top = obj.location[<span class="string">'y'</span>]</span><br><span class="line">        right = left + obj.size[<span class="string">'width'</span>]</span><br><span class="line">        bottom = top + obj.size[<span class="string">'height'</span>]</span><br><span class="line">        print(<span class="string">'å›¾ï¼š'</span> + name)</span><br><span class="line">        print(<span class="string">'Left %s'</span> % left)</span><br><span class="line">        print(<span class="string">'Top %s'</span> % top)</span><br><span class="line">        print(<span class="string">'Right %s'</span> % right)</span><br><span class="line">        print(<span class="string">'Bottom %s'</span> % bottom)</span><br><span class="line">        print(<span class="string">''</span>)</span><br><span class="line">        im = Image.open(<span class="string">'.\\bilibili.png'</span>)</span><br><span class="line">        im = im.crop((left, top, right, bottom))</span><br><span class="line">        file_name = <span class="string">'bili_'</span> + name + <span class="string">'.png'</span></span><br><span class="line">        im.save(file_name)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> msg:</span><br><span class="line">        print(<span class="string">"%s:æˆªå›¾å¤±è´¥!"</span> % msg)</span><br></pre></td></tr></table></figure><p><code>location</code> å±æ€§å¯ä»¥è¿”å›è¯¥å›¾ç‰‡å¯¹è±¡åœ¨æµè§ˆå™¨ä¸­çš„ä½ç½®ï¼Œåæ ‡è½´æ˜¯ä»¥å±å¹•å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œxè½´å‘å³é€’å¢ï¼Œyè½´å‘ä¸‹é€’å¢ï¼Œ<code>size</code> å±æ€§å¯ä»¥è¿”å›è¯¥å›¾ç‰‡å¯¹è±¡çš„é«˜åº¦å’Œå®½åº¦ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°éªŒè¯ç çš„ä½ç½®ä¿¡æ¯ï¼Œé¦–å…ˆè°ƒç”¨ <code>save_screenshot()</code> å±æ€§å¯¹æ•´ä¸ªé¡µé¢æˆªå›¾å¹¶ä¿å­˜ï¼Œç„¶åå‘ <code>crop()</code> æ–¹æ³•ä¼ å…¥éªŒè¯ç çš„ä½ç½®ä¿¡æ¯ï¼Œç”±ä½ç½®ä¿¡æ¯å†å¯¹éªŒè¯ç è¿›è¡Œå‰ªè£å¹¶ä¿å­˜</p><hr><h1 id="ã€13-10ã€‘æ»‘åŠ¨å‡½æ•°"><a href="#ã€13-10ã€‘æ»‘åŠ¨å‡½æ•°" class="headerlink" title="ã€13.10ã€‘æ»‘åŠ¨å‡½æ•°"></a><font color="#ff0000">ã€13.10ã€‘æ»‘åŠ¨å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slide</span><span class="params">()</span>:</span></span><br><span class="line">    distance = get_distance(Image.open(<span class="string">'.\\bili_back.png'</span>), Image.open(<span class="string">'.\\bili_full.png'</span>))</span><br><span class="line">    print(<span class="string">'è®¡ç®—åç§»é‡ä¸ºï¼š%s Px'</span> % distance)</span><br><span class="line">    trace = get_trace(distance - <span class="number">5</span>)</span><br><span class="line">    move_to_gap(trace)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>å‘ <code>get_distance()</code> å‡½æ•°ä¼ å…¥å®Œæ•´çš„å›¾ç‰‡å’Œç¼ºå£å›¾ç‰‡ï¼Œè®¡ç®—æ»‘å—éœ€è¦æ»‘åŠ¨çš„è·ç¦»ï¼Œå†æŠŠè·ç¦»ä¿¡æ¯ä¼ å…¥ <code>get_trace()</code> å‡½æ•°ï¼Œæ„é€ æ»‘å—çš„ç§»åŠ¨è½¨è¿¹ï¼Œæœ€åæ ¹æ®è½¨è¿¹ä¿¡æ¯è°ƒç”¨ <code>move_to_gap()</code> å‡½æ•°ç§»åŠ¨æ»‘å—å®ŒæˆéªŒè¯</p><hr><h1 id="ã€13-11ã€‘è®¡ç®—æ»‘å—ç§»åŠ¨è·ç¦»å‡½æ•°"><a href="#ã€13-11ã€‘è®¡ç®—æ»‘å—ç§»åŠ¨è·ç¦»å‡½æ•°" class="headerlink" title="ã€13.11ã€‘è®¡ç®—æ»‘å—ç§»åŠ¨è·ç¦»å‡½æ•°"></a><font color="#ff0000">ã€13.11ã€‘è®¡ç®—æ»‘å—ç§»åŠ¨è·ç¦»å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_distance</span><span class="params">(bg_image, fullbg_image)</span>:</span></span><br><span class="line">    distance = <span class="number">60</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(distance, fullbg_image.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(fullbg_image.size[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> is_pixel_equal(fullbg_image, bg_image, i, j):</span><br><span class="line">                <span class="keyword">return</span> i</span><br></pre></td></tr></table></figure><p><code>get_distance()</code> æ–¹æ³•å³è·å–ç¼ºå£ä½ç½®çš„æ–¹æ³•ï¼Œæ­¤æ–¹æ³•çš„å‚æ•°æ˜¯ä¸¤å¼ å›¾ç‰‡ï¼Œä¸€å¼ ä¸ºå®Œæ•´çš„å›¾ç‰‡ï¼Œå¦ä¸€å¼ ä¸ºå¸¦ç¼ºå£çš„å›¾ç‰‡ï¼Œdistance ä¸ºæ»‘å—çš„åˆå§‹ä½ç½®ï¼Œéå†ä¸¤å¼ å›¾ç‰‡çš„æ¯ä¸ªåƒç´ ï¼Œåˆ©ç”¨ <code>is_pixel_equal()</code> åƒç´ åˆ¤æ–­å‡½æ•°åˆ¤æ–­ä¸¤å¼ å›¾ç‰‡åŒä¸€ä½ç½®çš„åƒç´ æ˜¯å¦ç›¸åŒï¼Œæ¯”è¾ƒä¸¤å¼ å›¾ RGB çš„ç»å¯¹å€¼æ˜¯å¦å‡å°äºå®šä¹‰çš„é˜ˆå€¼ thresholdï¼Œå¦‚æœç»å¯¹å€¼å‡åœ¨é˜ˆå€¼ä¹‹å†…ï¼Œåˆ™ä»£è¡¨åƒç´ ç‚¹ç›¸åŒï¼Œç»§ç»­éå†ï¼Œå¦åˆ™ä»£è¡¨ä¸ç›¸åŒçš„åƒç´ ç‚¹ï¼Œå³ç¼ºå£çš„ä½ç½®</p><hr><h1 id="ã€13-12ã€‘åƒç´ åˆ¤æ–­å‡½æ•°"><a href="#ã€13-12ã€‘åƒç´ åˆ¤æ–­å‡½æ•°" class="headerlink" title="ã€13.12ã€‘åƒç´ åˆ¤æ–­å‡½æ•°"></a><font color="#ff0000">ã€13.12ã€‘åƒç´ åˆ¤æ–­å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_pixel_equal</span><span class="params">(bg_image, fullbg_image, x, y)</span>:</span></span><br><span class="line">    bg_pixel = bg_image.load()[x, y]</span><br><span class="line">    fullbg_pixel = fullbg_image.load()[x, y]</span><br><span class="line">    threshold = <span class="number">60</span></span><br><span class="line">    <span class="keyword">if</span> (abs(bg_pixel[<span class="number">0</span>] - fullbg_pixel[<span class="number">0</span>] &lt; threshold) <span class="keyword">and</span> abs(bg_pixel[<span class="number">1</span>] - fullbg_pixel[<span class="number">1</span>] &lt; threshold) <span class="keyword">and</span> abs(</span><br><span class="line">            bg_pixel[<span class="number">2</span>] - fullbg_pixel[<span class="number">2</span>] &lt; threshold)):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure><p>å°†å®Œæ•´å›¾ç‰‡å’Œç¼ºå£å›¾ç‰‡ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«èµ‹å€¼ç»™å˜é‡ bg_imageå’Œ fullbg_imageï¼Œæ¥ä¸‹æ¥å¯¹æ¯”å›¾ç‰‡è·å–ç¼ºå£ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œéå†å›¾ç‰‡çš„æ¯ä¸ªåæ ‡ç‚¹ï¼Œè·å–ä¸¤å¼ å›¾ç‰‡å¯¹åº”åƒç´ ç‚¹çš„ RGB æ•°æ®ï¼Œåˆ¤æ–­åƒç´ çš„å„ä¸ªé¢œè‰²ä¹‹å·®ï¼Œ<code>abs()</code> ç”¨äºå–ç»å¯¹å€¼ï¼Œå¦‚æœäºŒè€…çš„ RGB æ•°æ®å·®è·åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œé‚£å°±ä»£è¡¨ä¸¤ä¸ªåƒç´ ç›¸åŒï¼Œç»§ç»­æ¯”å¯¹ä¸‹ä¸€ä¸ªåƒç´ ç‚¹ï¼Œå¦‚æœå·®è·è¶…è¿‡ä¸€å®šèŒƒå›´ï¼Œåˆ™ä»£è¡¨åƒç´ ç‚¹ä¸åŒï¼Œå½“å‰ä½ç½®å³ä¸ºç¼ºå£ä½ç½®</p><hr><h1 id="ã€13-13ã€‘æ„é€ ç§»åŠ¨è½¨è¿¹å‡½æ•°"><a href="#ã€13-13ã€‘æ„é€ ç§»åŠ¨è½¨è¿¹å‡½æ•°" class="headerlink" title="ã€13.13ã€‘æ„é€ ç§»åŠ¨è½¨è¿¹å‡½æ•°"></a><font color="#ff0000">ã€13.13ã€‘æ„é€ ç§»åŠ¨è½¨è¿¹å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_trace</span><span class="params">(distance)</span>:</span></span><br><span class="line">    trace = []</span><br><span class="line">    faster_distance = distance * (<span class="number">4</span> / <span class="number">5</span>)</span><br><span class="line">    start, v0, t = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span></span><br><span class="line">    <span class="keyword">while</span> start &lt; distance:</span><br><span class="line">        <span class="keyword">if</span> start &lt; faster_distance:</span><br><span class="line">            a = <span class="number">20</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            a = <span class="number">-20</span></span><br><span class="line">        move = v0 * t + <span class="number">1</span> / <span class="number">2</span> * a * t * t</span><br><span class="line">        v = v0 + a * t</span><br><span class="line">        v0 = v</span><br><span class="line">        start += move</span><br><span class="line">        trace.append(round(move))</span><br><span class="line">    <span class="keyword">return</span> trace</span><br></pre></td></tr></table></figure><p><code>get_trace()</code> æ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¸ºç§»åŠ¨çš„æ€»è·ç¦»ï¼Œè¿”å›çš„æ˜¯è¿åŠ¨è½¨è¿¹ï¼Œè¿åŠ¨è½¨è¿¹ç”¨ trace è¡¨ç¤ºï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨æ¯æ¬¡ç§»åŠ¨å¤šå°‘è·ç¦»ï¼Œåˆ©ç”¨ Selenium è¿›è¡Œå¯¹æ»‘å—çš„æ‹–æ‹½æ—¶è¦æ¨¡ä»¿äººçš„è¡Œä¸ºï¼Œç”±äºæœ‰ä¸ªå¯¹å‡†è¿‡ç¨‹ï¼Œæ‰€ä»¥æ˜¯å…ˆå¿«åæ…¢ï¼ŒåŒ€é€Ÿç§»åŠ¨ã€éšæœºé€Ÿåº¦ç§»åŠ¨éƒ½ä¸ä¼šæˆåŠŸï¼Œå› æ­¤è¦è®¾ç½®ä¸€ä¸ªåŠ é€Ÿå’Œå‡é€Ÿçš„è·ç¦»ï¼Œè¿™é‡Œè®¾ç½®åŠ é€Ÿè·ç¦» <code>faster_distance</code> æ˜¯æ€»è·ç¦» <code>distance</code> çš„4/5å€ï¼Œæ»‘å—æ»‘åŠ¨çš„åŠ é€Ÿåº¦ç”¨ a æ¥è¡¨ç¤ºï¼Œå½“å‰é€Ÿåº¦ç”¨ v è¡¨ç¤ºï¼Œåˆé€Ÿåº¦ç”¨ v0 è¡¨ç¤ºï¼Œä½ç§»ç”¨ move è¡¨ç¤ºï¼Œæ‰€éœ€æ—¶é—´ç”¨ t è¡¨ç¤ºï¼Œå®ƒä»¬ä¹‹é—´æ»¡è¶³ä»¥ä¸‹å…³ç³»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">move = v0 * t + 0.5 * a * t * t </span><br><span class="line">v = v0 + a * t</span><br></pre></td></tr></table></figure><p>è®¾ç½®åˆå§‹ä½ç½®ã€åˆå§‹é€Ÿåº¦ã€æ—¶é—´é—´éš”åˆ†åˆ«ä¸º0, 0, 0.1ï¼ŒåŠ é€Ÿé˜¶æ®µå’Œå‡é€Ÿé˜¶æ®µçš„åŠ é€Ÿåº¦åˆ†åˆ«è®¾ç½®ä¸º20å’Œ-20ï¼Œç›´åˆ°è¿åŠ¨è½¨è¿¹è¾¾åˆ°æ€»è·ç¦»æ—¶ï¼Œå¾ªç¯ç»ˆæ­¢ï¼Œæœ€åå¾—åˆ°çš„ trace è®°å½•äº†æ¯ä¸ªæ—¶é—´é—´éš”ç§»åŠ¨äº†å¤šå°‘ä½ç§»ï¼Œè¿™æ ·æ»‘å—çš„è¿åŠ¨è½¨è¿¹å°±å¾—åˆ°äº†</p><hr><h1 id="ã€13-14ã€‘æ¨¡æ‹Ÿæ‹–åŠ¨å‡½æ•°"><a href="#ã€13-14ã€‘æ¨¡æ‹Ÿæ‹–åŠ¨å‡½æ•°" class="headerlink" title="ã€13.14ã€‘æ¨¡æ‹Ÿæ‹–åŠ¨å‡½æ•°"></a><font color="#ff0000">ã€13.14ã€‘æ¨¡æ‹Ÿæ‹–åŠ¨å‡½æ•°</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move_to_gap</span><span class="params">(trace)</span>:</span></span><br><span class="line">    slider = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'div.geetest_slider_button'</span>)))</span><br><span class="line">    ActionChains(browser).click_and_hold(slider).perform()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> trace:</span><br><span class="line">        ActionChains(browser).move_by_offset(xoffset=x, yoffset=<span class="number">0</span>).perform()</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    ActionChains(browser).release().perform()</span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„å‚æ•°ä¸ºè¿åŠ¨è½¨è¿¹ï¼Œé¦–å…ˆæŸ¥æ‰¾åˆ°æ»‘åŠ¨æŒ‰é’®ï¼Œç„¶åè°ƒç”¨ ActionChains çš„ <code>click_and_hold()</code> æ–¹æ³•æŒ‰ä½æ‹–åŠ¨åº•éƒ¨æ»‘å—ï¼Œ<code>perform()</code> æ–¹æ³•ç”¨äºæ‰§è¡Œï¼Œéå†è¿åŠ¨è½¨è¿¹è·å–æ¯å°æ®µä½ç§»è·ç¦»ï¼Œè°ƒç”¨ <code>move_by_offset()</code> æ–¹æ³•ç§»åŠ¨æ­¤ä½ç§»ï¼Œæœ€åè°ƒç”¨ <code>release()</code> æ–¹æ³•æ¾å¼€é¼ æ ‡å³å¯</p><hr><h1 id="ã€13-15ã€‘æ•ˆæœå®ç°åŠ¨å›¾"><a href="#ã€13-15ã€‘æ•ˆæœå®ç°åŠ¨å›¾" class="headerlink" title="ã€13.15ã€‘æ•ˆæœå®ç°åŠ¨å›¾"></a><font color="#ff0000">ã€13.15ã€‘æ•ˆæœå®ç°åŠ¨å›¾</font></h1><p>æœ€ç»ˆå®ç°æ•ˆæœå›¾ï¼šï¼ˆå…³é”®ä¿¡æ¯å·²ç»è¿‡æ‰“ç å¤„ç†ï¼‰</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A43/bilibili.gif" alt="03"><br></fancybox><hr><h1 id="ã€13-16ã€‘å®Œæ•´ä»£ç "><a href="#ã€13-16ã€‘å®Œæ•´ä»£ç " class="headerlink" title="ã€13.16ã€‘å®Œæ•´ä»£ç "></a><font color="#ff0000">ã€13.16ã€‘å®Œæ•´ä»£ç </font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> url, browser, username, password, wait</span><br><span class="line">    url = <span class="string">'https://passport.bilibili.com/login'</span></span><br><span class="line">    path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">    chrome_options = Options()</span><br><span class="line">    chrome_options.add_argument(<span class="string">'--start-maximized'</span>)</span><br><span class="line">    browser = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">    username = <span class="string">'155********'</span></span><br><span class="line">    password = <span class="string">'***********'</span></span><br><span class="line">    wait = WebDriverWait(browser, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    browser.get(url)</span><br><span class="line">    user = wait.until(EC.presence_of_element_located((By.ID, <span class="string">'login-username'</span>)))</span><br><span class="line">    passwd = wait.until(EC.presence_of_element_located((By.ID, <span class="string">'login-passwd'</span>)))</span><br><span class="line">    user.send_keys(username)</span><br><span class="line">    passwd.send_keys(password)</span><br><span class="line">    login_btn = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'a.btn.btn-login'</span>)))</span><br><span class="line">    time.sleep(random.random() * <span class="number">3</span>)</span><br><span class="line">    login_btn.click()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_element</span><span class="params">()</span>:</span></span><br><span class="line">    c_background = wait.until(</span><br><span class="line">        EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'canvas.geetest_canvas_bg.geetest_absolute'</span>)))</span><br><span class="line">    c_slice = wait.until(</span><br><span class="line">        EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'canvas.geetest_canvas_slice.geetest_absolute'</span>)))</span><br><span class="line">    c_full_bg = wait.until(</span><br><span class="line">        EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'canvas.geetest_canvas_fullbg.geetest_fade.geetest_absolute'</span>)))</span><br><span class="line">    hide_element(c_slice)</span><br><span class="line">    save_screenshot(c_background, <span class="string">'back'</span>)</span><br><span class="line">    show_element(c_slice)</span><br><span class="line">    save_screenshot(c_slice, <span class="string">'slice'</span>)</span><br><span class="line">    show_element(c_full_bg)</span><br><span class="line">    save_screenshot(c_full_bg, <span class="string">'full'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hide_element</span><span class="params">(element)</span>:</span></span><br><span class="line">    browser.execute_script(<span class="string">"arguments[0].style=arguments[1]"</span>, element, <span class="string">"display: none;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_element</span><span class="params">(element)</span>:</span></span><br><span class="line">    browser.execute_script(<span class="string">"arguments[0].style=arguments[1]"</span>, element, <span class="string">"display: block;"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_screenshot</span><span class="params">(obj, name)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pic_url = browser.save_screenshot(<span class="string">'.\\bilibili.png'</span>)</span><br><span class="line">        print(<span class="string">"%s:æˆªå›¾æˆåŠŸ!"</span> % pic_url)</span><br><span class="line">        left = obj.location[<span class="string">'x'</span>]</span><br><span class="line">        top = obj.location[<span class="string">'y'</span>]</span><br><span class="line">        right = left + obj.size[<span class="string">'width'</span>]</span><br><span class="line">        bottom = top + obj.size[<span class="string">'height'</span>]</span><br><span class="line">        print(<span class="string">'å›¾ï¼š'</span> + name)</span><br><span class="line">        print(<span class="string">'Left %s'</span> % left)</span><br><span class="line">        print(<span class="string">'Top %s'</span> % top)</span><br><span class="line">        print(<span class="string">'Right %s'</span> % right)</span><br><span class="line">        print(<span class="string">'Bottom %s'</span> % bottom)</span><br><span class="line">        print(<span class="string">''</span>)</span><br><span class="line">        im = Image.open(<span class="string">'.\\bilibili.png'</span>)</span><br><span class="line">        im = im.crop((left, top, right, bottom))</span><br><span class="line">        file_name = <span class="string">'bili_'</span> + name + <span class="string">'.png'</span></span><br><span class="line">        im.save(file_name)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> msg:</span><br><span class="line">        print(<span class="string">"%s:æˆªå›¾å¤±è´¥!"</span> % msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slide</span><span class="params">()</span>:</span></span><br><span class="line">    distance = get_distance(Image.open(<span class="string">'.\\bili_back.png'</span>), Image.open(<span class="string">'.\\bili_full.png'</span>))</span><br><span class="line">    print(<span class="string">'è®¡ç®—åç§»é‡ä¸ºï¼š%s Px'</span> % distance)</span><br><span class="line">    trace = get_trace(distance - <span class="number">5</span>)</span><br><span class="line">    move_to_gap(trace)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_distance</span><span class="params">(bg_image, fullbg_image)</span>:</span></span><br><span class="line">    distance = <span class="number">60</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(distance, fullbg_image.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(fullbg_image.size[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> is_pixel_equal(fullbg_image, bg_image, i, j):</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_pixel_equal</span><span class="params">(bg_image, fullbg_image, x, y)</span>:</span></span><br><span class="line">    bg_pixel = bg_image.load()[x, y]</span><br><span class="line">    fullbg_pixel = fullbg_image.load()[x, y]</span><br><span class="line">    threshold = <span class="number">60</span></span><br><span class="line">    <span class="keyword">if</span> (abs(bg_pixel[<span class="number">0</span>] - fullbg_pixel[<span class="number">0</span>] &lt; threshold) <span class="keyword">and</span> abs(bg_pixel[<span class="number">1</span>] - fullbg_pixel[<span class="number">1</span>] &lt; threshold) <span class="keyword">and</span> abs(</span><br><span class="line">            bg_pixel[<span class="number">2</span>] - fullbg_pixel[<span class="number">2</span>] &lt; threshold)):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_trace</span><span class="params">(distance)</span>:</span></span><br><span class="line">    trace = []</span><br><span class="line">    faster_distance = distance * (<span class="number">4</span> / <span class="number">5</span>)</span><br><span class="line">    start, v0, t = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span></span><br><span class="line">    <span class="keyword">while</span> start &lt; distance:</span><br><span class="line">        <span class="keyword">if</span> start &lt; faster_distance:</span><br><span class="line">            a = <span class="number">20</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            a = <span class="number">-20</span></span><br><span class="line">        move = v0 * t + <span class="number">1</span> / <span class="number">2</span> * a * t * t</span><br><span class="line">        v = v0 + a * t</span><br><span class="line">        v0 = v</span><br><span class="line">        start += move</span><br><span class="line">        trace.append(round(move))</span><br><span class="line">    <span class="keyword">return</span> trace</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move_to_gap</span><span class="params">(trace)</span>:</span></span><br><span class="line">    slider = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'div.geetest_slider_button'</span>)))</span><br><span class="line">    ActionChains(browser).click_and_hold(slider).perform()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> trace:</span><br><span class="line">        ActionChains(browser).move_by_offset(xoffset=x, yoffset=<span class="number">0</span>).perform()</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    ActionChains(browser).release().perform()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    init()</span><br><span class="line">    login()</span><br><span class="line">    find_element()</span><br><span class="line">    slide()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åä¸‰ç«  â€”â€” ã€éªŒè¯ç å¯¹æŠ—ç³»åˆ— â€” æ»‘åŠ¨éªŒè¯ç ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="æ»‘åŠ¨éªŒè¯ç " scheme="https://www.itrhx.com/tags/%E6%BB%91%E5%8A%A8%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C12</title>
    <link href="https://www.itrhx.com/2019/09/05/A42-Python3-spider-C12/"/>
    <id>https://www.itrhx.com/2019/09/05/A42-Python3-spider-C12/</id>
    <published>2019-09-05T14:54:48.887Z</published>
    <updated>2019-09-24T12:40:54.127Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åäºŒç«  â€”â€” ã€éªŒè¯ç å¯¹æŠ—ç³»åˆ— â€” å›¾å½¢éªŒè¯ç ã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€12-1ã€‘å…³äºæ™®é€šå›¾å½¢éªŒè¯ç "><a href="#ã€12-1ã€‘å…³äºæ™®é€šå›¾å½¢éªŒè¯ç " class="headerlink" title="ã€12.1ã€‘å…³äºæ™®é€šå›¾å½¢éªŒè¯ç "></a><font color="#ff0000">ã€12.1ã€‘å…³äºæ™®é€šå›¾å½¢éªŒè¯ç </font></h1><p>æ™®é€šå›¾å½¢éªŒè¯ç ä¸€èˆ¬ç”±å››ä½çº¯æ•°å­—ã€çº¯å­—æ¯æˆ–è€…å­—æ¯æ•°å­—ç»„åˆæ„æˆï¼Œæ˜¯æœ€å¸¸è§çš„éªŒè¯ç ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„éªŒè¯ç ï¼Œåˆ©ç”¨ tesserocr æˆ–è€… pytesseract åº“å³å¯è¯†åˆ«æ­¤ç±»éªŒè¯ç ï¼Œå‰ææ˜¯å·²ç»å®‰è£…å¥½ Tesseract-OCR è½¯ä»¶</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A42/01.png" alt="01"><br></fancybox><h1 id="ã€12-2ã€‘tesserocr-åº“è¯†åˆ«éªŒè¯ç "><a href="#ã€12-2ã€‘tesserocr-åº“è¯†åˆ«éªŒè¯ç " class="headerlink" title="ã€12.2ã€‘tesserocr åº“è¯†åˆ«éªŒè¯ç "></a><font color="#ff0000">ã€12.2ã€‘tesserocr åº“è¯†åˆ«éªŒè¯ç </font></h1><p>ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = Image.open(<span class="string">'code.png'</span>)</span><br><span class="line">result = tesserocr.image_to_text(image)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ª Image å¯¹è±¡ï¼Œè°ƒç”¨ tesserocr çš„ <code>image_to_text()</code> æ–¹æ³•ï¼Œä¼ å…¥ Image å¯¹è±¡å³å¯å®Œæˆè¯†åˆ«ï¼Œå¦ä¸€ç§æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line">print(tesserocr.file_to_text(<span class="string">'code.png'</span>))</span><br></pre></td></tr></table></figure><h1 id="ã€12-3ã€‘pytesseract-åº“è¯†åˆ«éªŒè¯ç "><a href="#ã€12-3ã€‘pytesseract-åº“è¯†åˆ«éªŒè¯ç " class="headerlink" title="ã€12.3ã€‘pytesseract åº“è¯†åˆ«éªŒè¯ç "></a><font color="#ff0000">ã€12.3ã€‘pytesseract åº“è¯†åˆ«éªŒè¯ç </font></h1><p>ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">img = Image.open(<span class="string">'code.png'</span>)</span><br><span class="line">img = img.convert(<span class="string">'RGB'</span>)</span><br><span class="line">img.show()</span><br><span class="line">print(pytesseract.image_to_string(img))</span><br></pre></td></tr></table></figure><p>pytesseract çš„å„ç§æ–¹æ³•ï¼š</p><ul><li>get_tesseract_versionï¼šè¿”å› Tesseract çš„ç‰ˆæœ¬ä¿¡æ¯ï¼›</li><li>image_to_stringï¼šå°†å›¾åƒä¸Šçš„ Tesseract OCR è¿è¡Œç»“æœè¿”å›åˆ°å­—ç¬¦ä¸²ï¼›</li><li>image_to_boxesï¼šè¿”å›åŒ…å«å·²è¯†åˆ«å­—ç¬¦åŠå…¶æ¡†è¾¹ç•Œçš„ç»“æœï¼›</li><li>image_to_dataï¼šè¿”å›åŒ…å«æ¡†è¾¹ç•Œï¼Œç½®ä¿¡åº¦å’Œå…¶ä»–ä¿¡æ¯çš„ç»“æœã€‚éœ€è¦ Tesseract 3.05+ï¼›</li><li>image_to_osdï¼šè¿”å›åŒ…å«æœ‰å…³æ–¹å‘å’Œè„šæœ¬æ£€æµ‹çš„ä¿¡æ¯çš„ç»“æœã€‚</li></ul><p>æœ‰å…³å‚æ•°ï¼š</p><p><code>image_to_data(image, lang=&#39;&#39;, config=&#39;&#39;, nice=0, output_type=Output.STRING)</code></p><ul><li>imageï¼šå›¾åƒå¯¹è±¡ï¼›</li><li>langï¼šTesseract è¯­è¨€ä»£ç å­—ç¬¦ä¸²ï¼›</li><li>configï¼šä»»ä½•å…¶ä»–é…ç½®ä¸ºå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šconfig=â€™â€“psm 6â€™ï¼›</li><li>niceï¼šä¿®æ”¹ Tesseract è¿è¡Œçš„å¤„ç†å™¨ä¼˜å…ˆçº§ã€‚Windowsä¸æ”¯æŒã€‚å°¼æ–¯è°ƒæ•´äº†ç±»ä¼¼ unix çš„æµç¨‹çš„ä¼˜ç‚¹ï¼›</li><li>output_typeï¼šç±»å±æ€§ï¼ŒæŒ‡å®šè¾“å‡ºçš„ç±»å‹ï¼Œé»˜è®¤ä¸ºstringã€‚</li></ul><p>lang å‚æ•°ï¼Œå¸¸è§è¯­è¨€ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>chi_simï¼šç®€ä½“ä¸­æ–‡</li><li>chi_traï¼šç¹ä½“ä¸­æ–‡</li><li>engï¼šè‹±æ–‡</li><li>rusï¼šä¿„ç½—æ–¯è¯­</li><li>fraï¼šæ³•è¯­</li><li>deuï¼šå¾·è¯­</li><li>jpnï¼šæ—¥è¯­</li></ul><h1 id="ã€12-4ã€‘éªŒè¯ç å¤„ç†"><a href="#ã€12-4ã€‘éªŒè¯ç å¤„ç†" class="headerlink" title="ã€12.4ã€‘éªŒè¯ç å¤„ç†"></a><font color="#ff0000">ã€12.4ã€‘éªŒè¯ç å¤„ç†</font></h1><p>åˆ©ç”¨ Image å¯¹è±¡çš„ <code>convert()</code> æ–¹æ³•ä¼ å…¥ä¸åŒå‚æ•°å¯ä»¥å¯¹éªŒè¯ç åšä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œå¦‚è½¬ç°åº¦ã€äºŒå€¼åŒ–ç­‰æ“ä½œï¼Œç»è¿‡å¤„ç†è¿‡åçš„éªŒè¯ç ä¼šæ›´åŠ å®¹æ˜“è¢«è¯†åˆ«ï¼Œè¯†åˆ«å‡†ç¡®åº¦æ›´é«˜ï¼Œå„ç§å‚æ•°åŠå«ä¹‰ï¼š</p><ul><li>1ï¼š1ä½åƒç´ ï¼Œé»‘ç™½ï¼Œæ¯å­—èŠ‚ä¸€ä¸ªåƒç´ å­˜å‚¨ï¼›</li><li>Lï¼š8ä½åƒç´ ï¼Œé»‘ç™½ï¼›</li><li>Pï¼š8ä½åƒç´ ï¼Œä½¿ç”¨è°ƒè‰²æ¿æ˜ å°„åˆ°ä»»ä½•å…¶ä»–æ¨¡å¼ï¼›</li><li>RGBï¼š3x8ä½åƒç´ ï¼ŒçœŸå½©è‰²ï¼›</li><li>RGBAï¼š4x8ä½åƒç´ ï¼Œå¸¦é€æ˜åº¦æ©æ¨¡çš„çœŸå½©è‰²ï¼›</li><li>CMYKï¼š4x8ä½åƒç´ ï¼Œåˆ†è‰²ï¼›</li><li>YCbCrï¼š3x8ä½åƒç´ ï¼Œå½©è‰²è§†é¢‘æ ¼å¼ï¼›</li><li>Iï¼š32ä½æœ‰ç¬¦å·æ•´æ•°åƒç´ ï¼›</li><li>Fï¼š32ä½æµ®ç‚¹åƒç´ ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = Image.open(<span class="string">'code.png'</span>)</span><br><span class="line">image = image.convert(<span class="string">'L'</span>)</span><br><span class="line">image.show()</span><br><span class="line">result = pytesseract.image_to_string(image)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>Image å¯¹è±¡çš„ <code>convert()</code> æ–¹æ³•å‚æ•°ä¼ å…¥ Lï¼Œå³å¯å°†å›¾ç‰‡è½¬åŒ–ä¸ºç°åº¦å›¾åƒï¼Œè½¬æ¢å‰åå¯¹æ¯”ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A42/02.png" alt="02"><br></fancybox><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">image = Image.open(<span class="string">'code.png'</span>)</span><br><span class="line">image = image.convert(<span class="string">'1'</span>)</span><br><span class="line">image.show()</span><br><span class="line">result = pytesseract.image_to_string(image)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>Image å¯¹è±¡çš„ <code>convert()</code> æ–¹æ³•å‚æ•°ä¼ å…¥ 1ï¼Œå³å¯å°†å›¾ç‰‡è¿›è¡ŒäºŒå€¼åŒ–å¤„ç†ï¼Œå¤„ç†å‰åå¯¹æ¯”ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A42/03.png" alt="03"><br></fancybox><h1 id="ã€12-5ã€‘tesserocr-ä¸-pytesserocr-ç›¸å…³èµ„æ–™"><a href="#ã€12-5ã€‘tesserocr-ä¸-pytesserocr-ç›¸å…³èµ„æ–™" class="headerlink" title="ã€12.5ã€‘tesserocr ä¸ pytesserocr ç›¸å…³èµ„æ–™"></a><font color="#ff0000">ã€12.5ã€‘tesserocr ä¸ pytesserocr ç›¸å…³èµ„æ–™</font></h1><ul><li><p>tesserocr GitHubï¼š<a href="https://github.com/sirfz/tesserocr" target="_blank" rel="noopener">https://github.com/sirfz/tesserocr</a></p></li><li><p>tesserocr PyPIï¼š<a href="https://pypi.python.org/pypi/tesserocr" target="_blank" rel="noopener">https://pypi.python.org/pypi/tesserocr</a></p></li><li><p>pytesserocr GitHubï¼š<a href="https://github.com/madmaze/pytesseract" target="_blank" rel="noopener">https://github.com/madmaze/pytesseract</a></p></li><li><p>pytesserocr PyPIï¼š<a href="https://pypi.org/project/pytesseract/" target="_blank" rel="noopener">https://pypi.org/project/pytesseract/</a></p></li><li><p>Tesseract-OCR ä¸‹è½½åœ°å€ï¼š<a href="http://digi.bib.uni-mannheim.de/tesseract" target="_blank" rel="noopener">http://digi.bib.uni-mannheim.de/tesseract</a></p></li><li><p>tesseract GitHubï¼š<a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract</a></p></li><li><p>tesseract è¯­è¨€åŒ…ï¼š<a href="https://github.com/tesseract-ocr/tessdata" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tessdata</a></p></li><li><p>tesseract æ–‡æ¡£ï¼š<a href="https://github.com/tesseract-ocr/tesseract/wiki/Documentation" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract/wiki/Documentation</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åäºŒç«  â€”â€” ã€éªŒè¯ç å¯¹æŠ—ç³»åˆ— â€” å›¾å½¢éªŒè¯ç ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="å›¾å½¢éªŒè¯ç " scheme="https://www.itrhx.com/tags/%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C11</title>
    <link href="https://www.itrhx.com/2019/09/04/A41-Python3-spider-C11/"/>
    <id>https://www.itrhx.com/2019/09/04/A41-Python3-spider-C11/</id>
    <published>2019-09-04T14:06:03.110Z</published>
    <updated>2019-09-24T12:40:45.074Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åä¸€ç«  â€”â€” ã€MongoDBæ•°æ®å‚¨å­˜ã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€11-1ã€‘å…³äº-MongoDB"><a href="#ã€11-1ã€‘å…³äº-MongoDB" class="headerlink" title="ã€11.1ã€‘å…³äº MongoDB"></a><font color="#ff0000">ã€11.1ã€‘å…³äº MongoDB</font></h1><p>MongoDB å±äºéå…³ç³»å‹æ•°æ®åº“ï¼Œå³ NoSQLï¼ˆNot Only SQLï¼‰ï¼ŒNoSQL æ˜¯åŸºäºé”®å€¼å¯¹çš„ï¼Œä¸éœ€è¦ç»è¿‡ SQL å±‚çš„è§£æï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰è€¦åˆæ€§ï¼Œæ€§èƒ½æé«˜ï¼Œéå…³ç³»å‹æ•°æ®åº“åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼šRedisã€Voldemortã€Oracle BDB ç­‰ï¼›</li><li>åˆ—å­˜å‚¨æ•°æ®åº“ï¼šCassandraã€HBaseã€Riak ç­‰ï¼›</li><li>æ–‡æ¡£å‹æ•°æ®åº“ï¼šCouchDBã€MongoDB ç­‰ï¼›</li><li>å›¾å½¢æ•°æ®åº“ï¼šNeo4Jã€InfoGridã€Infinite Graph ç­‰ã€‚</li></ul><h1 id="ã€11-2ã€‘MongoDB-åŸºæœ¬æ“ä½œè¯­å¥"><a href="#ã€11-2ã€‘MongoDB-åŸºæœ¬æ“ä½œè¯­å¥" class="headerlink" title="ã€11.2ã€‘MongoDB åŸºæœ¬æ“ä½œè¯­å¥"></a><font color="#ff0000">ã€11.2ã€‘MongoDB åŸºæœ¬æ“ä½œè¯­å¥</font></h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨å°±åˆ›å»ºæ•°æ®åº“, å­˜åœ¨å°±åˆ‡æ¢åˆ°æŒ‡å®šçš„æ•°æ®åº“ï¼‰</span><br><span class="line"><span class="keyword">use</span> DATABASE_NAME</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> dbs</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å½“å‰æ‰€åœ¨æ•°æ®åº“</span><br><span class="line">db</span><br><span class="line"></span><br><span class="line"># åˆ é™¤å½“å‰æ•°æ®åº“</span><br><span class="line">db.dropDatabase()</span><br><span class="line"></span><br><span class="line"># åˆ é™¤é›†åˆ</span><br><span class="line">db.COLLECTION_NAME.drop()</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºé›†åˆ</span><br><span class="line">db.createCollection(<span class="string">"COLLECTION_NAME"</span>)</span><br><span class="line"></span><br><span class="line"># æ’å…¥æ–‡æ¡£</span><br><span class="line">db.COLLECTION_NAME.insert(<span class="keyword">document</span>)</span><br><span class="line">db.COLLECTION_NAME.save(<span class="keyword">document</span>) </span><br><span class="line"></span><br><span class="line"># æ›´æ–°æ–‡æ¡£</span><br><span class="line">db.COLLECTION_NAME.update()</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æ–‡æ¡£</span><br><span class="line">db.COLLECTION_NAME.remove()</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢æ–‡æ¡£</span><br><span class="line">db.COLLECTION_NAME.find(<span class="keyword">query</span>, projection)</span><br></pre></td></tr></table></figure><h1 id="ã€11-3ã€‘è¿æ¥-MongoDB"><a href="#ã€11-3ã€‘è¿æ¥-MongoDB" class="headerlink" title="ã€11.3ã€‘è¿æ¥ MongoDB"></a><font color="#ff0000">ã€11.3ã€‘è¿æ¥ MongoDB</font></h1><p>è¿æ¥ MongoDB éœ€è¦å¯¼å…¥ pymongo åº“ï¼Œä½¿ç”¨ <code>MongoClient()</code> æ–¹æ³•ï¼Œå‘å…¶ä¼ å…¥åœ°å€å‚æ•° host å’Œ ç«¯å£å‚æ•° port å³å¯ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥ MongoDB çš„è¿æ¥å­—ç¬¦ä¸²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(<span class="string">'mongodb://localhost:27017/'</span>)</span><br></pre></td></tr></table></figure><h1 id="ã€11-4ã€‘æŒ‡å®šæ•°æ®åº“"><a href="#ã€11-4ã€‘æŒ‡å®šæ•°æ®åº“" class="headerlink" title="ã€11.4ã€‘æŒ‡å®šæ•°æ®åº“"></a><font color="#ff0000">ã€11.4ã€‘æŒ‡å®šæ•°æ®åº“</font></h1><p>ä½¿ç”¨ä»¥ä¸‹è¯­å¥çš†å¯æŒ‡å®šä¸€ä¸ªåä¸º spiders çš„æ•°æ®åº“ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db = client.spiders</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db = client[<span class="string">'spiders'</span>]</span><br></pre></td></tr></table></figure><h1 id="ã€11-5ã€‘æŒ‡å®šé›†åˆ"><a href="#ã€11-5ã€‘æŒ‡å®šé›†åˆ" class="headerlink" title="ã€11.5ã€‘æŒ‡å®šé›†åˆ"></a><font color="#ff0000">ã€11.5ã€‘æŒ‡å®šé›†åˆ</font></h1><p>MongoDB çš„æ¯ä¸ªæ•°æ®åº“åŒ…å«å¤šä¸ªé›†åˆï¼ˆcollectionï¼‰ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ MySQL ä¸­çš„æ•°æ®è¡¨ï¼Œä½¿ç”¨ä»¥ä¸‹è¯­å¥çš†å¯æŒ‡å®šä¸€ä¸ªåä¸º students çš„é›†åˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection = db.students</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collection = db[<span class="string">'students'</span>]</span><br></pre></td></tr></table></figure><h1 id="ã€11-6ã€‘æ’å…¥æ•°æ®"><a href="#ã€11-6ã€‘æ’å…¥æ•°æ®" class="headerlink" title="ã€11.6ã€‘æ’å…¥æ•°æ®"></a><font color="#ff0000">ã€11.6ã€‘æ’å…¥æ•°æ®</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">students = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110105'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRHX'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line">result = collection.insert(students)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>åœ¨ spiders æ•°æ®åº“çš„ students é›†åˆé‡Œï¼Œæ–°å»ºä¸€æ¡å­¦ç”Ÿæ•°æ®ï¼Œè¯¥æ•°æ®ä»¥å­—å…¸å½¢å¼è¡¨ç¤ºï¼Œè°ƒç”¨ collection çš„ <code>insert()</code> æ–¹æ³•æ’å…¥æ•°æ®ï¼Œåœ¨ MongoDB ä¸­ï¼Œæ¯æ¡æ•°æ®éƒ½æœ‰ä¸€ä¸ª_id å±æ€§æ¥å”¯ä¸€æ ‡è¯†ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡æ˜è¯¥å±æ€§ï¼ŒMongoDB ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ª ObjectId ç±»å‹çš„_id å±æ€§ã€‚<code>insert()</code> æ–¹æ³•ä¼šåœ¨æ‰§è¡Œåè¿”å› _id  å€¼ï¼Œåœ¨ MongoDB æ•°æ®åº“é‡Œé¢å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæ’å…¥æ•°æ®ï¼Œè¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span>d6f1a4b57b65e1547bb3c24</span><br></pre></td></tr></table></figure><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A41/01.png" alt="01"><br></fancybox><p>è¿›é˜¶æ“ä½œï¼šåŒæ—¶æ’å…¥å¤šæ¡æ•°æ®ï¼Œä»¥åˆ—è¡¨å½¢å¼ä¼ é€’ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">students1 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110105'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRHX'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line">students2 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110106'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'AAAA'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">22</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line">result = collection.insert([students1, students2])</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ObjectId(<span class="string">'5d6f2be3cd1721962218a709'</span>), ObjectId(<span class="string">'5d6f2be3cd1721962218a70a'</span>)]</span><br></pre></td></tr></table></figure><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A41/02.png" alt="02"><br></fancybox><p>PyMongo 3.x åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ¨èä½¿ç”¨ <code>insert_one()</code> å’Œ <code>insert_many()</code> æ–¹æ³•æ¥åˆ†åˆ«æ’å…¥å•æ¡è®°å½•å’Œå¤šæ¡è®°å½•ï¼Œç¤ºä¾‹ï¼š</p><p>æ’å…¥å•æ¡è®°å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">students = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110105'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRHX'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line">result = collection.insert_one(students)</span><br><span class="line">print(result)</span><br><span class="line">print(result.inserted_id)</span><br></pre></td></tr></table></figure><p>è¿”å›çš„æ˜¯ InsertOneResult å¯¹è±¡ï¼Œè°ƒç”¨å…¶ <code>inserted_id</code> å±æ€§è·å–_idï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;pymongo.results.InsertOneResult object at <span class="number">0x0000020ED91A5608</span>&gt;</span><br><span class="line"><span class="number">5</span>d6f73940fe700c5a7ac19f0</span><br></pre></td></tr></table></figure><p>æ’å…¥å¤šæ¡è®°å½•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">students1 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110105'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRHX'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line">students2 = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110106'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'AAAA'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">22</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line">result = collection.insert_many([students1, students2])</span><br><span class="line">print(result)</span><br><span class="line">print(result.inserted_ids)</span><br></pre></td></tr></table></figure><p>è¿”å›çš„ç±»å‹æ˜¯ InsertManyResultï¼Œè°ƒç”¨ <code>inserted_ids</code> å±æ€§å¯ä»¥è·å–æ’å…¥æ•°æ®çš„_id åˆ—è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;pymongo.results.InsertManyResult object at <span class="number">0x0000021698DD36C8</span>&gt;</span><br><span class="line">[ObjectId(<span class="string">'5d6f68598fa881c69b2e0006'</span>), ObjectId(<span class="string">'5d6f68598fa881c69b2e0007'</span>)]</span><br></pre></td></tr></table></figure><h1 id="ã€11-6ã€‘æ•°æ®æŸ¥è¯¢"><a href="#ã€11-6ã€‘æ•°æ®æŸ¥è¯¢" class="headerlink" title="ã€11.6ã€‘æ•°æ®æŸ¥è¯¢"></a><font color="#ff0000">ã€11.6ã€‘æ•°æ®æŸ¥è¯¢</font></h1><p>äº‹å…ˆå·²ç»åˆ›å»ºå¥½ spiders æ•°æ®åº“å’Œ students é›†åˆï¼ŒåŒ…å«ä»¥ä¸‹æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">_id:ObjectId("5d6f95d40828142f1dc35fa5")</span><br><span class="line">id:"17110105"</span><br><span class="line">name:"TRHX"</span><br><span class="line">age:20</span><br><span class="line">gender:"male"</span><br><span class="line"></span><br><span class="line">_id:ObjectId("5d6f95d40828142f1dc35fa6")</span><br><span class="line">id:"17110106"</span><br><span class="line">name:"AAA"</span><br><span class="line">age:20</span><br><span class="line">gender:"male"</span><br><span class="line"></span><br><span class="line">_id:ObjectId("5d6f95d40828142f1dc35fa7")</span><br><span class="line">id:"17110107"</span><br><span class="line">name:"BBB"</span><br><span class="line">age:19</span><br><span class="line">gender:"female"</span><br><span class="line"></span><br><span class="line">_id:ObjectId("5d6f95d40828142f1dc35fa8")</span><br><span class="line">id:"17110108"</span><br><span class="line">name:"CCC"</span><br><span class="line">age:22</span><br><span class="line">gender:"male"</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ–¹æ³•ä¸€ï¼šåˆ©ç”¨ <code>find_one()</code> æˆ– <code>find()</code> æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ï¼Œ <code>find_one()</code> æŸ¥è¯¢å¾—åˆ°çš„æ˜¯å•ä¸ªç»“æœï¼Œ<code>find()</code> åˆ™è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">result = collection.find_one(&#123;<span class="string">'name'</span>: <span class="string">'TRHX'</span>&#125;)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ name ä¸º TRHX çš„æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa5'</span>), <span class="string">'id'</span>: <span class="string">'17110105'</span>, <span class="string">'name'</span>: <span class="string">'TRHX'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ–¹æ³•äºŒï¼šæ ¹æ® ObjectId æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦ä½¿ç”¨ bson åº“é‡Œé¢çš„ objectidï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">from</span> bson.objectid <span class="keyword">import</span> ObjectId</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">result = collection.find_one(&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa7'</span>)&#125;)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa7'</span>), <span class="string">'id'</span>: <span class="string">'17110107'</span>, <span class="string">'name'</span>: <span class="string">'BBB'</span>, <span class="string">'age'</span>: <span class="number">19</span>, <span class="string">'gender'</span>: <span class="string">'female'</span>&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>find()</code> æ–¹æ³•æŸ¥è¯¢å¤šæ¡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">results = collection.find(&#123;<span class="string">'gender'</span>: <span class="string">'male'</span>&#125;)</span><br><span class="line">print(results)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p><code>find()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œéå†å¾—åˆ°æ‰€æœ‰æ•°æ®ï¼Œæ¯æ¡æ•°æ®éƒ½æ˜¯å­—å…¸ç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;pymongo.cursor.Cursor object at <span class="number">0x00000191F69AAA90</span>&gt;</span><br><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa5'</span>), <span class="string">'id'</span>: <span class="string">'17110105'</span>, <span class="string">'name'</span>: <span class="string">'TRHX'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa6'</span>), <span class="string">'id'</span>: <span class="string">'17110106'</span>, <span class="string">'name'</span>: <span class="string">'AAA'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa8'</span>), <span class="string">'id'</span>: <span class="string">'17110108'</span>, <span class="string">'name'</span>: <span class="string">'CCC'</span>, <span class="string">'age'</span>: <span class="number">22</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­åŠ å…¥æ¯”è¾ƒç¬¦å·è¿›è¡ŒæŸ¥è¯¢ï¼Œä»¥ä¸‹ä»£ç å®ç°äº†å¹´é¾„å¤§äºç­‰äº20çš„æ•°æ®æŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">results = collection.find(&#123;<span class="string">'age'</span>: &#123;<span class="string">'$gte'</span>: <span class="number">20</span>&#125;&#125;)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>ç¬¦å· <code>$gte</code> è¡¨ç¤ºå¤§äºç­‰äºï¼ŒæŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa5'</span>), <span class="string">'id'</span>: <span class="string">'17110105'</span>, <span class="string">'name'</span>: <span class="string">'TRHX'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa6'</span>), <span class="string">'id'</span>: <span class="string">'17110106'</span>, <span class="string">'name'</span>: <span class="string">'AAA'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa8'</span>), <span class="string">'id'</span>: <span class="string">'17110108'</span>, <span class="string">'name'</span>: <span class="string">'CCC'</span>, <span class="string">'age'</span>: <span class="number">22</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><center>é™„è¡¨ï¼šå„ç§æ¯”è¾ƒç¬¦å·</center><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>$lt</td><td>å°äº</td><td>{â€˜ageâ€™: {â€˜$ltâ€™: 20}}</td></tr><tr><td>$gt</td><td>å¤§äº</td><td>{â€˜ageâ€™: {â€˜$gtâ€™: 20}}</td></tr><tr><td>$lte</td><td>å°äºç­‰äº</td><td>{â€˜ageâ€™: {â€˜$lteâ€™: 20}}</td></tr><tr><td>$gte</td><td>å¤§äºç­‰äº</td><td>{â€˜ageâ€™: {â€˜$gteâ€™: 20}}</td></tr><tr><td>$ne</td><td>ä¸ç­‰äº</td><td>{â€˜ageâ€™: {â€˜$neâ€™: 20}}</td></tr><tr><td>$in</td><td>åœ¨èŒƒå›´å†…</td><td>{â€˜ageâ€™: {â€˜$inâ€™: [20, 23]}}</td></tr><tr><td>$nin</td><td>ä¸åœ¨èŒƒå›´å†…</td><td>{â€˜ageâ€™: {â€˜$ninâ€™: [20, 23]}}</td></tr></tbody></table><p>åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­åŠ å…¥åŠŸèƒ½ç¬¦å·è¿›è¡ŒæŸ¥è¯¢ï¼Œä»¥ä¸‹ä»£ç ç”¨æ­£åˆ™åŒ¹é…å®ç°äº†å¯¹åå­—ä»¥ T å¼€å¤´çš„å­¦ç”Ÿæ•°æ®çš„æŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">results = collection.find(&#123;<span class="string">'name'</span>: &#123;<span class="string">'$regex'</span>: <span class="string">'^T.*'</span>&#125;&#125;)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'_id'</span>: ObjectId(<span class="string">'5d6f95d40828142f1dc35fa5'</span>), <span class="string">'id'</span>: <span class="string">'17110105'</span>, <span class="string">'name'</span>: <span class="string">'TRHX'</span>, <span class="string">'age'</span>: <span class="number">20</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>&#125;</span><br></pre></td></tr></table></figure><center>é™„è¡¨ï¼šå„ç§åŠŸèƒ½ç¬¦å·</center><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th><th>ç¤ºä¾‹å«ä¹‰</th></tr></thead><tbody><tr><td>$regex</td><td>åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼</td><td>{â€˜nameâ€™: {â€˜$regexâ€™: â€˜^T.*â€™}}</td><td>name ä»¥ T å¼€å¤´</td></tr><tr><td>$exists</td><td>å±æ€§æ˜¯å¦å­˜åœ¨</td><td>{â€˜nameâ€™: {â€˜$existsâ€™: True}}</td><td>name å±æ€§å­˜åœ¨</td></tr><tr><td>$type</td><td>ç±»å‹åˆ¤æ–­</td><td>{â€˜ageâ€™: {â€˜$typeâ€™: â€˜intâ€™}}</td><td>age çš„ç±»å‹ä¸º int</td></tr><tr><td>$mod</td><td>æ•°å­—æ¨¡æ“ä½œ</td><td>{â€˜ageâ€™: {â€˜$modâ€™: [5, 0]}}</td><td>å¹´é¾„æ¨¡ 5 ä½™ 0</td></tr><tr><td>$text</td><td>æ–‡æœ¬æŸ¥è¯¢</td><td>{â€˜$textâ€™: {â€˜$searchâ€™: â€˜Mikeâ€™}}</td><td>text ç±»å‹çš„å±æ€§ä¸­åŒ…å« Mike å­—ç¬¦ä¸²</td></tr><tr><td>$where</td><td>é«˜çº§æ¡ä»¶æŸ¥è¯¢</td><td>{â€˜$whereâ€™: â€˜obj.fans_count == obj.follows_countâ€™}</td><td>è‡ªèº«ç²‰ä¸æ•°ç­‰äºå…³æ³¨æ•°</td></tr></tbody></table><p>å…¶ä»–æ“ä½œï¼š<a href="https://docs.mongodb.com/manual/reference/operator/query/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/operator/query/</a></p><h1 id="ã€11-7ã€‘æ•°æ®è®¡æ•°"><a href="#ã€11-7ã€‘æ•°æ®è®¡æ•°" class="headerlink" title="ã€11.7ã€‘æ•°æ®è®¡æ•°"></a><font color="#ff0000">ã€11.7ã€‘æ•°æ®è®¡æ•°</font></h1><p>è°ƒç”¨ <code>count()</code> æ–¹æ³•å¯ä»¥ç»Ÿè®¡æŸ¥è¯¢ç»“æœæœ‰å¤šå°‘æ¡æ•°æ®ï¼Œè¾“å‡ºç»“æœä¸ºä¸€ä¸ªæ•´æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">result = collection.find(&#123;<span class="string">'name'</span>: &#123;<span class="string">'$regex'</span>: <span class="string">'^T.*'</span>&#125;&#125;).count()</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><h1 id="ã€11-8ã€‘æ•°æ®æ’åº"><a href="#ã€11-8ã€‘æ•°æ®æ’åº" class="headerlink" title="ã€11.8ã€‘æ•°æ®æ’åº"></a><font color="#ff0000">ã€11.8ã€‘æ•°æ®æ’åº</font></h1><p>è°ƒç”¨ <code>sort()</code> æ–¹æ³•ï¼Œå‘å…¶ä¼ å…¥æ’åºçš„å­—æ®µåŠå‡é™åºæ ‡å¿—å³å¯å®Œæˆæ’åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">ascending = collection.find().sort(<span class="string">'name'</span>, pymongo.ASCENDING)</span><br><span class="line">descending = collection.find().sort(<span class="string">'name'</span>, pymongo.DESCENDING)</span><br><span class="line">print(<span class="string">'å‡åºæ’åˆ—ï¼š'</span>, [result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> ascending])</span><br><span class="line">print(<span class="string">'é™åºæ’åˆ—ï¼š'</span>, [result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> descending])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‡åºæ’åˆ—ï¼š [<span class="string">'AAA'</span>, <span class="string">'BBB'</span>, <span class="string">'CCC'</span>, <span class="string">'TRHX'</span>]</span><br><span class="line">é™åºæ’åˆ—ï¼š [<span class="string">'TRHX'</span>, <span class="string">'CCC'</span>, <span class="string">'BBB'</span>, <span class="string">'AAA'</span>]</span><br></pre></td></tr></table></figure><h1 id="ã€11-9ã€‘æ•°æ®åç§»"><a href="#ã€11-9ã€‘æ•°æ®åç§»" class="headerlink" title="ã€11.9ã€‘æ•°æ®åç§»"></a><font color="#ff0000">ã€11.9ã€‘æ•°æ®åç§»</font></h1><p>åˆ©ç”¨ <code>skip()</code> æ–¹æ³•åç§»å‡ ä¸ªä½ç½®ï¼Œå°±å¯ä»¥è·³è¿‡å‰å‡ æ¡æ•°æ®ï¼Œè·å–åç§»é‡ä¹‹åçš„å‡ ä¸ªæ•°æ®ï¼›åˆ©ç”¨ <code>limit()</code> æ–¹æ³•æŒ‡å®šè·å–å‰å‡ æ¡æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">ascending = collection.find().sort(<span class="string">'name'</span>, pymongo.ASCENDING).skip(<span class="number">1</span>)</span><br><span class="line">descending = collection.find().sort(<span class="string">'name'</span>, pymongo.DESCENDING).limit(<span class="number">2</span>)</span><br><span class="line">print(<span class="string">'å‡åºæ’åˆ—ï¼ˆåç§»é‡ä¸º1ï¼Œè·å–åä¸‰æ¡æ•°æ®ï¼‰ï¼š'</span>, [result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> ascending])</span><br><span class="line">print(<span class="string">'é™åºæ’åˆ—ï¼ˆé™åˆ¶è·å–å‰ä¸¤æ¡æ•°æ®ï¼‰ï¼š'</span>, [result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> descending])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‡åºæ’åˆ—ï¼ˆåç§»é‡ä¸º<span class="number">1</span>ï¼Œè·å–åä¸‰æ¡æ•°æ®ï¼‰ï¼š [<span class="string">'BBB'</span>, <span class="string">'CCC'</span>, <span class="string">'TRHX'</span>]</span><br><span class="line">é™åºæ’åˆ—ï¼ˆé™åˆ¶è·å–å‰ä¸¤æ¡æ•°æ®ï¼‰ï¼š [<span class="string">'TRHX'</span>, <span class="string">'CCC'</span>]</span><br></pre></td></tr></table></figure><h1 id="ã€11-10ã€‘æ›´æ–°æ•°æ®"><a href="#ã€11-10ã€‘æ›´æ–°æ•°æ®" class="headerlink" title="ã€11.10ã€‘æ›´æ–°æ•°æ®"></a><font color="#ff0000">ã€11.10ã€‘æ›´æ–°æ•°æ®</font></h1><p>ä½¿ç”¨ <code>update()</code> æ–¹æ³•ï¼ŒæŒ‡å®šæ›´æ–°çš„æ¡ä»¶å’Œæ›´æ–°åçš„æ•°æ®å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">condition = &#123;<span class="string">'name'</span>: <span class="string">'TRHX'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">18</span></span><br><span class="line">result = collection.update(condition, student)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¯¥ä»£ç å°† name ä¸º TRHX çš„ age æ”¹ä¸ºäº† 18ï¼Œè¿”å›ç»“æœä»ç„¶æ˜¯å­—å…¸å½¢å¼ï¼Œok ä»£è¡¨æ‰§è¡ŒæˆåŠŸï¼ŒnModified ä»£è¡¨å½±å“çš„æ•°æ®æ¡æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'n'</span>: <span class="number">1</span>, <span class="string">'nModified'</span>: <span class="number">1</span>, <span class="string">'ok'</span>: <span class="number">1.0</span>, <span class="string">'updatedExisting'</span>: <span class="keyword">True</span>&#125;</span><br></pre></td></tr></table></figure><p>è¿›é˜¶æ“ä½œï¼šä½¿ç”¨ <code>$set</code> æ“ä½œç¬¦å¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼ŒæŒ‡å®šæ›´æ–°çš„æ¡ä»¶å’Œæ›´æ–°åçš„æ•°æ®å³å¯ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šåªæ›´æ–°æŒ‡å®šçš„ student å­—å…¸å†…å­˜åœ¨çš„å­—æ®µï¼Œå¦‚æœåŸå…ˆè¿˜æœ‰å…¶ä»–å­—æ®µï¼Œåˆ™ä¸ä¼šæ›´æ–°ï¼Œä¹Ÿä¸ä¼šåˆ é™¤ï¼›å¦‚æœä¸ç”¨ <code>$set</code> ï¼Œåˆ™ä¼šæŠŠä¹‹å‰çš„æ•°æ®å…¨éƒ¨ç”¨ student å­—å…¸æ›¿æ¢ï¼Œå¦‚æœåŸæœ¬å­˜åœ¨å…¶ä»–å­—æ®µï¼Œåˆ™ä¼šè¢«åˆ é™¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">condition = &#123;<span class="string">'name'</span>: <span class="string">'TRHX'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">18</span></span><br><span class="line">result = collection.update(condition, &#123;<span class="string">'$set'</span>: student&#125;)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>å’Œæ’å…¥æ•°æ®çš„ <code>insert()</code> æ–¹æ³•ä¸€æ ·ï¼Œåœ¨ PyMongo 3.x ç‰ˆæœ¬é‡Œï¼Œæ¨èä½¿ç”¨ <code>update_one()</code> å’Œ <code>update_many()</code> æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">condition = &#123;<span class="string">'name'</span>: <span class="string">'TRHX'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">19</span></span><br><span class="line">result = collection.update_one(condition, &#123;<span class="string">'$set'</span>: student&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.matched_count, result.modified_count)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>update_one()</code> æ–¹æ³•ä¸èƒ½ç›´æ¥ä¼ å…¥ä¿®æ”¹åçš„å­—å…¸ï¼Œåªèƒ½ä½¿ç”¨ <code>{&#39;$set&#39;: student}</code> çš„å½¢å¼ä¼ å…¥ï¼Œå¯ä»¥è°ƒç”¨ <code>matched_count</code> å’Œ <code>modified_count</code> å±æ€§ï¼Œè·å–åŒ¹é…çš„æ•°æ®æ¡æ•°å’Œå½±å“çš„æ•°æ®æ¡æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;pymongo.results.UpdateResult object at <span class="number">0x00000235A1684508</span>&gt;</span><br><span class="line"><span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>update_many()</code> æ–¹æ³•å¯ä»¥å°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®éƒ½æ›´æ–°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">condition = &#123;<span class="string">'age'</span>: &#123;<span class="string">'$gt'</span>: <span class="number">18</span>&#125;&#125;</span><br><span class="line">result = collection.update_many(condition, &#123;<span class="string">'$set'</span>: &#123;<span class="string">'age'</span>: <span class="number">25</span>&#125;&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.matched_count, result.modified_count)</span><br></pre></td></tr></table></figure><p>åŒ¹é…æ‰€æœ‰å¹´é¾„å¤§äº 18 çš„æ•°æ®ï¼Œæ›´æ–°æ¡ä»¶ä¸ºå°†è¿™äº›æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å¹´é¾„éƒ½è®¾ç½®æˆ 25ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;pymongo.results.UpdateResult object at <span class="number">0x00000285CECC45C8</span>&gt;</span><br><span class="line"><span class="number">4</span> <span class="number">4</span></span><br></pre></td></tr></table></figure><h1 id="ã€11-11ã€‘åˆ é™¤æ•°æ®"><a href="#ã€11-11ã€‘åˆ é™¤æ•°æ®" class="headerlink" title="ã€11.11ã€‘åˆ é™¤æ•°æ®"></a><font color="#ff0000">ã€11.11ã€‘åˆ é™¤æ•°æ®</font></h1><p>è°ƒç”¨ <code>remove()</code> æ–¹æ³•å¹¶æŒ‡å®šåˆ é™¤çš„æ¡ä»¶ï¼Œæ­¤æ—¶ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰æ•°æ®å‡ä¼šè¢«åˆ é™¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">result = collection.remove(&#123;<span class="string">'name'</span>: <span class="string">'CCC'</span>&#125;)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'n'</span>: <span class="number">1</span>, <span class="string">'ok'</span>: <span class="number">1.0</span>&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œåœ¨ PyMongo 3.x ç‰ˆæœ¬é‡Œï¼Œæ¨èä½¿ç”¨ <code>delete_one()</code> å’Œ <code>delete_many()</code> æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>, port=<span class="number">27017</span>)</span><br><span class="line">db = client.spiders</span><br><span class="line">collection = db.students</span><br><span class="line">result = collection.delete_one(&#123;<span class="string">'name'</span>: <span class="string">'AAA'</span>&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.deleted_count)</span><br><span class="line">result = collection.delete_many(&#123;<span class="string">'gender'</span>: <span class="string">'female'</span>&#125;)</span><br><span class="line">print(result.deleted_count)</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ <code>deleted_count</code> å±æ€§å¯ä»¥è·å–åˆ é™¤çš„æ•°æ®æ¡æ•°ï¼Œè¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;pymongo.results.DeleteResult object at <span class="number">0x0000024441B245C8</span>&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>PyMongo å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://api.mongodb.com/python/current/api/pymongo/collection.html" target="_blank" rel="noopener">http://api.mongodb.com/python/current/api/pymongo/collection.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åä¸€ç«  â€”â€” ã€MongoDBæ•°æ®å‚¨å­˜ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="MongoDB" scheme="https://www.itrhx.com/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C10</title>
    <link href="https://www.itrhx.com/2019/09/03/A40-Python3-spider-C10/"/>
    <id>https://www.itrhx.com/2019/09/03/A40-Python3-spider-C10/</id>
    <published>2019-09-03T15:39:27.326Z</published>
    <updated>2019-09-24T12:40:41.602Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åç«  â€”â€” ã€MySQLæ•°æ®å‚¨å­˜ã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€10-1ã€‘MySQL-åŸºæœ¬æ“ä½œè¯­å¥"><a href="#ã€10-1ã€‘MySQL-åŸºæœ¬æ“ä½œè¯­å¥" class="headerlink" title="ã€10.1ã€‘MySQL åŸºæœ¬æ“ä½œè¯­å¥"></a><font color="#ff0000">ã€10.1ã€‘MySQL åŸºæœ¬æ“ä½œè¯­å¥</font></h1><p>å®‰è£…å®Œ MySQL åï¼Œæ‰“å¼€ MySQL x.x Command Line Client - Unicodeï¼Œè¾“å…¥å¯†ç å³å¯ç™»å½• MySQLï¼Œä¹Ÿå¯åœ¨ MySQL å®‰è£…ç›®å½•ä¸‹æ‰“å¼€ cmd ä½¿ç”¨å‘½ä»¤ç™»å½•æ•°æ®åº“</p><h2 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># è¿æ¥æ•°æ®åº“</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"># é€€å‡ºæ•°æ®åº“</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªæ•°æ®åº“</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> X;</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ä¸€ä¸ªæ•°æ®åº“</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> X;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“</span><br><span class="line"><span class="keyword">USE</span> X;</span><br></pre></td></tr></table></figure><h2 id="è¡¨æ“ä½œ"><a href="#è¡¨æ“ä½œ" class="headerlink" title="è¡¨æ“ä½œ"></a>è¡¨æ“ä½œ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹æ‰€æœ‰çš„è¡¨</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span> ;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªè¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> n(<span class="keyword">id</span> <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>));</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> m(<span class="keyword">id</span> <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>), PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>), FOREIGN <span class="keyword">KEY</span> (<span class="keyword">id</span>) <span class="keyword">REFERENCES</span> n(<span class="keyword">id</span>), <span class="keyword">UNIQUE</span> (<span class="keyword">name</span>));</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> m(<span class="keyword">id</span> <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"># ç›´æ¥å°†æŸ¥è¯¢ç»“æœå¯¼å…¥æˆ–å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> n <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> m;</span><br><span class="line"></span><br><span class="line"># æ–°åˆ›å»ºçš„è¡¨ä¸ä¸€ä¸ªå­˜åœ¨çš„è¡¨çš„æ•°æ®ç»“æ„ç±»ä¼¼</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> m <span class="keyword">LIKE</span> n;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨</span><br><span class="line"># ä¸´æ—¶è¡¨å°†åœ¨ä½ è¿æ¥MySQLæœŸé—´å­˜åœ¨ã€‚å½“æ–­å¼€è¿æ¥æ—¶ï¼ŒMySQLå°†è‡ªåŠ¨åˆ é™¤è¡¨å¹¶é‡Šæ”¾æ‰€ç”¨çš„ç©ºé—´ã€‚ä¹Ÿå¯æ‰‹åŠ¨åˆ é™¤ã€‚</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> l(<span class="keyword">id</span> <span class="built_in">INT</span>, <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"># ç›´æ¥å°†æŸ¥è¯¢ç»“æœå¯¼å…¥æˆ–å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„ä¸´æ—¶è¡¨</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> tt <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> n;</span><br><span class="line"></span><br><span class="line"># åˆ é™¤ä¸€ä¸ªå­˜åœ¨è¡¨</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> m;</span><br><span class="line"></span><br><span class="line"># æ›´æ”¹å­˜åœ¨è¡¨çš„åç§°</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">RENAME</span> m;</span><br><span class="line"><span class="keyword">RENAME</span> <span class="keyword">TABLE</span> n <span class="keyword">TO</span> m;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¡¨çš„ç»“æ„(ä»¥ä¸‹äº”æ¡è¯­å¥æ•ˆæœç›¸åŒï¼‰</span><br><span class="line">DESC n;</span><br><span class="line"><span class="keyword">DESCRIBE</span> n;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLUMNS</span> <span class="keyword">IN</span> n;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLUMNS</span> <span class="keyword">FROM</span> n;</span><br><span class="line"><span class="keyword">EXPLAIN</span> n;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¡¨çš„åˆ›å»ºè¯­å¥</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> n;</span><br></pre></td></tr></table></figure><h2 id="è¡¨çš„ç»“æ„"><a href="#è¡¨çš„ç»“æ„" class="headerlink" title="è¡¨çš„ç»“æ„"></a>è¡¨çš„ç»“æ„</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ å­—æ®µ</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">ADD</span> age <span class="built_in">VARCHAR</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å­—æ®µæ—¶è®¾å®šä½ç½®</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">ADD</span> age <span class="built_in">VARCHAR</span>(<span class="number">2</span>)  <span class="keyword">FIRST</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">ADD</span> age <span class="built_in">VARCHAR</span>(<span class="number">2</span>)  <span class="keyword">AFTER</span> <span class="keyword">name</span>;</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å­—æ®µåœ¨è¡¨ä¸­çš„ä½ç½®</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">MODIFY</span> age <span class="built_in">VARCHAR</span>(<span class="number">2</span>) <span class="keyword">AFTER</span> <span class="keyword">name</span>;</span><br><span class="line"></span><br><span class="line"># åˆ é™¤å­—æ®µ</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">DROP</span> age;</span><br><span class="line"></span><br><span class="line"># æ›´æ”¹å­—æ®µå±æ€§å’Œå±æ€§</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">CHANGE</span> age a <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line"># åªæ›´æ”¹å­—æ®µå±æ€§</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> n <span class="keyword">MODIFY</span> age <span class="built_in">VARCHAR</span>(<span class="number">7</span>) ;</span><br><span class="line"></span><br><span class="line"># æ”¹å˜è¡¨çš„å­˜å‚¨å¼•æ“</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t <span class="keyword">ENGINE</span> myisam;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t <span class="keyword">ENGINE</span> <span class="keyword">innodb</span>;</span><br><span class="line"></span><br><span class="line"># è®¾å®šè‡ªå¢ åˆå§‹ä¸º1ï¼Œåªèƒ½ä¸€ä¸ªå­—æ®µä½¿ç”¨ï¼Œè¯¥å­—æ®µä¸ºä¸»é”®çš„ä¸€éƒ¨åˆ†</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t AUTO_INCREMENT = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h2 id="è¡¨çš„æ•°æ®"><a href="#è¡¨çš„æ•°æ®" class="headerlink" title="è¡¨çš„æ•°æ®"></a>è¡¨çš„æ•°æ®</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># å¢åŠ æ•°æ®</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> n <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">'tom'</span>, <span class="string">'23'</span>), (<span class="number">2</span>, <span class="string">'john'</span>, <span class="string">'22'</span>);</span><br><span class="line">INSERT INTO n SELECT * FROM n;  # æŠŠæ•°æ®å¤åˆ¶ä¸€éé‡æ–°æ’å…¥</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æ•°æ®</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> n <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"># æ›´æ”¹æ•°æ®</span><br><span class="line"><span class="keyword">UPDATE</span> n <span class="keyword">SET</span> <span class="keyword">name</span> = <span class="string">'tom'</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"># æ•°æ®æŸ¥æ‰¾</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> n <span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%h%'</span>;</span><br><span class="line"></span><br><span class="line"># æ•°æ®æ’åº(ååº)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> n <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">name</span>, <span class="keyword">id</span> <span class="keyword">DESC</span> ;</span><br></pre></td></tr></table></figure><h1 id="ã€10-2ã€‘Python-è¿æ¥-MySQL"><a href="#ã€10-2ã€‘Python-è¿æ¥-MySQL" class="headerlink" title="ã€10.2ã€‘Python è¿æ¥ MySQL"></a><font color="#ff0000">ã€10.2ã€‘Python è¿æ¥ MySQL</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">cursor.execute(<span class="string">'SELECT VERSION()'</span>)</span><br><span class="line">data = cursor.fetchone()</span><br><span class="line">print(<span class="string">'Database version:'</span>, data)</span><br><span class="line">cursor.execute(<span class="string">"CREATE DATABASE spiders DEFAULT CHARACTER SET utf8mb4"</span>)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>é€šè¿‡ PyMySQL çš„ connect æ–¹æ³•å£°æ˜ä¸€ä¸ª MySQL è¿æ¥å¯¹è±¡ dbï¼Œå½“å‰ MySQL æ•°æ®åº“è¿è¡Œåœ¨æœ¬åœ°ï¼Œè®¾å®š <code>host=&#39;localhost&#39;</code>ï¼Œç”¨æˆ·åä¸º <code>root</code>ï¼Œç™»å½•å¯†ç ä¸º <code>000000</code>ï¼Œè¿è¡Œåœ¨ <code>3306</code> ç«¯å£ï¼Œè°ƒç”¨ <code>cursor()</code> æ–¹æ³•è·å¾— MySQL çš„æ“ä½œæ¸¸æ ‡ï¼Œè¯¥æ¸¸æ ‡ç”¨æ¥æ‰§è¡Œ SQL è¯­å¥ï¼Œé€šè¿‡æ¸¸æ ‡æ“ä½œ <code>execute()</code> æ–¹æ³•å†™å…¥ SQL è¯­å¥ï¼Œç¬¬ä¸€æ¡ SQL è¯­å¥è·å– MySQL çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè°ƒç”¨ <code>fetchone()</code> æ–¹æ³•è·å¾—ç¬¬ä¸€æ¡æ•°æ®ï¼Œå³ MySQL çš„ç‰ˆæœ¬å·ã€‚ç¬¬äºŒæ¡ SQL è¯­å¥æ‰§è¡Œåˆ›å»º spiders æ•°æ®åº“çš„æ“ä½œï¼Œç¼–ç ä¸º utf8mb4ï¼Œè¿è¡Œè¯¥æ®µä»£ç å°†è¾“å‡º MySQL çš„ç‰ˆæœ¬å·ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Database version: (<span class="string">'8.0.17'</span>,)</span><br></pre></td></tr></table></figure><h1 id="ã€10-3ã€‘åˆ›å»ºè¡¨"><a href="#ã€10-3ã€‘åˆ›å»ºè¡¨" class="headerlink" title="ã€10.3ã€‘åˆ›å»ºè¡¨"></a><font color="#ff0000">ã€10.3ã€‘åˆ›å»ºè¡¨</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'CREATE TABLE IF NOT EXISTS students (id VARCHAR(255) NOT NULL, name VARCHAR(255) NOT NULL, age VARCHAR(255) NOT NULL, PRIMARY KEY (id))'</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>è¯¥æ®µä»£ç å®ç°äº†åœ¨ spiders æ•°æ®åº“é‡Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º students çš„è¡¨ï¼ŒåŒ…å« idã€nameã€age ä¸‰ä¸ªå­—æ®µï¼Œç±»å‹ä¾æ¬¡ä¸º varcharã€varcharã€int</p><h1 id="ã€10-4ã€‘æ’å…¥æ•°æ®"><a href="#ã€10-4ã€‘æ’å…¥æ•°æ®" class="headerlink" title="ã€10.4ã€‘æ’å…¥æ•°æ®"></a><font color="#ff0000">ã€10.4ã€‘æ’å…¥æ•°æ®</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">id = <span class="string">'17110105'</span></span><br><span class="line">user = <span class="string">'TRH'</span></span><br><span class="line">age = <span class="number">20</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'INSERT INTO students(id, name, age) values(%s, %s, %s)'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql, (id, user, age))</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p><code>commit()</code> æ–¹æ³•çš„ä½œç”¨æ˜¯å®ç°æ•°æ®æ’å…¥ï¼Œæ˜¯çœŸæ­£å°†è¯­å¥æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œçš„æ–¹æ³•ï¼Œä½¿ç”¨ <code>try except</code> è¯­å¥å®ç°å¼‚å¸¸å¤„ç†ï¼Œå¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨ <code>rollback()</code> æ–¹æ³•æ‰§è¡Œæ•°æ®å›æ»šï¼Œä¿è¯åŸæ•°æ®ä¸è¢«ç ´åï¼Œä½¿ç”¨æŸ¥è¯¢è¯­å¥å¯ä»¥çœ‹åˆ°å·²ç»æ’å…¥çš„æ•°æ®ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A40/01.png" alt="01"><br></fancybox><p>è¿›é˜¶æ“ä½œï¼šå°†éœ€è¦æ’å…¥çš„æ•°æ®æ„é€ æˆä¸€ä¸ªå­—å…¸ï¼Œè¿™æ ·çš„åšæ³•å¯ä»¥è®©æ’å…¥æ–¹æ³•æ— éœ€æ”¹åŠ¨ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ªåŠ¨æ€å˜åŒ–çš„å­—å…¸å°±è¡Œäº†ï¼Œæ”¹å†™åŸæ¥çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110105'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRH'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = <span class="string">', '</span>.join(data.keys())</span><br><span class="line">values = <span class="string">', '</span>.join([<span class="string">'%s'</span>]*len(data))</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;)'</span>.format(table=table, keys=keys, values=values)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql, tuple(data.values()))</span><br><span class="line">    print(<span class="string">'æ•°æ®æ’å…¥æˆåŠŸï¼'</span>)</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'æ•°æ®æ’å…¥å¤±è´¥ï¼'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>ä¼ å…¥çš„æ•°æ˜¯å­—å…¸ï¼Œå°†å…¶å®šä¹‰ä¸º data å˜é‡ï¼Œè¡¨åå®šä¹‰æˆå˜é‡ tableï¼Œæ„é€ æ’å…¥çš„å­—æ®µ idã€name å’Œ ageã€‚<code>&#39;, &#39;.join(data.keys())</code>  çš„ç»“æœå°±æ˜¯ id, name, ageï¼Œæ¥ç€éœ€è¦æ„é€ å¤šä¸ª <code>%s</code> å½“ä½œå ä½ç¬¦ï¼Œæœ‰ä¸‰ä¸ªå­—æ®µï¼Œå°±éœ€è¦æ„é€  <code>%s, %s, %s</code>ã€‚é¦–å…ˆå®šä¹‰é•¿åº¦ä¸º 1 çš„æ•°ç»„ <code>[&#39;%s&#39;]</code>ï¼Œç„¶åç”¨ä¹˜æ³•å°†å…¶æ‰©å……ä¸º <code>[&#39;%s&#39;, &#39;%s&#39;, &#39;%s&#39;]</code>ï¼Œå†è°ƒç”¨ <code>join()</code> æ–¹æ³•ï¼Œæœ€ç»ˆå˜æˆ <code>%s, %s, %s</code>ã€‚å†åˆ©ç”¨å­—ç¬¦ä¸²çš„ <code>format()</code> æ–¹æ³•å°†è¡¨åã€å­—æ®µåå’Œå ä½ç¬¦æ„é€ å‡ºæ¥ã€‚æœ€ç»ˆçš„ SQL è¯­å¥å°±è¢«åŠ¨æ€æ„é€ æˆäº†å¦‚ä¸‹è¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students(id, name, age) VALUES (%s, %s, %s)</span><br></pre></td></tr></table></figure><h1 id="ã€10-5ã€‘æ›´æ–°æ•°æ®"><a href="#ã€10-5ã€‘æ›´æ–°æ•°æ®" class="headerlink" title="ã€10.5ã€‘æ›´æ–°æ•°æ®"></a><font color="#ff0000">ã€10.5ã€‘æ›´æ–°æ•°æ®</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>: <span class="string">'17110105'</span>,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRH'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = <span class="string">', '</span>.join(data.keys())</span><br><span class="line">values = <span class="string">', '</span>.join([<span class="string">'%s'</span>]*len(data))</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE'</span>.format(table=table, keys=keys, values=values)</span><br><span class="line">update = <span class="string">','</span>.join([<span class="string">"&#123;key&#125; = % s"</span>.format(key=key) <span class="keyword">for</span> key <span class="keyword">in</span> data])</span><br><span class="line">sql += update</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql, tuple(data.values())*<span class="number">2</span>):</span><br><span class="line">        print(<span class="string">'æ•°æ®æ’å…¥æˆåŠŸï¼'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'æ•°æ®æ’å…¥å¤±è´¥ï¼'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p><code>ON DUPLICATE KEY UPDATE</code> è¡¨ç¤ºå¦‚æœä¸»é”®å·²ç»å­˜åœ¨ï¼Œå°±æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œæœ€ç»ˆè¢«æ„é€ æˆå¦‚ä¸‹è¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students(id, name, age) VALUES (% s, % s, % s) ON DUPLICATE KEY UPDATE id = % s, name = % s, age = % s</span><br></pre></td></tr></table></figure><h1 id="ã€10-6ã€‘åˆ é™¤æ•°æ®"><a href="#ã€10-6ã€‘åˆ é™¤æ•°æ®" class="headerlink" title="ã€10.6ã€‘åˆ é™¤æ•°æ®"></a><font color="#ff0000">ã€10.6ã€‘åˆ é™¤æ•°æ®</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">condition = <span class="string">'age = 20'</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'DELETE FROM  &#123;table&#125; WHERE &#123;condition&#125;'</span>.format(table=table, condition=condition)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    print(<span class="string">'æ•°æ®åˆ é™¤æˆåŠŸï¼'</span>)</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'æ•°æ®åˆ é™¤å¤±è´¥ï¼'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ“ä½œç›´æ¥ä½¿ç”¨ <code>DELETE</code> è¯­å¥ï¼ŒæŒ‡å®šè¦åˆ é™¤çš„ç›®æ ‡è¡¨åå’Œåˆ é™¤æ¡ä»¶å³å¯</p><h1 id="ã€10-7ã€‘æŸ¥è¯¢æ•°æ®"><a href="#ã€10-7ã€‘æŸ¥è¯¢æ•°æ®" class="headerlink" title="ã€10.7ã€‘æŸ¥è¯¢æ•°æ®"></a><font color="#ff0000">ã€10.7ã€‘æŸ¥è¯¢æ•°æ®</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;= 20'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    print(<span class="string">'Count:'</span>, cursor.rowcount)</span><br><span class="line">    one = cursor.fetchone()</span><br><span class="line">    print(<span class="string">'One:'</span>, one)</span><br><span class="line">    results = cursor.fetchall()</span><br><span class="line">    print(<span class="string">'Results:'</span>, results)</span><br><span class="line">    print(<span class="string">'Results Type:'</span>, type(results))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">        print(row)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'æŸ¥è¯¢å¤±è´¥ï¼'</span>)</span><br></pre></td></tr></table></figure><p><code>sql = &#39;SELECT * FROM students WHERE age &gt;= 20&#39;</code>ï¼šæ„é€ ä¸€æ¡ SQL è¯­å¥ï¼Œå°†å¹´é¾„ å¤§äºç­‰äº20 å²çš„å­¦ç”ŸæŸ¥è¯¢å‡ºæ¥</p><p><code>cursor.rowcount</code>ï¼šè°ƒç”¨ cursor çš„ rowcount å±æ€§è·å–æŸ¥è¯¢ç»“æœçš„æ¡æ•°</p><p><code>cursor.fetchone()</code>ï¼šè°ƒç”¨ cursor çš„ fetchone() æ–¹æ³•ï¼Œè·å–ç»“æœçš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œè¿”å›ç»“æœæ˜¯å…ƒç»„å½¢å¼ï¼Œå…ƒç»„çš„å…ƒç´ é¡ºåºè·Ÿå­—æ®µä¸€ä¸€å¯¹åº”ï¼Œå³ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µ idï¼Œç¬¬äºŒä¸ªå…ƒç´ å°±æ˜¯ç¬¬äºŒä¸ªå­—æ®µ nameï¼Œä»¥æ­¤ç±»æ¨</p><p><code>cursor.fetchall()</code>ï¼šè°ƒç”¨ cursor çš„ fetchall() æ–¹æ³•ï¼Œå¾—åˆ°ç»“æœçš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒæ˜¯äºŒé‡å…ƒç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€æ¡è®°å½•ï¼Œæœ¬ä¾‹ä¸­æ˜¾ç¤ºçš„æ˜¯ 3 æ¡æ•°æ®è€Œä¸æ˜¯ 4 æ¡ï¼Œè¿™æ˜¯å› ä¸ºå®ƒçš„å†…éƒ¨å®ç°æœ‰ä¸€ä¸ªåç§»æŒ‡é’ˆç”¨æ¥æŒ‡å‘æŸ¥è¯¢ç»“æœï¼Œæœ€å¼€å§‹åç§»æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€æ¡æ•°æ®ï¼Œå–ä¸€æ¬¡ä¹‹åï¼ŒæŒ‡é’ˆåç§»åˆ°ä¸‹ä¸€æ¡æ•°æ®ï¼Œè¿™æ ·å†å–çš„è¯ï¼Œå°±ä¼šå–åˆ°ä¸‹ä¸€æ¡æ•°æ®äº†ã€‚æˆ‘ä»¬æœ€åˆè°ƒç”¨äº†ä¸€æ¬¡ fetchone æ–¹æ³•ï¼Œè¿™æ ·ç»“æœçš„åç§»æŒ‡é’ˆå°±æŒ‡å‘ä¸‹ä¸€æ¡æ•°æ®ï¼Œfetchall æ–¹æ³•è¿”å›çš„æ˜¯åç§»æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®ä¸€ç›´åˆ°ç»“æŸçš„æ‰€æœ‰æ•°æ®ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•è·å–çš„ç»“æœå°±åªå‰© 3 ä¸ªäº†</p><h1 id="ã€10-8ã€‘å®æˆ˜è®­ç»ƒ-â€”-çˆ¬å–CSDNåšå®¢æ ‡é¢˜å’Œåœ°å€ä¿å­˜åˆ°-MySQL"><a href="#ã€10-8ã€‘å®æˆ˜è®­ç»ƒ-â€”-çˆ¬å–CSDNåšå®¢æ ‡é¢˜å’Œåœ°å€ä¿å­˜åˆ°-MySQL" class="headerlink" title="ã€10.8ã€‘å®æˆ˜è®­ç»ƒ â€” çˆ¬å–CSDNåšå®¢æ ‡é¢˜å’Œåœ°å€ä¿å­˜åˆ° MySQL"></a><font color="#ff0000">ã€10.8ã€‘å®æˆ˜è®­ç»ƒ â€” çˆ¬å–CSDNåšå®¢æ ‡é¢˜å’Œåœ°å€ä¿å­˜åˆ° MySQL</font></h1><p>åˆ©ç”¨ requests åº“æ„å»ºè¯·æ±‚ï¼ŒBeautifulSoup è§£æåº“è§£æç½‘é¡µï¼Œè·å–è‡ªå·±åšå®¢æ–‡ç« çš„æ ‡é¢˜å’Œåœ°å€ï¼Œå°†å…¶å‚¨å­˜åˆ°æœ¬åœ° MySQL æ•°æ®åº“ä¸­ï¼Œäº‹å…ˆå·²ç»åˆ›å»ºå¥½äº†ä¸€ä¸ª blog æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªåä¸º article çš„æ•°æ®è¡¨ï¼Œæ•°æ®è¡¨åŒ…å« idã€titleã€url ä¸‰ä¸ªå­—æ®µï¼Œå…¶ä¸­ id çš„ <code>AUTO_INCREMENT</code> å±æ€§å¯ä»¥ä½¿ id è‡ªå·±å¢åŠ ï¼Œ<code>PRIMARY KEY</code> å…³é”®å­—ç”¨äºå°† id å®šä¹‰ä¸ºä¸»é”®</p><p>åˆ›å»º article æ•°æ®è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'blog'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'CREATE TABLE IF NOT EXISTS article (id INT NOT NULL AUTO_INCREMENT, title VARCHAR(255) NOT NULL, url VARCHAR(255) NOT NULL, PRIMARY KEY (id))'</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>è·å–æ–‡ç« æ ‡é¢˜å’Œå¯¹åº”çš„ URL å¹¶å°†å…¶å‚¨å­˜åˆ° MySQL ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">'000000'</span>, port=<span class="number">3306</span>, db=<span class="string">'blog'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">"https://blog.csdn.net/qq_36759224"</span></span><br><span class="line"></span><br><span class="line">request = requests.get(url, headers=headers)</span><br><span class="line">soup = BeautifulSoup(request.text, <span class="string">'lxml'</span>)</span><br><span class="line">title_list = soup.find_all(<span class="string">'h4'</span>)</span><br><span class="line"><span class="keyword">for</span> list <span class="keyword">in</span> title_list:</span><br><span class="line">    s = list.a.text.strip()</span><br><span class="line">    title = s.replace(<span class="string">'åŸ'</span>, <span class="string">''</span>)</span><br><span class="line">    url = list.a[<span class="string">'href'</span>].strip()</span><br><span class="line">    <span class="comment"># print(title + url)</span></span><br><span class="line">    cursor.execute(<span class="string">'INSERT INTO article (title, url) VALUES (%s, %s)'</span>, (title, url))</span><br><span class="line">db.commit()</span><br><span class="line">print(<span class="string">'æ•°æ®å†™å…¥å®Œæ¯•ï¼'</span>)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>SELECT * FROM article;</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°æ•°æ®å·²ç»æˆåŠŸè·å–å¹¶å‚¨å­˜åˆ°äº†æ•°æ®åº“ä¸­ï¼š</p><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TRHX/ImageHosting/ITRHX-PIC/A40/02.png" alt="02"><br></fancybox>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬åç«  â€”â€” ã€MySQLæ•°æ®å‚¨å­˜ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="MySQL" scheme="https://www.itrhx.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C09</title>
    <link href="https://www.itrhx.com/2019/08/27/A39-Python3-spider-C09/"/>
    <id>https://www.itrhx.com/2019/08/27/A39-Python3-spider-C09/</id>
    <published>2019-08-27T10:58:37.295Z</published>
    <updated>2019-10-09T10:40:08.565Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬ä¹ç«  â€”â€” ã€æ–‡ä»¶å‚¨å­˜ã€‘</font></center></blockquote><a id="more"></a><p>ç”¨è§£æå™¨è§£æå‡ºæ•°æ®ä¹‹åï¼Œè¿˜éœ€è¦å¯¹æ•°æ®è¿›è¡Œä¿å­˜ã€‚ä¿å­˜çš„å½¢å¼å¤šç§å¤šæ ·ï¼Œæœ€ç®€å•çš„å½¢å¼æ˜¯ç›´æ¥ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼Œå¦‚ TXTã€JSONã€CSV ç­‰ã€‚</p><h1 id="ã€9-1ã€‘TXT-æ–‡æœ¬å­˜å‚¨"><a href="#ã€9-1ã€‘TXT-æ–‡æœ¬å­˜å‚¨" class="headerlink" title="ã€9.1ã€‘TXT æ–‡æœ¬å­˜å‚¨"></a><font color="#ff0000">ã€9.1ã€‘TXT æ–‡æœ¬å­˜å‚¨</font></h1><p>TXT æ–‡æœ¬å­˜å‚¨çš„ä¼˜ç‚¹ï¼šæ“ä½œéå¸¸ç®€å•ï¼ŒTXT æ–‡æœ¬å‡ ä¹å…¼å®¹ä»»ä½•å¹³å°ï¼›ç¼ºç‚¹ï¼šä¸åˆ©äºæ£€ç´¢ã€‚</p><h2 id="ã€9-1-1ã€‘åŸºæœ¬ç¤ºä¾‹"><a href="#ã€9-1-1ã€‘åŸºæœ¬ç¤ºä¾‹" class="headerlink" title="ã€9.1.1ã€‘åŸºæœ¬ç¤ºä¾‹"></a><font color="#ff0000">ã€9.1.1ã€‘åŸºæœ¬ç¤ºä¾‹</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">"https://blog.csdn.net/qq_36759224"</span></span><br><span class="line"></span><br><span class="line">request = requests.get(url, headers=headers)</span><br><span class="line">tree = etree.HTML(request.text)</span><br><span class="line">title_list = tree.xpath(<span class="string">'//h4/a/text()'</span>)</span><br><span class="line"><span class="keyword">for</span> title <span class="keyword">in</span> title_list:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'blog.txt'</span>, <span class="string">'a'</span>, encoding=<span class="string">'utf8'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(title)</span><br></pre></td></tr></table></figure><p>ä»£ç å®ç°äº†æˆ‘çš„ CSDN åšå®¢é¦–é¡µæ‰€æœ‰åšæ–‡æ ‡é¢˜çš„çˆ¬å–ï¼Œåˆ©ç”¨ requests è¯·æ±‚åº“å‘é€è¯·æ±‚ï¼Œè·å–å“åº”ï¼Œç”¨ XPath è·å–æ¯ä¸€ç¯‡åšæ–‡çš„æ ‡é¢˜ï¼Œç„¶åå†™å…¥ blog.txt æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">å¸éƒ½çš„å‡›å†¬</span><br><span class="line">    æœ€æ–°å±è”½ CSDN å¹¿å‘Šæ–¹æ³•ï¼Œä¸“æ³¨é˜…è¯»å­¦ä¹ ï¼      </span><br><span class="line">    ä½¿ç”¨Github Pageså’ŒHexoæ­å»ºè‡ªå·±çš„ç‹¬ç«‹åšå®¢ã€è¶…çº§è¯¦ç»†çš„å°ç™½æ•™ç¨‹ã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C08ã€è§£æåº“ Beautiful Soupã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C07 ã€è§£æåº“ lxmlã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C06 ã€æ­£åˆ™è¡¨è¾¾å¼ã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C05 ã€Selenium + æ— ç•Œé¢æµè§ˆå™¨ã€‘      </span><br><span class="line">    Python3 å·²ç»å®‰è£…ç›¸å…³åº“ï¼ŒPycharm ä»ç„¶æŠ¥é”™ ModuleNotFoundError: No module named &apos;xxxxxx&apos; çš„è§£å†³åŠæ³•      </span><br><span class="line">    Windows/Android/iOS ç­‰å¸¸è§ User-Agent å¤§å…¨      </span><br><span class="line">    Selenium æ˜¾å¼ç­‰å¾…æ¡ä»¶åŠå…¶å«ä¹‰      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C04 ã€è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…· Seleniumã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C03 ã€Ajax æ•°æ®çˆ¬å–ã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C02 ã€åŸºæœ¬åº“ requests çš„ä½¿ç”¨ã€‘      </span><br><span class="line">    Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C01 ã€åŸºæœ¬åº“ urllib çš„ä½¿ç”¨ã€‘      </span><br><span class="line">    åˆ©ç”¨å®˜æ–¹æ”¯æŒä¸ºåŸºäºGitHub Pagesçš„Hexoåšå®¢å¯ç”¨HTTPS      </span><br><span class="line">    å…‰å­¦å­—ç¬¦è¯†åˆ« Tesseract-OCR çš„ä¸‹è½½ã€å®‰è£…å’ŒåŸºæœ¬ç”¨æ³•      </span><br><span class="line">    Github+jsDelivr+PicGo æ‰“é€ ç¨³å®šå¿«é€Ÿã€é«˜æ•ˆå…è´¹å›¾åºŠ      </span><br><span class="line">    åˆ©ç”¨Cloudflareä¸ºåŸºäºGitHub Pagesçš„Hexoåšå®¢æ·»åŠ HTTPSæ”¯æŒ      </span><br><span class="line">    Python ä¸­ if __name__ == &apos;__main__&apos;: çš„ç†è§£      </span><br><span class="line">    Hexo åšå®¢æœ¬åœ°é¢„è§ˆæŠ¥é”™ï¼šError: listen EADDRINUSE 0.0.0.0:4000      </span><br><span class="line">    è°·æ­Œæµè§ˆå™¨æ£€æŸ¥æ›´æ–°æ—¶å‡ºé”™ï¼šæ— æ³•å¯åŠ¨æ›´æ–°æ£€æŸ¥ï¼ˆé”™è¯¯ä»£ç ä¸º 3: 0x80080005 -- system levelï¼‰</span><br></pre></td></tr></table></figure><h2 id="ã€9-1-2ã€‘æ‰“å¼€æ–¹å¼"><a href="#ã€9-1-2ã€‘æ‰“å¼€æ–¹å¼" class="headerlink" title="ã€9.1.2ã€‘æ‰“å¼€æ–¹å¼"></a><font color="#ff0000">ã€9.1.2ã€‘æ‰“å¼€æ–¹å¼</font></h2><p>open() æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ‰“å¼€æ–¹å¼ï¼Œä¸åŒçš„æ‰“å¼€æ–¹å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>è¯»å†™æ–¹å¼</th><th>å¯å¦è¯»å†™</th><th>è‹¥æ–‡ä»¶ä¸å­˜åœ¨</th><th>å†™å…¥æ–¹å¼</th></tr></thead><tbody><tr><td>r</td><td>è¯»å–</td><td>æŠ¥é”™</td><td>ä¸å¯å†™å…¥</td></tr><tr><td>rb</td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å–</td><td>æŠ¥é”™</td><td>ä¸å¯å†™å…¥</td></tr><tr><td>r+</td><td>è¯»å– + å†™å…¥</td><td>æŠ¥é”™</td><td>è¦†ç›–å†™å…¥</td></tr><tr><td>rb+</td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å–+å†™å…¥</td><td>æŠ¥é”™</td><td>è¦†ç›–å†™å…¥</td></tr><tr><td>w</td><td>å†™å…¥</td><td>åˆ›å»º</td><td>è¦†ç›–å†™å…¥</td></tr><tr><td>wb</td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼å†™å…¥</td><td>åˆ›å»º</td><td>è¦†ç›–å†™å…¥</td></tr><tr><td>w+</td><td>è¯»å– + å†™å…¥</td><td>åˆ›å»º</td><td>è¦†ç›–å†™å…¥</td></tr><tr><td>wb+</td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å–+å†™å…¥</td><td>åˆ›å»º</td><td>è¦†ç›–å†™å…¥</td></tr><tr><td>a</td><td>å†™å…¥</td><td>åˆ›å»º</td><td>é™„åŠ å†™å…¥</td></tr><tr><td>ab</td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼å†™å…¥</td><td>åˆ›å»º</td><td>é™„åŠ å†™å…¥</td></tr><tr><td>a+</td><td>è¯»å– + å†™å…¥</td><td>åˆ›å»º</td><td>é™„åŠ å†™å…¥</td></tr><tr><td>ab+</td><td>ä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å–+å†™å…¥</td><td>åˆ›å»º</td><td>é™„åŠ å†™å…¥</td></tr></tbody></table><h1 id="ã€9-2ã€‘JSON-æ–‡ä»¶å­˜å‚¨"><a href="#ã€9-2ã€‘JSON-æ–‡ä»¶å­˜å‚¨" class="headerlink" title="ã€9.2ã€‘JSON æ–‡ä»¶å­˜å‚¨"></a><font color="#ff0000">ã€9.2ã€‘JSON æ–‡ä»¶å­˜å‚¨</font></h1><p>JSONï¼Œå…¨ç§°ä¸º JavaScript Object Notation, å³ JavaScript å¯¹è±¡æ ‡è®°ï¼Œå®ƒé€šè¿‡å¯¹è±¡å’Œæ•°ç»„çš„ç»„åˆæ¥è¡¨ç¤ºæ•°æ®ï¼Œæ„é€ ç®€æ´ä½†æ˜¯ç»“æ„åŒ–ç¨‹åº¦éå¸¸é«˜ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚</p><h2 id="ã€9-2-1ã€‘å¯¹è±¡å’Œæ•°ç»„"><a href="#ã€9-2-1ã€‘å¯¹è±¡å’Œæ•°ç»„" class="headerlink" title="ã€9.2.1ã€‘å¯¹è±¡å’Œæ•°ç»„"></a><font color="#ff0000">ã€9.2.1ã€‘å¯¹è±¡å’Œæ•°ç»„</font></h2><p>åœ¨ JavaScript è¯­è¨€ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ã€‚å› æ­¤ï¼Œä»»ä½•æ”¯æŒçš„ç±»å‹éƒ½å¯ä»¥é€šè¿‡ JSON æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡ã€æ•°ç»„ç­‰ï¼Œä½†æ˜¯å¯¹è±¡å’Œæ•°ç»„æ˜¯æ¯”è¾ƒç‰¹æ®Šä¸”å¸¸ç”¨çš„ä¸¤ç§ç±»å‹</p><ul><li><p>å¯¹è±¡ï¼šå®ƒåœ¨ JavaScript ä¸­æ˜¯ä½¿ç”¨èŠ±æ‹¬å· {} åŒ…è£¹èµ·æ¥çš„å†…å®¹ï¼Œæ•°æ®ç»“æ„ä¸º {key1ï¼švalue1, key2ï¼švalue2, â€¦} çš„é”®å€¼å¯¹ç»“æ„ã€‚åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œkey ä¸ºå¯¹è±¡çš„å±æ€§ï¼Œvalue ä¸ºå¯¹åº”çš„å€¼ã€‚é”®åå¯ä»¥ä½¿ç”¨æ•´æ•°å’Œå­—ç¬¦ä¸²æ¥è¡¨ç¤ºã€‚å€¼çš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚</p></li><li><p>æ•°ç»„ï¼šæ•°ç»„åœ¨ JavaScript ä¸­æ˜¯æ–¹æ‹¬å· [] åŒ…è£¹èµ·æ¥çš„å†…å®¹ï¼Œæ•°æ®ç»“æ„ä¸º [â€œjavaâ€, â€œjavascriptâ€, â€œvbâ€, â€¦] çš„ç´¢å¼•ç»“æ„ã€‚åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„æ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œå®ƒä¹Ÿå¯ä»¥åƒå¯¹è±¡é‚£æ ·ä½¿ç”¨é”®å€¼å¯¹ï¼Œä½†è¿˜æ˜¯ç´¢å¼•ç”¨å¾—å¤šã€‚åŒæ ·ï¼Œå€¼çš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚</p></li></ul><p>ç¤ºä¾‹ï¼šä¸€ä¸ª JSON å¯¹è±¡</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"TRH"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"male"</span>,</span><br><span class="line">    <span class="attr">"birthday"</span>: <span class="string">"1999-01-25"</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">     <span class="attr">"name"</span>: <span class="string">"XXX"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"female"</span>,</span><br><span class="line">    <span class="attr">"birthday"</span>: <span class="string">"1999-10-18"</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><h2 id="ã€9-2-2ã€‘è¯»å–-JSON"><a href="#ã€9-2-2ã€‘è¯»å–-JSON" class="headerlink" title="ã€9.2.2ã€‘è¯»å– JSON"></a><font color="#ff0000">ã€9.2.2ã€‘è¯»å– JSON</font></h2><p>Python é‡Œé¢çš„ JSON åº“å¯ä»¥å®ç°å¯¹ JSON æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œè°ƒç”¨ JSON åº“çš„ loads æ–¹æ³•å°† JSON æ–‡æœ¬å­—ç¬¦ä¸²è½¬ä¸º JSON å¯¹è±¡ã€ dumps() æ–¹æ³•å°† JSON å¯¹è±¡è½¬ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">str = <span class="string">'''</span></span><br><span class="line"><span class="string">[&#123;</span></span><br><span class="line"><span class="string">    "name": "TRH",</span></span><br><span class="line"><span class="string">    "gender": "male",</span></span><br><span class="line"><span class="string">    "birthday": "1999-01-25"</span></span><br><span class="line"><span class="string">&#125;, &#123;</span></span><br><span class="line"><span class="string">     "name": "XXX",</span></span><br><span class="line"><span class="string">    "gender": "female",</span></span><br><span class="line"><span class="string">    "birthday": "1999-10-18"</span></span><br><span class="line"><span class="string">&#125;]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">data = json.loads(str)</span><br><span class="line">print(data)</span><br><span class="line">print(data[<span class="number">0</span>][<span class="string">'name'</span>])</span><br><span class="line">print(data[<span class="number">0</span>].get(<span class="string">'name'</span>))</span><br><span class="line">print(data[<span class="number">0</span>].get(<span class="string">'age'</span>))</span><br><span class="line">print(data[<span class="number">0</span>].get(<span class="string">'age'</span>, <span class="number">25</span>))</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ loads æ–¹æ³•å°†å­—ç¬¦ä¸²è½¬ä¸º JSON å¯¹è±¡ï¼Œé€šè¿‡ç´¢å¼•æ¥è·å–å¯¹åº”çš„å†…å®¹ï¼Œè·å–é”®å€¼æ—¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä¸­æ‹¬å·åŠ é”®åï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ get æ–¹æ³•ä¼ å…¥é”®åã€‚ä½¿ç”¨ get æ–¹æ³•ï¼Œå¦‚æœé”®åä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šæŠ¥é”™ï¼Œä¼šè¿”å› Noneï¼Œget æ–¹æ³•è¿˜å¯ä»¥ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå³é»˜è®¤å€¼ï¼‰ï¼Œå°è¯•è·å–ä¸€ä¸ªåŸå­—å…¸ä¸­ä¸å­˜åœ¨çš„é”®åï¼Œæ­¤æ—¶é»˜è®¤ä¼šè¿”å› Noneã€‚å¦‚æœä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå³é»˜è®¤å€¼ï¼‰ï¼Œé‚£ä¹ˆåœ¨ä¸å­˜åœ¨çš„æƒ…å†µä¸‹è¿”å›è¯¥é»˜è®¤å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="string">'name'</span>: <span class="string">'TRH'</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>, <span class="string">'birthday'</span>: <span class="string">'1999-01-25'</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'XXX'</span>, <span class="string">'gender'</span>: <span class="string">'female'</span>, <span class="string">'birthday'</span>: <span class="string">'1999-10-18'</span>&#125;]</span><br><span class="line">TRH</span><br><span class="line">TRH</span><br><span class="line"><span class="keyword">None</span></span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure><h2 id="ã€9-2-3ã€‘å†™å…¥-JSON-æ–‡ä»¶"><a href="#ã€9-2-3ã€‘å†™å…¥-JSON-æ–‡ä»¶" class="headerlink" title="ã€9.2.3ã€‘å†™å…¥ JSON æ–‡ä»¶"></a><font color="#ff0000">ã€9.2.3ã€‘å†™å…¥ JSON æ–‡ä»¶</font></h2><p>è°ƒç”¨ dumps æ–¹æ³•å¯ä»¥å°† JSON å¯¹è±¡è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå†è°ƒç”¨æ–‡ä»¶çš„ write æ–¹æ³•å³å¯å†™å…¥æ–‡æœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [&#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRH'</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>: <span class="string">'1999-01-25'</span></span><br><span class="line">&#125;]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(json.dumps(data))</span><br></pre></td></tr></table></figure><p>data.json æ–‡ä»¶ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;<span class="attr">"name"</span>: <span class="string">"TRH"</span>, <span class="attr">"gender"</span>: <span class="string">"male"</span>, <span class="attr">"birthday"</span>: <span class="string">"1999-01-25"</span>&#125;]</span><br></pre></td></tr></table></figure><p>æ·»åŠ å‚æ•° indentï¼ˆä»£è¡¨ç¼©è¿›å­—ç¬¦ä¸ªæ•°ï¼‰ï¼Œå°†ä¼šæ ¼å¼åŒ–è¾“å‡ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [&#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'TRH'</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'male'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>: <span class="string">'1999-01-25'</span></span><br><span class="line">&#125;]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(json.dumps(data, indent=<span class="number">2</span>))</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"TRH"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"male"</span>,</span><br><span class="line">    <span class="attr">"birthday"</span>: <span class="string">"1999-01-25"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¦‚æœ JSON ä¸­åŒ…å«ä¸­æ–‡å­—ç¬¦ï¼Œéœ€è¦æŒ‡å®šå‚æ•° ensure_ascii ä¸º Falseï¼Œå¦å¤–è¿˜è¦è§„å®šæ–‡ä»¶è¾“å‡ºçš„ç¼–ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [&#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'å°æ˜'</span>,</span><br><span class="line">    <span class="string">'gender'</span>: <span class="string">'ç”·'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>: <span class="string">'1999å¹´01æœˆ25æ—¥'</span></span><br><span class="line">&#125;]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(json.dumps(data, indent=<span class="number">2</span>, ensure_ascii=<span class="keyword">False</span>))</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"å°æ˜"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"ç”·"</span>,</span><br><span class="line">    <span class="attr">"birthday"</span>: <span class="string">"1999å¹´01æœˆ25æ—¥"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="ã€9-3ã€‘CSV-æ–‡æœ¬å­˜å‚¨"><a href="#ã€9-3ã€‘CSV-æ–‡æœ¬å­˜å‚¨" class="headerlink" title="ã€9.3ã€‘CSV æ–‡æœ¬å­˜å‚¨"></a><font color="#ff0000">ã€9.3ã€‘CSV æ–‡æœ¬å­˜å‚¨</font></h1><p>CSVï¼ˆComma-Separated Valuesï¼‰æ˜¯é€—å·åˆ†éš”å€¼æˆ–å­—ç¬¦åˆ†éš”å€¼çš„æ–‡ä»¶æ ¼å¼ï¼Œå…¶æ–‡ä»¶ä»¥çº¯æ–‡æœ¬çš„å½¢å¼å‚¨å­˜è¡¨æ ¼æ•°æ®ï¼ˆæ•°å­—å’Œæ–‡æœ¬ï¼‰ï¼ŒCSV æ–‡ä»¶çš„è¡Œä¸è¡Œä¹‹é—´ç”¨æ¢è¡Œç¬¦åˆ†éš”ï¼Œåˆ—ä¸åˆ—ä¹‹é—´ç”¨é€—å·åˆ†éš”</p><h2 id="ã€9-3-1ã€‘å†™å…¥"><a href="#ã€9-3-1ã€‘å†™å…¥" class="headerlink" title="ã€9.3.1ã€‘å†™å…¥"></a><font color="#ff0000">ã€9.3.1ã€‘å†™å…¥</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    writer = csv.writer(csvfile)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10001'</span>, <span class="string">'TRHX'</span>, <span class="number">20</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>])</span><br></pre></td></tr></table></figure><p>æ‰“å¼€ data.csv æ–‡ä»¶ï¼Œè°ƒç”¨ CSV åº“çš„ writer æ–¹æ³•åˆå§‹åŒ–å†™å…¥å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ writerow æ–¹æ³•ä¼ å…¥æ¯è¡Œçš„æ•°æ®å³å¯å®Œæˆå†™å…¥ï¼Œç”¨ Excel æ‰“å¼€ data.csv æ–‡ä»¶å°†æ˜¯è¡¨æ ¼å½¢å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line"></span><br><span class="line"><span class="number">10001</span>,TRHX,<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤æ¯ä¸€è¡Œä¹‹é—´æ˜¯æœ‰ä¸€è¡Œç©ºæ ¼çš„ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•° <code>newline</code> æ¥å»é™¤ç©ºè¡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>, newline=<span class="string">''</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    writer = csv.writer(csvfile)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10001'</span>, <span class="string">'TRHX'</span>, <span class="number">20</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line"><span class="number">10001</span>,TRHX,<span class="number">20</span></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br></pre></td></tr></table></figure><p>åˆ—ä¸åˆ—ä¹‹é—´çš„åˆ†éš”ç¬¦æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œåªéœ€è¦ä¼ å…¥ <code>delimiter</code> å‚æ•°å³å¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    writer = csv.writer(csvfile, delimiter=<span class="string">' '</span>)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10001'</span>, <span class="string">'TRHX'</span>, <span class="number">20</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id name age</span><br><span class="line"></span><br><span class="line"><span class="number">10001</span> TRHX <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="number">10002</span> Bob <span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="number">10003</span> Jordan <span class="number">21</span></span><br></pre></td></tr></table></figure><p>è°ƒç”¨ <code>writerows</code> æ–¹æ³•ä¹Ÿå¯ä»¥åŒæ—¶å†™å…¥å¤šè¡Œï¼Œæ­¤æ—¶å‚æ•°å°±éœ€è¦ä¸ºäºŒç»´åˆ—è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    writer = csv.writer(csvfile, delimiter=<span class="string">' '</span>)</span><br><span class="line">    writer.writerow([<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>])</span><br><span class="line">    writer.writerows([[<span class="string">'10001'</span>, <span class="string">'TRHX'</span>, <span class="number">20</span>], [<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="number">22</span>], [<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="number">21</span>]])</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä»ä¸åŸæ¥çš„ä¸€æ ·</p><p>æ­¤å¤– CSV åº“ä¸­ä¹Ÿæä¾›äº†å­—å…¸çš„å†™å…¥æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10001'</span>, <span class="string">'name'</span>: <span class="string">'TRHX'</span>, <span class="string">'age'</span>: <span class="number">20</span>&#125;)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10002'</span>, <span class="string">'name'</span>: <span class="string">'Bob'</span>, <span class="string">'age'</span>: <span class="number">22</span>&#125;)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>: <span class="string">'10003'</span>, <span class="string">'name'</span>: <span class="string">'Jordan'</span>, <span class="string">'age'</span>: <span class="number">21</span>&#125;)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå®šä¹‰ 3 ä¸ªå­—æ®µï¼Œç”¨ fieldnames è¡¨ç¤ºï¼Œç„¶åå°†å…¶ä¼ ç»™ DictWriter æ¥åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸å†™å…¥å¯¹è±¡ï¼Œæ¥ç€å¯ä»¥è°ƒç”¨ writeheader æ–¹æ³•å…ˆå†™å…¥å¤´ä¿¡æ¯ï¼Œç„¶åå†è°ƒç”¨ writerow æ–¹æ³•ä¼ å…¥ç›¸åº”å­—å…¸å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id,name,age</span><br><span class="line"></span><br><span class="line"><span class="number">10001</span>,TRHX,<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="number">10002</span>,Bob,<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="number">10003</span>,Jordan,<span class="number">21</span></span><br></pre></td></tr></table></figure><h2 id="ã€9-3-2ã€‘è¯»å–"><a href="#ã€9-3-2ã€‘è¯»å–" class="headerlink" title="ã€9.3.2ã€‘è¯»å–"></a><font color="#ff0000">ã€9.3.2ã€‘è¯»å–</font></h2><p>æœ‰å†™å…¥æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ csv åº“æ¥è¯»å– CSV æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    reader = csv.reader(csvfile)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        print(row)</span><br></pre></td></tr></table></figure><p>æ„é€  Reader å¯¹è±¡ï¼Œéå†è¾“å‡ºæ¯è¡Œçš„å†…å®¹ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªåˆ—è¡¨å½¢å¼ã€‚ï¼ˆå¦‚æœ CSV æ–‡ä»¶ä¸­åŒ…å«ä¸­æ–‡çš„è¯ï¼Œè¿˜éœ€è¦æŒ‡å®šæ–‡ä»¶ç¼–ç ï¼‰è¯»å–ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">[<span class="string">'10001'</span>, <span class="string">'TRHX'</span>, <span class="string">'20'</span>]</span><br><span class="line">[<span class="string">'10002'</span>, <span class="string">'Bob'</span>, <span class="string">'22'</span>]</span><br><span class="line">[<span class="string">'10003'</span>, <span class="string">'Jordan'</span>, <span class="string">'21'</span>]</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ pandas çš„ read_csv æ–¹æ³•å°†æ•°æ®ä» CSV ä¸­è¯»å–å‡ºæ¥ï¼ˆpandas æ˜¯åŸºäºNumPy çš„ä¸€ç§å·¥å…·ï¼Œè¯¥å·¥å…·æ˜¯ä¸ºäº†è§£å†³æ•°æ®åˆ†æä»»åŠ¡è€Œåˆ›å»ºçš„ã€‚Pandas çº³å…¥äº†å¤§é‡åº“å’Œä¸€äº›æ ‡å‡†çš„æ•°æ®æ¨¡å‹ï¼Œæä¾›äº†é«˜æ•ˆåœ°æ“ä½œå¤§å‹æ•°æ®é›†æ‰€éœ€çš„å·¥å…·ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">'data.csv'</span>)</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure><p>è¯»å–ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">      id    name  age</span><br><span class="line"><span class="number">0</span>  <span class="number">10001</span>    TRHX   <span class="number">20</span></span><br><span class="line"><span class="number">1</span>  <span class="number">10002</span>     Bob   <span class="number">22</span></span><br><span class="line"><span class="number">2</span>  <span class="number">10003</span>  Jordan   <span class="number">21</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬ä¹ç«  â€”â€” ã€æ–‡ä»¶å‚¨å­˜ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="æ–‡ä»¶å‚¨å­˜" scheme="https://www.itrhx.com/tags/%E6%96%87%E4%BB%B6%E5%82%A8%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C08</title>
    <link href="https://www.itrhx.com/2019/08/26/A38-Python3-spider-C08/"/>
    <id>https://www.itrhx.com/2019/08/26/A38-Python3-spider-C08/</id>
    <published>2019-08-26T13:57:58.870Z</published>
    <updated>2019-09-24T12:40:34.686Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬å…«ç«  â€”â€” ã€è§£æåº“ Beautiful Soupã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€8-1ã€‘å…³äº-Beautiful-Soup"><a href="#ã€8-1ã€‘å…³äº-Beautiful-Soup" class="headerlink" title="ã€8.1ã€‘å…³äº Beautiful Soup"></a><font color="#ff0000">ã€8.1ã€‘å…³äº Beautiful Soup</font></h1><p>Beautiful Soup å¯ä»¥ä» HTML æˆ–è€… XML æ–‡ä»¶ä¸­æå–æ•°æ®ï¼ŒBeautiful Soup å¯ä»¥æä¾›ä¸€äº›ç®€å•çš„ã€Python å¼çš„å‡½æ•°ç”¨æ¥å¤„ç†å¯¼èˆªã€æœç´¢ã€ä¿®æ”¹åˆ†ææ ‘ç­‰ï¼Œå®ƒå€ŸåŠ©ç½‘é¡µçš„ç»“æ„å’Œå±æ€§ç­‰ç‰¹æ€§æ¥è§£æç½‘é¡µï¼Œlxml åªä¼šå±€éƒ¨éå†ï¼Œè€Œ Beautiful Soup æ˜¯åŸºäº HTML DOM çš„ï¼Œä¼šè½½å…¥æ•´ä¸ªæ–‡æ¡£ï¼Œè§£ææ•´ä¸ª DOM æ ‘ï¼Œå› æ­¤æ—¶é—´å’Œå†…å­˜å¼€é”€éƒ½ä¼šå¤§å¾ˆå¤šï¼Œæ‰€ä»¥æ€§èƒ½è¦ä½äºlxml</p><table><thead><tr><th style="text-align:center">æŠ“å–å·¥å…·</th><th style="text-align:center">é€Ÿåº¦</th><th style="text-align:center">ä½¿ç”¨éš¾åº¦</th><th style="text-align:center">å®‰è£…éš¾åº¦</th></tr></thead><tbody><tr><td style="text-align:center">æ­£åˆ™</td><td style="text-align:center">æœ€å¿«</td><td style="text-align:center">å›°éš¾</td><td style="text-align:center">æ— ï¼ˆå†…ç½®ï¼‰</td></tr><tr><td style="text-align:center">lxml</td><td style="text-align:center">å¿«</td><td style="text-align:center">ç®€å•</td><td style="text-align:center">ä¸€èˆ¬</td></tr><tr><td style="text-align:center">BeautifulSoup</td><td style="text-align:center">æ…¢</td><td style="text-align:center">æœ€ç®€å•</td><td style="text-align:center">ç®€å•</td></tr></tbody></table><h1 id="ã€8-2ã€‘Beautiful-Soup-çš„åŸºæœ¬ä½¿ç”¨"><a href="#ã€8-2ã€‘Beautiful-Soup-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ã€8.2ã€‘Beautiful Soup çš„åŸºæœ¬ä½¿ç”¨"></a><font color="#ff0000">ã€8.2ã€‘Beautiful Soup çš„åŸºæœ¬ä½¿ç”¨</font></h1><p>éœ€è¦ä½¿ç”¨å‘½ä»¤ <code>pip install bs4</code> å®‰è£…åº“ï¼ŒBeautiful Soup åœ¨è§£ææ—¶ä¾èµ–è§£æå™¨ï¼Œé™¤äº†æ”¯æŒ Python æ ‡å‡†åº“ä¸­çš„ HTML è§£æå™¨å¤–ï¼Œè¿˜æ”¯æŒä¸€äº›ç¬¬ä¸‰æ–¹è§£æå™¨ï¼š</p><table><thead><tr><th>è§£æå™¨</th><th>ä½¿ç”¨æ–¹æ³•</th><th>ä¼˜åŠ¿</th><th>åŠ£åŠ¿</th></tr></thead><tbody><tr><td>Python æ ‡å‡†åº“</td><td>BeautifulSoup(markup, â€œhtml.parserâ€)</td><td>Python çš„å†…ç½®æ ‡å‡†åº“ã€æ‰§è¡Œé€Ÿåº¦é€‚ä¸­ ã€æ–‡æ¡£å®¹é”™èƒ½åŠ›å¼º</td><td>Python 2.7.3 or 3.2.2) å‰çš„ç‰ˆæœ¬ä¸­æ–‡å®¹é”™èƒ½åŠ›å·®</td></tr><tr><td>LXML HTML è§£æå™¨</td><td>BeautifulSoup(markup, â€œlxmlâ€)</td><td>é€Ÿåº¦å¿«ã€æ–‡æ¡£å®¹é”™èƒ½åŠ›å¼º</td><td>éœ€è¦å®‰è£… C è¯­è¨€åº“</td></tr><tr><td>LXML XML è§£æå™¨</td><td>BeautifulSoup(markup, â€œxmlâ€)</td><td>é€Ÿåº¦å¿«ã€å”¯ä¸€æ”¯æŒ XML çš„è§£æå™¨</td><td>éœ€è¦å®‰è£… C è¯­è¨€åº“</td></tr><tr><td>html5lib</td><td>BeautifulSoup(markup, â€œhtml5libâ€)</td><td>æœ€å¥½çš„å®¹é”™æ€§ã€ä»¥æµè§ˆå™¨çš„æ–¹å¼è§£ææ–‡æ¡£ã€ç”Ÿæˆ HTML5 æ ¼å¼çš„æ–‡æ¡£</td><td>é€Ÿåº¦æ…¢ã€ä¸ä¾èµ–å¤–éƒ¨æ‰©å±•</td></tr></tbody></table><p>åŸºæœ¬ä½¿ç”¨ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="string">'&lt;p&gt;Hello&lt;/p&gt;'</span>, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment"># soup = BeautifulSoup(open('soup.html', encoding='utf8'), 'lxml')</span></span><br><span class="line">print(soup.p.string)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello</span><br></pre></td></tr></table></figure></p><h1 id="ã€8-3ã€‘èŠ‚ç‚¹é€‰æ‹©å™¨"><a href="#ã€8-3ã€‘èŠ‚ç‚¹é€‰æ‹©å™¨" class="headerlink" title="ã€8.3ã€‘èŠ‚ç‚¹é€‰æ‹©å™¨"></a><font color="#ff0000">ã€8.3ã€‘èŠ‚ç‚¹é€‰æ‹©å™¨</font></h1><p>ç›´æ¥è°ƒç”¨èŠ‚ç‚¹çš„åç§°å°±å¯ä»¥é€‰æ‹©èŠ‚ç‚¹å…ƒç´ ï¼Œå†è°ƒç”¨ string å±æ€§å°±å¯ä»¥å¾—åˆ°èŠ‚ç‚¹å†…çš„æ–‡æœ¬</p><h2 id="ã€8-3-1ã€‘å…ƒç´ é€‰æ‹©"><a href="#ã€8-3-1ã€‘å…ƒç´ é€‰æ‹©" class="headerlink" title="ã€8.3.1ã€‘å…ƒç´ é€‰æ‹©"></a><font color="#ff0000">ã€8.3.1ã€‘å…ƒç´ é€‰æ‹©</font></h2><p>æ–°å»º <code>soup.html</code> æ–‡ä»¶ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span> /&gt;</span><br><span class="line">    &lt;title&gt;æµ‹è¯•bs4&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    ç”„å§¬</span><br><span class="line">    &lt;p&gt;ç™¾é‡Œå®ˆçº¦&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;æç™½&lt;/p&gt;</span><br><span class="line">    å¤ªä¹™çœŸäºº</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class="song"&gt;</span><br><span class="line">    &lt;p&gt;ææ¸…ç…§&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;ç‹å®‰çŸ³&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;è‹è½¼&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;æŸ³å®—å…ƒ&lt;/p&gt;</span><br><span class="line">    &lt;a href="http://www.song.com/" title="èµµåŒ¡ä¹‰" target="_self"&gt;å®‹æœæ˜¯æœ€å¼ºå¤§çš„ç‹æœï¼Œä¸æ˜¯å†›é˜Ÿçš„å¼ºå¤§ï¼Œè€Œæ˜¯ç»æµå¾ˆå¼ºå¤§ï¼Œå›½æ°‘éƒ½å¾ˆæœ‰é’±ã€‚&lt;/a&gt;</span><br><span class="line">    &lt;img src=<span class="string">"http://www.baidu.com/meinv.jpg"</span> alt=<span class="string">""</span>&gt;</span><br><span class="line">    &lt;a href="" class="du"&gt;æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class="tang"&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href="http://www.baidu.com" title="qing"&gt;æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚&lt;/a&gt; &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href="http://www.163.com" title="qin"&gt;ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³ï¼Œä¸‡é‡Œé•¿å¾äººæœªè¿˜ï¼Œä½†ä½¿é¾™åŸé£å°†åœ¨ï¼Œä¸æ•™èƒ¡é©¬åº¦é˜´å±±ã€‚&lt;/a&gt; &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href="http://www.126.com" alt="qi"&gt;å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚&lt;/a&gt; &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href="http://www.sina.com" class="du"&gt;æœç”«&lt;/a&gt; &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;b&gt;å”æœ&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;i&gt;å®‹æœ&lt;/i&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href="http://www.haha.com" id="feng"&gt;å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚&lt;/a&gt; &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(open(<span class="string">'soup.html'</span>, encoding=<span class="string">'utf8'</span>), <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title)</span><br><span class="line">print(type(soup.title))</span><br><span class="line">print(soup.title.string)</span><br><span class="line">print(soup.head)</span><br><span class="line">print(soup.p)</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡æŸ¥æ‰¾ titleã€headã€p èŠ‚ç‚¹ã€‚è¾“å‡ºç»“æœï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;æµ‹è¯•bs4&lt;/title&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>'&gt;</span></span><br><span class="line"><span class="class">æµ‹è¯•<span class="title">bs4</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">&lt;meta charset="utf-8"/&gt;</span><br><span class="line">&lt;title&gt;æµ‹è¯•bs4&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;p&gt;ç™¾é‡Œå®ˆçº¦&lt;/p&gt;</span><br></pre></td></tr></table></figure></p><h2 id="ã€8-3-2ã€‘æå–ä¿¡æ¯"><a href="#ã€8-3-2ã€‘æå–ä¿¡æ¯" class="headerlink" title="ã€8.3.2ã€‘æå–ä¿¡æ¯"></a><font color="#ff0000">ã€8.3.2ã€‘æå–ä¿¡æ¯</font></h2><ul><li>string å±æ€§ï¼šè·å–èŠ‚ç‚¹åŒ…å«çš„æ–‡æœ¬å€¼ï¼ˆå¦‚æœæ ‡ç­¾é‡Œé¢è¿˜æœ‰æ ‡ç­¾ï¼Œé‚£ä¹ˆstringè·å–åˆ°çš„ç»“æœä¸ºNoneï¼‰</li><li>text å±æ€§ï¼šè·å–èŠ‚ç‚¹åŒ…å«çš„æ–‡æœ¬å€¼</li><li>get_text() å±æ€§ï¼šè·å–èŠ‚ç‚¹åŒ…å«çš„æ–‡æœ¬å€¼</li><li>name å±æ€§ï¼šè·å–èŠ‚ç‚¹çš„åç§°</li><li>attrs ï¼šè·å–æ‰€æœ‰å±æ€§</li><li>attrs[â€˜å±æ€§åâ€™] ï¼šè·å–æŒ‡å®šå±æ€§</li></ul><p>ä¾ç„¶ä»¥ soup.html ä¸ºä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(open(<span class="string">'soup.html'</span>, encoding=<span class="string">'utf8'</span>), <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title)</span><br><span class="line">print(soup.title.text)</span><br><span class="line">print(soup.title.get_text())</span><br><span class="line">print(soup.title.string)</span><br><span class="line">print(soup.div.string)</span><br><span class="line">print(soup.div.text)</span><br><span class="line">print(soup.title.name)</span><br><span class="line">print(soup.a[<span class="string">'href'</span>])  <span class="comment"># è·å–hrefå±æ€§</span></span><br><span class="line">print(soup.a[<span class="string">'title'</span>])  <span class="comment"># è·å–titleå±æ€§</span></span><br><span class="line">print(soup.a[<span class="string">'target'</span>])  <span class="comment"># è·å–targetå±æ€§</span></span><br><span class="line">print(soup.a.attrs)  <span class="comment"># è·å–æ‰€æœ‰å±æ€§</span></span><br><span class="line">print(soup.a.attrs[<span class="string">'href'</span>])  <span class="comment"># è·å–hrefå±æ€§</span></span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;æµ‹è¯•bs4&lt;/title&gt;</span><br><span class="line">æµ‹è¯•bs4</span><br><span class="line">æµ‹è¯•bs4</span><br><span class="line">æµ‹è¯•bs4</span><br><span class="line"><span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    ç”„å§¬</span><br><span class="line">    ç™¾é‡Œå®ˆçº¦</span><br><span class="line">æç™½</span><br><span class="line">    å¤ªä¹™çœŸäºº</span><br><span class="line"></span><br><span class="line">title</span><br><span class="line">http://www.song.com/</span><br><span class="line">èµµåŒ¡ä¹‰</span><br><span class="line">_self</span><br><span class="line">&#123;<span class="string">'href'</span>: <span class="string">'http://www.song.com/'</span>, <span class="string">'title'</span>: <span class="string">'èµµåŒ¡ä¹‰'</span>, <span class="string">'target'</span>: <span class="string">'_self'</span>&#125;</span><br><span class="line">http://www.song.com/</span><br></pre></td></tr></table></figure></p><h1 id="ã€8-3-3ã€‘åµŒå¥—é€‰æ‹©"><a href="#ã€8-3-3ã€‘åµŒå¥—é€‰æ‹©" class="headerlink" title="ã€8.3.3ã€‘åµŒå¥—é€‰æ‹©"></a><font color="#ff0000">ã€8.3.3ã€‘åµŒå¥—é€‰æ‹©</font></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;This is a demo&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.head.title)</span><br><span class="line">print(type(soup.head.title))</span><br><span class="line">print(soup.head.title.string)</span><br></pre></td></tr></table></figure><p>è·å– head èŠ‚ç‚¹é‡Œé¢çš„ title èŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;This is a demo&lt;/title&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">This</span> <span class="title">is</span> <span class="title">a</span> <span class="title">demo</span></span></span><br></pre></td></tr></table></figure></p><h1 id="ã€8-3-4ã€‘å…³è”é€‰æ‹©"><a href="#ã€8-3-4ã€‘å…³è”é€‰æ‹©" class="headerlink" title="ã€8.3.4ã€‘å…³è”é€‰æ‹©"></a><font color="#ff0000">ã€8.3.4ã€‘å…³è”é€‰æ‹©</font></h1><ul><li>contents å±æ€§ï¼šè·å–æŸä¸ªèŠ‚ç‚¹å…ƒç´ çš„ç›´æ¥å­èŠ‚ç‚¹</li><li>children å±æ€§ï¼šéå†æŸä¸ªèŠ‚ç‚¹å…ƒç´ çš„å­èŠ‚ç‚¹</li><li>descendants å±æ€§ï¼šè·å–æŸä¸ªèŠ‚ç‚¹å…ƒç´ æ‰€æœ‰çš„å­å­™èŠ‚ç‚¹</li><li>parent å±æ€§ï¼šè·å–æŸä¸ªèŠ‚ç‚¹å…ƒç´ çš„çˆ¶èŠ‚ç‚¹</li><li>parents å±æ€§ï¼šè·å–æŸä¸ªèŠ‚ç‚¹å…ƒç´ æ‰€æœ‰çš„ç¥–å…ˆèŠ‚ç‚¹</li><li>next_sibling å±æ€§ï¼šè·å–èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ </li><li>previous_sibling å±æ€§ï¼šè·å–èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´ </li><li>next_siblings å±æ€§ï¼šè·å–æŸä¸ªèŠ‚ç‚¹æ‰€æœ‰åé¢çš„å…„å¼Ÿå…ƒç´ </li><li>previous_siblings å±æ€§ï¼šè·å–æŸä¸ªèŠ‚ç‚¹æ‰€æœ‰å‰é¢çš„å…„å¼Ÿå…ƒç´ </li></ul><font color="#ff0000">contents å±æ€§åº”ç”¨ç¤ºä¾‹</font><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;The Dormouse's story&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string">            and</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="string">            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.contents)</span><br></pre></td></tr></table></figure><p>è·å– p èŠ‚ç‚¹å…ƒç´ çš„ç›´æ¥å­èŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">['\n            Once upon a time there were three little sisters; and their names were\n            ', &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;, '\n', &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;, ' \n            and\n            ', &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;, '\n            and they lived at the bottom of a well.\n        ']</span><br></pre></td></tr></table></figure></p><font color="#ff0000">children å±æ€§åº”ç”¨ç¤ºä¾‹ï¼š</font><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;The Dormouse's story&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string">            and</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="string">            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.children)</span><br><span class="line"><span class="keyword">for</span> i, child <span class="keyword">in</span> enumerate(soup.p.children):</span><br><span class="line">    print(i, child)</span><br></pre></td></tr></table></figure><p>éå† p èŠ‚ç‚¹å…ƒç´ çš„å­èŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;list_iterator object at <span class="number">0x00000228E3C205F8</span>&gt;</span><br><span class="line"><span class="number">0</span> </span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">            </span><br><span class="line">1 &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"><span class="number">2</span> </span><br><span class="line"></span><br><span class="line">3 &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;</span><br><span class="line"><span class="number">4</span>  </span><br><span class="line">            <span class="keyword">and</span></span><br><span class="line">            </span><br><span class="line">5 &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;</span><br><span class="line"><span class="number">6</span> </span><br><span class="line">            <span class="keyword">and</span> they lived at the bottom of a well.</span><br></pre></td></tr></table></figure></p><font color="#ff0000">descendants å±æ€§åº”ç”¨ç¤ºä¾‹ï¼š</font><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;The Dormouse's story&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string">            and</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="string">            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.descendants)</span><br><span class="line"><span class="keyword">for</span> i, child <span class="keyword">in</span> enumerate(soup.p.descendants):</span><br><span class="line">    print(i, child)</span><br></pre></td></tr></table></figure><br><br>è·å– p èŠ‚ç‚¹å…ƒç´ æ‰€æœ‰çš„å­å­™èŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;generator object descendants at <span class="number">0x0000018404A4C3B8</span>&gt;</span><br><span class="line"><span class="number">0</span> </span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">            </span><br><span class="line">1 &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line"><span class="number">2</span> </span><br><span class="line"></span><br><span class="line">3 &lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line"><span class="number">4</span> Elsie</span><br><span class="line"><span class="number">5</span> </span><br><span class="line"></span><br><span class="line"><span class="number">6</span> </span><br><span class="line"></span><br><span class="line">7 &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;</span><br><span class="line"><span class="number">8</span> Lacie</span><br><span class="line"><span class="number">9</span>  </span><br><span class="line">            <span class="keyword">and</span></span><br><span class="line">            </span><br><span class="line">10 &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;</span><br><span class="line"><span class="number">11</span> Tillie</span><br><span class="line"><span class="number">12</span> </span><br><span class="line">            <span class="keyword">and</span> they lived at the bottom of a well.</span><br></pre></td></tr></table></figure><br><br><font color="#ff0000">parent å±æ€§åº”ç”¨ç¤ºä¾‹ï¼š</font><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;The Dormouse's story&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.a.parent)</span><br></pre></td></tr></table></figure><br><br>è·å– a èŠ‚ç‚¹å…ƒç´ çš„çˆ¶èŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;p class="story"&gt;</span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">            &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><br><br><font color="#ff0000">parents å±æ€§åº”ç”¨ç¤ºä¾‹ï¼š</font><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(type(soup.a.parents))</span><br><span class="line">print(list(enumerate(soup.a.parents)))</span><br></pre></td></tr></table></figure><br><br>è·å– a èŠ‚ç‚¹å…ƒç´ æ‰€æœ‰çš„ç¥–å…ˆèŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">generator</span>'&gt;</span></span><br><span class="line"><span class="class">[<span class="params">(<span class="number">0</span>, &lt;p class=<span class="string">"story"</span>&gt;</span></span></span><br><span class="line"><span class="class"><span class="params">&lt;a class=<span class="string">"sister"</span> href=<span class="string">"http://example.com/elsie"</span> id=<span class="string">"link1"</span>&gt;</span></span></span><br><span class="line"><span class="class"><span class="params">&lt;span&gt;Elsie&lt;/span&gt;</span></span></span><br><span class="line"><span class="class"><span class="params">&lt;/a&gt;</span></span></span><br><span class="line">&lt;/p&gt;), (1, &lt;body&gt;</span><br><span class="line">&lt;p class="story"&gt;</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;), (2, &lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p class="story"&gt;</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;), (3, &lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p class="story"&gt;</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">&lt;span&gt;Elsie&lt;/span&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;)]</span><br></pre></td></tr></table></figure><br><br><font color="#ff0000">next_siblingã€previous_siblingã€next_siblingsã€previous_siblings å±æ€§åº”ç”¨ç¤ºä¾‹ï¼š</font><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">            Hello</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string">            and</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="string">            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(<span class="string">'Next Sibling'</span>, soup.a.next_sibling)</span><br><span class="line">print(<span class="string">'Prev Sibling'</span>, soup.a.previous_sibling)</span><br><span class="line">print(<span class="string">'Next Siblings'</span>, list(enumerate(soup.a.next_siblings)))</span><br><span class="line">print(<span class="string">'Prev Siblings'</span>, list(enumerate(soup.a.previous_siblings)))</span><br></pre></td></tr></table></figure><p>next_sibling å’Œ previous_sibling åˆ†åˆ«è·å– a èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå’Œä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´ ï¼Œnext_siblings å’Œ previous_siblings åˆ™åˆ†åˆ«è¿”å› a èŠ‚ç‚¹åé¢å’Œå‰é¢çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œè¾“å‡ºç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Next Sibling </span><br><span class="line">            Hello</span><br><span class="line">            </span><br><span class="line">Prev Sibling </span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">            </span><br><span class="line">Next Siblings [(0, '\n            Hello\n            '), (1, &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;), (2, ' \n            and\n            '), (3, &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;), (4, '\n            and they lived at the bottom of a well.\n        ')]</span><br><span class="line">Prev Siblings [(<span class="number">0</span>, <span class="string">'\n            Once upon a time there were three little sisters; and their names were\n            '</span>)]</span><br></pre></td></tr></table></figure><h1 id="ã€8-4ã€‘æ–¹æ³•é€‰æ‹©å™¨"><a href="#ã€8-4ã€‘æ–¹æ³•é€‰æ‹©å™¨" class="headerlink" title="ã€8.4ã€‘æ–¹æ³•é€‰æ‹©å™¨"></a><font color="#ff0000">ã€8.4ã€‘æ–¹æ³•é€‰æ‹©å™¨</font></h1><p>èŠ‚ç‚¹é€‰æ‹©å™¨ç›´æ¥è°ƒç”¨èŠ‚ç‚¹çš„åç§°å°±å¯ä»¥é€‰æ‹©èŠ‚ç‚¹å…ƒç´ ï¼Œå¦‚æœè¿›è¡Œæ¯”è¾ƒå¤æ‚çš„é€‰æ‹©çš„è¯ï¼Œæ–¹æ³•é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå®ƒæ›´çµæ´»ï¼Œå¸¸è§çš„æ–¹æ³•æœ‰ find_allã€find ç­‰ï¼Œè°ƒç”¨å®ƒä»¬ï¼Œç›´æ¥ä¼ å…¥ç›¸åº”çš„å‚æ•°ï¼Œå°±å¯ä»¥çµæ´»æŸ¥è¯¢äº†ã€‚</p><h2 id="ã€8-4-1ã€‘find-all-æ–¹æ³•"><a href="#ã€8-4-1ã€‘find-all-æ–¹æ³•" class="headerlink" title="ã€8.4.1ã€‘find_all() æ–¹æ³•"></a><font color="#ff0000">ã€8.4.1ã€‘find_all() æ–¹æ³•</font></h2><p>find_all æ–¹æ³•å¯ä»¥æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œç»™å®ƒä¼ å…¥ä¸€äº›å±æ€§æˆ–æ–‡æœ¬æ¥å¾—åˆ°ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚find_all æ–¹æ³•çš„ APIï¼š<code>find_all(name , attrs , recursive , text , **kwargs)</code><br>æ–°å»º soup.htmlï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æµ‹è¯•bs4<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    ç”„å§¬</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>ç™¾é‡Œå®ˆçº¦<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æç™½<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    å¤ªä¹™çœŸäºº</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"song"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>ææ¸…ç…§<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>ç‹å®‰çŸ³<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>è‹è½¼<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>æŸ³å®—å…ƒ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.song.com/"</span> <span class="attr">title</span>=<span class="string">"èµµåŒ¡ä¹‰"</span> <span class="attr">target</span>=<span class="string">"_self"</span>&gt;</span>å®‹æœæ˜¯æœ€å¼ºå¤§çš„ç‹æœï¼Œä¸æ˜¯å†›é˜Ÿçš„å¼ºå¤§ï¼Œè€Œæ˜¯ç»æµå¾ˆå¼ºå¤§ï¼Œå›½æ°‘éƒ½å¾ˆæœ‰é’±ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://www.baidu.com/meinv.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"du"</span>&gt;</span>æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tang"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> <span class="attr">title</span>=<span class="string">"qing"</span>&gt;</span>æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.163.com"</span> <span class="attr">title</span>=<span class="string">"qin"</span>&gt;</span>ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³ï¼Œä¸‡é‡Œé•¿å¾äººæœªè¿˜ï¼Œä½†ä½¿é¾™åŸé£å°†åœ¨ï¼Œä¸æ•™èƒ¡é©¬åº¦é˜´å±±ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.126.com"</span> <span class="attr">name</span>=<span class="string">"qi"</span>&gt;</span>å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.sina.com"</span> <span class="attr">class</span>=<span class="string">"du"</span>&gt;</span>æœç”«<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>å”æœ<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>å®‹æœ<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.haha.com"</span> <span class="attr">id</span>=<span class="string">"feng"</span>&gt;</span>å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç¤ºä¾‹ä»£ç ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(open(<span class="string">'soup.html'</span>, encoding=<span class="string">'utf8'</span>), <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(<span class="string">'a'</span>), <span class="string">'\n'</span>)</span><br><span class="line">print(soup.find_all(<span class="string">'a'</span>)[<span class="number">1</span>], <span class="string">'\n'</span>)</span><br><span class="line">print(soup.find_all(<span class="string">'a'</span>)[<span class="number">1</span>].text, <span class="string">'\n'</span>)</span><br><span class="line">print(soup.find_all([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'i'</span>]), <span class="string">'\n'</span>)</span><br><span class="line">print(soup.find_all(<span class="string">'a'</span>, limit=<span class="number">2</span>), <span class="string">'\n'</span>)</span><br><span class="line">print(soup.find_all(title=<span class="string">'qing'</span>), <span class="string">'\n'</span>)</span><br><span class="line">print(soup.find_all(attrs=&#123;<span class="string">'id'</span>: <span class="string">'feng'</span>&#125;), <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[&lt;a href="http://www.song.com/" target="_self" title="èµµåŒ¡ä¹‰"&gt;å®‹æœæ˜¯æœ€å¼ºå¤§çš„ç‹æœï¼Œä¸æ˜¯å†›é˜Ÿçš„å¼ºå¤§ï¼Œè€Œæ˜¯ç»æµå¾ˆå¼ºå¤§ï¼Œå›½æ°‘éƒ½å¾ˆæœ‰é’±ã€‚&lt;/a&gt;, &lt;a class="du" href=""&gt;æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„&lt;/a&gt;, &lt;a href="http://www.baidu.com" title="qing"&gt;æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚&lt;/a&gt;, &lt;a href="http://www.163.com" title="qin"&gt;ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³ï¼Œä¸‡é‡Œé•¿å¾äººæœªè¿˜ï¼Œä½†ä½¿é¾™åŸé£å°†åœ¨ï¼Œä¸æ•™èƒ¡é©¬åº¦é˜´å±±ã€‚&lt;/a&gt;, &lt;a href="http://www.126.com" name="qi"&gt;å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚&lt;/a&gt;, &lt;a class="du" href="http://www.sina.com"&gt;æœç”«&lt;/a&gt;, &lt;a href="http://www.haha.com" id="feng"&gt;å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚&lt;/a&gt;] </span><br><span class="line"></span><br><span class="line">&lt;a class="du" href=""&gt;æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„&lt;/a&gt; </span><br><span class="line"></span><br><span class="line">æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„ </span><br><span class="line"></span><br><span class="line">[&lt;a href="http://www.song.com/" target="_self" title="èµµåŒ¡ä¹‰"&gt;å®‹æœæ˜¯æœ€å¼ºå¤§çš„ç‹æœï¼Œä¸æ˜¯å†›é˜Ÿçš„å¼ºå¤§ï¼Œè€Œæ˜¯ç»æµå¾ˆå¼ºå¤§ï¼Œå›½æ°‘éƒ½å¾ˆæœ‰é’±ã€‚&lt;/a&gt;, &lt;a class="du" href=""&gt;æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„&lt;/a&gt;, &lt;a href="http://www.baidu.com" title="qing"&gt;æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚&lt;/a&gt;, &lt;a href="http://www.163.com" title="qin"&gt;ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³ï¼Œä¸‡é‡Œé•¿å¾äººæœªè¿˜ï¼Œä½†ä½¿é¾™åŸé£å°†åœ¨ï¼Œä¸æ•™èƒ¡é©¬åº¦é˜´å±±ã€‚&lt;/a&gt;, &lt;a href="http://www.126.com" name="qi"&gt;å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚&lt;/a&gt;, &lt;a class="du" href="http://www.sina.com"&gt;æœç”«&lt;/a&gt;, &lt;b&gt;å”æœ&lt;/b&gt;, &lt;i&gt;å®‹æœ&lt;/i&gt;, &lt;a href="http://www.haha.com" id="feng"&gt;å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚&lt;/a&gt;] </span><br><span class="line"></span><br><span class="line">[&lt;a href="http://www.song.com/" target="_self" title="èµµåŒ¡ä¹‰"&gt;å®‹æœæ˜¯æœ€å¼ºå¤§çš„ç‹æœï¼Œä¸æ˜¯å†›é˜Ÿçš„å¼ºå¤§ï¼Œè€Œæ˜¯ç»æµå¾ˆå¼ºå¤§ï¼Œå›½æ°‘éƒ½å¾ˆæœ‰é’±ã€‚&lt;/a&gt;, &lt;a class="du" href=""&gt;æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥ï¼Œé•¿å®‰ä¸è§ä½¿äººæ„&lt;/a&gt;] </span><br><span class="line"></span><br><span class="line">[&lt;a href="http://www.baidu.com" title="qing"&gt;æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚&lt;/a&gt;] </span><br><span class="line"></span><br><span class="line">[&lt;a href="http://www.haha.com" id="feng"&gt;å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚&lt;/a&gt;]</span><br></pre></td></tr></table></figure></p><h2 id="ã€8-4-2ã€‘find-æ–¹æ³•"><a href="#ã€8-4-2ã€‘find-æ–¹æ³•" class="headerlink" title="ã€8.4.2ã€‘find() æ–¹æ³•"></a><font color="#ff0000">ã€8.4.2ã€‘find() æ–¹æ³•</font></h2><p>find() æ–¹æ³•ä½¿ç”¨æ–¹æ³•ä¸ find_all() æ–¹æ³•ç›¸åŒï¼Œä¸åŒçš„æ˜¯ï¼Œfind æ–¹æ³•è¿”å›çš„æ˜¯å•ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ï¼Œè€Œ find_all è¿”å›çš„æ˜¯æ‰€æœ‰åŒ¹é…çš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨<br>ç‰¹åˆ«çš„ï¼š</p><ul><li><p>find_parents å’Œ find_parentï¼šå‰è€…è¿”å›æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼Œåè€…è¿”å›ç›´æ¥çˆ¶èŠ‚ç‚¹ã€‚</p></li><li><p>find_next_siblings å’Œ find_next_siblingï¼šå‰è€…è¿”å›åé¢æ‰€æœ‰çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œåè€…è¿”å›åé¢ç¬¬ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p></li><li><p>find_previous_siblings å’Œ find_previous_siblingï¼šå‰è€…è¿”å›å‰é¢æ‰€æœ‰çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œåè€…è¿”å›å‰é¢ç¬¬ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p></li><li><p>find_all_next å’Œ find_nextï¼šå‰è€…è¿”å›èŠ‚ç‚¹åæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œåè€…è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚</p></li><li><p>find_all_previous å’Œ find_previousï¼šå‰è€…è¿”å›èŠ‚ç‚¹å‰æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œåè€…è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚</p></li></ul><h1 id="ã€8-5ã€‘CSS-é€‰æ‹©å™¨"><a href="#ã€8-5ã€‘CSS-é€‰æ‹©å™¨" class="headerlink" title="ã€8.5ã€‘CSS é€‰æ‹©å™¨"></a><font color="#ff0000">ã€8.5ã€‘CSS é€‰æ‹©å™¨</font></h1><p>ä½¿ç”¨ CSS é€‰æ‹©å™¨ï¼Œåªéœ€è¦è°ƒç”¨ select æ–¹æ³•ï¼Œä¼ å…¥ç›¸åº”çš„ CSS é€‰æ‹©å™¨å³å¯<br>æ–°å»º soup.html æ–‡ä»¶ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tang"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> <span class="attr">title</span>=<span class="string">"qing"</span>&gt;</span>æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.163.com"</span> <span class="attr">title</span>=<span class="string">"qin"</span>&gt;</span>ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³ï¼Œä¸‡é‡Œé•¿å¾äººæœªè¿˜ï¼Œä½†ä½¿é¾™åŸé£å°†åœ¨ï¼Œä¸æ•™èƒ¡é©¬åº¦é˜´å±±ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.126.com"</span> <span class="attr">name</span>=<span class="string">"qi"</span>&gt;</span>å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.sina.com"</span> <span class="attr">class</span>=<span class="string">"du"</span>&gt;</span>æœç”«<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.haha.com"</span> <span class="attr">id</span>=<span class="string">"feng"</span>&gt;</span>å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ CSS é€‰æ‹©å™¨ä¾æ¬¡é€‰æ‹© class=â€tangâ€ çš„ div èŠ‚ç‚¹ä¸‹çš„ a èŠ‚ç‚¹ã€id ä¸º feng çš„èŠ‚ç‚¹ä»¥åŠå…¶ href å…ƒç´ ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(open(<span class="string">'soup.html'</span>, encoding=<span class="string">'utf8'</span>), <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.select(<span class="string">'li'</span>), <span class="string">'\n'</span>)</span><br><span class="line">print(soup.select(<span class="string">'.tang &gt; ul &gt; li &gt; a'</span>)[<span class="number">2</span>], <span class="string">'\n'</span>)</span><br><span class="line">print(soup.select(<span class="string">'#feng'</span>)[<span class="number">0</span>].text, <span class="string">'\n'</span>)</span><br><span class="line">print(soup.select(<span class="string">'#feng'</span>)[<span class="number">0</span>][<span class="string">'href'</span>], <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[&lt;li&gt;&lt;a href="http://www.baidu.com" title="qing"&gt;æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·ï¼Œè·¯ä¸Šè¡Œäººæ¬²æ–­é­‚ï¼Œå€Ÿé—®é…’å®¶ä½•å¤„æœ‰ï¼Œç‰§ç«¥é¥æŒ‡æèŠ±æ‘ã€‚&lt;/a&gt; &lt;/li&gt;, &lt;li&gt;&lt;a href="http://www.163.com" title="qin"&gt;ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³ï¼Œä¸‡é‡Œé•¿å¾äººæœªè¿˜ï¼Œä½†ä½¿é¾™åŸé£å°†åœ¨ï¼Œä¸æ•™èƒ¡é©¬åº¦é˜´å±±ã€‚&lt;/a&gt; &lt;/li&gt;, &lt;li&gt;&lt;a href="http://www.126.com" name="qi"&gt;å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚&lt;/a&gt; &lt;/li&gt;, &lt;li&gt;&lt;a class="du" href="http://www.sina.com"&gt;æœç”«&lt;/a&gt; &lt;/li&gt;, &lt;li&gt;&lt;a href="http://www.haha.com" id="feng"&gt;å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚&lt;/a&gt; &lt;/li&gt;] </span><br><span class="line"></span><br><span class="line">&lt;a href="http://www.126.com" name="qi"&gt;å²ç‹å®…é‡Œå¯»å¸¸è§ï¼Œå´”ä¹å ‚å‰å‡ åº¦é—»ï¼Œæ­£æ˜¯æ±Ÿå—å¥½é£æ™¯ï¼Œè½èŠ±æ—¶èŠ‚åˆé€¢å›ã€‚&lt;/a&gt; </span><br><span class="line"></span><br><span class="line">å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸ï¼Œå‡¤å»å°ç©ºæ±Ÿè‡ªæµï¼Œå´å®«èŠ±è‰åŸ‹å¹½å¾„ï¼Œæ™‹ä»£è¡£å† æˆå¤ä¸˜ã€‚ </span><br><span class="line"></span><br><span class="line">http://www.haha.com</span><br></pre></td></tr></table></figure></p><p>é™„è¡¨ï¼šCSS é€‰æ‹©å™¨ï¼Œæ¥æºï¼š<a href="https://www.w3school.com.cn/cssref/css_selectors.asp" target="_blank" rel="noopener">https://www.w3school.com.cn/cssref/css_selectors.asp</a></p><table><thead><tr><th>é€‰æ‹©å™¨</th><th>ä¾‹å­</th><th>ä¾‹å­æè¿°</th><th>CSS</th></tr></thead><tbody><tr><td>.class</td><td>.intro</td><td>é€‰æ‹© class=â€introâ€ çš„æ‰€æœ‰å…ƒç´ </td><td>1</td></tr><tr><td>#id</td><td>#firstname</td><td>é€‰æ‹© id=â€firstnameâ€ çš„æ‰€æœ‰å…ƒç´ </td><td>1</td></tr><tr><td>*</td><td>*</td><td>é€‰æ‹©æ‰€æœ‰å…ƒç´ </td><td>2</td></tr><tr><td>element</td><td>p</td><td>é€‰æ‹©æ‰€æœ‰ <p> å…ƒç´ </p></td><td>1</td></tr><tr><td>element,element</td><td>div,p</td><td>é€‰æ‹©æ‰€æœ‰ <div> å…ƒç´ å’Œæ‰€æœ‰ <p> å…ƒç´ </p></div></td><td>1</td></tr><tr><td>element element</td><td>div p</td><td>é€‰æ‹© <div> å…ƒç´ å†…éƒ¨çš„æ‰€æœ‰ <p> å…ƒç´ </p></div></td><td>1</td></tr><tr><td>element&gt;element</td><td>div&gt;p</td><td>é€‰æ‹©çˆ¶å…ƒç´ ä¸º <div> å…ƒç´ çš„æ‰€æœ‰ <p> å…ƒç´ </p></div></td><td>2</td></tr><tr><td>element+element</td><td>div+p</td><td>é€‰æ‹©ç´§æ¥åœ¨ <div> å…ƒç´ ä¹‹åçš„æ‰€æœ‰ <p> å…ƒç´ </p></div></td><td>2</td></tr><tr><td>[attribute]</td><td>[target]</td><td>é€‰æ‹©å¸¦æœ‰ target å±æ€§æ‰€æœ‰å…ƒç´ </td><td>2</td></tr><tr><td>[attribute=value]</td><td>[target=_blank]</td><td>é€‰æ‹© target=â€_blankâ€ çš„æ‰€æœ‰å…ƒç´ </td><td>2</td></tr><tr><td>[attribute~=value]</td><td>[title~=flower]</td><td>é€‰æ‹© title å±æ€§åŒ…å«å•è¯ â€œflowerâ€ çš„æ‰€æœ‰å…ƒç´ </td><td>2</td></tr><tr><td>[attribute</td><td>=value]</td><td>[lang</td><td>=en]</td><td>é€‰æ‹© lang å±æ€§å€¼ä»¥ â€œenâ€ å¼€å¤´çš„æ‰€æœ‰å…ƒç´ </td><td>2</td></tr><tr><td>:link</td><td>a:link</td><td>é€‰æ‹©æ‰€æœ‰æœªè¢«è®¿é—®çš„é“¾æ¥</td><td>1</td></tr><tr><td>:visited</td><td>a:visited</td><td>é€‰æ‹©æ‰€æœ‰å·²è¢«è®¿é—®çš„é“¾æ¥</td><td>1</td></tr><tr><td>:active</td><td>a:active</td><td>é€‰æ‹©æ´»åŠ¨é“¾æ¥</td><td>1</td></tr><tr><td>:hover</td><td>a:hover</td><td>é€‰æ‹©é¼ æ ‡æŒ‡é’ˆä½äºå…¶ä¸Šçš„é“¾æ¥</td><td>1</td></tr><tr><td>:focus</td><td>input:focus</td><td>é€‰æ‹©è·å¾—ç„¦ç‚¹çš„ input å…ƒç´ </td><td>2</td></tr><tr><td>:first-letter</td><td>p:first-letter</td><td>é€‰æ‹©æ¯ä¸ª <p> å…ƒç´ çš„é¦–å­—æ¯</p></td><td>1</td></tr><tr><td>:first-line</td><td>p:first-line</td><td>é€‰æ‹©æ¯ä¸ª <p> å…ƒç´ çš„é¦–è¡Œ</p></td><td>1</td></tr><tr><td>:first-child</td><td>p:first-child</td><td>é€‰æ‹©å±äºçˆ¶å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ çš„æ¯ä¸ª <p> å…ƒç´ </p></td><td>2</td></tr><tr><td>:before</td><td>p:before</td><td>åœ¨æ¯ä¸ª <p> å…ƒç´ çš„å†…å®¹ä¹‹å‰æ’å…¥å†…å®¹</p></td><td>2</td></tr><tr><td>:after</td><td>p:after</td><td>åœ¨æ¯ä¸ª <p> å…ƒç´ çš„å†…å®¹ä¹‹åæ’å…¥å†…å®¹</p></td><td>2</td></tr><tr><td>:lang(language)</td><td>p:lang(it)</td><td>é€‰æ‹©å¸¦æœ‰ä»¥ â€œitâ€ å¼€å¤´çš„ lang å±æ€§å€¼çš„æ¯ä¸ª <p> å…ƒç´ </p></td><td>2</td></tr><tr><td>element1~element2</td><td>p~ul</td><td>é€‰æ‹©å‰é¢æœ‰ <p> å…ƒç´ çš„æ¯ä¸ª <ul> å…ƒç´ </ul></p></td><td>3</td></tr><tr><td>[attribute^=value]</td><td>a[src^=â€httpsâ€]</td><td>é€‰æ‹©å…¶ src å±æ€§å€¼ä»¥ â€œhttpsâ€ å¼€å¤´çš„æ¯ä¸ª <a> å…ƒç´ </a></td><td>3</td></tr><tr><td>[attribute$=value]</td><td>a[src$=â€.pdfâ€]</td><td>é€‰æ‹©å…¶ src å±æ€§ä»¥ â€œ.pdfâ€ ç»“å°¾çš„æ‰€æœ‰ <a> å…ƒç´ </a></td><td>3</td></tr><tr><td>[attribute*=value]</td><td>a[src*=â€abcâ€]</td><td>é€‰æ‹©å…¶ src å±æ€§ä¸­åŒ…å« â€œabcâ€ å­ä¸²çš„æ¯ä¸ª <a> å…ƒç´ </a></td><td>3</td></tr><tr><td>:first-of-type</td><td>p:first-of-type</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„é¦–ä¸ª <p> å…ƒç´ çš„æ¯ä¸ª </p><p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:last-of-type</td><td>p:last-of-type</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„æœ€å <p> å…ƒç´ çš„æ¯ä¸ª </p><p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:only-of-type</td><td>p:only-of-type</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ å”¯ä¸€çš„ <p> å…ƒç´ çš„æ¯ä¸ª </p><p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:only-child</td><td>p:only-child</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„å”¯ä¸€å­å…ƒç´ çš„æ¯ä¸ª <p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:nth-child(n)</td><td>p:nth-child(2)</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„ç¬¬äºŒä¸ªå­å…ƒç´ çš„æ¯ä¸ª <p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:nth-last-child(n)</td><td>p:nth-last-child(2)</td><td>åŒä¸Šï¼Œä»æœ€åä¸€ä¸ªå­å…ƒç´ å¼€å§‹è®¡æ•°</td><td>3</td></tr><tr><td>:nth-of-type(n)</td><td>p:nth-of-type(2)</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ ç¬¬äºŒä¸ª <p> å…ƒç´ çš„æ¯ä¸ª </p><p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:nth-last-of-type(n)</td><td>p:nth-last-of-type(2)</td><td>åŒä¸Šï¼Œä½†æ˜¯ä»æœ€åä¸€ä¸ªå­å…ƒç´ å¼€å§‹è®¡æ•°</td><td>3</td></tr><tr><td>:last-child</td><td>p:last-child</td><td>é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ æœ€åä¸€ä¸ªå­å…ƒç´ æ¯ä¸ª <p> å…ƒç´ </p></td><td>3</td></tr><tr><td>:root</td><td>:root</td><td>é€‰æ‹©æ–‡æ¡£çš„æ ¹å…ƒç´ </td><td>3</td></tr><tr><td>:empty</td><td>p:empty</td><td>é€‰æ‹©æ²¡æœ‰å­å…ƒç´ çš„æ¯ä¸ª <p> å…ƒç´ ï¼ˆåŒ…æ‹¬æ–‡æœ¬èŠ‚ç‚¹ï¼‰</p></td><td>3</td></tr><tr><td>:target</td><td>#news:target</td><td>é€‰æ‹©å½“å‰æ´»åŠ¨çš„ #news å…ƒç´ </td><td>3</td></tr><tr><td>:enabled</td><td>input:enabled</td><td>é€‰æ‹©æ¯ä¸ªå¯ç”¨çš„ <input> å…ƒç´ </td><td>3</td></tr><tr><td>:disabled</td><td>input:disabled</td><td>é€‰æ‹©æ¯ä¸ªç¦ç”¨çš„ <input> å…ƒç´ </td><td>3</td></tr><tr><td>:checked</td><td>input:checked</td><td>é€‰æ‹©æ¯ä¸ªè¢«é€‰ä¸­çš„ <input> å…ƒç´ </td><td>3</td></tr><tr><td>:not(selector)</td><td>:not(p)</td><td>é€‰æ‹©é <p> å…ƒç´ çš„æ¯ä¸ªå…ƒç´ </p></td><td>3</td></tr><tr><td>::selection</td><td>::selection</td><td>é€‰æ‹©è¢«ç”¨æˆ·é€‰å–çš„å…ƒç´ éƒ¨åˆ†</td><td>3</td></tr></tbody></table><h1 id="ã€8-6ã€‘é™„è¡¨ï¼šBeautiful-Soup-åº“-soup-å¯¹è±¡å¸¸ç”¨å±æ€§ä¸æ–¹æ³•"><a href="#ã€8-6ã€‘é™„è¡¨ï¼šBeautiful-Soup-åº“-soup-å¯¹è±¡å¸¸ç”¨å±æ€§ä¸æ–¹æ³•" class="headerlink" title="ã€8.6ã€‘é™„è¡¨ï¼šBeautiful Soup åº“ soup å¯¹è±¡å¸¸ç”¨å±æ€§ä¸æ–¹æ³•"></a><font color="#ff0000">ã€8.6ã€‘é™„è¡¨ï¼šBeautiful Soup åº“ soup å¯¹è±¡å¸¸ç”¨å±æ€§ä¸æ–¹æ³•</font></h1><table><thead><tr><th>åŸºæœ¬å…ƒç´ </th><th>è¯´æ˜</th><th>è¿”å›ç±»å‹</th></tr></thead><tbody><tr><td>tag</td><td>soup.a</td><td>bs4.element.Tag</td></tr><tr><td>name</td><td>soup.a.name</td><td>str</td></tr><tr><td>attrs</td><td>soup.a.attrs</td><td>dict</td></tr><tr><td>contents</td><td>å­èŠ‚ç‚¹</td><td>list</td></tr><tr><td>children</td><td>éå†å­èŠ‚ç‚¹</td><td>list_iterator</td></tr><tr><td>descendants</td><td>éå†æ‰€æœ‰å­å­™èŠ‚ç‚¹</td><td>generator</td></tr><tr><td>parent</td><td>è¿”å›çˆ¶äº²æ ‡ç­¾</td><td>bs4.element.Tag</td></tr><tr><td>parents</td><td>ä¸Šè¡Œéå†çˆ¶è¾ˆæ ‡ç­¾</td><td>generator</td></tr><tr><td>prettify()</td><td>æ·»åŠ /n</td><td>str</td></tr><tr><td>find_all(name,attr)</td><td>soup.find_all(â€˜aâ€™)/([â€˜aâ€™,â€˜bâ€™])/(True)/(â€˜pâ€™,â€˜courseâ€™)/(id=â€˜link1â€™)/(string=â€˜pythonâ€™)</td><td>bs4.element.ResultSet</td></tr><tr><td>find()</td><td>soup.find(â€˜aâ€™)/è¿”å›ç¬¬ä¸€ä¸ªaæ ‡ç­¾</td><td>bs4.element.Tag</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬å…«ç«  â€”â€” ã€è§£æåº“ Beautiful Soupã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="Beautiful Soup" scheme="https://www.itrhx.com/tags/Beautiful-Soup/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C07</title>
    <link href="https://www.itrhx.com/2019/08/25/A37-Python3-spider-C07/"/>
    <id>https://www.itrhx.com/2019/08/25/A37-Python3-spider-C07/</id>
    <published>2019-08-25T11:31:18.872Z</published>
    <updated>2019-09-24T12:40:30.940Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬ä¸ƒç«  â€”â€” ã€è§£æåº“ lxmlã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€7-1ã€‘å…³äº-lxml"><a href="#ã€7-1ã€‘å…³äº-lxml" class="headerlink" title="ã€7.1ã€‘å…³äº lxml"></a><font color="#ff0000">ã€7.1ã€‘å…³äº lxml</font></h1><p> lxml æ˜¯ Python çš„ä¸€ä¸ªè§£æåº“ï¼Œæ”¯æŒ HTML å’Œ XML çš„è§£æï¼Œæ”¯æŒ XPath è§£ææ–¹å¼ï¼Œè§£ææ•ˆç‡éå¸¸é«˜ï¼Œä½¿ç”¨å‰éœ€è¦ç”¨å‘½ä»¤ <code>pip3 install lxml</code> å®‰è£… lxml åº“</p><h1 id="ã€7-2ã€‘ä½¿ç”¨-XPath"><a href="#ã€7-2ã€‘ä½¿ç”¨-XPath" class="headerlink" title="ã€7.2ã€‘ä½¿ç”¨  XPath"></a><font color="#ff0000">ã€7.2ã€‘ä½¿ç”¨  XPath</font></h1><p> XPathï¼ˆXML Path Languageï¼‰å³ XML è·¯å¾„è¯­è¨€ï¼Œ lxml è§£æåº“ä½¿ç”¨çš„æ­£æ˜¯ XPath è¯­æ³•ï¼Œæœ€åˆæ˜¯ç”¨æ¥æœå¯» XML æ–‡æ¡£çš„ï¼Œæ˜¯ä¸€é—¨åœ¨ XML æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ï¼Œå®ƒåŒæ ·é€‚ç”¨äº HTML æ–‡æ¡£çš„æœç´¢</p><p>  XPath å¸¸ç”¨è§„åˆ™</p><table><thead><tr><th style="text-align:center">è¡¨è¾¾å¼</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">nodename</td><td style="text-align:center">é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td></tr><tr><td style="text-align:center">/</td><td style="text-align:center">ä»å½“å‰èŠ‚ç‚¹é€‰å–ç›´æ¥å­èŠ‚ç‚¹</td></tr><tr><td style="text-align:center">//</td><td style="text-align:center">ä»å½“å‰èŠ‚ç‚¹é€‰å–å­å­™èŠ‚ç‚¹</td></tr><tr><td style="text-align:center">.</td><td style="text-align:center">é€‰å–å½“å‰èŠ‚ç‚¹</td></tr><tr><td style="text-align:center">..</td><td style="text-align:center">é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td></tr><tr><td style="text-align:center">@</td><td style="text-align:center">é€‰å–å±æ€§</td></tr><tr><td style="text-align:center">*</td><td style="text-align:center">é€šé…ç¬¦ï¼Œé€‰æ‹©æ‰€æœ‰å…ƒç´ èŠ‚ç‚¹ä¸å…ƒç´ å</td></tr><tr><td style="text-align:center">@*</td><td style="text-align:center">é€‰å–æ‰€æœ‰å±æ€§</td></tr><tr><td style="text-align:center">[@attrib]</td><td style="text-align:center">é€‰å–å…·æœ‰ç»™å®šå±æ€§çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td style="text-align:center">[@attrib=â€™valueâ€™]</td><td style="text-align:center">é€‰å–ç»™å®šå±æ€§å…·æœ‰ç»™å®šå€¼çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td style="text-align:center">[tag]</td><td style="text-align:center">é€‰å–æ‰€æœ‰å…·æœ‰æŒ‡å®šå…ƒç´ çš„ç›´æ¥å­èŠ‚ç‚¹</td></tr><tr><td style="text-align:center">[tag=â€™textâ€™]</td><td style="text-align:center">é€‰å–æ‰€æœ‰å…·æœ‰æŒ‡å®šå…ƒç´ å¹¶ä¸”æ–‡æœ¬å†…å®¹æ˜¯textèŠ‚ç‚¹</td></tr></tbody></table><p> æµè§ˆå™¨æ’ä»¶ XPath Helperï¼Œåœ¨çº¿éªŒè¯ XPathï¼Œè°·æ­Œå•†åº—ä¸‹è½½åœ°å€ï¼š<a href="https://chrome.google.com/webstore/detail/hgimnogjllphhhkhlmebbmlgjoejdpjl" target="_blank" rel="noopener">https://chrome.google.com/webstore/detail/hgimnogjllphhhkhlmebbmlgjoejdpjl</a></p><p> XPath åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼šé¦–å…ˆä½¿ç”¨ä»£ç  <code>from lxml import etree</code>å¯¼å…¥åº“ï¼Œç„¶åå°† HTML æ–‡æ¡£å˜æˆä¸€ä¸ªå¯¹è±¡ï¼Œå†è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•å»æŸ¥æ‰¾æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œæ–¹æ³•æœ‰ä¸¤ç§ï¼š<code>tree = etree.parse()</code> ä¸ºæœ¬åœ°æ–‡ä»¶æŸ¥æ‰¾ï¼Œ<code>tree = etree.HTML()</code> ä¸ºç½‘ç»œæ–‡ä»¶æŸ¥æ‰¾ï¼Œå†ä½¿ç”¨è¯­å¥ <code>tree.xpath()</code> æŸ¥æ‰¾æŒ‡å®šèŠ‚ç‚¹ã€‚</p><h1 id="ã€7-3ã€‘æŸ¥æ‰¾æ‰€æœ‰èŠ‚ç‚¹"><a href="#ã€7-3ã€‘æŸ¥æ‰¾æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="ã€7.3ã€‘æŸ¥æ‰¾æ‰€æœ‰èŠ‚ç‚¹"></a><font color="#ff0000">ã€7.3ã€‘æŸ¥æ‰¾æ‰€æœ‰èŠ‚ç‚¹</font></h1><p> æ–°å»ºä¸€ä¸ª xpath.html æœ¬åœ°æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>xpathæµ‹è¯•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"song"</span>&gt;</span></span><br><span class="line">    ç«è¯</span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>æŒ‡å—é’ˆ<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>å°åˆ·æœ¯<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    é€ çº¸æœ¯</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tang"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"balove"</span>&gt;</span>åœè½¦åçˆ±æ«æ—æ™šï¼Œéœœå¶çº¢äºäºŒæœˆèŠ±ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"hua"</span>&gt;</span>å•†å¥³ä¸çŸ¥äº¡å›½æ¨ï¼Œéš”æ±ŸçŠ¹å”±ååº­èŠ±ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"love"</span> <span class="attr">name</span>=<span class="string">"yang"</span>&gt;</span>ä¸€éª‘çº¢å°˜å¦ƒå­ç¬‘ï¼Œæ— äººçŸ¥æ˜¯è”ææ¥ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"bei"</span>&gt;</span>è‘¡è„ç¾é…’å¤œå…‰æ¯ï¼Œæ¬²é¥®çµç¶é©¬ä¸Šå‚¬ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com/"</span>&gt;</span>ç™¾åº¦ä¸€ä¸‹<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"balucy"</span>&gt;</span>å¯»å¯»è§…è§…å†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆšã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lily"</span>&gt;</span>å’‹æš–è¿˜å¯’æ—¶å€™ï¼Œæœ€éš¾å°†æ¯ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"lilei"</span>&gt;</span>ä¸‰æ¯ä¸¤ç›æ·¡é…’ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>æ€æ•Œä»–æ™šæ¥é£æ€¥ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>é›è¿‡ä¹Ÿï¼Œæ­£ä¼¤å¿ƒï¼Œå´æ˜¯æ—§æ—¶ç›¸è¯†ã€‚<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>çˆ±æƒ…ä¸‰åå…­è®¡<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>ä»€ä¹ˆæ˜¯çˆ±æƒ…<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æŸ¥æ‰¾æ‰€æœ‰èŠ‚ç‚¹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//*'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨ <code>*</code> ä»£è¡¨åŒ¹é…æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ•´ä¸ª xpath.html æ–‡ä»¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šè¢«è·å–åˆ°ï¼Œè¿”å›å½¢å¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ Element ç±»å‹ï¼Œå…¶åè·Ÿäº†èŠ‚ç‚¹çš„åç§°ï¼Œå¦‚ htmlã€bodyã€divã€ulã€liã€a ç­‰ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½åŒ…å«åœ¨åˆ—è¡¨ä¸­ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&lt;Element html at <span class="number">0x1a836a34508</span>&gt;, &lt;Element head at <span class="number">0x1a836a344c8</span>&gt;, &lt;Element meta at <span class="number">0x1a836a345c8</span>&gt;, &lt;Element title at <span class="number">0x1a836a34608</span>&gt;, &lt;Element body at <span class="number">0x1a836a34648</span>&gt;, &lt;Element div at <span class="number">0x1a836a346c8</span>&gt;, &lt;Element b at <span class="number">0x1a836a34708</span>&gt;, &lt;Element b at <span class="number">0x1a836a34748</span>&gt;, &lt;Element div at <span class="number">0x1a836a34788</span>&gt;, &lt;Element ul at <span class="number">0x1a836a34688</span>&gt;, &lt;Element li at <span class="number">0x1a836a347c8</span>&gt;, &lt;Element li at <span class="number">0x1a836a34808</span>&gt;, &lt;Element li at <span class="number">0x1a836a34848</span>&gt;, &lt;Element li at <span class="number">0x1a836a34888</span>&gt;, &lt;Element li at <span class="number">0x1a836a348c8</span>&gt;, &lt;Element a at <span class="number">0x1a836a34908</span>&gt;, &lt;Element ol at <span class="number">0x1a836a34948</span>&gt;, &lt;Element li at <span class="number">0x1a836a34988</span>&gt;, &lt;Element li at <span class="number">0x1a836a349c8</span>&gt;, &lt;Element li at <span class="number">0x1a836a34a08</span>&gt;, &lt;Element li at <span class="number">0x1a836a34a48</span>&gt;, &lt;Element li at <span class="number">0x1a836a34a88</span>&gt;, &lt;Element li at <span class="number">0x1a836a34ac8</span>&gt;, &lt;Element li at <span class="number">0x1a836a34b08</span>&gt;]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-4ã€‘æŸ¥æ‰¾å­èŠ‚ç‚¹"><a href="#ã€7-4ã€‘æŸ¥æ‰¾å­èŠ‚ç‚¹" class="headerlink" title="ã€7.4ã€‘æŸ¥æ‰¾å­èŠ‚ç‚¹"></a><font color="#ff0000">ã€7.4ã€‘æŸ¥æ‰¾å­èŠ‚ç‚¹</font></h1><p> é€šè¿‡ <font color="#ff0000">/</font> æˆ– <font color="#ff0000">//</font> å³å¯æŸ¥æ‰¾å…ƒç´ çš„å­èŠ‚ç‚¹æˆ–å­å­™èŠ‚ç‚¹ï¼š<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//ul/li'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>é€‰æ‹© ul èŠ‚ç‚¹çš„æ‰€æœ‰<font color="#ff0000">ç›´æ¥</font> li å­èŠ‚ç‚¹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&lt;Element li at <span class="number">0x2a094d044c8</span>&gt;, &lt;Element li at <span class="number">0x2a094d045c8</span>&gt;, &lt;Element li at <span class="number">0x2a094d04608</span>&gt;, &lt;Element li at <span class="number">0x2a094d04648</span>&gt;, &lt;Element li at <span class="number">0x2a094d04688</span>&gt;]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-5ã€‘æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹"><a href="#ã€7-5ã€‘æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹" class="headerlink" title="ã€7.5ã€‘æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹"></a><font color="#ff0000">ã€7.5ã€‘æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹</font></h1><p> çŸ¥é“äº†å­èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥ç”¨ <font color="#ff0000">..</font> æˆ–è€… <font color="#ff0000">parent::</font> æŸ¥æ‰¾å…¶çˆ¶èŠ‚ç‚¹<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//ol/../@class'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//ol/parent::*/@class'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>å…ˆæŸ¥æ‰¾åˆ° ol èŠ‚ç‚¹ï¼Œéšåè·å–å…¶çˆ¶èŠ‚ç‚¹ä»¥åŠå…¶ class å±æ€§ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'tang'</span>]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-6ã€‘å±æ€§åŒ¹é…"><a href="#ã€7-6ã€‘å±æ€§åŒ¹é…" class="headerlink" title="ã€7.6ã€‘å±æ€§åŒ¹é…"></a><font color="#ff0000">ã€7.6ã€‘å±æ€§åŒ¹é…</font></h1><p> æœ‰æ—¶å€™ HTML åŒ…å«å¤šä¸ªç›¸åŒåçš„èŠ‚ç‚¹ï¼Œè€ŒèŠ‚ç‚¹çš„å±æ€§æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ­¤æ—¶å¯ä»¥ç”¨ <font color="#ff0000">@</font> ç¬¦å·è¿›è¡Œå±æ€§è¿‡æ»¤<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="balucy"]'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>xpath.html æ–‡ä»¶ä¸­ï¼Œåªæœ‰ä¸€ä¸ª class ä¸º balucy çš„èŠ‚ç‚¹ï¼š<code>&lt;li class=&quot;balucy&quot;&gt;å¯»å¯»è§…è§…å†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆšã€‚&lt;/li&gt;</code>ï¼Œè¿è¡Œä»¥ä¸Šä»£ç å°†è¿”å›ä¸€ä¸ªè¯¥å…ƒç´ ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&lt;Element li at <span class="number">0x16e53aa54c8</span>&gt;]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-7ã€‘æ–‡æœ¬è·å–"><a href="#ã€7-7ã€‘æ–‡æœ¬è·å–" class="headerlink" title="ã€7.7ã€‘æ–‡æœ¬è·å–"></a><font color="#ff0000">ã€7.7ã€‘æ–‡æœ¬è·å–</font></h1><p> ä½¿ç”¨ text() æ–¹æ³•å³å¯æå–èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ï¼š<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="balucy"]/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'å¯»å¯»è§…è§…å†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆšã€‚'</span>]</span><br></pre></td></tr></table></figure></p><p>å†æ¬¡è§‚å¯Ÿ xpath.html æ–‡ä»¶ä¸­çš„ <code>&lt;ol&gt;&lt;/ol&gt;</code>è¿™ä¸€éƒ¨åˆ†ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;ol&gt;</span><br><span class="line">    &lt;li class="balucy"&gt;å¯»å¯»è§…è§…å†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆšã€‚&lt;/li&gt;</span><br><span class="line">    &lt;li class="lily"&gt;å’‹æš–è¿˜å¯’æ—¶å€™ï¼Œæœ€éš¾å°†æ¯ã€‚&lt;/li&gt;</span><br><span class="line">    &lt;li class="lilei"&gt;ä¸‰æ¯ä¸¤ç›æ·¡é…’ã€‚&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;æ€æ•Œä»–æ™šæ¥é£æ€¥ã€‚&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;é›è¿‡ä¹Ÿï¼Œæ­£ä¼¤å¿ƒï¼Œå´æ˜¯æ—§æ—¶ç›¸è¯†ã€‚&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;çˆ±æƒ…ä¸‰åå…­è®¡&lt;/li&gt;</span><br><span class="line">    &lt;li&gt;ä»€ä¹ˆæ˜¯çˆ±æƒ…&lt;/li&gt;</span><br><span class="line">&lt;/ol&gt;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æå– <code>&lt;li&gt;</code> èŠ‚ç‚¹é‡Œé¢æ‰€æœ‰çš„æ–‡æœ¬ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>html.xpath(&#39;//ol/li/text()&#39;)</code> è¯­å¥ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//ol/li/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'å¯»å¯»è§…è§…å†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆšã€‚'</span>, <span class="string">'å’‹æš–è¿˜å¯’æ—¶å€™ï¼Œæœ€éš¾å°†æ¯ã€‚'</span>, <span class="string">'ä¸‰æ¯ä¸¤ç›æ·¡é…’ã€‚'</span>, <span class="string">'æ€æ•Œä»–æ™šæ¥é£æ€¥ã€‚'</span>, <span class="string">'é›è¿‡ä¹Ÿï¼Œæ­£ä¼¤å¿ƒï¼Œå´æ˜¯æ—§æ—¶ç›¸è¯†ã€‚'</span>, <span class="string">'çˆ±æƒ…ä¸‰åå…­è®¡'</span>, <span class="string">'ä»€ä¹ˆæ˜¯çˆ±æƒ…'</span>]</span><br></pre></td></tr></table></figure></p><p>åŒæ ·è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨ <code>html.xpath(&#39;//ol//text()&#39;)</code> è¯­å¥ï¼Œ<code>//</code> å°†ä¼šé€‰å–æ‰€æœ‰å­å­™èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œ<code>&lt;ol&gt;</code> å’Œ <code>&lt;li&gt;</code> èŠ‚ç‚¹ä¸‹çš„æ¢è¡Œç¬¦ä¹Ÿå°†è¢«æå–å‡ºæ¥ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//ol//text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'\n        '</span>, <span class="string">'å¯»å¯»è§…è§…å†·å†·æ¸…æ¸…ï¼Œå‡„å‡„æƒ¨æƒ¨æˆšæˆšã€‚'</span>, <span class="string">'\n        '</span>, <span class="string">'å’‹æš–è¿˜å¯’æ—¶å€™ï¼Œæœ€éš¾å°†æ¯ã€‚'</span>, <span class="string">'\n        '</span>, <span class="string">'ä¸‰æ¯ä¸¤ç›æ·¡é…’ã€‚'</span>, <span class="string">'\n        '</span>, <span class="string">'æ€æ•Œä»–æ™šæ¥é£æ€¥ã€‚'</span>, <span class="string">'\n        '</span>, <span class="string">'é›è¿‡ä¹Ÿï¼Œæ­£ä¼¤å¿ƒï¼Œå´æ˜¯æ—§æ—¶ç›¸è¯†ã€‚'</span>, <span class="string">'\n        '</span>, <span class="string">'çˆ±æƒ…ä¸‰åå…­è®¡'</span>, <span class="string">'\n        '</span>, <span class="string">'ä»€ä¹ˆæ˜¯çˆ±æƒ…'</span>, <span class="string">'\n    '</span>]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-8ã€‘å±æ€§è·å–"><a href="#ã€7-8ã€‘å±æ€§è·å–" class="headerlink" title="ã€7.8ã€‘å±æ€§è·å–"></a><font color="#ff0000">ã€7.8ã€‘å±æ€§è·å–</font></h1><p> ä¸å±æ€§åŒ¹é…ä¸€æ ·ï¼Œå±æ€§è·å–ä»ç„¶ä½¿ç”¨ <font color="#ff0000">@</font>ï¼š<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.parse(<span class="string">'./xpath.html'</span>)</span><br><span class="line">result = html.xpath(<span class="string">'//ul/li[5]/a/@href'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p> è·å– href å±æ€§ï¼š<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'http://www.baidu.com/'</span>]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-9ã€‘ä¸€ä¸ªå±æ€§åŒ…å«å¤šä¸ªå€¼çš„åŒ¹é…"><a href="#ã€7-9ã€‘ä¸€ä¸ªå±æ€§åŒ…å«å¤šä¸ªå€¼çš„åŒ¹é…" class="headerlink" title="ã€7.9ã€‘ä¸€ä¸ªå±æ€§åŒ…å«å¤šä¸ªå€¼çš„åŒ¹é…"></a><font color="#ff0000">ã€7.9ã€‘ä¸€ä¸ªå±æ€§åŒ…å«å¤šä¸ªå€¼çš„åŒ¹é…</font></h1><p>æŸä¸ªèŠ‚ç‚¹çš„æŸä¸ªå±æ€§å¯èƒ½æœ‰å¤šä¸ªå€¼ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"li li-first"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>li èŠ‚ç‚¹çš„ class å±æ€§æœ‰ li å’Œ li-first ä¸¤ä¸ªå€¼ï¼Œå¦‚æœä½¿ç”¨ <code>html.xpath(&#39;//li[@class=&quot;li&quot;]</code> è¯­å¥ï¼Œå°†æ— æ³•æˆåŠŸåŒ¹é…ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨<font color="#ff0000"> contains</font> æ–¹æ³•äº†ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥å±æ€§å€¼ï¼Œåªè¦æ­¤å±æ€§åŒ…å«æ‰€ä¼ å…¥çš„å±æ€§å€¼ï¼Œå°±å¯ä»¥å®ŒæˆåŒ¹é…äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;li class="li li-first"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;  </span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[contains(@class, "li")]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'first item'</span>]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-10ã€‘å¤šä¸ªå±æ€§åŒ¹é…ä¸€ä¸ªèŠ‚ç‚¹"><a href="#ã€7-10ã€‘å¤šä¸ªå±æ€§åŒ¹é…ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="ã€7.10ã€‘å¤šä¸ªå±æ€§åŒ¹é…ä¸€ä¸ªèŠ‚ç‚¹"></a><font color="#ff0000">ã€7.10ã€‘å¤šä¸ªå±æ€§åŒ¹é…ä¸€ä¸ªèŠ‚ç‚¹</font></h1><p>XPath è¿˜å¯ä»¥æ ¹æ®å¤šä¸ªå±æ€§æ¥ç¡®å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶å°±éœ€è¦åŒæ—¶åŒ¹é…å¤šä¸ªå±æ€§ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ and æ¥è¿æ¥ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">text = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;li class="li" name="item"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="li" and @name="item"]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'first item'</span>]</span><br></pre></td></tr></table></figure></p><p>ç¤ºä¾‹ä¸­è¿ç”¨äº†è¿ç®—ç¬¦ and æ¥è¿æ¥ï¼Œæ­¤å¤–å¸¸è§çš„è¿ç®—ç¬¦å¦‚ä¸‹ï¼š</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>æè¿°</th><th>å®ä¾‹</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td>or</td><td>æˆ–</td><td>age=19 or age=20</td><td>å¦‚æœ age æ˜¯ 19 æˆ–è€… 20ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age æ˜¯å…¶ä»–å€¼ï¼Œåˆ™è¿”å› false</td></tr><tr><td>and</td><td>ä¸</td><td>age&gt;19 and age&lt;21</td><td>å¦‚æœ age å¤§äº 19 ä¸”å°äº 21ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age æ˜¯å…¶ä»–å€¼ï¼Œåˆ™è¿”å› false</td></tr><tr><td>mod</td><td>è®¡ç®—é™¤æ³•çš„ä½™æ•°</td><td>5 mod 2</td><td>1</td></tr><tr><td>&#124;</td><td>è®¡ç®—ä¸¤ä¸ªèŠ‚ç‚¹é›†</td><td>//book &#124; //cd</td><td>è¿”å›æ‰€æœ‰æ‹¥æœ‰ book å’Œ cd å…ƒç´ çš„èŠ‚ç‚¹é›†</td></tr><tr><td>+</td><td>åŠ æ³•</td><td>10 + 5</td><td>15</td></tr><tr><td>-</td><td>å‡æ³•</td><td>10 - 5</td><td>5</td></tr><tr><td>*</td><td>ä¹˜æ³•</td><td>10 * 5</td><td>50</td></tr><tr><td>div</td><td>é™¤æ³•</td><td>10 div 5</td><td>2</td></tr><tr><td>=</td><td>ç­‰äº</td><td>age=19</td><td>å¦‚æœ age æ˜¯ 19ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age ä¸æ˜¯ 19ï¼Œåˆ™è¿”å› false</td></tr><tr><td>!=</td><td>ä¸ç­‰äº</td><td>age!=19</td><td>å¦‚æœ age ä¸æ˜¯ 19ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age æ˜¯ 19ï¼Œåˆ™è¿”å› false</td></tr><tr><td>&lt;</td><td>å°äº</td><td>age&lt;19</td><td>å¦‚æœ age å°äº 19ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age ä¸å°äº 19ï¼Œåˆ™è¿”å› false</td></tr><tr><td>&lt;=</td><td>å°äºæˆ–ç­‰äº</td><td>age&lt;=19</td><td>å¦‚æœ age å°äºç­‰äº 19ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age å¤§äº 19ï¼Œåˆ™è¿”å› false</td></tr><tr><td>&gt;</td><td>å¤§äº</td><td>age&gt;19</td><td>å¦‚æœ age å¤§äº 19ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age ä¸å¤§äº 19ï¼Œåˆ™è¿”å› false</td></tr><tr><td>&gt;=</td><td>å¤§äºæˆ–ç­‰äº</td><td>age&gt;=19</td><td>å¦‚æœ age å¤§äºç­‰äº 19ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ age å°äº 19ï¼Œåˆ™è¿”å› false</td></tr></tbody></table><h1 id="ã€7-11ã€‘æŒ‰é¡ºåºé€‰æ‹©èŠ‚ç‚¹"><a href="#ã€7-11ã€‘æŒ‰é¡ºåºé€‰æ‹©èŠ‚ç‚¹" class="headerlink" title="ã€7.11ã€‘æŒ‰é¡ºåºé€‰æ‹©èŠ‚ç‚¹"></a><font color="#ff0000">ã€7.11ã€‘æŒ‰é¡ºåºé€‰æ‹©èŠ‚ç‚¹</font></h1><p>æŸäº›å±æ€§å¯èƒ½åŒæ—¶åŒ¹é…äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœè¦é€‰æ‹©å…¶ä¸­å‡ ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥åˆ©ç”¨ä¸­æ‹¬å·ä¼ å…¥ç´¢å¼•çš„æ–¹æ³•è·å–ç‰¹å®šæ¬¡åºçš„èŠ‚ç‚¹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[last()]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[position()&lt;3]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[last()-2]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><ul><li>li[1]ï¼šé€‰å–ç¬¬ä¸€ä¸ª li èŠ‚ç‚¹ï¼›</li><li>li[last()]ï¼šé€‰å–æœ€åä¸€ä¸ª li èŠ‚ç‚¹ï¼›</li><li>position()&lt;3ï¼šé€‰å–ä½ç½®å°äº 3 çš„ li èŠ‚ç‚¹ï¼›</li><li>li[last()-2]ï¼šé€‰å–å€’æ•°ç¬¬ä¸‰ä¸ª li èŠ‚ç‚¹</li></ul><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'first item'</span>]</span><br><span class="line">[<span class="string">'fifth item'</span>]</span><br><span class="line">[<span class="string">'first item'</span>, <span class="string">'second item'</span>]</span><br><span class="line">[<span class="string">'third item'</span>]</span><br></pre></td></tr></table></figure></p><h1 id="ã€7-12ã€‘èŠ‚ç‚¹è½´é€‰æ‹©"><a href="#ã€7-12ã€‘èŠ‚ç‚¹è½´é€‰æ‹©" class="headerlink" title="ã€7.12ã€‘èŠ‚ç‚¹è½´é€‰æ‹©"></a><font color="#ff0000">ã€7.12ã€‘èŠ‚ç‚¹è½´é€‰æ‹©</font></h1><p>èŠ‚ç‚¹è½´é€‰æ‹©ï¼šè·å–å­å…ƒç´ ã€å…„å¼Ÿå…ƒç´ ã€çˆ¶å…ƒç´ ã€ç¥–å…ˆå…ƒç´ ç­‰<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;&lt;span&gt;first item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-1"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;</span></span><br><span class="line"><span class="string">     &lt;/ul&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/ancestor::*'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/ancestor::div'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/attribute::*'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/child::a[@href="link1.html"]'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/descendant::span'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/following::*[2]'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/following-sibling::*'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[&lt;Element html at <span class="number">0x1d3749e9548</span>&gt;, &lt;Element body at <span class="number">0x1d3749e94c8</span>&gt;, &lt;Element div at <span class="number">0x1d3749e9488</span>&gt;, &lt;Element ul at <span class="number">0x1d3749e9588</span>&gt;]</span><br><span class="line">[&lt;Element div at <span class="number">0x1d3749e9488</span>&gt;]</span><br><span class="line">[<span class="string">'item-0'</span>]</span><br><span class="line">[&lt;Element a at <span class="number">0x1d3749e9588</span>&gt;]</span><br><span class="line">[&lt;Element span at <span class="number">0x1d3749e9488</span>&gt;]</span><br><span class="line">[&lt;Element a at <span class="number">0x1d3749e9588</span>&gt;]</span><br><span class="line">[&lt;Element li at <span class="number">0x1d3749e94c8</span>&gt;, &lt;Element li at <span class="number">0x1d3749e95c8</span>&gt;, &lt;Element li at <span class="number">0x1d3749e9608</span>&gt;, &lt;Element li at <span class="number">0x1d3749e9648</span>&gt;]</span><br></pre></td></tr></table></figure></p><p>åŸºæœ¬è¯­æ³•ï¼šè½´åç§°::èŠ‚ç‚¹æµ‹è¯•[è°“è¯­]</p><p>è½´åç§°å¯¹åº”çš„ç»“æœï¼š</p><table><thead><tr><th>è½´åç§°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>ancestor</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å…ˆè¾ˆï¼ˆçˆ¶ã€ç¥–çˆ¶ç­‰ï¼‰</td></tr><tr><td>ancestor-or-self</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å…ˆè¾ˆï¼ˆçˆ¶ã€ç¥–çˆ¶ç­‰ï¼‰ä»¥åŠå½“å‰èŠ‚ç‚¹æœ¬èº«</td></tr><tr><td>attribute</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§</td></tr><tr><td>child</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­å…ƒç´ </td></tr><tr><td>descendant</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰åä»£å…ƒç´ ï¼ˆå­ã€å­™ç­‰ï¼‰</td></tr><tr><td>descendant-or-self</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰åä»£å…ƒç´ ï¼ˆå­ã€å­™ç­‰ï¼‰ä»¥åŠå½“å‰èŠ‚ç‚¹æœ¬èº«</td></tr><tr><td>following</td><td>é€‰å–æ–‡æ¡£ä¸­å½“å‰èŠ‚ç‚¹çš„ç»“æŸæ ‡ç­¾ä¹‹åçš„æ‰€æœ‰èŠ‚ç‚¹</td></tr><tr><td>namespace</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å‘½åç©ºé—´èŠ‚ç‚¹</td></tr><tr><td>parent</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td></tr><tr><td>preceding</td><td>é€‰å–æ–‡æ¡£ä¸­å½“å‰èŠ‚ç‚¹çš„å¼€å§‹æ ‡ç­¾ä¹‹å‰çš„æ‰€æœ‰èŠ‚ç‚¹</td></tr><tr><td>preceding-sibling</td><td>é€‰å–å½“å‰èŠ‚ç‚¹ä¹‹å‰çš„æ‰€æœ‰åŒçº§èŠ‚ç‚¹</td></tr><tr><td>self</td><td>é€‰å–å½“å‰èŠ‚ç‚¹</td></tr></tbody></table><p>å®ä¾‹ï¼š</p><table><thead><tr><th>ä¾‹å­</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>child::book</td><td>é€‰å–æ‰€æœ‰å±äºå½“å‰èŠ‚ç‚¹çš„å­å…ƒç´ çš„ book èŠ‚ç‚¹</td></tr><tr><td>attribute::lang</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„ lang å±æ€§</td></tr><tr><td>child::*</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­å…ƒç´ </td></tr><tr><td>attribute::*</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§</td></tr><tr><td>child::text()</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰æ–‡æœ¬å­èŠ‚ç‚¹</td></tr><tr><td>child::node()</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td></tr><tr><td>descendant::book</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ book åä»£</td></tr><tr><td>ancestor::book</td><td>é€‰æ‹©å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ book å…ˆè¾ˆ</td></tr><tr><td>ancestor-or-self::book</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ book å…ˆè¾ˆä»¥åŠå½“å‰èŠ‚ç‚¹ï¼ˆå¦‚æœæ­¤èŠ‚ç‚¹æ˜¯ book èŠ‚ç‚¹ï¼‰</td></tr><tr><td>child::*/child::price</td><td>é€‰å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰ price å­™èŠ‚ç‚¹</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬ä¸ƒç«  â€”â€” ã€è§£æåº“ lxmlã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="lxml" scheme="https://www.itrhx.com/tags/lxml/"/>
    
      <category term="XPath" scheme="https://www.itrhx.com/tags/XPath/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C06</title>
    <link href="https://www.itrhx.com/2019/08/24/A36-Python3-spider-C06/"/>
    <id>https://www.itrhx.com/2019/08/24/A36-Python3-spider-C06/</id>
    <published>2019-08-24T10:37:05.278Z</published>
    <updated>2019-09-24T12:40:18.770Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬å…­ç«  â€”â€” ã€æ­£åˆ™è¡¨è¾¾å¼ã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€6-1ã€‘å…³äºæ­£åˆ™è¡¨è¾¾å¼"><a href="#ã€6-1ã€‘å…³äºæ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ã€6.1ã€‘å…³äºæ­£åˆ™è¡¨è¾¾å¼"></a><font color="#ff0000">ã€6.1ã€‘å…³äºæ­£åˆ™è¡¨è¾¾å¼</font></h1><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¯¹å­—ç¬¦ä¸²æ“ä½œçš„ä¸€ç§é€»è¾‘å…¬å¼ï¼Œç”¨å®šä¹‰å¥½çš„ç‰¹å®šå­—ç¬¦å’Œè¿™äº›ç‰¹å®šå­—ç¬¦çš„ç»„åˆç»„æˆä¸€ä¸ªè§„åˆ™å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªè§„åˆ™å­—ç¬¦ä¸²åŸæ¥è¡¨è¾¾å¯¹å­—ç¬¦ä¸²çš„ä¸€ç§è¿‡æ»¤é€»è¾‘ï¼Œä»è€Œå®ç°å­—ç¬¦ä¸²çš„æ£€ç´¢ã€æ›¿æ¢ã€åŒ¹é…éªŒè¯ç­‰ã€‚Python çš„ re åº“æä¾›äº†æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„å®ç°ï¼ŒåŒ…å«äº”ç§æ–¹æ³•ï¼š<font color="#ff0000">matchã€searchã€findallã€subã€compile</font><br>å¸¸ç”¨çš„åŒ¹é…è§„åˆ™ï¼š</p><table><thead><tr><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>\w</td><td>åŒ¹é…å­—æ¯ã€æ•°å­—åŠä¸‹åˆ’çº¿</td></tr><tr><td>\W</td><td>åŒ¹é…ä¸æ˜¯å­—æ¯ã€æ•°å­—åŠä¸‹åˆ’çº¿çš„å­—ç¬¦</td></tr><tr><td>\s</td><td>åŒ¹é…ä»»æ„ç©ºç™½å­—ç¬¦ï¼Œç­‰ä»·äº [\t\n\r\f]</td></tr><tr><td>\S</td><td>åŒ¹é…ä»»æ„éç©ºå­—ç¬¦</td></tr><tr><td>\d</td><td>åŒ¹é…ä»»æ„æ•°å­—ï¼Œç­‰ä»·äº [0-9]</td></tr><tr><td>\D</td><td>åŒ¹é…ä»»æ„éæ•°å­—çš„å­—ç¬¦</td></tr><tr><td>\A</td><td>åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´</td></tr><tr><td>\z</td><td>åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ï¼Œå¦‚æœå­˜åœ¨æ¢è¡Œï¼ŒåŒæ—¶è¿˜ä¼šåŒ¹é…æ¢è¡Œç¬¦</td></tr><tr><td>\Z</td><td>åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ï¼Œå¦‚æœå­˜åœ¨æ¢è¡Œï¼ŒåªåŒ¹é…åˆ°æ¢è¡Œå‰çš„ç»“æŸå­—ç¬¦ä¸²</td></tr><tr><td>\G</td><td>åŒ¹é…æœ€ååŒ¹é…å®Œæˆçš„ä½ç½®</td></tr><tr><td>\n</td><td>åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦</td></tr><tr><td>\t</td><td>åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦</td></tr><tr><td>^</td><td>åŒ¹é…ä¸€è¡Œå­—ç¬¦ä¸²çš„å¼€å¤´</td></tr><tr><td>$</td><td>åŒ¹é…ä¸€è¡Œå­—ç¬¦ä¸²çš„ç»“å°¾</td></tr><tr><td>.</td><td>åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œé™¤äº†æ¢è¡Œç¬¦ï¼Œå½“ re.DOTALL æ ‡è®°è¢«æŒ‡å®šæ—¶ï¼Œåˆ™å¯ä»¥åŒ¹é…åŒ…æ‹¬æ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦</td></tr><tr><td>[â€¦]</td><td>ç”¨æ¥è¡¨ç¤ºä¸€ç»„å­—ç¬¦ï¼Œå•ç‹¬åˆ—å‡ºï¼Œæ¯”å¦‚ [amk] åŒ¹é… aã€m æˆ– k</td></tr><tr><td>[^â€¦]</td><td>ä¸åœ¨ [] ä¸­çš„å­—ç¬¦ï¼Œæ¯”å¦‚  åŒ¹é…é™¤äº† aã€bã€c ä¹‹å¤–çš„å­—ç¬¦</td></tr><tr><td>*</td><td>åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼</td></tr><tr><td>+</td><td>åŒ¹é… 1 ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼</td></tr><tr><td>?</td><td>åŒ¹é… 0 ä¸ªæˆ– 1 ä¸ªå‰é¢çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„ç‰‡æ®µï¼Œéè´ªå©ªæ–¹å¼</td></tr><tr><td>{n}</td><td>ç²¾ç¡®åŒ¹é… n ä¸ªå‰é¢çš„è¡¨è¾¾å¼</td></tr><tr><td>{n, m}</td><td>åŒ¹é… n åˆ° m æ¬¡ç”±å‰é¢æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çš„ç‰‡æ®µï¼Œè´ªå©ªæ–¹å¼</td></tr><tr><td>a\</td><td>b</td><td>åŒ¹é… a æˆ– b</td></tr><tr><td>( )</td><td>åŒ¹é…æ‹¬å·å†…çš„è¡¨è¾¾å¼ï¼Œä¹Ÿè¡¨ç¤ºä¸€ä¸ªç»„</td></tr></tbody></table><h1 id="ã€6-2ã€‘re-match-æ–¹æ³•"><a href="#ã€6-2ã€‘re-match-æ–¹æ³•" class="headerlink" title="ã€6.2ã€‘re.match æ–¹æ³•"></a><font color="#ff0000">ã€6.2ã€‘re.match æ–¹æ³•</font></h1><p>match() æ–¹æ³•ä¼šå°è¯•ä»å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚æœåŒ¹é…ï¼Œå°±è¿”å›åŒ¹é…æˆåŠŸçš„ç»“æœï¼›å¦‚æœä¸åŒ¹é…ï¼Œå°±è¿”å› Noneï¼Œåœ¨ match() æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥è¦åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'This is a Demo_123 4567_I Love China'</span></span><br><span class="line">print(len(content))</span><br><span class="line">result = re.match(<span class="string">'^This\s\w\w\s\w\s\w&#123;5&#125;\d&#123;3&#125;\s\w&#123;6&#125;'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">36</span></span><br><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">25</span>), match=<span class="string">'This is a Demo_123 4567_I'</span>&gt;</span><br><span class="line">This <span class="keyword">is</span> a Demo_123 <span class="number">4567</span>_I</span><br><span class="line">(<span class="number">0</span>, <span class="number">25</span>)</span><br></pre></td></tr></table></figure></p><p>æ‰“å° result ç»“æœæ˜¯ SRE_Match å¯¹è±¡ï¼Œè¡¨æ˜åŒ¹é…æˆåŠŸã€‚SRE_Match å¯¹è±¡æœ‰ä¸¤ç§æ–¹æ³•ï¼š<font color="#ff0000">group()</font> æ–¹æ³•å¯ä»¥è¾“å‡ºåŒ¹é…åˆ°çš„å†…å®¹ï¼›<font color="#ff0000">span()</font> æ–¹æ³•å¯ä»¥è¾“å‡ºåŒ¹é…çš„èŒƒå›´ã€‚</p><h2 id="ã€6-2-1ã€‘æå–å†…å®¹"><a href="#ã€6-2-1ã€‘æå–å†…å®¹" class="headerlink" title="ã€6.2.1ã€‘æå–å†…å®¹"></a><font color="#ff0000">ã€6.2.1ã€‘æå–å†…å®¹</font></h2><p>ä½¿ç”¨æ‹¬å·å°†æƒ³æå–çš„å­å­—ç¬¦ä¸²æ‹¬èµ·æ¥ã€‚æ‹¬å·å®é™…ä¸Šæ ‡è®°äº†ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œè¢«æ ‡è®°çš„æ¯ä¸ªå­è¡¨è¾¾å¼ä¼šä¾æ¬¡å¯¹åº”æ¯ä¸€ä¸ªåˆ†ç»„ï¼Œè°ƒç”¨ <font color="#ff0000">group()</font> æ–¹æ³•ä¼ å…¥åˆ†ç»„çš„ç´¢å¼•å³å¯è·å–æå–çš„ç»“æœã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'This is a Demo_123 4567_I Love China'</span></span><br><span class="line">result = re.match(<span class="string">'^This\s\w\w\s\w\s(\w&#123;5&#125;)\d&#123;3&#125;\s\w&#123;6&#125;'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">25</span>), match=<span class="string">'This is a Demo_123 4567_I'</span>&gt;</span><br><span class="line">This <span class="keyword">is</span> a Demo_123 <span class="number">4567</span>_I</span><br><span class="line">Demo_</span><br><span class="line">(<span class="number">0</span>, <span class="number">25</span>)</span><br></pre></td></tr></table></figure></p><h2 id="ã€6-2-2ã€‘é€šç”¨åŒ¹é…"><a href="#ã€6-2-2ã€‘é€šç”¨åŒ¹é…" class="headerlink" title="ã€6.2.2ã€‘é€šç”¨åŒ¹é…"></a><font color="#ff0000">ã€6.2.2ã€‘é€šç”¨åŒ¹é…</font></h2><p>å¦‚æœæ¯ä¸ªå­—ç¬¦éƒ½ç”¨éƒ½ç”¨ä¸€ä¸ªç¬¦å·æ¥åŒ¹é…çš„è¯å°±æ˜¾å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ç”¨ <code>.*</code>æ¥åŒ¹é…ï¼Œ<code>.</code> å¯ä»¥åŒ¹é…é™¤æ¢è¡Œç¬¦å¤–çš„ä»»æ„å­—ç¬¦ï¼Œ<code>*</code> ä»£è¡¨åŒ¹é…å‰é¢çš„å­—ç¬¦æ— é™æ¬¡ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'This is a Demo_123 4567_I Love China'</span></span><br><span class="line">result = re.match(<span class="string">'^This.*China$'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">36</span>), match=<span class="string">'This is a Demo_123 4567_I Love China'</span>&gt;</span><br><span class="line">This <span class="keyword">is</span> a Demo_123 <span class="number">4567</span>_I Love China</span><br><span class="line">(<span class="number">0</span>, <span class="number">36</span>)</span><br></pre></td></tr></table></figure></p><h2 id="ã€6-2-3ã€‘è´ªå©ªåŒ¹é…"><a href="#ã€6-2-3ã€‘è´ªå©ªåŒ¹é…" class="headerlink" title="ã€6.2.3ã€‘è´ªå©ªåŒ¹é…"></a><font color="#ff0000">ã€6.2.3ã€‘è´ªå©ªåŒ¹é…</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'This is a Demo_1234567_I Love China'</span></span><br><span class="line">result = re.match(<span class="string">'^This.*(\d+).*China$'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">35</span>), match=<span class="string">'This is a Demo_1234567_I Love China'</span>&gt;</span><br><span class="line">This <span class="keyword">is</span> a Demo_1234567_I Love China</span><br><span class="line"><span class="number">7</span></span><br><span class="line">(<span class="number">0</span>, <span class="number">35</span>)</span><br></pre></td></tr></table></figure></p><font color="#ff0000"><code>.*</code> ä¸ºè´ªå©ªåŒ¹é…ï¼Œä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ï¼Œæ‰€ä»¥ \d+ åªä¼šåŒ¹é…åˆ°æœ€åä¸€ä¸ªæ•°å­—ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„æ•°å­—</font><h2 id="ã€6-2-4ã€‘éè´ªå©ªåŒ¹é…"><a href="#ã€6-2-4ã€‘éè´ªå©ªåŒ¹é…" class="headerlink" title="ã€6.2.4ã€‘éè´ªå©ªåŒ¹é…"></a><font color="#ff0000">ã€6.2.4ã€‘éè´ªå©ªåŒ¹é…</font></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'This is a Demo_1234567_I Love China'</span></span><br><span class="line">result = re.match(<span class="string">'^This.*?(\d+).*China$'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">35</span>), match=<span class="string">'This is a Demo_1234567_I Love China'</span>&gt;</span><br><span class="line">This <span class="keyword">is</span> a Demo_1234567_I Love China</span><br><span class="line"><span class="number">1234567</span></span><br><span class="line">(<span class="number">0</span>, <span class="number">35</span>)</span><br></pre></td></tr></table></figure></p><font color="#ff0000"><code>.*?</code> ä¸ºéè´ªå©ªåŒ¹é…ï¼Œä¼šåŒ¹é…å°½å¯èƒ½å°‘çš„å­—ç¬¦ï¼Œæ‰€ä»¥ \d+ ä¼šåŒ¹é…åˆ°æ‰€æœ‰çš„æ•°å­—</font><h2 id="ã€6-2-5ã€‘è½¬ä¹‰åŒ¹é…"><a href="#ã€6-2-5ã€‘è½¬ä¹‰åŒ¹é…" class="headerlink" title="ã€6.2.5ã€‘è½¬ä¹‰åŒ¹é…"></a><font color="#ff0000">ã€6.2.5ã€‘è½¬ä¹‰åŒ¹é…</font></h2><p>å½“é‡åˆ°ç”¨äºæ­£åˆ™åŒ¹é…æ¨¡å¼çš„ç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œåœ¨å‰é¢åŠ åæ–œçº¿è½¬ä¹‰ä¸€ä¸‹å³å¯ã€‚ä¾‹å¦‚ <code>.</code> å¯ä»¥ç”¨ <code>\.</code> æ¥åŒ¹é…ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'(åšå®¢)www.itrhx.com'</span></span><br><span class="line">result = re.match(<span class="string">'\(åšå®¢\)www\.itrhx\.com'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">17</span>), match=<span class="string">'(åšå®¢)www.itrhx.com'</span>&gt;</span><br><span class="line">(åšå®¢)www.itrhx.com</span><br></pre></td></tr></table></figure></p><h2 id="ã€6-2-6ã€‘ä¿®é¥°ç¬¦"><a href="#ã€6-2-6ã€‘ä¿®é¥°ç¬¦" class="headerlink" title="ã€6.2.6ã€‘ä¿®é¥°ç¬¦"></a><font color="#ff0000">ã€6.2.6ã€‘ä¿®é¥°ç¬¦</font></h2><p>ä¿®é¥°ç¬¦ç”¨æ¥è§£å†³æ¢è¡Œã€å¤§å°å†™ç­‰é—®é¢˜ï¼Œè¾ƒä¸ºå¸¸ç”¨çš„æœ‰ re.S å’Œ re.Iã€‚</p><table><thead><tr><th style="text-align:center">ä¿®é¥°ç¬¦</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">re.S</td><td style="text-align:center">ä½¿ <code>.</code> åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td style="text-align:center">re.I</td><td style="text-align:center">ä½¿åŒ¹é…å¯¹å¤§å°å†™ä¸æ•æ„Ÿ</td></tr><tr><td style="text-align:center">re.L</td><td style="text-align:center">åšæœ¬åœ°åŒ–è¯†åˆ«ï¼ˆlocale-awareï¼‰åŒ¹é…</td></tr><tr><td style="text-align:center">re.M</td><td style="text-align:center">å¤šè¡ŒåŒ¹é…ï¼Œå½±å“ <code>^</code> å’Œ <code>$</code></td></tr><tr><td style="text-align:center">re.U</td><td style="text-align:center">æ ¹æ® Unicode å­—ç¬¦é›†è§£æå­—ç¬¦ã€‚è¿™ä¸ªæ ‡å¿—å½±å“ <code>\w</code>ã€<code>\W</code>ã€<code>\b</code> å’Œ <code>\B</code></td></tr><tr><td style="text-align:center">re.X</td><td style="text-align:center">è¯¥æ ‡å¿—é€šè¿‡ç»™äºˆä½ æ›´çµæ´»çš„æ ¼å¼ä»¥ä¾¿ä½ å°†æ­£åˆ™è¡¨è¾¾å¼å†™å¾—æ›´æ˜“äºç†è§£</td></tr></tbody></table><p>ç¤ºä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''This is a Demo_1234567</span></span><br><span class="line"><span class="string">          _I Love China'''</span></span><br><span class="line">result = re.match(<span class="string">'^This.*?(\d+).*China$'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p><p>ç¤ºä¾‹ä¸­ content å­—æ®µè¿›è¡Œäº†æ¢è¡Œå¤„ç†ï¼Œå¦‚æœæ²¡æœ‰ä¿®é¥°ç¬¦ï¼Œå°±ä¼šæŠ¥é”™ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line"><span class="keyword">None</span></span><br><span class="line">  File <span class="string">"F:/PycharmProjects/Python3çˆ¬è™«/test.py"</span>, line <span class="number">7</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(result.group())</span><br><span class="line">AttributeError: <span class="string">'NoneType'</span> object has no attribute <span class="string">'group'</span></span><br></pre></td></tr></table></figure></p><p>æ·»åŠ  re.S ä¿®é¥°ç¬¦åå³å¯åŒ¹é…æˆåŠŸï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''This is a Demo_1234567</span></span><br><span class="line"><span class="string">          _I Love China'''</span></span><br><span class="line">result = re.match(<span class="string">'^This.*?(\d+).*China$'</span>, content, re.S)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">0</span>, <span class="number">46</span>), match=<span class="string">'This is a Demo_1234567\n          _I Love China'</span>&gt;</span><br><span class="line">This <span class="keyword">is</span> a Demo_1234567</span><br><span class="line">          _I Love China</span><br><span class="line"><span class="number">1234567</span></span><br><span class="line">(<span class="number">0</span>, <span class="number">46</span>)</span><br></pre></td></tr></table></figure></p><h1 id="ã€6-3ã€‘re-search-æ–¹æ³•"><a href="#ã€6-3ã€‘re-search-æ–¹æ³•" class="headerlink" title="ã€6.3ã€‘re.search æ–¹æ³•"></a><font color="#ff0000">ã€6.3ã€‘re.search æ–¹æ³•</font></h1><p>match() æ–¹æ³•åªèƒ½ä»å­—ç¬¦ä¸²çš„å¼€å¤´å¼€å§‹åŒ¹é…ï¼Œä¸€æ—¦å¼€å¤´ä¸åŒ¹é…ï¼Œé‚£ä¹ˆæ•´ä¸ªåŒ¹é…å°±å¤±è´¥äº†ï¼Œmatch() æ–¹æ³•æ›´é€‚åˆç”¨æ¥æ£€æµ‹æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæŸä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™ï¼Œè€Œ search() æ–¹æ³•åˆ™ä¼šæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²å¹¶è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„åŒ¹é…<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'This is a Demo_1234567_I Love China'</span></span><br><span class="line">result = re.search(<span class="string">'a.*?(\d&#123;5&#125;)'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;_sre.SRE_Match object; span=(<span class="number">8</span>, <span class="number">20</span>), match=<span class="string">'a Demo_12345'</span>&gt;</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></figure></p><h1 id="ã€6-4ã€‘re-findall-æ–¹æ³•"><a href="#ã€6-4ã€‘re-findall-æ–¹æ³•" class="headerlink" title="ã€6.4ã€‘re.findall æ–¹æ³•"></a><font color="#ff0000">ã€6.4ã€‘re.findall æ–¹æ³•</font></h1><p>search() æ–¹æ³•åˆ™ä¼šæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯ç¬¬ä¸€ä¸ªæˆåŠŸçš„åŒ¹é…ï¼Œè€Œ findall() æ–¹æ³•å°†ä¼šè¿”å›æ‰€æœ‰æˆåŠŸçš„åŒ¹é…<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">        &lt;h2 class="title"&gt; æ°‘è°£ &lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        æ°‘è°£æ­Œæ›²åˆ—è¡¨</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt; ä¸ƒé‡Œé¦™ &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">        &lt;a href="/2.mp3" singer="èµµé›·"&gt; ç†æƒ³ &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">        &lt;a href="/3.mp3" singer="è®¸å·"&gt; åƒé£ä¸€æ ·è‡ªç”± &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="å®‰ä¸éª‘å…µ"&gt; çº¢å±±æœ &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="è–›ä¹‹è°¦"&gt; æ„å¤– &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">        &lt;a href="/6.mp3" singer="é©¬é ”"&gt; ä½†å—å±±å— &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;'''</span></span><br><span class="line">results = re.findall(<span class="string">'&lt;li.*?href="(.*?)".*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>, html, re.S)</span><br><span class="line">print(results)</span><br><span class="line">print(type(results))</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result)</span><br><span class="line">    print(result[<span class="number">0</span>], result[<span class="number">1</span>], result[<span class="number">2</span>])</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[(<span class="string">'/2.mp3'</span>, <span class="string">'èµµé›·'</span>, <span class="string">' ç†æƒ³ '</span>), (<span class="string">'/3.mp3'</span>, <span class="string">'è®¸å·'</span>, <span class="string">' åƒé£ä¸€æ ·è‡ªç”± '</span>), (<span class="string">'/4.mp3'</span>, <span class="string">'å®‰ä¸éª‘å…µ'</span>, <span class="string">' çº¢å±±æœ '</span>), (<span class="string">'/5.mp3'</span>, <span class="string">'è–›ä¹‹è°¦'</span>, <span class="string">' æ„å¤– '</span>), (<span class="string">'/6.mp3'</span>, <span class="string">'é©¬é ”'</span>, <span class="string">' ä½†å—å±±å— '</span>)]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'/2.mp3'</span>, <span class="string">'èµµé›·'</span>, <span class="string">' ç†æƒ³ '</span>)</span></span></span><br><span class="line"><span class="class">/2.<span class="title">mp3</span> èµµé›·  ç†æƒ³ </span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'/3.mp3'</span>, <span class="string">'è®¸å·'</span>, <span class="string">' åƒé£ä¸€æ ·è‡ªç”± '</span>)</span></span></span><br><span class="line"><span class="class">/3.<span class="title">mp3</span> è®¸å·  åƒé£ä¸€æ ·è‡ªç”± </span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'/4.mp3'</span>, <span class="string">'å®‰ä¸éª‘å…µ'</span>, <span class="string">' çº¢å±±æœ '</span>)</span></span></span><br><span class="line"><span class="class">/4.<span class="title">mp3</span> å®‰ä¸éª‘å…µ  çº¢å±±æœ </span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'/5.mp3'</span>, <span class="string">'è–›ä¹‹è°¦'</span>, <span class="string">' æ„å¤– '</span>)</span></span></span><br><span class="line"><span class="class">/5.<span class="title">mp3</span> è–›ä¹‹è°¦  æ„å¤– </span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'/6.mp3'</span>, <span class="string">'é©¬é ”'</span>, <span class="string">' ä½†å—å±±å— '</span>)</span></span></span><br><span class="line"><span class="class">/6.<span class="title">mp3</span> é©¬é ”  ä½†å—å±±å—</span></span><br></pre></td></tr></table></figure></p><h1 id="ã€6-5ã€‘re-sub-æ–¹æ³•"><a href="#ã€6-5ã€‘re-sub-æ–¹æ³•" class="headerlink" title="ã€6.5ã€‘re.sub æ–¹æ³•"></a><font color="#ff0000">ã€6.5ã€‘re.sub æ–¹æ³•</font></h1><p>ä¸å­—ç¬¦ä¸²çš„ replace() æ–¹æ³•ç±»ä¼¼ï¼Œsub() æ–¹æ³•å¯ä»¥å¯¹æ–‡æœ¬è¿›è¡Œä¿®æ”¹ï¼Œsub() æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåŒ¹é…å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ›¿æ¢æˆçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœè¦å»æ‰åŒ¹é…å¯¹è±¡çš„è¯ï¼Œå¯ä»¥èµ‹å€¼ä¸ºç©ºï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºåŸæ¥çš„å­—ç¬¦ä¸²<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'87dsf4as2w4jh1k4kdl4'</span></span><br><span class="line">result = re.sub(<span class="string">'\d+'</span>, <span class="string">''</span>, content)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure></p><p>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsfaswjhkkdl</span><br></pre></td></tr></table></figure></p><h1 id="ã€6-5ã€‘re-compile-æ–¹æ³•"><a href="#ã€6-5ã€‘re-compile-æ–¹æ³•" class="headerlink" title="ã€6.5ã€‘re.compile() æ–¹æ³•"></a><font color="#ff0000">ã€6.5ã€‘re.compile() æ–¹æ³•</font></h1><p>compile() æ–¹æ³•å¯ä»¥å°†æ­£åˆ™å­—ç¬¦ä¸²ç¼–è¯‘æˆæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨åé¢çš„åŒ¹é…ä¸­å¤ç”¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content1 = <span class="string">'åŒ—äº¬æ—¶é—´ï¼š2019-08-24 18:30'</span></span><br><span class="line">content2 = <span class="string">'ä¼¦æ•¦æ—¶é—´ï¼š2019-08-24 11:30'</span></span><br><span class="line">content3 = <span class="string">'å·´é»æ—¶é—´ï¼š2019-08-24 12:30'</span></span><br><span class="line">content4 = <span class="string">'å¤–æ˜Ÿæ—¶é—´ï¼š9019-99-66 50:30'</span></span><br><span class="line">pattern = re.compile(<span class="string">'\d&#123;2&#125;:\d&#123;2&#125;'</span>)</span><br><span class="line">result1 = re.sub(pattern, <span class="string">''</span>, content1)</span><br><span class="line">result2 = re.sub(pattern, <span class="string">''</span>, content2)</span><br><span class="line">result3 = re.sub(pattern, <span class="string">''</span>, content3)</span><br><span class="line">result4 = re.sub(pattern, <span class="string">''</span>, content4)</span><br><span class="line">print(result1, result2, result3, result4)</span><br></pre></td></tr></table></figure></p><p>åˆ©ç”¨ compile() æ–¹æ³•å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œä»¥ä¾¿å¤ç”¨ï¼Œç„¶åç”¨ sub() æ–¹æ³•å»æ‰å…·ä½“æ—¶é—´<br>è¾“å‡ºç»“æœï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åŒ—äº¬æ—¶é—´ï¼š<span class="number">2019</span><span class="number">-08</span><span class="number">-24</span>  ä¼¦æ•¦æ—¶é—´ï¼š<span class="number">2019</span><span class="number">-08</span><span class="number">-24</span>  å·´é»æ—¶é—´ï¼š<span class="number">2019</span><span class="number">-08</span><span class="number">-24</span>  å¤–æ˜Ÿæ—¶é—´ï¼š<span class="number">9019</span><span class="number">-99</span><span class="number">-66</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬å…­ç«  â€”â€” ã€æ­£åˆ™è¡¨è¾¾å¼ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="https://www.itrhx.com/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Python3 çˆ¬è™«å­¦ä¹ ç¬”è®° C05</title>
    <link href="https://www.itrhx.com/2019/08/23/A35-Python3-spider-C05/"/>
    <id>https://www.itrhx.com/2019/08/23/A35-Python3-spider-C05/</id>
    <published>2019-08-23T12:13:55.085Z</published>
    <updated>2019-09-24T12:40:15.920Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><center><font color="#1BC3FB" size="4">Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬äº”ç«  â€”â€” ã€Selenium + æ— ç•Œé¢æµè§ˆå™¨ã€‘</font></center></blockquote><a id="more"></a><h1 id="ã€5-1ã€‘å…³äºæ— ç•Œé¢æµè§ˆå™¨"><a href="#ã€5-1ã€‘å…³äºæ— ç•Œé¢æµè§ˆå™¨" class="headerlink" title="ã€5.1ã€‘å…³äºæ— ç•Œé¢æµè§ˆå™¨"></a><font color="#ff0000">ã€5.1ã€‘å…³äºæ— ç•Œé¢æµè§ˆå™¨</font></h1><p>æ— ç•Œé¢ï¼ˆheadlessï¼‰æµè§ˆå™¨ï¼Œä¼šæŠŠç½‘ç«™åŠ è½½åˆ°å†…å­˜å¹¶æ‰§è¡Œé¡µé¢ä¸Šçš„ JavaScriptï¼Œå› ä¸ºä¸ä¼šå±•ç¤ºå›¾å½¢ç•Œé¢ï¼Œæ‰€ä»¥è¿è¡Œèµ·æ¥æ¯”å®Œæ•´çš„æµè§ˆå™¨æ›´é«˜æ•ˆã€‚Selenium æ­é…æ— ç•Œé¢æµè§ˆå™¨ä½¿ç”¨ï¼Œè¢«ç§°ä¸ºçˆ¬è™«åˆ©å™¨ï¼Œå¸¸ç”¨çš„æ— ç•Œé¢æµè§ˆå™¨æœ‰ï¼šPhantomJSã€Headless Chromeã€Headless Firefoxï¼Œå…¶ä¸­ï¼Œ18å¹´3æœˆï¼ŒPhantomJS çš„ä½œè€…åœ¨ GitHub ä¸Šå®£å¸ƒæš‚åœå¼€å‘ PhantomJSï¼Œç°åœ¨ä½¿ç”¨ PhantomJS ä¼šå‡ºç°è­¦å‘Šï¼š<code>UserWarning: Selenium support for PhantomJS has been deprecated, please use headless versions of Chrome or Firefox instead</code>ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨è°·æ­Œæˆ–è€…ç«ç‹çš„æ— ç•Œé¢æµè§ˆå™¨</p><h1 id="ã€5-2ã€‘PhantomJS"><a href="#ã€5-2ã€‘PhantomJS" class="headerlink" title="ã€5.2ã€‘PhantomJS"></a><font color="#ff0000">ã€5.2ã€‘PhantomJS</font></h1><p>ä¸‹è½½ PhantomJSï¼š<a href="https://phantomjs.org/download.html" target="_blank" rel="noopener">https://phantomjs.org/download.html</a><br>path ä¸º PhantomJS è·¯å¾„ï¼Œå¦‚æœç³»ç»Ÿé…ç½®äº†ç¯å¢ƒå˜é‡ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨æŒ‡å®š executable_path å‚æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">path = <span class="string">r'F:\PycharmProjects\Python3çˆ¬è™«\phantomjs-2.1.1\bin\phantomjs.exe'</span></span><br><span class="line">driver = webdriver.PhantomJS(executable_path=path)</span><br><span class="line">driver.get(<span class="string">"https://www.itrhx.com"</span>)</span><br><span class="line">print(driver.page_source)</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure></p><h1 id="ã€5-3ã€‘Headless-Chrome"><a href="#ã€5-3ã€‘Headless-Chrome" class="headerlink" title="ã€5.3ã€‘Headless Chrome"></a><font color="#ff0000">ã€5.3ã€‘Headless Chrome</font></h1><p>ä¸‹è½½ Chromedriverï¼š<a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">http://chromedriver.storage.googleapis.com/index.html</a><br>éœ€è¦æœ¬åœ°æœ‰ Chrome æµè§ˆå™¨ï¼Œpath ä¸º Headless Chrome è·¯å¾„ï¼Œå¦‚æœç³»ç»Ÿé…ç½®äº†ç¯å¢ƒå˜é‡ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨æŒ‡å®š executable_path å‚æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">'--headless'</span>)</span><br><span class="line">chrome_options.add_argument(<span class="string">'--disable-gpu'</span>)</span><br><span class="line">path = <span class="string">'F:\PycharmProjects\Python3çˆ¬è™«\chromedriver.exe'</span></span><br><span class="line">driver = webdriver.Chrome(executable_path=path, chrome_options=chrome_options)</span><br><span class="line">driver.get(<span class="string">"https://www.itrhx.com"</span>)</span><br><span class="line">print(driver.page_source)</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure></p><h1 id="ã€5-4ã€‘Headless-Firefox"><a href="#ã€5-4ã€‘Headless-Firefox" class="headerlink" title="ã€5.4ã€‘Headless Firefox"></a><font color="#ff0000">ã€5.4ã€‘Headless Firefox</font></h1><p>ä¸‹è½½ geckodriverï¼š<a href="https://github.com/mozilla/geckodriver/releases/" target="_blank" rel="noopener">https://github.com/mozilla/geckodriver/releases/</a><br>éœ€è¦æœ¬åœ°æœ‰ Firefox æµè§ˆå™¨ï¼Œpath ä¸º Headless Firefox è·¯å¾„ï¼Œå¦‚æœç³»ç»Ÿé…ç½®äº†ç¯å¢ƒå˜é‡ï¼Œå°±ä¸ç”¨æ‰‹åŠ¨æŒ‡å®š executable_path å‚æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> Firefox</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.firefox.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">options = Options()</span><br><span class="line">options.add_argument(<span class="string">'-headless'</span>)</span><br><span class="line">path = <span class="string">'F:\PycharmProjects\Python3çˆ¬è™«\geckodriver.exe'</span></span><br><span class="line">driver = Firefox(executable_path=path, firefox_options=options)</span><br><span class="line">driver.get(<span class="string">"https://www.itrhx.com"</span>)</span><br><span class="line">print(driver.page_source)</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;center&gt;&lt;font color=&quot;#1BC3FB&quot; size=&quot;4&quot;&gt;Python3 çˆ¬è™«å­¦ä¹ ç¬”è®°ç¬¬äº”ç«  â€”â€” ã€Selenium + æ— ç•Œé¢æµè§ˆå™¨ã€‘&lt;/font&gt;&lt;/center&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python3 å­¦ä¹ ç¬”è®°" scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
      <category term="çˆ¬è™«å­¦ä¹ " scheme="https://www.itrhx.com/categories/Python3-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="çˆ¬è™«" scheme="https://www.itrhx.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="Selenium" scheme="https://www.itrhx.com/tags/Selenium/"/>
    
      <category term="æ— ç•Œé¢æµè§ˆå™¨" scheme="https://www.itrhx.com/tags/%E6%97%A0%E7%95%8C%E9%9D%A2%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
</feed>
